!function(De){var Fe=function v(C,x,S){function y(i,e){if(!x[i]){if(!C[i]){var t="function"==typeof require&&require;if(!e&&t)return t(i,!0);if(_)return _(i,!0);var r=new Error("Cannot find module '"+i+"'");throw r.code="MODULE_NOT_FOUND",r}var n=x[i]={exports:{}};C[i][0].call(n.exports,function(a){return y(C[i][1][a]||a)},n,n.exports,v,C,x,S)}return x[i].exports}for(var _="function"==typeof require&&require,o=0;o<S.length;o++)y(S[o]);return y}({1:[function(v,C,x){"use strict";var S=v("./util/cancelablepromise");C.exports=function y(_,o,i,e){var t,r=new Error("Canceled");return new S(function(a,s,c){var p;_(function(d){return c()?S.reject(r):(p=o(d),i(p).then(function(k){if(c())throw r;return t=k()}))}).then(function(d){if(c())throw d.disconnect(),r;a(e(p,d))}).catch(function(d){s(d)})},function(){t&&t.cancel()})}},{"./util/cancelablepromise":124}],2:[function(v,C,x){"use strict";var S=v("./webrtc").MediaStreamTrack,y=v("./webrtc/util"),_=y.guessBrowser,o=y.guessBrowserVersion,i=y.isCodecSupported,e=v("./cancelableroompromise"),t=v("./encodingparameters"),r=v("./localparticipant"),n=v("./util/insightspublisher"),a=v("./util/insightspublisher/null"),s=v("./media/track/es5"),c=s.LocalAudioTrack,p=s.LocalDataTrack,l=s.LocalVideoTrack,d=v("./networkqualityconfiguration"),h=v("./room"),k=v("./signaling/v2"),b=v("./util"),R=b.asLocalTrack,T=b.buildLogLevels,w=b.filterObject,m=b.isNonArrayObject,u=v("./util/constants"),f=u.DEFAULT_ENVIRONMENT,g=u.DEFAULT_LOG_LEVEL,P=u.DEFAULT_LOGGER_NAME,E=u.DEFAULT_REALM,O=u.DEFAULT_REGION,A=u.WS_SERVER,N=u.SDK_NAME,j=u.SDK_VERSION,M=u.typeErrors,Q=v("./util/cancelablepromise"),G=v("./util/eventobserver"),K=v("./util/log"),F=v("./util/validate").validateBandwidthProfile,V="safari"===_()&&o(),D=0,L=!1,H=!1;if(V){var J=V.major;H=J<12||12===J&&V.minor<1}var $=new Set([{didWarn:!1,shouldDelete:!0,name:"abortOnIceServersTimeout"},{didWarn:!1,shouldDelete:!0,name:"dscpTagging",newName:"enableDscp"},{didWarn:!1,shouldDelete:!0,name:"iceServersTimeout"},{didWarn:!1,shouldDelete:!1,name:"eventListener",newName:"Video.Logger"},{didWarn:!1,shouldDelete:!1,name:"logLevel",newName:"Video.Logger"}]),Z=new Set([{didWarn:!1,shouldDelete:!1,name:"maxTracks",newName:"bandwidthProfile.video.clientTrackSwitchOffControl"},{didWarn:!1,shouldDelete:!1,name:"renderDimensions",newName:"bandwidthProfile.video.contentPreferencesMode"}]);function Y(ae,re,Se){Se.forEach(function(Pe){var Ce=Pe.didWarn,Oe=Pe.name,Me=Pe.newName,Ee=Pe.shouldDelete;Oe in ae&&typeof ae[Oe]<"u"&&(Me&&Ee&&(ae[Me]=ae[Oe]),Ee&&delete ae[Oe],!Ce&&!["error","off"].includes(re.level)&&(re.warn('The ConnectOptions "'+Oe+'" is '+(Me?'deprecated and scheduled for removal. Please use "'+Me+'" instead.':"no longer applicable and will be ignored.")),Pe.didWarn=!0))})}function q(ae,re,Se,Pe,Ce,Oe){var Me=ae.createLocalParticipantSignaling(Se,Pe);return re.debug("Creating a new LocalParticipant:",Me),new Ce.LocalParticipant(Me,Oe,Ce)}function B(ae,re,Se){var Pe=new h(re,Se,ae),Ce=ae.log;return Ce.debug("Creating a new Room:",Pe),Se.on("stateChanged",function Oe(Me){"disconnected"===Me&&(Ce.info("Disconnected from Room:",Pe.toString()),Se.removeListener("stateChanged",Oe))}),Pe}function I(ae,re,Se,Pe,Ce,Oe){return re.log.debug("Creating a new RoomSignaling"),Se.connect(Oe._signaling,ae,Pe,Ce,re)}function U(ae,re){var Se=ae.log;return ae.shouldStopLocalTracks=!ae.tracks,ae.shouldStopLocalTracks?Se.info("LocalTracks were not provided, so they will be acquired automatically before connecting to the Room. LocalTracks will be released if connecting to the Room fails or if the Room is disconnected"):(Se.info("Getting LocalTracks"),Se.debug("Options:",ae)),ae.createLocalTracks(ae).then(function(Ce){var Oe=re(Ce);return Oe.catch(function(){ae.shouldStopLocalTracks&&(Se.info("The automatically acquired LocalTracks will now be stopped"),Ce.forEach(function(Ee){Ee.stop()}))}),Oe})}function ue(ae){var re="string"==typeof ae?{codec:ae}:ae;switch(re.codec.toLowerCase()){case"opus":return Object.assign({dtx:!0},re);case"vp8":return Object.assign({simulcast:!1},re);default:return re}}C.exports=function se(ae,re){if(typeof re>"u"&&(re={}),!m(re))return Q.reject(M.INVALID_TYPE("options","object"));var Ee,Se=re.Log||K,Pe=re.loggerName||P,Ce=re.logLevel||g,Oe=T(Ce),Me="[connect #"+ ++D+"]";try{Ee=new Se("default",Me,Oe,Pe)}catch(me){return Q.reject(me)}Y(re,Ee,$);var oe="auto"===re.preferredVideoCodecs;if(oe&&(re.preferredVideoCodecs=[{codec:"VP8",simulcast:!0,adaptiveSimulcast:!0}]),re.maxVideoBitrate&&oe)return Ee.error('ConnectOptions "maxVideoBitrate" is not compatible with "preferredVideoCodecs=auto"'),Q.reject(M.ILLEGAL_INVOKE("connect",'ConnectOptions "maxVideoBitrate" is not compatible with "preferredVideoCodecs=auto"'));var ne={};"string"==typeof(re=Object.assign({automaticSubscription:!0,dominantSpeaker:!1,enableDscp:!1,environment:f,eventListener:null,insights:!0,LocalAudioTrack:c,LocalDataTrack:p,LocalParticipant:r,LocalVideoTrack:l,Log:Se,MediaStreamTrack:S,loggerName:Pe,logLevel:Ce,maxAudioBitrate:null,maxVideoBitrate:null,name:null,networkMonitor:!0,networkQuality:!1,preferredAudioCodecs:[],preferredVideoCodecs:[],realm:E,region:O,signaling:k},w(re))).wsServerInsights&&(ne.gateway=re.wsServerInsights);var z=new(re.insights?n:a)(ae,N,j,re.environment,re.realm,ne),ee=A(re.environment,re.region),te=new G(z,Date.now(),Ee,re.eventListener);if((re=Object.assign({eventObserver:te,wsServer:ee},re)).log=Ee,H&&!L&&"error"!==Ee.logLevel&&"off"!==Ee.logLevel&&(L=!0,Ee.warn(["Support for Safari 12.0 and below is limited because it does not support VP8.","This means you may experience codec issues in Group Rooms. You may also","experience codec issues in Peer-to-Peer (P2P) Rooms containing Android- or","iOS-based Participants who do not support H.264. However, P2P Rooms","with browser-based Participants should work. For more information, please","refer to this guide: https://www.twilio.com/docs/video/javascript-v2-developing-safari-11"].join(" "))),"string"!=typeof ae)return Q.reject(M.INVALID_TYPE("token","string"));var ie=Object.assign({},re);if(delete ie.name,"tracks"in re){if(!Array.isArray(re.tracks))return Q.reject(M.INVALID_TYPE("options.tracks","Array of LocalAudioTrack, LocalVideoTrack or MediaStreamTrack"));try{re.tracks=re.tracks.map(function(me){return R(me,ie)})}catch(me){return Q.reject(me)}}var he=F(re.bandwidthProfile);if(he)return Q.reject(he);re.clientTrackSwitchOffControl="disabled",re.contentPreferencesMode="disabled",re.bandwidthProfile&&(re.clientTrackSwitchOffControl="auto",re.contentPreferencesMode="auto",re.bandwidthProfile.video&&(Y(re.bandwidthProfile.video,Ee,Z),re.clientTrackSwitchOffControl="maxTracks"in re.bandwidthProfile.video?"disabled":"manual"===re.bandwidthProfile.video.clientTrackSwitchOffControl?"manual":"auto",re.contentPreferencesMode="renderDimensions"in re.bandwidthProfile.video?"disabled":"manual"===re.bandwidthProfile.video.contentPreferencesMode?"manual":"auto"));var xe=new(0,re.signaling)(re.wsServer,re);Ee.info("Connecting to a Room"),Ee.debug("Options:",re);var Ae=new t({maxAudioBitrate:re.maxAudioBitrate,maxVideoBitrate:re.maxVideoBitrate},oe),Te={audio:re.preferredAudioCodecs.map(ue),video:re.preferredVideoCodecs.map(ue)},Re=new d(m(re.networkQuality)?re.networkQuality:{});["audio","video"].forEach(function(me){return Te[me].forEach(function(Ie){var je=Ie.codec;return i(je,me).then(function(Be){return!Be&&Ee.warn("The preferred "+me+' codec "'+je+'" will be ignored as it is not supported by the browser.')})})});var _e=e(U.bind(null,re),q.bind(null,xe,Ee,Ae,Re,re),I.bind(null,ae,re,xe,Ae,Te),B.bind(null,re));return _e.then(function(me){return z.connect(me.sid,me.localParticipant.sid),Ee.info("Connected to Room:",me.toString()),Ee.info("Room name:",me.name),Ee.debug("Room:",me),me.once("disconnected",function(){return z.disconnect()}),me},function(me){z.disconnect(),_e._isCanceled?Ee.info("Attempt to connect to a Room was canceled"):Ee.info("Error while connecting to a Room:",me)}),_e}},{"./cancelableroompromise":1,"./encodingparameters":9,"./localparticipant":13,"./media/track/es5":15,"./networkqualityconfiguration":44,"./room":57,"./signaling/v2":71,"./util":132,"./util/cancelablepromise":124,"./util/constants":125,"./util/eventobserver":130,"./util/insightspublisher":133,"./util/insightspublisher/null":134,"./util/log":136,"./util/validate":150,"./webrtc":158,"./webrtc/util":170}],3:[function(v,C,x){"use strict";var S=v("./util/constants"),y=S.DEFAULT_LOG_LEVEL,_=S.DEFAULT_LOGGER_NAME;function o(r,n){n=Object.assign({loggerName:_,logLevel:y},n);var a={};a.loggerName=n.loggerName,a.logLevel=n.logLevel,delete n.loggerName,delete n.logLevel;var s=n.createLocalTracks;return delete n.createLocalTracks,a[r]=!(Object.keys(n).length>0)||n,s(a).then(function(c){return c[0]})}C.exports={audio:function i(r){return o("audio",r)},video:function e(r){return o("video",r)}}},{"./util/constants":125}],4:[function(v,C,x){"use strict";var S=this&&this.__assign||function(){return S=Object.assign||function(u){for(var f,g=1,P=arguments.length;g<P;g++)for(var E in f=arguments[g])Object.prototype.hasOwnProperty.call(f,E)&&(u[E]=f[E]);return u},S.apply(this,arguments)},y=this&&this.__awaiter||function(u,f,g,P){return new(g||(g=Promise))(function(O,A){function N(Q){try{M(P.next(Q))}catch(G){A(G)}}function j(Q){try{M(P.throw(Q))}catch(G){A(G)}}function M(Q){Q.done?O(Q.value):function E(O){return O instanceof g?O:new g(function(A){A(O)})}(Q.value).then(N,j)}M((P=P.apply(u,f||[])).next())})},_=this&&this.__generator||function(u,f){var P,E,O,A,g={label:0,sent:function(){if(1&O[0])throw O[1];return O[1]},trys:[],ops:[]};return A={next:N(0),throw:N(1),return:N(2)},"function"==typeof Symbol&&(A[Symbol.iterator]=function(){return this}),A;function N(M){return function(Q){return function j(M){if(P)throw new TypeError("Generator is already executing.");for(;g;)try{if(P=1,E&&(O=2&M[0]?E.return:M[0]?E.throw||((O=E.return)&&O.call(E),0):E.next)&&!(O=O.call(E,M[1])).done)return O;switch(E=0,O&&(M=[2&M[0],O.value]),M[0]){case 0:case 1:O=M;break;case 4:return g.label++,{value:M[1],done:!1};case 5:g.label++,E=M[1],M=[0];continue;case 7:M=g.ops.pop(),g.trys.pop();continue;default:if(!(O=(O=g.trys).length>0&&O[O.length-1])&&(6===M[0]||2===M[0])){g=0;continue}if(3===M[0]&&(!O||M[1]>O[0]&&M[1]<O[3])){g.label=M[1];break}if(6===M[0]&&g.label<O[1]){g.label=O[1],O=M;break}if(O&&g.label<O[2]){g.label=O[2],g.ops.push(M);break}O[2]&&g.ops.pop(),g.trys.pop();continue}M=f.call(u,g)}catch(Q){M=[6,Q],E=0}finally{P=O=0}if(5&M[0])throw M[1];return{value:M[0]?M[1]:void 0,done:!0}}([M,Q])}}},o=this&&this.__read||function(u,f){var g="function"==typeof Symbol&&u[Symbol.iterator];if(!g)return u;var E,A,P=g.call(u),O=[];try{for(;(void 0===f||f-- >0)&&!(E=P.next()).done;)O.push(E.value)}catch(N){A={error:N}}finally{try{E&&!E.done&&(g=P.return)&&g.call(P)}finally{if(A)throw A.error}}return O},i=this&&this.__spreadArray||function(u,f){for(var g=0,P=f.length,E=u.length;g<P;g++,E++)u[E]=f[g];return u};Object.defineProperty(x,"__esModule",{value:!0}),x.createLocalTracks=void 0;var e=v("./media/track/noisecancellationimpl"),t=v("./util").buildLogLevels,r=v("./webrtc"),n=r.getUserMedia,a=r.MediaStreamTrack,s=v("./media/track/es5"),c=s.LocalAudioTrack,p=s.LocalDataTrack,l=s.LocalVideoTrack,d=v("./util/log"),h=v("./util/constants"),k=h.DEFAULT_LOG_LEVEL,b=h.DEFAULT_LOGGER_NAME,R=h.typeErrors.INVALID_VALUE,T=v("./webaudio/workaround180748"),w=0;x.createLocalTracks=function m(u){return y(this,void 0,void 0,function(){var f,g,P,E,O,A,N,j,M,Q,G,K,F,V=this;return _(this,function(D){switch(D.label){case 0:if(g=S({audio:f=!(u&&("audio"in u||"video"in u)),getUserMedia:n,loggerName:b,logLevel:k,LocalAudioTrack:c,LocalDataTrack:p,LocalVideoTrack:l,MediaStreamTrack:a,Log:d,video:f},u),P="[createLocalTracks #"+ ++w+"]",E=t(g.logLevel),O=new g.Log("default",P,E,g.loggerName),delete(A=Object.assign({log:O},g)).name,!1===g.audio&&!1===g.video)return O.info("Neither audio nor video requested, so returning empty LocalTracks"),[2,[]];if(g.tracks)return O.info("Adding user-provided LocalTracks"),O.debug("LocalTracks:",g.tracks),[2,g.tracks];if((N={audio:"object"==typeof g.audio&&g.audio.name?{name:g.audio.name}:{defaultDeviceCaptureMode:"auto"},video:"object"==typeof g.video&&g.video.name?{name:g.video.name}:{}}).audio.isCreatedByCreateLocalTracks=!0,N.video.isCreatedByCreateLocalTracks=!0,"object"==typeof g.audio)if("boolean"==typeof g.audio.workaroundWebKitBug1208516&&(N.audio.workaroundWebKitBug1208516=g.audio.workaroundWebKitBug1208516),"noiseCancellationOptions"in g.audio&&(j=g.audio.noiseCancellationOptions,delete g.audio.noiseCancellationOptions),"defaultDeviceCaptureMode"in g.audio){if(["auto","manual"].every(function(L){return L!==g.audio.defaultDeviceCaptureMode}))throw R("CreateLocalAudioTrackOptions.defaultDeviceCaptureMode",["auto","manual"]);N.audio.defaultDeviceCaptureMode=g.audio.defaultDeviceCaptureMode}else N.audio.defaultDeviceCaptureMode="auto";"object"==typeof g.video&&"boolean"==typeof g.video.workaroundWebKitBug1208516&&(N.video.workaroundWebKitBug1208516=g.video.workaroundWebKitBug1208516),"object"==typeof g.audio&&delete g.audio.name,"object"==typeof g.video&&delete g.video.name,M={audio:g.audio,video:g.video},Q="object"==typeof g.audio&&g.audio.workaroundWebKitBug180748,D.label=1;case 1:return D.trys.push([1,4,,5]),[4,Q?T(O,g.getUserMedia,M):g.getUserMedia(M)];case 2:return G=D.sent(),K=i(i([],o(G.getAudioTracks())),o(G.getVideoTracks())),O.info("Call to getUserMedia successful; got tracks:",K),[4,Promise.all(K.map(function(L){return y(V,void 0,void 0,function(){var H,X;return _(this,function($){switch($.label){case 0:return"audio"===L.kind&&j?[4,e.applyNoiseCancellation(L,j,O)]:[3,2];case 1:return H=$.sent(),X=H.noiseCancellation,[2,new A.LocalAudioTrack(H.cleanTrack,S(S(S({},N.audio),A),{noiseCancellation:X}))];case 2:if("audio"===L.kind)return[2,new A.LocalAudioTrack(L,S(S({},N.audio),A))];$.label=3;case 3:return[2,new A.LocalVideoTrack(L,S(S({},N.video),A))]}})})}))];case 3:return[2,D.sent()];case 4:throw F=D.sent(),O.warn("Call to getUserMedia failed:",F),F;case 5:return[2]}})})}},{"./media/track/es5":15,"./media/track/noisecancellationimpl":29,"./util":132,"./util/constants":125,"./util/log":136,"./webaudio/workaround180748":155,"./webrtc":158}],5:[function(v,C,x){"use strict";var i,S=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),y=v("./transceiver"),_=v("./transport"),o=function(i){function e(t){var r=i.call(this,t.label,t.maxPacketLifeTime,t.maxRetransmits,t.ordered)||this;return Object.defineProperties(r,{_dataChannel:{value:t}}),t.binaryType="arraybuffer",t.addEventListener("message",function(n){r.emit("message",n.data)}),t.addEventListener("close",function(){r.emit("close")}),r}return S(e,i),e.prototype.stop=function(){this._dataChannel.close(),i.prototype.stop.call(this)},e.prototype.toDataTransport=function(){return new _(this._dataChannel)},e}(y);C.exports=o},{"./transceiver":7,"./transport":8}],6:[function(v,C,x){"use strict";var i,S=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),y=v("./transceiver"),_=v("../util").makeUUID,o=function(i){function e(t,r,n){var a=i.call(this,_(),t,r,n)||this;return Object.defineProperties(a,{_clones:{value:new Set},_dataChannels:{value:new Set}}),a}return S(e,i),e.prototype._addClone=function(t){this._clones.add(t)},e.prototype.removeClone=function(t){this._clones.delete(t)},e.prototype.addDataChannel=function(t){return this._dataChannels.add(t),this},e.prototype.clone=function(){var t=this,r=new e(this.maxPacketLifeTime,this.maxRetransmits,this.ordered);return this._addClone(r),r.once("stopped",function(){return t.removeClone(r)}),r},e.prototype.removeDataChannel=function(t){return this._dataChannels.delete(t),this},e.prototype.send=function(t){return this._dataChannels.forEach(function(r){try{r.send(t)}catch{}}),this._clones.forEach(function(r){try{r.send(t)}catch{}}),this},e.prototype.stop=function(){this._dataChannels.forEach(function(t){return t.close()}),this._clones.forEach(function(t){return t.stop()}),i.prototype.stop.call(this)},e}(y);C.exports=o},{"../util":132,"./transceiver":7}],7:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t,r,n){var a=o.call(this,e,"data")||this;return Object.defineProperties(a,{maxPacketLifeTime:{enumerable:!0,value:t},maxRetransmits:{enumerable:!0,value:r},ordered:{enumerable:!0,value:n}}),a}return S(i,o),i}(v("../transceiver"));C.exports=_},{"../transceiver":119}],8:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e){var t=o.call(this)||this;return Object.defineProperties(t,{_dataChannel:{value:e},_messageQueue:{value:[]}}),e.addEventListener("open",function(){t._messageQueue.splice(0).forEach(function(r){return t._publish(r)})}),e.addEventListener("message",function(r){var n=r.data;try{var a=JSON.parse(n);t.emit("message",a)}catch{}}),t.publish({type:"ready"}),t}return S(i,o),i.prototype._publish=function(e){var t=JSON.stringify(e);try{this._dataChannel.send(t)}catch{}},i.prototype.publish=function(e){var t=this._dataChannel;return"closing"!==t.readyState&&"closed"!==t.readyState&&("connecting"===t.readyState?(this._messageQueue.push(e),!0):(this._publish(e),!0))},i}(v("events").EventEmitter);C.exports=_},{events:173}],9:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t){var r=o.call(this)||this;return e=Object.assign({maxAudioBitrate:null,maxVideoBitrate:null},e),Object.defineProperties(r,{maxAudioBitrate:{value:e.maxAudioBitrate,writable:!0},maxVideoBitrate:{value:e.maxVideoBitrate,writable:!0},adaptiveSimulcast:{value:t}}),r}return S(i,o),i.prototype.toJSON=function(){return{maxAudioBitrate:this.maxAudioBitrate,maxVideoBitrate:this.maxVideoBitrate}},i.prototype.update=function(e){var t=this;e=Object.assign({maxAudioBitrate:this.maxAudioBitrate,maxVideoBitrate:this.maxVideoBitrate},e),["maxAudioBitrate","maxVideoBitrate"].reduce(function(n,a){return t[a]!==e[a]&&(t[a]=e[a],n=!0),n},!1)&&this.emit("changed")},i}(v("events").EventEmitter);C.exports=_},{events:173}],10:[function(v,C,x){"use strict";var S=v("events").EventEmitter,y=v("./util").hidePrivateAndCertainPublicPropertiesInClass;C.exports=y(S,["domain"])},{"./util":132,events:173}],11:[function(v,C,x){"use strict";var S=this&&this.__read||function(i,e){var t="function"==typeof Symbol&&i[Symbol.iterator];if(!t)return i;var n,s,r=t.call(i),a=[];try{for(;(void 0===e||e-- >0)&&!(n=r.next()).done;)a.push(n.value)}catch(c){s={error:c}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(s)throw s.error}}return a},y=this&&this.__spreadArray||function(i,e){for(var t=0,r=e.length,n=i.length;t<r;t++,n++)i[n]=e[t];return i},_=v("events").EventEmitter,o=function(){function i(){Object.defineProperties(this,{_eventEmitter:{value:new _}})}return i.prototype.dispatchEvent=function(e){return this._eventEmitter.emit(e.type,e)},i.prototype.addEventListener=function(){var e;return(e=this._eventEmitter).addListener.apply(e,y([],S(arguments)))},i.prototype.removeEventListener=function(){var e;return(e=this._eventEmitter).removeListener.apply(e,y([],S(arguments)))},i}();C.exports=o},{events:173}],12:[function(v,C,x){"use strict";var S=this&&this.__assign||function(){return S=Object.assign||function(l){for(var d,h=1,k=arguments.length;h<k;h++)for(var b in d=arguments[h])Object.prototype.hasOwnProperty.call(d,b)&&(l[b]=d[b]);return l},S.apply(this,arguments)};Object.defineProperty(x,"__esModule",{value:!0});var y=v("./createlocaltracks"),_=v("./preflight/preflighttest"),o={connect:v("./connect"),createLocalAudioTrack:v("./createlocaltrack").audio,createLocalVideoTrack:v("./createlocaltrack").video,isSupported:v("./util/support")(),version:v("../package.json").version,Logger:v("./vendor/loglevel"),LocalAudioTrack:v("./media/track/es5").LocalAudioTrack,LocalDataTrack:v("./media/track/es5").LocalDataTrack,LocalVideoTrack:v("./media/track/es5").LocalVideoTrack};C.exports={connect:function i(l,d){var h=S({createLocalTracks:y.createLocalTracks},d);return o.connect(l,h)},createLocalAudioTrack:function e(l){var d=S({createLocalTracks:y.createLocalTracks},l);return o.createLocalAudioTrack(d)},createLocalVideoTrack:function t(l){var d=S({createLocalTracks:y.createLocalTracks},l);return o.createLocalVideoTrack(d)},createLocalTracks:y.createLocalTracks,runPreflight:_.runPreflight,isSupported:o.isSupported,version:o.version,Logger:o.Logger,LocalAudioTrack:o.LocalAudioTrack,LocalVideoTrack:o.LocalVideoTrack,LocalDataTrack:o.LocalDataTrack}},{"../package.json":174,"./connect":2,"./createlocaltrack":3,"./createlocaltracks":4,"./media/track/es5":15,"./preflight/preflighttest":51,"./util/support":145,"./vendor/loglevel":152}],13:[function(v,C,x){"use strict";var w,S=this&&this.__extends||(w=function(m,u){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,g){f.__proto__=g}||function(f,g){for(var P in g)Object.prototype.hasOwnProperty.call(g,P)&&(f[P]=g[P])})(m,u)},function(m,u){if("function"!=typeof u&&null!==u)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");function f(){this.constructor=m}w(m,u),m.prototype=null===u?Object.create(u):(f.prototype=u.prototype,new f)}),y=v("./webrtc").MediaStreamTrack,_=v("./util"),o=_.asLocalTrack,i=_.asLocalTrackPublication,e=_.trackClass,t=v("./util/constants"),r=t.typeErrors,n=t.trackPriority,a=v("./util/validate").validateLocalTrack,s=v("./media/track/es5"),c=s.LocalAudioTrack,p=s.LocalDataTrack,l=s.LocalVideoTrack,d=v("./media/track/localaudiotrackpublication"),h=v("./media/track/localdatatrackpublication"),k=v("./media/track/localvideotrackpublication"),R=function(w){function m(u,f,g){var P=this,E=(g=Object.assign({LocalAudioTrack:c,LocalVideoTrack:l,LocalDataTrack:p,MediaStreamTrack:y,LocalAudioTrackPublication:d,LocalVideoTrackPublication:k,LocalDataTrackPublication:h,shouldStopLocalTracks:!1,tracks:f},g)).shouldStopLocalTracks?new Set(f.filter(function(O){return"data"!==O.kind})):new Set;return P=w.call(this,u,g)||this,Object.defineProperties(P,{_eventObserver:{value:g.eventObserver},_LocalAudioTrack:{value:g.LocalAudioTrack},_LocalDataTrack:{value:g.LocalDataTrack},_LocalVideoTrack:{value:g.LocalVideoTrack},_MediaStreamTrack:{value:g.MediaStreamTrack},_LocalAudioTrackPublication:{value:g.LocalAudioTrackPublication},_LocalDataTrackPublication:{value:g.LocalDataTrackPublication},_LocalVideoTrackPublication:{value:g.LocalVideoTrackPublication},_tracksToStop:{value:E},signalingRegion:{enumerable:!0,get:function(){return u.signalingRegion}}}),P._handleTrackSignalingEvents(),P}return S(m,w),m.prototype._addTrack=function(u,f,g){var P=w.prototype._addTrack.call(this,u,f);return P&&"disconnected"!==this.state&&this._addLocalTrack(u,g),P},m.prototype._addLocalTrack=function(u,f){var g,P=null===(g=u.noiseCancellation)||void 0===g?void 0:g.vendor;this._signaling.addTrack(u._trackSender,u.name,f,P),this._log.info("Added a new "+e(u,!0)+":",u.id),this._log.debug(e(u,!0)+":",u)},m.prototype._removeTrack=function(u,f){var g=w.prototype._removeTrack.call(this,u,f);return g&&"disconnected"!==this.state&&(this._signaling.removeTrack(u._trackSender),this._log.info("Removed a "+e(u,!0)+":",u.id),this._log.debug(e(u,!0)+":",u)),g},m.prototype._getTrackEvents=function(){return w.prototype._getTrackEvents.call(this).concat([["disabled","trackDisabled"],["enabled","trackEnabled"],["stopped","trackStopped"]])},m.prototype.toString=function(){return"[LocalParticipant #"+this._instanceId+(this.sid?": "+this.sid:"")+"]"},m.prototype._handleTrackSignalingEvents=function(){var u=this,f=this._log;if("disconnected"!==this.state){var g=function(A){var N=u._signaling.getPublication(A._trackSender);N&&(N.disable(),f.debug("Disabled the "+e(A,!0)+":",A.id))},P=function(A){var N=u._signaling.getPublication(A._trackSender);N&&(N.enable(),f.debug("Enabled the "+e(A,!0)+":",A.id))},E=function(A){var N=u._signaling.getPublication(A._trackSender);return N&&N.stop(),N},O=function(A){f.debug("Transitioned to state:",A),"disconnected"===A?(f.debug("Removing LocalTrack event listeners"),u._signaling.removeListener("stateChanged",O),u.removeListener("trackDisabled",g),u.removeListener("trackEnabled",P),u.removeListener("trackStopped",E),u._tracks.forEach(function(N){var j=E(N);j&&N._trackSender.removeClone(j._trackTransceiver)}),f.info("LocalParticipant disconnected. Stopping "+u._tracksToStop.size+" automatically-acquired LocalTracks"),u._tracksToStop.forEach(function(N){N.stop()})):"connected"===A&&(f.info("reconnected"),setTimeout(function(){return u.emit("reconnected")},0))};this.on("trackDisabled",g),this.on("trackEnabled",P),this.on("trackStopped",E),this._signaling.on("stateChanged",O),this._tracks.forEach(function(A){u._addLocalTrack(A,n.PRIORITY_STANDARD),u._getOrCreateLocalTrackPublication(A).catch(function(N){f.warn("Failed to get or create LocalTrackPublication for "+A+":",N)})})}},m.prototype._getOrCreateLocalTrackPublication=function(u){var f=T(this.tracks,u);if(f)return Promise.resolve(f);var g=this._log,P=this,E=this._signaling.getPublication(u._trackSender);return E?new Promise(function(O,A){E.on("updated",function N(){var j=E.error;if(j)return E.removeListener("updated",N),g.warn("Failed to publish the "+e(u,!0)+": "+j.message),P._removeTrack(u,u.id),setTimeout(function(){P.emit("trackPublicationFailed",j,u)}),void A(j);if(!P._tracks.has(u.id))return E.removeListener("updated",N),void A(new Error("The "+u+" was unpublished"));if(E.sid){E.removeListener("updated",N);var Q={log:g,LocalAudioTrackPublication:P._LocalAudioTrackPublication,LocalDataTrackPublication:P._LocalDataTrackPublication,LocalVideoTrackPublication:P._LocalVideoTrackPublication};f=T(P.tracks,u);var G=function(D){return P.emit("trackWarning",D,f)},K=function(){return P.emit("trackWarningsCleared",f)};f||(f=i(u,E,function(D){f.removeListener("trackWarning",G),f.removeListener("trackWarningsCleared",K),P.unpublishTrack(D.track)},Q),P._addTrackPublication(f)),f.on("warning",G),f.on("warningsCleared",K);var V=P._signaling.state;("connected"===V||"connecting"===V)&&(u._processorEventObserver&&u._processorEventObserver.on("event",function(D){P._eventObserver.emit("event",{name:D.name,payload:D.data,group:"video-processor",level:"info"})}),u.processedTrack&&(u._captureFrames(),u._setSenderMediaStreamTrack(!0))),"connected"===V&&setTimeout(function(){P.emit("trackPublished",f)}),O(f)}})}):Promise.reject(new Error("Unexpected error: The "+u+" cannot be published"))},m.prototype.publishTrack=function(u,f){var P,g=T(this.tracks,u);if(g)return Promise.resolve(g);f=Object.assign({log:this._log,priority:n.PRIORITY_STANDARD,LocalAudioTrack:this._LocalAudioTrack,LocalDataTrack:this._LocalDataTrack,LocalVideoTrack:this._LocalVideoTrack,MediaStreamTrack:this._MediaStreamTrack},f);try{P=o(u,f)}catch(j){return Promise.reject(j)}var E=P.noiseCancellation;E&&!this._signaling.audioProcessors.includes(E.vendor)&&(this._log.warn(E.vendor+" is not supported in this room. disabling it permanently"),E.disablePermanently());var A=Object.values(n);if(!A.includes(f.priority))return Promise.reject(r.INVALID_VALUE("LocalTrackPublishOptions.priority",A));var N=this._addTrack(P,P.id,f.priority)||this._tracks.get(P.id);return this._getOrCreateLocalTrackPublication(N)},m.prototype.publishTracks=function(u){if(!Array.isArray(u))throw r.INVALID_TYPE("tracks","Array of LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack");return Promise.all(u.map(this.publishTrack,this))},m.prototype.setBandwidthProfile=function(){this._log.warn("setBandwidthProfile is not implemented yet and may be available in future versions of twilio-video.js")},m.prototype.setNetworkQualityConfiguration=function(u){if("object"!=typeof u||null===u)throw r.INVALID_TYPE("networkQualityConfiguration","NetworkQualityConfiguration");return["local","remote"].forEach(function(f){if(f in u&&("number"!=typeof u[f]||isNaN(u[f])))throw r.INVALID_TYPE("networkQualityConfiguration."+f,"number")}),this._signaling.setNetworkQualityConfiguration(u),this},m.prototype.setParameters=function(u){if(typeof u<"u"&&"object"!=typeof u)throw r.INVALID_TYPE("encodingParameters","EncodingParameters, null or undefined");if(u){if(this._signaling.getParameters().adaptiveSimulcast&&u.maxVideoBitrate)throw r.INVALID_TYPE("encodingParameters",'encodingParameters.maxVideoBitrate is not compatible with "preferredVideoCodecs=auto"');["maxAudioBitrate","maxVideoBitrate"].forEach(function(f){if(typeof u[f]<"u"&&"number"!=typeof u[f]&&null!==u[f])throw r.INVALID_TYPE("encodingParameters."+f,"number, null or undefined")})}else null===u&&(u={maxAudioBitrate:null,maxVideoBitrate:null});return this._signaling.setParameters(u),this},m.prototype.unpublishTrack=function(u){a(u,{LocalAudioTrack:this._LocalAudioTrack,LocalDataTrack:this._LocalDataTrack,LocalVideoTrack:this._LocalVideoTrack,MediaStreamTrack:this._MediaStreamTrack});var f=this._tracks.get(u.id);if(!f)return null;if(this._signaling.getPublication(f._trackSender).publishFailed(new Error("The "+f+" was unpublished")),!(f=this._removeTrack(f,f.id)))return null;var P=T(this.tracks,f);return P&&this._removeTrackPublication(P),P},m.prototype.unpublishTracks=function(u){var f=this;if(!Array.isArray(u))throw r.INVALID_TYPE("tracks","Array of LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack");return u.reduce(function(g,P){var E=f.unpublishTrack(P);return E?g.concat(E):g},[])},m}(v("./participant"));function T(w,m){return Array.from(w.values()).find(function(u){return u.track===m||u.track.mediaStreamTrack===m})||null}C.exports=R},{"./media/track/es5":15,"./media/track/localaudiotrackpublication":21,"./media/track/localdatatrackpublication":23,"./media/track/localvideotrackpublication":27,"./participant":46,"./util":132,"./util/constants":125,"./util/validate":150,"./webrtc":158}],14:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t){return o.call(this,e,t)||this}return S(i,o),i.prototype.attach=function(){return o.prototype.attach.apply(this,arguments)},i.prototype.detach=function(){return o.prototype.detach.apply(this,arguments)},i}(v("./mediatrack"));C.exports=_},{"./mediatrack":28}],15:[function(v,C,x){"use strict";C.exports={LocalAudioTrack:v("./localaudiotrack"),LocalVideoTrack:v("./localvideotrack"),LocalDataTrack:v("./localdatatrack")}},{"./localaudiotrack":16,"./localdatatrack":17,"./localvideotrack":18}],16:[function(v,C,x){"use strict";var S=v("../../../vendor/inherits"),y=v("../localaudiotrack");function _(o,i){var e=new y(o,i);return Object.setPrototypeOf(e,_.prototype),e}S(_,y),C.exports=_},{"../../../vendor/inherits":151,"../localaudiotrack":20}],17:[function(v,C,x){"use strict";var S=v("../../../vendor/inherits"),y=v("../localdatatrack");function _(o){var i=new y(o);return Object.setPrototypeOf(i,_.prototype),i}S(_,y),C.exports=_},{"../../../vendor/inherits":151,"../localdatatrack":22}],18:[function(v,C,x){"use strict";var S=v("../../../vendor/inherits"),y=v("../localvideotrack");function _(o,i){var e=new y(o,i);return Object.setPrototypeOf(e,_.prototype),e}S(_,y),C.exports=_},{"../../../vendor/inherits":151,"../localvideotrack":26}],19:[function(v,C,x){"use strict";var a,S=this&&this.__extends||(a=function(s,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,l){p.__proto__=l}||function(p,l){for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(p[d]=l[d])})(s,c)},function(s,c){if("function"!=typeof c&&null!==c)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");function p(){this.constructor=s}a(s,c),s.prototype=null===c?Object.create(c):(p.prototype=c.prototype,new p)}),y=v("../../eventemitter"),_=v("../../util"),o=_.buildLogLevels,i=_.valueToJSON,e=v("../../util/constants").DEFAULT_LOG_LEVEL,t=v("../../util/log"),r=0,n=function(a){function s(c,p,l){var d;l=Object.assign({name:c,log:null,logLevel:e},l),d=a.call(this)||this;var h=String(l.name),k=o(l.logLevel),b=l.log?l.log.createLog("media",d):new t("media",d,k,l.loggerName);return Object.defineProperties(d,{_instanceId:{value:++r},_log:{value:b},kind:{enumerable:!0,value:p},name:{enumerable:!0,value:h}}),d}return S(s,a),s.prototype.toJSON=function(){return i(this)},s}(y);C.exports=n},{"../../eventemitter":10,"../../util":132,"../../util/constants":125,"../../util/log":136}],20:[function(v,C,x){"use strict";var n,S=this&&this.__extends||(n=function(a,s){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,p){c.__proto__=p}||function(c,p){for(var l in p)Object.prototype.hasOwnProperty.call(p,l)&&(c[l]=p[l])})(a,s)},function(a,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function c(){this.constructor=a}n(a,s),a.prototype=null===s?Object.create(s):(c.prototype=s.prototype,new c)}),y=v("../../util/browserdetection").isIOS,_=v("../../util/detectsilentaudio"),o=v("../../webrtc/util").isIOSChrome,i=v("./audiotrack"),r=function(n){function a(s,c){var p=this,l=c?.noiseCancellation||null,d=(p=n.call(this,s,c)||this)._log,h=s.label,k=void 0===h?"":h,b=s.getSettings(),R=b.deviceId,w=b.groupId;return Object.defineProperties(p,{_currentDefaultDeviceInfo:{value:{deviceId:void 0===R?"":R,groupId:void 0===w?"":w,label:k},writable:!0},_defaultDeviceCaptureMode:{value:!y()&&p._isCreatedByCreateLocalTracks&&"object"==typeof navigator&&"object"==typeof navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.addEventListener&&"function"==typeof navigator.mediaDevices.enumerateDevices?c?.defaultDeviceCaptureMode||"auto":"manual"},_onDeviceChange:{value:function(){navigator.mediaDevices.enumerateDevices().then(function(u){var f=u.find(function(g){return"audioinput"===g.kind&&"default"!==g.deviceId});f&&["deviceId","groupId"].some(function(g){return f[g]!==p._currentDefaultDeviceInfo[g]})&&(d.info("Default device changed, restarting the LocalAudioTrack"),d.debug('Old default device: "'+p._currentDefaultDeviceInfo.deviceId+'" => "'+p._currentDefaultDeviceInfo.label+'"'),d.debug('New default device: "'+f.deviceId+'" => "'+f.label+'"'),p._currentDefaultDeviceInfo=f,p._restartDefaultDevice().catch(function(g){return d.warn("Failed to restart: "+g.message)}))},function(u){d.warn("Failed to run enumerateDevices(): "+u.message)})}},_restartOnDefaultDeviceChangeCleanup:{value:null,writable:!0},noiseCancellation:{enumerable:!0,value:l,writable:!1}}),d.debug("defaultDeviceCaptureMode:",p._defaultDeviceCaptureMode),p._maybeRestartOnDefaultDeviceChange(),p}return S(a,n),a.prototype.toString=function(){return"[LocalAudioTrack #"+this._instanceId+": "+this.id+"]"},a.prototype.attach=function(s){return(s=n.prototype.attach.call(this,s)).muted=!0,s},a.prototype._end=function(){return n.prototype._end.apply(this,arguments)},a.prototype._maybeRestartOnDefaultDeviceChange=function(){var s=this,c=this,p=c._constraints,l=c._defaultDeviceCaptureMode,d=c._log,k=(this.noiseCancellation?this.noiseCancellation.sourceTrack:this.mediaStreamTrack).getSettings().deviceId,b=function(T){return T!==k||"default"===T},R=function T(w){return void 0===w&&(w={}),"string"==typeof w?b(w):Array.isArray(w)?w.every(b):w.exact?T(w.exact):!w.ideal||T(w.ideal)}(p.deviceId);"auto"===l&&R?this._restartOnDefaultDeviceChangeCleanup||(d.info("LocalAudioTrack will be restarted if the default device changes"),navigator.mediaDevices.addEventListener("devicechange",this._onDeviceChange),this._restartOnDefaultDeviceChangeCleanup=function(){d.info("Cleaning up the listener to restart the LocalAudioTrack if the default device changes"),navigator.mediaDevices.removeEventListener("devicechange",s._onDeviceChange),s._restartOnDefaultDeviceChangeCleanup=null}):(d.info("LocalAudioTrack will NOT be restarted if the default device changes"),this._restartOnDefaultDeviceChangeCleanup&&this._restartOnDefaultDeviceChangeCleanup())},a.prototype._reacquireTrack=function(s){var c=this;return this._log.debug("_reacquireTrack: ",s),this.noiseCancellation?this.noiseCancellation.reacquireTrack(function(){return n.prototype._reacquireTrack.call(c,s)}):n.prototype._reacquireTrack.call(this,s)},a.prototype._restartDefaultDevice=function(){var s=this,c=Object.assign({},this._constraints),p=Object.assign({},c,{deviceId:this._currentDefaultDeviceInfo.deviceId});return this.restart(p).then(function(){s._constraints=c,s._maybeRestartOnDefaultDeviceChange()})},a.prototype._setMediaStreamTrack=function(s){var c=this,l=this._log,d=this.noiseCancellation,h=n.prototype._setMediaStreamTrack.call(this,s);return o()&&d&&(l.debug("iOS Chrome detected, checking if the restarted Krisp audio is silent"),h=h.then(function(){return _(c._dummyEl)}).then(function(k){return l.debug("Krisp audio is "+(k?"silent, using source audio":"not silent")),k&&d.disablePermanently().then(function(){return n.prototype._setMediaStreamTrack.call(c,d.sourceTrack)})})),h},a.prototype.disable=function(){return n.prototype.disable.apply(this,arguments)},a.prototype.enable=function(){return n.prototype.enable.apply(this,arguments)},a.prototype.restart=function(){return n.prototype.restart.apply(this,arguments)},a.prototype.stop=function(){return this.noiseCancellation&&this.noiseCancellation.stop(),this._restartOnDefaultDeviceChangeCleanup&&this._restartOnDefaultDeviceChangeCleanup(),n.prototype.stop.apply(this,arguments)},a}(v("./localmediatrack")(i));C.exports=r},{"../../util/browserdetection":123,"../../util/detectsilentaudio":126,"../../webrtc/util":170,"./audiotrack":14,"./localmediatrack":24}],21:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t,r,n){return o.call(this,e,t,r,n)||this}return S(i,o),i.prototype.toString=function(){return"[LocalAudioTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(v("./localtrackpublication"));C.exports=_},{"./localtrackpublication":25}],22:[function(v,C,x){"use strict";var i,S=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),y=v("./"),_=v("../../data/sender"),o=function(i){function e(t){var r,a=new(0,(t=Object.assign({DataTrackSender:_,maxPacketLifeTime:null,maxRetransmits:null,ordered:!0},t)).DataTrackSender)(t.maxPacketLifeTime,t.maxRetransmits,t.ordered);return r=i.call(this,a.id,"data",t)||this,Object.defineProperties(r,{_trackSender:{value:a},id:{enumerable:!0,value:a.id},maxPacketLifeTime:{enumerable:!0,value:t.maxPacketLifeTime},maxRetransmits:{enumerable:!0,value:t.maxRetransmits},ordered:{enumerable:!0,value:t.ordered},reliable:{enumerable:!0,value:null===t.maxPacketLifeTime&&null===t.maxRetransmits}}),r}return S(e,i),e.prototype.send=function(t){this._trackSender.send(t)},e}(y);C.exports=o},{"../../data/sender":6,"./":19}],23:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t,r,n){return o.call(this,e,t,r,n)||this}return S(i,o),i.prototype.toString=function(){return"[LocalDataTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(v("./localtrackpublication"));C.exports=_},{"./localtrackpublication":25}],24:[function(v,C,x){"use strict";var b,S=this&&this.__extends||(b=function(R,T){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,m){w.__proto__=m}||function(w,m){for(var u in m)Object.prototype.hasOwnProperty.call(m,u)&&(w[u]=m[u])})(R,T)},function(R,T){if("function"!=typeof T&&null!==T)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");function w(){this.constructor=R}b(R,T),R.prototype=null===T?Object.create(T):(w.prototype=T.prototype,new w)}),y=v("../../webrtc").getUserMedia,_=v("../../util/browserdetection").isIOS,o=v("../../util"),i=o.capitalize,e=o.defer,t=o.waitForSometime,r=o.waitForEvent,n=v("../../util/constants").typeErrors.ILLEGAL_INVOKE,a=v("../../util/detectsilentaudio"),s=v("../../util/detectsilentvideo"),c=v("../../util/documentvisibilitymonitor.js"),p=v("../../util/localmediarestartdeferreds"),l=v("../../webaudio/workaround180748"),d=v("./sender");function k(b){var R=b._log,T=b.kind,w=b._noiseCancellation,m={audio:a,video:s}[T],u=function(){return w?w.sourceTrack:b.mediaStreamTrack},f=b._dummyEl,g=u(),P=null;function A(){return Promise.race([r(g,"unmute"),t(50)]).then(function(){return function O(){var F=b.isStopped&&!!b._workaroundWebKitBug1208516Cleanup,V=u().muted;return Promise.resolve().then(function(){return"visible"===document.visibilityState&&!P&&(V||F||function E(){return f.play().then(function(){return m(f)}).then(function(G){return G?R.warn("Silence detected"):R.info("Non-silence detected"),G}).catch(function(G){R.warn("Failed to detect silence:",G)}).finally(function(){b.processedTrack||f.pause()})}())})}()}).then(function(G){return G&&!P&&(P=e(),b._restart().finally(function(){f=b._dummyEl,M(),g=u(),j(),P.resolve(),P=null}).catch(function(F){R.error("failed to restart track: ",F)})),(P&&P.promise||Promise.resolve()).finally(function(){return p.resolveDeferred(T)})}).catch(function(G){R.error("error in maybeRestart: "+G.message)})}function N(){var G=b._log,K=b.kind;G.info("Muted"),G.debug("LocalMediaTrack:",b),p.startDeferred(K)}function j(){g.addEventListener("ended",A),g.addEventListener("mute",N),g.addEventListener("unmute",A)}function M(){g.removeEventListener("ended",A),g.removeEventListener("mute",N),g.removeEventListener("unmute",A)}var Q=function(G){return!!G&&A()};return c.onVisibilityChange(1,Q),j(),function(){c.offVisibilityChange(1,Q),M()}}C.exports=function h(b){return function(R){function T(w,m){var u=this,f=_()&&"object"==typeof document&&"function"==typeof document.addEventListener&&"string"==typeof document.visibilityState;m=Object.assign({getUserMedia:y,isCreatedByCreateLocalTracks:!1,workaroundWebKitBug1208516:f,gUMSilentTrackWorkaround:l},m);var g=new d(w),P=g.kind;return u=R.call(this,g,m)||this,Object.defineProperties(u,{_constraints:{value:"object"==typeof m[P]?m[P]:{},writable:!0},_getUserMedia:{value:m.getUserMedia},_gUMSilentTrackWorkaround:{value:m.gUMSilentTrackWorkaround},_eventsToReemitters:{value:new Map([["muted",function(){return u.emit("muted",u)}],["unmuted",function(){return u.emit("unmuted",u)}]])},_workaroundWebKitBug1208516:{value:m.workaroundWebKitBug1208516},_workaroundWebKitBug1208516Cleanup:{value:null,writable:!0},_didCallEnd:{value:!1,writable:!0},_isCreatedByCreateLocalTracks:{value:m.isCreatedByCreateLocalTracks},_noiseCancellation:{value:m.noiseCancellation||null},_trackSender:{value:g},id:{enumerable:!0,value:g.id},isEnabled:{enumerable:!0,get:function(){return g.enabled}},isMuted:{enumerable:!0,get:function(){return g.muted}},isStopped:{enumerable:!0,get:function(){return"ended"===g.readyState}}}),u._workaroundWebKitBug1208516&&(u._workaroundWebKitBug1208516Cleanup=k(u)),u._reemitTrackSenderEvents(),u}return S(T,R),T.prototype._end=function(){var w=this;this._didCallEnd||(R.prototype._end.call(this),this._didCallEnd=!0,this._eventsToReemitters.forEach(function(m,u){return w._trackSender.removeListener(u,m)}),this.emit("stopped",this))},T.prototype._initialize=function(){this._didCallEnd&&(this._didCallEnd=!1),this._eventsToReemitters&&this._reemitTrackSenderEvents(),R.prototype._initialize.call(this)},T.prototype._reacquireTrack=function(w){var m,u=this,f=u._getUserMedia,g=u._gUMSilentTrackWorkaround,P=u._log,E=u.mediaStreamTrack.kind;P.info("Re-acquiring the MediaStreamTrack"),P.debug("Constraints:",w);var O=Object.assign({audio:!1,video:!1},((m={})[E]=w,m));return(this._workaroundWebKitBug1208516Cleanup?g(P,f,O):f(O)).then(function(N){return N.getTracks()[0]})},T.prototype._reemitTrackSenderEvents=function(){var w=this;this._eventsToReemitters.forEach(function(m,u){return w._trackSender.on(u,m)}),this._trackSender.dequeue("muted"),this._trackSender.dequeue("unmuted")},T.prototype._restart=function(w){var m=this,u=this._log;return w=w||this._constraints,this._stop(),this._reacquireTrack(w).catch(function(f){throw u.error("Failed to re-acquire the MediaStreamTrack:",{error:f,constraints:w}),f}).then(function(f){return u.info("Re-acquired the MediaStreamTrack"),u.debug("MediaStreamTrack:",f),m._constraints=Object.assign({},w),m._setMediaStreamTrack(f)})},T.prototype._setMediaStreamTrack=function(w){var m=this;return w.enabled=this.mediaStreamTrack.enabled,this._stop(),(this._unprocessedTrack?Promise.resolve().then(function(){m._unprocessedTrack=w}):this._trackSender.setMediaStreamTrack(w).catch(function(u){m._log.warn("setMediaStreamTrack failed:",{error:u,mediaStreamTrack:w})})).then(function(){m._initialize(),m._getAllAttachedElements().forEach(function(u){return m._attach(u)})})},T.prototype._stop=function(){return this.mediaStreamTrack.stop(),this._end(),this},T.prototype.enable=function(w){return(w="boolean"!=typeof w||w)!==this.mediaStreamTrack.enabled&&(this._log.info((w?"En":"Dis")+"abling"),this.mediaStreamTrack.enabled=w,this.emit(w?"enabled":"disabled",this)),this},T.prototype.disable=function(){return this.enable(!1)},T.prototype.restart=function(w){var m=this,u=this.kind;if(!this._isCreatedByCreateLocalTracks)return Promise.reject(n("restart","can only be called on a Local"+i(u)+"Track that is created using createLocalTracks or createLocal"+i(u)+"Track."));this._workaroundWebKitBug1208516Cleanup&&(this._workaroundWebKitBug1208516Cleanup(),this._workaroundWebKitBug1208516Cleanup=null);var f=this._restart(w);return this._workaroundWebKitBug1208516&&(f=f.finally(function(){m._workaroundWebKitBug1208516Cleanup=k(m)})),f},T.prototype.stop=function(){return this._log.info("Stopping"),this._workaroundWebKitBug1208516Cleanup&&(this._workaroundWebKitBug1208516Cleanup(),this._workaroundWebKitBug1208516Cleanup=null),this._stop()},T}(b)}},{"../../util":132,"../../util/browserdetection":123,"../../util/constants":125,"../../util/detectsilentaudio":126,"../../util/detectsilentvideo":127,"../../util/documentvisibilitymonitor.js":128,"../../util/localmediarestartdeferreds":135,"../../webaudio/workaround180748":155,"../../webrtc":158,"./sender":39}],25:[function(v,C,x){"use strict";var n,S=this&&this.__extends||(n=function(a,s){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,p){c.__proto__=p}||function(c,p){for(var l in p)Object.prototype.hasOwnProperty.call(p,l)&&(c[l]=p[l])})(a,s)},function(a,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function c(){this.constructor=a}n(a,s),a.prototype=null===s?Object.create(s):(c.prototype=s.prototype,new c)}),y=this&&this.__read||function(n,a){var s="function"==typeof Symbol&&n[Symbol.iterator];if(!s)return n;var p,d,c=s.call(n),l=[];try{for(;(void 0===a||a-- >0)&&!(p=c.next()).done;)l.push(p.value)}catch(h){d={error:h}}finally{try{p&&!p.done&&(s=c.return)&&s.call(c)}finally{if(d)throw d.error}}return l},_=this&&this.__spreadArray||function(n,a){for(var s=0,c=a.length,p=n.length;s<c;s++,p++)n[p]=a[s];return n},o=v("./trackpublication"),i=v("../../util/constants"),e=i.typeErrors,t=i.trackPriority,r=function(n){function a(s,c,p,l){var d=n.call(this,c.name,s.sid,l)||this;return Object.defineProperties(d,{_reemitSignalingEvent:{value:function(){for(var h=[],k=0;k<arguments.length;k++)h[k]=arguments[k];return d.emit.apply(d,_([h&&h.length?"warning":"warningsCleared"],y(h)))}},_reemitTrackEvent:{value:function(){return d.emit(d.isTrackEnabled?"trackEnabled":"trackDisabled")}},_signaling:{value:s},_unpublish:{value:p},isTrackEnabled:{enumerable:!0,get:function(){return"data"===this.track.kind||this.track.isEnabled}},kind:{enumerable:!0,value:c.kind},priority:{enumerable:!0,get:function(){return s.updatedPriority}},track:{enumerable:!0,value:c}}),["disabled","enabled"].forEach(function(h){return c.on(h,d._reemitTrackEvent)}),["warning","warningsCleared"].forEach(function(h){return s.on(h,d._reemitSignalingEvent)}),d}return S(a,n),a.prototype.toString=function(){return"[LocalTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},a.prototype.setPriority=function(s){var c=Object.values(t);if(!c.includes(s))throw e.INVALID_VALUE("priority",c);return this._signaling.setPriority(s),this},a.prototype.unpublish=function(){var s=this;return["disabled","enabled"].forEach(function(c){return s.track.removeListener(c,s._reemitTrackEvent)}),["warning","warningsCleared"].forEach(function(c){return s._signaling.removeListener(c,s._reemitSignalingEvent)}),this._unpublish(this),this},a}(o);C.exports=r},{"../../util/constants":125,"./trackpublication":40}],26:[function(v,C,x){"use strict";var n,S=this&&this.__extends||(n=function(a,s){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,p){c.__proto__=p}||function(c,p){for(var l in p)Object.prototype.hasOwnProperty.call(p,l)&&(c[l]=p[l])})(a,s)},function(a,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function c(){this.constructor=a}n(a,s),a.prototype=null===s?Object.create(s):(c.prototype=s.prototype,new c)}),y=v("../../util/browserdetection").isIOS,_=v("../../util/detectsilentvideo"),t=function(n){function a(s,c){var p=this;return c=Object.assign({workaroundSilentLocalVideo:y()&&typeof document<"u"&&"function"==typeof document.createElement},c),p=n.call(this,s,c)||this,Object.defineProperties(p,{_workaroundSilentLocalVideo:{value:c.workaroundSilentLocalVideo?r:null},_workaroundSilentLocalVideoCleanup:{value:null,writable:!0}}),p._workaroundSilentLocalVideo&&(p._workaroundSilentLocalVideoCleanup=p._workaroundSilentLocalVideo(p,document)),p}return S(a,n),a.prototype.toString=function(){return"[LocalVideoTrack #"+this._instanceId+": "+this.id+"]"},a.prototype._checkIfCanCaptureFrames=function(){return n.prototype._checkIfCanCaptureFrames.call(this,this._trackSender.isPublishing)},a.prototype._end=function(){return n.prototype._end.apply(this,arguments)},a.prototype._setSenderMediaStreamTrack=function(s){var c=this,p=this.mediaStreamTrack,l=s?this.processedTrack:p;return this._trackSender.setMediaStreamTrack(l).catch(function(d){return c._log.warn("setMediaStreamTrack failed on LocalVideoTrack RTCRtpSender",{error:d,mediaStreamTrack:l})}).then(function(){c._unprocessedTrack=s?p:null})},a.prototype.addProcessor=function(){this._log.debug("Adding VideoProcessor to the LocalVideoTrack");var s=n.prototype.addProcessor.apply(this,arguments);return this.processedTrack?(this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the processed MediaStreamTrack",this.processedTrack),this._setSenderMediaStreamTrack(!0),s):this._log.warn("Unable to add a VideoProcessor to the LocalVideoTrack")},a.prototype.removeProcessor=function(){var s=this;this._log.debug("Removing VideoProcessor from the LocalVideoTrack");var c=n.prototype.removeProcessor.apply(this,arguments);return this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the original MediaStreamTrack"),this._setSenderMediaStreamTrack().then(function(){return s._updateElementsMediaStreamTrack()}),c},a.prototype.disable=function(){var s=n.prototype.disable.apply(this,arguments);return this.processedTrack&&(this.processedTrack.enabled=!1),s},a.prototype.enable=function(s){void 0===s&&(s=!0);var c=n.prototype.enable.apply(this,arguments);return this.processedTrack&&(this.processedTrack.enabled=s,s&&(this._captureFrames(),this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the processed MediaStreamTrack",this.processedTrack),this._setSenderMediaStreamTrack(!0))),c},a.prototype.restart=function(){var s=this;this._workaroundSilentLocalVideoCleanup&&(this._workaroundSilentLocalVideoCleanup(),this._workaroundSilentLocalVideoCleanup=null);var c=n.prototype.restart.apply(this,arguments);return this.processor&&c.then(function(){s._restartProcessor()}),this._workaroundSilentLocalVideo&&c.finally(function(){s._workaroundSilentLocalVideoCleanup=s._workaroundSilentLocalVideo(s,document)}),c},a.prototype.stop=function(){return this._workaroundSilentLocalVideoCleanup&&(this._workaroundSilentLocalVideoCleanup(),this._workaroundSilentLocalVideoCleanup=null),n.prototype.stop.apply(this,arguments)},a}(v("./localmediatrack")(v("./videotrack")));function r(n,a){var s=n._log,c=n._dummyEl,p=n.mediaStreamTrack;function l(){n.isEnabled&&(s.info("Unmuted, checking silence"),c.play().then(function(){return _(c,a)}).then(function(d){if(d)return s.warn("Silence detected, restarting"),n._stop(),n._restart();s.info("Non-silent frames detected, so no need to restart")}).catch(function(d){s.warn("Failed to detect silence and restart:",d)}).finally(function(){(c=n._dummyEl)&&!c.paused&&!n.processedTrack&&c.pause(),p.removeEventListener("unmute",l),(p=n.mediaStreamTrack).addEventListener("unmute",l)}))}return p.addEventListener("unmute",l),function(){p.removeEventListener("unmute",l)}}C.exports=t},{"../../util/browserdetection":123,"../../util/detectsilentvideo":127,"./localmediatrack":24,"./videotrack":43}],27:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t,r,n){return o.call(this,e,t,r,n)||this}return S(i,o),i.prototype.toString=function(){return"[LocalVideoTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(v("./localtrackpublication"));C.exports=_},{"./localtrackpublication":25}],28:[function(v,C,x){"use strict";var c,S=this&&this.__extends||(c=function(p,l){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,h){d.__proto__=h}||function(d,h){for(var k in h)Object.prototype.hasOwnProperty.call(h,k)&&(d[k]=h[k])})(p,l)},function(p,l){if("function"!=typeof l&&null!==l)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");function d(){this.constructor=p}c(p,l),p.prototype=null===l?Object.create(l):(d.prototype=l.prototype,new d)}),y=v("../../util/browserdetection").isIOS,_=v("../../webrtc").MediaStream,o=v("../../util"),i=o.waitForEvent,e=o.waitForSometime,t=v("../../util/localmediarestartdeferreds"),n=function(c){function p(l,d){var h=this;d=Object.assign({playPausedElementsIfNotBackgrounded:y()&&"object"==typeof document&&"function"==typeof document.addEventListener&&"string"==typeof document.visibilityState},d),h=c.call(this,l.id,l.kind,d)||this;var k=!1;return d=Object.assign({MediaStream:_},d),Object.defineProperties(h,{_attachments:{value:new Set},_dummyEl:{value:null,writable:!0},_elShims:{value:new WeakMap},_isStarted:{get:function(){return k},set:function(b){k=b}},_playPausedElementsIfNotBackgrounded:{value:d.playPausedElementsIfNotBackgrounded},_shouldShimAttachedElements:{value:d.workaroundWebKitBug212780||d.playPausedElementsIfNotBackgrounded},_unprocessedTrack:{value:null,writable:!0},_MediaStream:{value:d.MediaStream},isStarted:{enumerable:!0,get:function(){return k}},mediaStreamTrack:{enumerable:!0,get:function(){return this._unprocessedTrack||l.track}},processedTrack:{enumerable:!0,value:null,writable:!0}}),h._initialize(),h}return S(p,c),p.prototype._start=function(){this._log.debug("Started"),this._isStarted=!0,this._dummyEl&&(this._dummyEl.oncanplay=null),this.emit("started",this)},p.prototype._initialize=function(){var l=this;this._log.debug("Initializing"),this._dummyEl=this._createElement(),this.mediaStreamTrack.addEventListener("ended",function d(){l._end(),l.mediaStreamTrack.removeEventListener("ended",d)}),this._dummyEl&&(this._dummyEl.muted=!0,this._dummyEl.oncanplay=this._start.bind(this,this._dummyEl),this._attach(this._dummyEl,this.mediaStreamTrack),this._attachments.delete(this._dummyEl))},p.prototype._end=function(){this._log.debug("Ended"),this._dummyEl&&(this._dummyEl.remove(),this._dummyEl.srcObject=null,this._dummyEl.oncanplay=null,this._dummyEl=null)},p.prototype.attach=function(l){var d=this;if("string"==typeof l?l=this._selectElement(l):l||(l=this._createElement()),this._log.debug("Attempting to attach to element:",l),l=this._attach(l),this._shouldShimAttachedElements&&!this._elShims.has(l)){var h=this._playPausedElementsIfNotBackgrounded?function(){return function a(c,p){var l=c.tagName.toLowerCase();p.warn("Unintentionally paused:",c),Promise.race([i(document,"visibilitychange"),e(1e3)]).then(function(){"visible"===document.visibilityState&&t.whenResolved("audio").then(function(){return p.info("Playing unintentionally paused <"+l+"> element"),p.debug("Element:",c),c.play()}).then(function(){p.info("Successfully played unintentionally paused <"+l+"> element"),p.debug("Element:",c)}).catch(function(d){p.warn("Error while playing unintentionally paused <"+l+"> element:",{error:d,el:c})})})}(l,d._log)}:null;this._elShims.set(l,function s(c,p){void 0===p&&(p=null);var l=c.pause,d=c.play,h=!1;c.pause=function(){return h=!0,l.call(c)},c.play=function(){return h=!1,d.call(c)};var k=p?function(){h||p()}:null;return k&&c.addEventListener("pause",k),{pausedIntentionally:function(){return h},unShim:function(){c.pause=l,c.play=d,k&&c.removeEventListener("pause",k)}}}(l,h))}return l},p.prototype._attach=function(l,d){void 0===d&&(d=this.processedTrack||this.mediaStreamTrack);var h=l.srcObject;return h instanceof this._MediaStream||(h=new this._MediaStream),h["audio"===d.kind?"getAudioTracks":"getVideoTracks"]().forEach(function(b){h.removeTrack(b)}),h.addTrack(d),l.srcObject=h,l.autoplay=!0,l.playsInline=!0,this._attachments.has(l)||this._attachments.add(l),l},p.prototype._selectElement=function(l){var d=document.querySelector(l);if(!d)throw new Error("Selector matched no element: "+l);return d},p.prototype._updateElementsMediaStreamTrack=function(){var l=this;this._log.debug("Reattaching all elements to update mediaStreamTrack"),this._getAllAttachedElements().forEach(function(d){return l._attach(d)})},p.prototype._createElement=function(){return typeof document<"u"?document.createElement(this.kind):null},p.prototype.detach=function(l){var d;return d="string"==typeof l?[this._selectElement(l)]:l?[l]:this._getAllAttachedElements(),this._log.debug("Attempting to detach from elements:",d),this._detachElements(d),l?d[0]:d},p.prototype._detachElements=function(l){return l.map(this._detachElement.bind(this))},p.prototype._detachElement=function(l){if(!this._attachments.has(l))return l;var d=l.srcObject;return d instanceof this._MediaStream&&d.removeTrack(this.processedTrack||this.mediaStreamTrack),this._attachments.delete(l),this._shouldShimAttachedElements&&this._elShims.has(l)&&(this._elShims.get(l).unShim(),this._elShims.delete(l)),l},p.prototype._getAllAttachedElements=function(){var l=[];return this._attachments.forEach(function(d){l.push(d)}),l},p}(v("./"));C.exports=n},{"../../util":132,"../../util/browserdetection":123,"../../util/localmediarestartdeferreds":135,"../../webrtc":158,"./":19}],29:[function(v,C,x){"use strict";var S=this&&this.__awaiter||function(t,r,n,a){return new(n||(n=Promise))(function(c,p){function l(k){try{h(a.next(k))}catch(b){p(b)}}function d(k){try{h(a.throw(k))}catch(b){p(b)}}function h(k){k.done?c(k.value):function s(c){return c instanceof n?c:new n(function(p){p(c)})}(k.value).then(l,d)}h((a=a.apply(t,r||[])).next())})},y=this&&this.__generator||function(t,r){var a,s,c,p,n={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]};return p={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(p[Symbol.iterator]=function(){return this}),p;function l(h){return function(k){return function d(h){if(a)throw new TypeError("Generator is already executing.");for(;n;)try{if(a=1,s&&(c=2&h[0]?s.return:h[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,h[1])).done)return c;switch(s=0,c&&(h=[2&h[0],c.value]),h[0]){case 0:case 1:c=h;break;case 4:return n.label++,{value:h[1],done:!1};case 5:n.label++,s=h[1],h=[0];continue;case 7:h=n.ops.pop(),n.trys.pop();continue;default:if(!(c=(c=n.trys).length>0&&c[c.length-1])&&(6===h[0]||2===h[0])){n=0;continue}if(3===h[0]&&(!c||h[1]>c[0]&&h[1]<c[3])){n.label=h[1];break}if(6===h[0]&&n.label<c[1]){n.label=c[1],c=h;break}if(c&&n.label<c[2]){n.label=c[2],n.ops.push(h);break}c[2]&&n.ops.pop(),n.trys.pop();continue}h=r.call(t,n)}catch(k){h=[6,k],s=0}finally{a=c=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}([h,k])}}};Object.defineProperty(x,"__esModule",{value:!0}),x.applyNoiseCancellation=x.NoiseCancellationImpl=void 0;var _=v("../../noisecancellationadapter"),i=(v("../../util/log"),function(){function t(r,n){this._processor=r,this._sourceTrack=n,this._disabledPermanent=!1}return Object.defineProperty(t.prototype,"vendor",{get:function(){return this._processor.vendor},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sourceTrack",{get:function(){return this._sourceTrack},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._processor.isEnabled()},enumerable:!1,configurable:!0}),t.prototype.enable=function(){if(this._disabledPermanent)throw new Error(this.vendor+" noise cancellation is disabled permanently for this track");return this._processor.enable(),Promise.resolve()},t.prototype.disable=function(){return this._processor.disable(),Promise.resolve()},t.prototype.reacquireTrack=function(r){return S(this,void 0,void 0,function(){var n,a,s;return y(this,function(c){switch(c.label){case 0:return n=this._processor.isEnabled(),this._processor.disconnect(),[4,r()];case 1:return a=c.sent(),this._sourceTrack=a,[4,this._processor.connect(a)];case 2:return s=c.sent(),n?this._processor.enable():this._processor.disable(),[2,s]}})})},t.prototype.disablePermanently=function(){return this._disabledPermanent=!0,this.disable()},t.prototype.stop=function(){this._processor.disconnect(),this._sourceTrack.stop()},t}());x.NoiseCancellationImpl=i,x.applyNoiseCancellation=function e(t,r,n){return S(this,void 0,void 0,function(){var a,s,c,p;return y(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,_.createNoiseCancellationAudioProcessor(r,n)];case 1:return a=l.sent(),s=a.connect(t),c=new i(a,t),[2,{cleanTrack:s,noiseCancellation:c}];case 2:return p=l.sent(),n.warn("Failed to create noise cancellation. Returning normal audio track: "+p),[2,{cleanTrack:t}];case 3:return[2]}})})}},{"../../noisecancellationadapter":45,"../../util/log":136}],30:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t){return o.call(this,e,t)||this}return S(i,o),i}(v("./transceiver"));C.exports=_},{"./transceiver":41}],31:[function(v,C,x){"use strict";var e,S=this&&this.__extends||(e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(n[s]=a[s])})(t,r)},function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),y=v("./audiotrack"),i=function(e){function t(r,n,a,s,c,p,l){return e.call(this,r,n,a,s,c,p,l)||this}return S(t,e),t.prototype.toString=function(){return"[RemoteAudioTrack #"+this._instanceId+": "+this.sid+"]"},t.prototype._start=function(){e.prototype._start.call(this),this._dummyEl&&(this._dummyEl.srcObject=null,this._dummyEl=null)},t.prototype.setPriority=function(r){return e.prototype.setPriority.call(this,r)},t}(v("./remotemediatrack")(y));C.exports=i},{"./audiotrack":14,"./remotemediatrack":35}],32:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t){return o.call(this,e,t)||this}return S(i,o),i.prototype.toString=function(){return"[RemoteAudioTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(v("./remotetrackpublication"));C.exports=_},{"./remotetrackpublication":36}],33:[function(v,C,x){"use strict";var n,S=this&&this.__extends||(n=function(a,s){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,p){c.__proto__=p}||function(c,p){for(var l in p)Object.prototype.hasOwnProperty.call(p,l)&&(c[l]=p[l])})(a,s)},function(a,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function c(){this.constructor=a}n(a,s),a.prototype=null===s?Object.create(s):(c.prototype=s.prototype,new c)}),y=this&&this.__read||function(n,a){var s="function"==typeof Symbol&&n[Symbol.iterator];if(!s)return n;var p,d,c=s.call(n),l=[];try{for(;(void 0===a||a-- >0)&&!(p=c.next()).done;)l.push(p.value)}catch(h){d={error:h}}finally{try{p&&!p.done&&(s=c.return)&&s.call(c)}finally{if(d)throw d.error}}return l},_=this&&this.__spreadArray||function(n,a){for(var s=0,c=a.length,p=n.length;s<c;s++,p++)n[p]=a[s];return n},o=v("./"),i=v("../../util/constants"),e=i.typeErrors,t=i.trackPriority,r=function(n){function a(s,c,p){var l=n.call(this,c.id,"data",p)||this;return Object.defineProperties(l,{_isSwitchedOff:{value:!1,writable:!0},_priority:{value:null,writable:!0},isEnabled:{enumerable:!0,value:!0},isSwitchedOff:{enumerable:!0,get:function(){return this._isSwitchedOff}},maxPacketLifeTime:{enumerable:!0,value:c.maxPacketLifeTime},maxRetransmits:{enumerable:!0,value:c.maxRetransmits},ordered:{enumerable:!0,value:c.ordered},priority:{enumerable:!0,get:function(){return this._priority}},reliable:{enumerable:!0,value:null===c.maxPacketLifeTime&&null===c.maxRetransmits},sid:{enumerable:!0,value:s}}),c.on("message",function(d){l.emit("message",d,l)}),l}return S(a,n),a.prototype.setPriority=function(s){var c=_([null],y(Object.values(t)));if(!c.includes(s))throw e.INVALID_VALUE("priority",c);return this._priority=s,this},a.prototype._setEnabled=function(){},a.prototype._setSwitchedOff=function(s){this._isSwitchedOff!==s&&(this._isSwitchedOff=s,this.emit(s?"switchedOff":"switchedOn",this))},a}(o);C.exports=r},{"../../util/constants":125,"./":19}],34:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t){return o.call(this,e,t)||this}return S(i,o),i.prototype.toString=function(){return"[RemoteDataTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(v("./remotetrackpublication"));C.exports=_},{"./remotetrackpublication":36}],35:[function(v,C,x){"use strict";var s,S=this&&this.__extends||(s=function(c,p){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var h in d)Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h])})(c,p)},function(c,p){if("function"!=typeof p&&null!==p)throw new TypeError("Class extends value "+String(p)+" is not a constructor or null");function l(){this.constructor=c}s(c,p),c.prototype=null===p?Object.create(p):(l.prototype=p.prototype,new l)}),y=this&&this.__read||function(s,c){var p="function"==typeof Symbol&&s[Symbol.iterator];if(!p)return s;var d,k,l=p.call(s),h=[];try{for(;(void 0===c||c-- >0)&&!(d=l.next()).done;)h.push(d.value)}catch(b){k={error:b}}finally{try{d&&!d.done&&(p=l.return)&&p.call(l)}finally{if(k)throw k.error}}return h},_=this&&this.__spreadArray||function(s,c){for(var p=0,l=c.length,d=s.length;p<l;p++,d++)s[d]=c[p];return s},o=v("../../util/constants"),i=o.typeErrors,e=o.trackPriority,t=v("../../util/browserdetection").isIOS,r=v("../../util/documentvisibilitymonitor.js");C.exports=function n(s){return function(c){function p(l,d,h,k,b,R,T){var w=this;return T=Object.assign({workaroundWebKitBug212780:t()&&"object"==typeof document&&"function"==typeof document.addEventListener&&"string"==typeof document.visibilityState},T),w=c.call(this,d,T)||this,Object.defineProperties(w,{_isEnabled:{value:h,writable:!0},_isSwitchedOff:{value:k,writable:!0},_priority:{value:null,writable:!0},_setPriority:{value:b},_setRenderHint:{value:function(m){w._log.debug("updating render hint:",m),R(m)}},isEnabled:{enumerable:!0,get:function(){return this._isEnabled}},isSwitchedOff:{enumerable:!0,get:function(){return this._isSwitchedOff}},priority:{enumerable:!0,get:function(){return this._priority}},sid:{enumerable:!0,value:l},_workaroundWebKitBug212780:{value:T.workaroundWebKitBug212780},_workaroundWebKitBug212780Cleanup:{value:null,writable:!0}}),w}return S(p,c),p.prototype.setPriority=function(l){var d=_([null],y(Object.values(e)));if(!d.includes(l))throw i.INVALID_VALUE("priority",d);return this._priority!==l&&(this._priority=l,this._setPriority(l)),this},p.prototype._setEnabled=function(l){this._isEnabled!==l&&(this._isEnabled=l,this.emit(this._isEnabled?"enabled":"disabled",this))},p.prototype._setSwitchedOff=function(l){this._isSwitchedOff!==l&&(this._isSwitchedOff=l,this.emit(l?"switchedOff":"switchedOn",this))},p.prototype.attach=function(l){var d=c.prototype.attach.call(this,l);return!0!==this.mediaStreamTrack.enabled&&(this.mediaStreamTrack.enabled=!0,this.processedTrack&&(this.processedTrack.enabled=!0),this.processor&&this._captureFrames()),this._workaroundWebKitBug212780&&(this._workaroundWebKitBug212780Cleanup=this._workaroundWebKitBug212780Cleanup||function a(s){var c=s._log,p=s.kind;function l(d){d&&s._attachments.forEach(function(h){var k=s._elShims.get(h);h.paused&&k&&!k.pausedIntentionally()&&(c.info("Playing inadvertently paused <"+p+"> element"),c.debug("Element:",h),c.debug("RemoteMediaTrack:",s),h.play().then(function(){c.info("Successfully played inadvertently paused <"+p+"> element"),c.debug("Element:",h),c.debug("RemoteMediaTrack:",s)}).catch(function(R){c.warn("Error while playing inadvertently paused <"+p+"> element:",{err:R,el:h,remoteMediaTrack:s})}))})}return r.onVisibilityChange(2,l),function(){r.offVisibilityChange(2,l)}}(this)),d},p.prototype.detach=function(l){var d=c.prototype.detach.call(this,l);return 0===this._attachments.size&&(this.mediaStreamTrack.enabled=!1,this.processedTrack&&(this.processedTrack.enabled=!1),this._workaroundWebKitBug212780Cleanup&&(this._workaroundWebKitBug212780Cleanup(),this._workaroundWebKitBug212780Cleanup=null)),d},p}(s)}},{"../../util/browserdetection":123,"../../util/constants":125,"../../util/documentvisibilitymonitor.js":128}],36:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t){var r=o.call(this,e.name,e.sid,t)||this;Object.defineProperties(r,{_signaling:{value:e},_track:{value:null,writable:!0},isSubscribed:{enumerable:!0,get:function(){return!!this._track}},isTrackEnabled:{enumerable:!0,get:function(){return e.isEnabled}},kind:{enumerable:!0,value:e.kind},publishPriority:{enumerable:!0,get:function(){return e.priority}},track:{enumerable:!0,get:function(){return this._track}}});var n=e.error,a=e.isEnabled,s=e.isSwitchedOff,c=e.priority;return e.on("updated",function(){if(n!==e.error)return n=e.error,void r.emit("subscriptionFailed",e.error);a!==e.isEnabled&&(a=e.isEnabled,r.track&&r.track._setEnabled(e.isEnabled),r.emit(e.isEnabled?"trackEnabled":"trackDisabled")),s!==e.isSwitchedOff&&(r._log.debug(r.trackSid+": "+(s?"OFF":"ON")+" => "+(e.isSwitchedOff?"OFF":"ON")),s=e.isSwitchedOff,r.track?(r.track._setSwitchedOff(e.isSwitchedOff),r.emit(s?"trackSwitchedOff":"trackSwitchedOn",r.track)):s&&r._log.warn("Track was not subscribed when switched Off.")),c!==e.priority&&r.emit("publishPriorityChanged",c=e.priority)}),r}return S(i,o),i.prototype.toString=function(){return"[RemoteTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i.prototype._subscribed=function(e){!this._track&&e&&(this._track=e,this.emit("subscribed",e))},i.prototype._unsubscribe=function(){if(this._track){var e=this._track;this._track=null,this.emit("unsubscribed",e)}},i}(v("./trackpublication"));C.exports=_},{"./trackpublication":40}],37:[function(v,C,x){"use strict";var l,S=this&&this.__extends||(l=function(d,h){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,b){k.__proto__=b}||function(k,b){for(var R in b)Object.prototype.hasOwnProperty.call(b,R)&&(k[R]=b[R])})(d,h)},function(d,h){if("function"!=typeof h&&null!==h)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");function k(){this.constructor=d}l(d,h),d.prototype=null===h?Object.create(h):(k.prototype=h.prototype,new k)}),y=this&&this.__read||function(l,d){var h="function"==typeof Symbol&&l[Symbol.iterator];if(!h)return l;var b,T,k=h.call(l),R=[];try{for(;(void 0===d||d-- >0)&&!(b=k.next()).done;)R.push(b.value)}catch(w){T={error:w}}finally{try{b&&!b.done&&(h=k.return)&&h.call(k)}finally{if(T)throw T.error}}return R},_=v("./remotemediatrack"),o=v("./videotrack"),i=v("../../util/documentvisibilitymonitor.js"),e=v("../../util/nullobserver.js").NullObserver,t=v("../../util/timeout"),a=function(l){function d(h,k,b,R,T,w,m){var u=this;return m=Object.assign({clientTrackSwitchOffControl:"auto",contentPreferencesMode:"auto",enableDocumentVisibilityTurnOff:!0},m),m=Object.assign({IntersectionObserver:typeof IntersectionObserver>"u"||"auto"!==m.clientTrackSwitchOffControl?e:IntersectionObserver,ResizeObserver:typeof ResizeObserver>"u"||"auto"!==m.contentPreferencesMode?e:ResizeObserver},m),u=l.call(this,h,k,b,R,T,w,m)||this,Object.defineProperties(u,{_enableDocumentVisibilityTurnOff:{value:!0===m.enableDocumentVisibilityTurnOff&&"auto"===m.clientTrackSwitchOffControl},_documentVisibilityTurnOffCleanup:{value:null,writable:!0},_clientTrackSwitchOffControl:{value:m.clientTrackSwitchOffControl},_contentPreferencesMode:{value:m.contentPreferencesMode},_invisibleElements:{value:new WeakSet},_elToPipCallbacks:{value:new WeakMap},_elToPipWindows:{value:new WeakMap},_turnOffTimer:{value:new t(function(){u._setRenderHint({enabled:!1})},50,!1)},_resizeObserver:{value:new m.ResizeObserver(function(f){f.find(function(P){return!u._invisibleElements.has(P.target)})&&p(u)})},_intersectionObserver:{value:new m.IntersectionObserver(function(f){var g=!1;f.forEach(function(P){!u._invisibleElements.has(P.target)!==P.isIntersecting&&(P.isIntersecting?(u._log.debug("intersectionObserver detected: Off => On"),u._invisibleElements.delete(P.target)):(u._log.debug("intersectionObserver detected: On => Off"),u._invisibleElements.add(P.target)),g=!0)}),g&&(c(u),p(u))},{threshold:.25})}}),u}return S(d,l),d.prototype._start=function(h){var k=l.prototype._start.call(this,h);return c(this),k},d.prototype.switchOn=function(){if("manual"!==this._clientTrackSwitchOffControl)throw new Error('Invalid state. You can call switchOn only when bandwidthProfile.video.clientTrackSwitchOffControl is set to "manual"');return this._setRenderHint({enabled:!0}),this},d.prototype.switchOff=function(){if("manual"!==this._clientTrackSwitchOffControl)throw new Error('Invalid state. You can call switchOff only when bandwidthProfile.video.clientTrackSwitchOffControl is set to "manual"');return this._setRenderHint({enabled:!1}),this},d.prototype.setContentPreferences=function(h){if("manual"!==this._contentPreferencesMode)throw new Error('Invalid state. You can call switchOn only when bandwidthProfile.video.contentPreferencesMode is set to "manual"');return h.renderDimensions&&this._setRenderHint({renderDimensions:h.renderDimensions}),this},d.prototype._unObservePip=function(h){var k=this._elToPipCallbacks.get(h);k&&(h.removeEventListener("enterpictureinpicture",k.onEnterPip),h.removeEventListener("leavepictureinpicture",k.onLeavePip),this._elToPipCallbacks.delete(h))},d.prototype._observePip=function(h){var k=this;if(!this._elToPipCallbacks.get(h)){var R=function(m){return k._onEnterPip(m,h)},T=function(m){return k._onLeavePip(m,h)};h.addEventListener("enterpictureinpicture",R),h.addEventListener("leavepictureinpicture",T),this._elToPipCallbacks.set(h,{onEnterPip:R,onLeavePip:T,onResizePip:function(m){return k._onResizePip(m,h)}})}},d.prototype._onEnterPip=function(h,k){this._log.debug("onEnterPip");var b=h.pictureInPictureWindow;this._elToPipWindows.set(k,b);var R=this._elToPipCallbacks.get(k).onResizePip;b.addEventListener("resize",R),c(this)},d.prototype._onLeavePip=function(h,k){this._log.debug("onLeavePip"),this._elToPipWindows.delete(k);var b=this._elToPipCallbacks.get(k).onResizePip;h.pictureInPictureWindow.removeEventListener("resize",b),c(this)},d.prototype._onResizePip=function(){p(this)},d.prototype.attach=function(h){var k=l.prototype.attach.call(this,h);return"auto"===this._clientTrackSwitchOffControl&&this._invisibleElements.add(k),this._intersectionObserver.observe(k),this._resizeObserver.observe(k),this._enableDocumentVisibilityTurnOff&&(this._documentVisibilityTurnOffCleanup=this._documentVisibilityTurnOffCleanup||function s(l){function d(){c(l)}return i.onVisibilityChange(1,d),function(){i.offVisibilityChange(1,d)}}(this)),this._observePip(k),k},d.prototype.detach=function(h){var k=this,b=l.prototype.detach.call(this,h);return(Array.isArray(b)?b:[b]).forEach(function(T){k._intersectionObserver.unobserve(T),k._resizeObserver.unobserve(T),k._invisibleElements.delete(T),k._unObservePip(T)}),0===this._attachments.size&&this._documentVisibilityTurnOffCleanup&&(this._documentVisibilityTurnOffCleanup(),this._documentVisibilityTurnOffCleanup=null),c(this),p(this),b},d.prototype.addProcessor=function(){return l.prototype.addProcessor.apply(this,arguments)},d.prototype.removeProcessor=function(){return l.prototype.removeProcessor.apply(this,arguments)},d.prototype.toString=function(){return"[RemoteVideoTrack #"+this._instanceId+": "+this.sid+"]"},d.prototype.setPriority=function(h){return l.prototype.setPriority.call(this,h)},d}(_(o));function c(l){if("auto"===l._clientTrackSwitchOffControl){var d=l._getAllAttachedElements().filter(function(b){return!l._invisibleElements.has(b)});!0==(l._getAllAttachedElements().filter(function(b){return l._elToPipWindows.has(b)}).length>0||"visible"===document.visibilityState&&d.length>0)?(l._turnOffTimer.clear(),l._setRenderHint({enabled:!0})):l._turnOffTimer.isSet||l._turnOffTimer.start()}}function p(l){if("auto"===l._contentPreferencesMode){var d=l._getAllAttachedElements().filter(function(u){return!l._invisibleElements.has(u)}),h=l._getAllAttachedElements().map(function(u){var f=l._elToPipWindows.get(u);return f?{clientHeight:f.height,clientWidth:f.width}:{clientHeight:0,clientWidth:0}}),k=d.concat(h);if(k.length>0){var R=y(k.sort(function(u,f){return f.clientHeight+f.clientWidth-u.clientHeight-u.clientWidth-1}),1)[0];l._setRenderHint({renderDimensions:{height:R.clientHeight,width:R.clientWidth}})}}}C.exports=a},{"../../util/documentvisibilitymonitor.js":128,"../../util/nullobserver.js":139,"../../util/timeout":146,"./remotemediatrack":35,"./videotrack":43}],38:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t){return o.call(this,e,t)||this}return S(i,o),i.prototype.toString=function(){return"[RemoteVideoTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(v("./remotetrackpublication"));C.exports=_},{"./remotetrackpublication":36}],39:[function(v,C,x){"use strict";var i,S=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),y=this&&this.__read||function(i,e){var t="function"==typeof Symbol&&i[Symbol.iterator];if(!t)return i;var n,s,r=t.call(i),a=[];try{for(;(void 0===e||e-- >0)&&!(n=r.next()).done;)a.push(n.value)}catch(c){s={error:c}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(s)throw s.error}}return a},o=function(i){function e(t){var r=i.call(this,t.id,t)||this;return Object.defineProperties(r,{_clones:{value:new Set},_eventsToReemitters:{value:new Map([["mute",function(){return r.queue("muted")}],["unmute",function(){return r.queue("unmuted")}]])},_senders:{value:new Set},_senderToPublisherHintCallbacks:{value:new Map},isPublishing:{enumerable:!0,get:function(){return!!this._clones.size}},muted:{enumerable:!0,get:function(){return this._track.muted}}}),r._reemitMediaStreamTrackEvents(),r}return S(e,i),e.prototype._reemitMediaStreamTrackEvents=function(t){void 0===t&&(t=this._track);var n=this._eventsToReemitters,a=this._track;n.forEach(function(c,p){return t.addEventListener(p,c)}),a!==t&&(n.forEach(function(c,p){return a.removeEventListener(p,c)}),a.muted!==t.muted)&&n.get(t.muted?"mute":"unmute")()},e.prototype.clone=function(){var t=new e(this.track.clone());return this._clones.add(t),t},e.prototype.removeClone=function(t){this._clones.delete(t)},e.prototype.setMediaStreamTrack=function(t){var r=this,n=Array.from(this._clones),a=Array.from(this._senders);return Promise.all(n.map(function(s){return s.setMediaStreamTrack(t.clone())}).concat(a.map(function(s){return r._replaceTrack(s,t)}))).finally(function(){r._reemitMediaStreamTrackEvents(t),r._track=t})},e.prototype.addSender=function(t,r){return this._senders.add(t),r&&this._senderToPublisherHintCallbacks.set(t,r),this},e.prototype.removeSender=function(t){return this._senders.delete(t),this._senderToPublisherHintCallbacks.delete(t),this},e.prototype.setPublisherHint=function(t){var n=y(Array.from(this._senderToPublisherHintCallbacks.values()),1)[0];return n?n(t):Promise.resolve("COULD_NOT_APPLY_HINT")},e.prototype._replaceTrack=function(t,r){var n=this;return t.replaceTrack(r).then(function(a){return n.setPublisherHint(null).catch(function(){}),n.emit("replaced"),a})},e}(v("./transceiver"));C.exports=o},{"./transceiver":41}],40:[function(v,C,x){"use strict";var a,S=this&&this.__extends||(a=function(s,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,l){p.__proto__=l}||function(p,l){for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(p[d]=l[d])})(s,c)},function(s,c){if("function"!=typeof c&&null!==c)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");function p(){this.constructor=s}a(s,c),s.prototype=null===c?Object.create(c):(p.prototype=c.prototype,new p)}),y=v("../../eventemitter"),_=v("../../util"),o=_.buildLogLevels,i=_.valueToJSON,e=v("../../util/constants").DEFAULT_LOG_LEVEL,t=v("../../util/log"),r=0,n=function(a){function s(c,p,l){var d=a.call(this)||this;l=Object.assign({logLevel:e},l);var h=o(l.logLevel);return Object.defineProperties(d,{_instanceId:{value:r++},_log:{value:l.log?l.log.createLog("default",d):new t("default",d,h,l.loggerName)},trackName:{enumerable:!0,value:c},trackSid:{enumerable:!0,value:p}}),d}return S(s,a),s.prototype.toJSON=function(){return i(this)},s.prototype.toString=function(){return"[TrackPublication #"+this._instanceId+": "+this.trackSid+"]"},s}(y);C.exports=n},{"../../eventemitter":10,"../../util":132,"../../util/constants":125,"../../util/log":136}],41:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t){var r=o.call(this,e,t.kind)||this;return Object.defineProperties(r,{_track:{value:t,writable:!0},enabled:{enumerable:!0,get:function(){return this._track.enabled}},readyState:{enumerable:!0,get:function(){return this._track.readyState}},track:{enumerable:!0,get:function(){return this._track}}}),r}return S(i,o),i.prototype.stop=function(){this.track.stop(),o.prototype.stop.call(this)},i}(v("../../transceiver"));C.exports=_},{"../../transceiver":119}],42:[function(v,C,x){"use strict";var i,S=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),y=v("events").EventEmitter,_=v("../../util/constants").DEFAULT_VIDEO_PROCESSOR_STATS_INTERVAL_MS,o=function(i){function e(t){var r=i.call(this)||this;return Object.defineProperties(r,{_lastStatsSaveTime:{value:null,writable:!0},_lastStatsPublishTime:{value:null,writable:!0},_log:{value:t},_processorInfo:{value:null,writable:!0},_stats:{value:null,writable:!0}}),r.on("add",function(n){r._lastStatsSaveTime=Date.now(),r._lastStatsPublishTime=Date.now(),r._processorInfo=n,r._stats=[],r._reemitEvent("add",r._getEventData())}),r.on("remove",function(){var n=r._getEventData();r._lastStatsSaveTime=null,r._lastStatsPublishTime=null,r._processorInfo=null,r._stats=null,r._reemitEvent("remove",n)}),r.on("start",function(){r._reemitEvent("start",r._getEventData())}),r.on("stop",function(n){r._reemitEvent("stop",Object.assign({message:n},r._getEventData()))}),r.on("stats",function(){return r._maybeEmitStats()}),r}return S(e,i),e.prototype._getEventData=function(){if(!this._processorInfo)return{};var t=this._processorInfo,r=t.processor,d={captureHeight:t.captureHeight,captureWidth:t.captureWidth,inputFrameRate:t.inputFrameRate,isRemoteVideoTrack:t.isRemoteVideoTrack,inputFrameBufferType:t.inputFrameBufferType,outputFrameBufferContextType:t.outputFrameBufferContextType};return d.name=r._name||"VideoProcessor",["assetsPath","blurFilterRadius","debounce","fitType","isSimdEnabled","maskBlurRadius","pipeline","version"].forEach(function(h){var k=r["_"+h];typeof k<"u"&&(d[h]=k)}),Object.keys(d).forEach(function(h){var k=d[h];"boolean"==typeof k&&(d[h]=k?"true":"false")}),d},e.prototype._maybeEmitStats=function(){if(this._stats&&this._processorInfo){var t=this._processorInfo.processor._benchmark;if(t){var r=Date.now();if(!(r-this._lastStatsSaveTime<1e3)){var n={outputFrameRate:t.getRate("totalProcessingDelay")};if(["captureFrameDelay","imageCompositionDelay","inputImageResizeDelay","processFrameDelay","segmentationDelay"].forEach(function(c){n[c]=t.getAverageDelay(c)}),this._lastStatsSaveTime=r,this._stats.push(n),!(r-this._lastStatsPublishTime<_)){this._lastStatsPublishTime=r;var s=this._stats.splice(0).reduce(function(c,p,l){return Object.keys(n).forEach(function(d){c[d]||(c[d]=0),c[d]=(c[d]*l+p[d])/(l+1)}),c},{});Object.keys(s).forEach(function(c){s[c]=parseFloat(s[c].toFixed(2))}),this._reemitEvent("stats",Object.assign({},s,this._getEventData()))}}}}},e.prototype._reemitEvent=function(t,r){this._log.debug("VideoProcessor:"+t,r),this.emit("event",{name:t,data:r})},e}(y);C.exports=o},{"../../util/constants":125,events:173}],43:[function(v,C,x){"use strict";var t,S=this&&this.__extends||(t=function(r,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,s){a.__proto__=s}||function(a,s){for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(a[c]=s[c])})(r,n)},function(r,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function a(){this.constructor=r}t(r,n),r.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}),y=v("./mediatrack"),_=v("./videoprocessoreventobserver"),o=v("../../util/constants").DEFAULT_FRAME_RATE,i=function(t){function r(n,a){var s=t.call(this,n,a)||this;return Object.defineProperties(s,{_captureTimeoutId:{value:null,writable:!0},_isCapturing:{value:!1,writable:!0},_inputFrame:{value:null,writable:!0},_outputFrame:{value:null,writable:!0},_processorEventObserver:{value:null,writable:!0},_processorOptions:{value:{},writable:!0},_unmuteHandler:{value:null,writable:!0},dimensions:{enumerable:!0,value:{width:null,height:null}},processor:{enumerable:!0,value:null,writable:!0}}),s._processorEventObserver=new(a.VideoProcessorEventObserver||_)(s._log),s}return S(r,t),r.prototype._checkIfCanCaptureFrames=function(n){void 0===n&&(n=!1);var a=!0,s="",c=this.mediaStreamTrack;return c.enabled||(a=!1,s="MediaStreamTrack is disabled"),"ended"===c.readyState&&(a=!1,s="MediaStreamTrack is ended"),this.processor||(a=!1,s="VideoProcessor not detected."),!this._attachments.size&&!n&&(a=!1,s="VideoTrack is not publishing and there is no attached element."),s&&this._log.debug(s),{canCaptureFrames:a,message:s}},r.prototype._captureFrames=function(){var n=this;if(this._isCapturing)this._log.debug("Ignoring captureFrames call. Capture is already in progress");else{if(!this._checkIfCanCaptureFrames().canCaptureFrames)return this._isCapturing=!1,void this._log.debug("Cannot capture frames. Ignoring captureFrames call.");this._isCapturing=!0,this._processorEventObserver.emit("start"),this._log.debug("Start capturing frames");var s,a=Date.now();this._dummyEl.play().then(function(){var c=function(l){clearTimeout(n._captureTimeoutId);var d=n.mediaStreamTrack.getSettings().frameRate,b=Math.floor(1e3/(void 0===d?o:d))-s;(b<0||"number"!=typeof s)&&(b=0),n._captureTimeoutId=setTimeout(l,b)},p=function(){var l=n._checkIfCanCaptureFrames();if(!l.canCaptureFrames)return n._isCapturing=!1,n._processorEventObserver.emit("stop",l.message),void n._log.debug("Cannot capture frames. Stopping capturing frames.");a=Date.now();var d=n.mediaStreamTrack.getSettings(),h=d.width,k=void 0===h?0:h,b=d.height,R=void 0===b?0:b;n._outputFrame&&n._outputFrame.width!==k&&(n._outputFrame.width=k,n._outputFrame.height=R),n._inputFrame&&(n._inputFrame.width!==k&&(n._inputFrame.width=k,n._inputFrame.height=R),n._inputFrame.getContext("2d").drawImage(n._dummyEl,0,0,k,R));var T=null;try{T=n.processor.processFrame("video"===n._processorOptions.inputFrameBufferType?n._dummyEl:n._inputFrame,n._outputFrame)}catch(m){n._log.debug("Exception detected after calling processFrame.",m)}(T instanceof Promise?T:Promise.resolve(T)).then(function(){n._outputFrame&&("function"==typeof n.processedTrack.requestFrame&&n.processedTrack.requestFrame(),n._processorEventObserver.emit("stats"))}).finally(function(){s=Date.now()-a,c(p)})};c(p)}).catch(function(c){return n._log.error("Video element cannot be played",{error:c,track:n})})}},r.prototype._initialize=function(){var n=this;t.prototype._initialize.call(this),this._dummyEl&&(this._dummyEl.onloadedmetadata=function(){e(n,n._dummyEl)&&(n.dimensions.width=n._dummyEl.videoWidth,n.dimensions.height=n._dummyEl.videoHeight)},this._dummyEl.onresize=function(){e(n,n._dummyEl)&&(n.dimensions.width=n._dummyEl.videoWidth,n.dimensions.height=n._dummyEl.videoHeight,n.isStarted&&(n._log.debug("Dimensions changed:",n.dimensions),n.emit(r.DIMENSIONS_CHANGED,n)))})},r.prototype._restartProcessor=function(){var n=this.processor;if(n){var a=Object.assign({},this._processorOptions);this.removeProcessor(n),this.addProcessor(n,a)}},r.prototype._start=function(n){return this.dimensions.width=n.videoWidth,this.dimensions.height=n.videoHeight,this._log.debug("Dimensions:",this.dimensions),this.emit(r.DIMENSIONS_CHANGED,this),t.prototype._start.call(this,n)},r.prototype.addProcessor=function(n,a){var s=this;if(!n||"function"!=typeof n.processFrame)throw new Error("Received an invalid VideoProcessor from addProcessor.");if(this.processor)throw new Error("A VideoProcessor has already been added.");if(!this._dummyEl)throw new Error("VideoTrack has not been initialized.");this._log.debug("Adding VideoProcessor to the VideoTrack",n),this._unmuteHandler||(this._unmuteHandler=function(){s._log.debug("mediaStreamTrack unmuted"),s.processedTrack.muted&&(s._log.debug("mediaStreamTrack is unmuted but processedTrack is muted. Restarting processor."),s._restartProcessor())},this.mediaStreamTrack.addEventListener("unmute",this._unmuteHandler)),this._processorOptions=a||{};var c=this._processorOptions,p=c.inputFrameBufferType,l=c.outputFrameBufferContextType;if(typeof OffscreenCanvas>"u"&&"offscreencanvas"===p)throw new Error("OffscreenCanvas is not supported by this browser.");if(p&&"video"!==p&&"canvas"!==p&&"offscreencanvas"!==p)throw new Error("Invalid inputFrameBufferType of "+p);p||(p=typeof OffscreenCanvas>"u"?"canvas":"offscreencanvas");var d=this.mediaStreamTrack.getSettings(),h=d.width,k=void 0===h?0:h,b=d.height,R=void 0===b?0:b,T=d.frameRate,w=void 0===T?o:T;if("offscreencanvas"===p&&(this._inputFrame=new OffscreenCanvas(k,R)),"canvas"===p&&(this._inputFrame=document.createElement("canvas")),this._inputFrame&&(this._inputFrame.width=k,this._inputFrame.height=R),this._outputFrame=document.createElement("canvas"),this._outputFrame.width=k,this._outputFrame.height=R,!this._outputFrame.getContext(l=l||"2d"))throw new Error("Cannot get outputFrameBufferContextType: "+l+".");var u=typeof CanvasCaptureMediaStreamTrack<"u"&&CanvasCaptureMediaStreamTrack.prototype&&"function"==typeof CanvasCaptureMediaStreamTrack.prototype.requestFrame?0:void 0;return this.processedTrack=this._outputFrame.captureStream(u).getTracks()[0],this.processedTrack.enabled=this.mediaStreamTrack.enabled,this.processor=n,this._processorEventObserver.emit("add",{processor:n,captureHeight:R,captureWidth:k,inputFrameRate:w,isRemoteVideoTrack:this.toString().includes("RemoteVideoTrack"),inputFrameBufferType:p,outputFrameBufferContextType:l}),this._updateElementsMediaStreamTrack(),this._captureFrames(),this},r.prototype.attach=function(){var n=t.prototype.attach.apply(this,arguments);return this.processor&&this._captureFrames(),n},r.prototype.detach=function(){return t.prototype.detach.apply(this,arguments)},r.prototype.removeProcessor=function(n){if(!n)throw new Error("Received an invalid VideoProcessor from removeProcessor.");if(!this.processor)throw new Error("No existing VideoProcessor detected.");if(n!==this.processor)throw new Error("The provided VideoProcessor is different than the existing one.");return this._processorEventObserver.emit("remove"),this._log.debug("Removing VideoProcessor from the VideoTrack",n),clearTimeout(this._captureTimeoutId),this.mediaStreamTrack.removeEventListener("unmute",this._unmuteHandler),this._processorOptions={},this._unmuteHandler=null,this._isCapturing=!1,this.processor=null,this.processedTrack=null,this._inputFrame=null,this._outputFrame=null,this._updateElementsMediaStreamTrack(),this},r}(y);function e(t,r){return t.dimensions.width!==r.videoWidth||t.dimensions.height!==r.videoHeight}i.DIMENSIONS_CHANGED="dimensionsChanged",C.exports=i},{"../../util/constants":125,"./mediatrack":28,"./videoprocessoreventobserver":42}],44:[function(v,C,x){"use strict";var a,S=this&&this.__extends||(a=function(s,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,l){p.__proto__=l}||function(p,l){for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(p[d]=l[d])})(s,c)},function(s,c){if("function"!=typeof c&&null!==c)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");function p(){this.constructor=s}a(s,c),s.prototype=null===c?Object.create(c):(p.prototype=c.prototype,new p)}),y=this&&this.__read||function(a,s){var c="function"==typeof Symbol&&a[Symbol.iterator];if(!c)return a;var l,h,p=c.call(a),d=[];try{for(;(void 0===s||s-- >0)&&!(l=p.next()).done;)d.push(l.value)}catch(k){h={error:k}}finally{try{l&&!l.done&&(c=p.return)&&c.call(p)}finally{if(h)throw h.error}}return d},_=v("events").EventEmitter,o=v("./util/constants"),i=o.DEFAULT_NQ_LEVEL_LOCAL,e=o.DEFAULT_NQ_LEVEL_REMOTE,t=o.MAX_NQ_LEVEL,r=v("./util").inRange,n=function(a){function s(c){var p=a.call(this)||this;return c=Object.assign({local:i,remote:e},c),Object.defineProperties(p,{local:{value:r(c.local,i,t)?c.local:i,writable:!0},remote:{value:r(c.remote,e,t)?c.remote:e,writable:!0}}),p}return S(s,a),s.prototype.update=function(c){var p=this;c=Object.assign({local:this.local,remote:this.remote},c),[["local",i,3],["remote",e,3]].forEach(function(l){var d=y(l,3),h=d[0],k=d[1];p[h]="number"==typeof c[h]&&r(c[h],k,d[2])?c[h]:k})},s}(_);C.exports=n},{"./util":132,"./util/constants":125,events:173}],45:[function(v,C,x){"use strict";var S=this&&this.__awaiter||function(n,a,s,c){return new(s||(s=Promise))(function(l,d){function h(R){try{b(c.next(R))}catch(T){d(T)}}function k(R){try{b(c.throw(R))}catch(T){d(T)}}function b(R){R.done?l(R.value):function p(l){return l instanceof s?l:new s(function(d){d(l)})}(R.value).then(h,k)}b((c=c.apply(n,a||[])).next())})},y=this&&this.__generator||function(n,a){var c,p,l,d,s={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return d={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(d[Symbol.iterator]=function(){return this}),d;function h(b){return function(R){return function k(b){if(c)throw new TypeError("Generator is already executing.");for(;s;)try{if(c=1,p&&(l=2&b[0]?p.return:b[0]?p.throw||((l=p.return)&&l.call(p),0):p.next)&&!(l=l.call(p,b[1])).done)return l;switch(p=0,l&&(b=[2&b[0],l.value]),b[0]){case 0:case 1:l=b;break;case 4:return s.label++,{value:b[1],done:!1};case 5:s.label++,p=b[1],b=[0];continue;case 7:b=s.ops.pop(),s.trys.pop();continue;default:if(!(l=(l=s.trys).length>0&&l[l.length-1])&&(6===b[0]||2===b[0])){s=0;continue}if(3===b[0]&&(!l||b[1]>l[0]&&b[1]<l[3])){s.label=b[1];break}if(6===b[0]&&s.label<l[1]){s.label=l[1],l=b;break}if(l&&s.label<l[2]){s.label=l[2],s.ops.push(b);break}l[2]&&s.ops.pop(),s.trys.pop();continue}b=a.call(n,s)}catch(R){b=[6,R],p=0}finally{c=l=0}if(5&b[0])throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}([b,R])}}};Object.defineProperty(x,"__esModule",{value:!0}),x.createNoiseCancellationAudioProcessor=void 0;var _=v("./util/dynamicimport"),i=(v("./util/log"),{krisp:{supportedVersion:"1.0.0",pluginFile:"krispsdk.mjs"},rnnoise:{supportedVersion:"0.6.0",pluginFile:"rnnoise_sdk.mjs"}}),t=new Map;x.createNoiseCancellationAudioProcessor=function r(n,a){return S(this,void 0,void 0,function(){var s,c,p,d,h,k,b,R;return y(this,function(T){switch(T.label){case 0:if(s=t.get(n.vendor))return[3,6];if(!(c=i[n.vendor]))throw new Error("Unsupported NoiseCancellationOptions.vendor: "+n.vendor);p=c.supportedVersion,h=(d=n.sdkAssetsPath)+"/"+c.pluginFile,T.label=1;case 1:return T.trys.push([1,5,,6]),a.debug("loading noise cancellation sdk: ",h),[4,_(h)];case 2:return k=T.sent(),a.debug("Loaded noise cancellation sdk:",k),function(n){var a=n.supportedVersion,s=n.plugin,c=n.log;if(!s.getVersion||!s.isSupported)throw new Error("Plugin does not export getVersion/isSupported api. Are you using old version of the plugin ?");var p=s.getVersion();c.debug("Plugin Version = "+p);var l=a.split(".").map(function(b){return Number(b)}),d=p.split(".").map(function(b){return Number(b)});if(3!==l.length||3!==d.length)throw new Error("Unsupported Plugin version format: "+a+", "+p);if(l[0]!==d[0])throw new Error("Major version mismatch: [Plugin version "+p+"],  [Supported Version "+a+"]");if(d[1]<l[1])throw new Error("Minor version mismatch: [Plugin version "+p+"] < [Supported Version "+a+"]");var h=new AudioContext,k=s.isSupported(h);if(h.close(),!k)throw new Error("Noise Cancellation plugin is not supported on your browser")}({supportedVersion:p,plugin:b=k.default,log:a}),b.isInitialized()?[3,4]:(a.debug("initializing noise cancellation sdk: ",d),[4,b.init({rootDir:d})]);case 3:T.sent(),a.debug("noise cancellation sdk initialized!"),T.label=4;case 4:return t.set(n.vendor,s={vendor:n.vendor,isInitialized:function(){return b.isInitialized()},isConnected:function(){return b.isConnected()},isEnabled:function(){return b.isEnabled()},disconnect:function(){return b.disconnect()},enable:function(){return b.enable()},disable:function(){return b.disable()},destroy:function(){return b.destroy()},setLogging:function(w){return b.setLogging(w)},connect:function(w){a.debug("connect: ",w.id),b.isConnected()&&b.disconnect();var m=b.connect(new MediaStream([w]));if(!m)throw new Error("Error connecting with noise cancellation sdk");var u=m.getAudioTracks()[0];if(!u)throw new Error("Error getting clean track from noise cancellation sdk");return b.enable(),u}}),[3,6];case 5:throw R=T.sent(),a.error("Error loading noise cancellation sdk:"+h,R),R;case 6:return[2,s]}})})}},{"./util/dynamicimport":129,"./util/log":136}],46:[function(v,C,x){"use strict";var b,S=this&&this.__extends||(b=function(R,T){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,m){w.__proto__=m}||function(w,m){for(var u in m)Object.prototype.hasOwnProperty.call(m,u)&&(w[u]=m[u])})(R,T)},function(R,T){if("function"!=typeof T&&null!==T)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");function w(){this.constructor=R}b(R,T),R.prototype=null===T?Object.create(T):(w.prototype=T.prototype,new w)}),y=this&&this.__read||function(b,R){var T="function"==typeof Symbol&&b[Symbol.iterator];if(!T)return b;var m,f,w=T.call(b),u=[];try{for(;(void 0===R||R-- >0)&&!(m=w.next()).done;)u.push(m.value)}catch(g){f={error:g}}finally{try{m&&!m.done&&(T=w.return)&&T.call(w)}finally{if(f)throw f.error}}return u},_=this&&this.__spreadArray||function(b,R){for(var T=0,w=R.length,m=b.length;T<w;T++,m++)b[m]=R[T];return b},o=v("./eventemitter"),i=v("./media/track/remoteaudiotrack"),e=v("./media/track/remoteaudiotrackpublication"),t=v("./media/track/remotedatatrack"),r=v("./media/track/remotedatatrackpublication"),n=v("./media/track/remotevideotrack"),a=v("./media/track/remotevideotrackpublication"),s=v("./util"),c=0,p=function(b){function R(T,w){var m=b.call(this)||this,u=function l(b){var R=b.map(function(u){return[u.id,u]}),T=R.filter(function(u){return"audio"===u[1].kind}),w=R.filter(function(u){return"video"===u[1].kind}),m=R.filter(function(u){return"data"===u[1].kind});return{audioTracks:T,dataTracks:m,tracks:R,videoTracks:w}}((w=Object.assign({RemoteAudioTrack:i,RemoteAudioTrackPublication:e,RemoteDataTrack:t,RemoteDataTrackPublication:r,RemoteVideoTrack:n,RemoteVideoTrackPublication:a,tracks:[]},w)).tracks),f=w.log.createLog("default",m),g=new Map(u.audioTracks),P=new Map(u.dataTracks),E=new Map(u.tracks),O=new Map(u.videoTracks);return Object.defineProperties(m,{_RemoteAudioTrack:{value:w.RemoteAudioTrack},_RemoteAudioTrackPublication:{value:w.RemoteAudioTrackPublication},_RemoteDataTrack:{value:w.RemoteDataTrack},_RemoteDataTrackPublication:{value:w.RemoteDataTrackPublication},_RemoteVideoTrack:{value:w.RemoteVideoTrack},_RemoteVideoTrackPublication:{value:w.RemoteVideoTrackPublication},_audioTracks:{value:g},_dataTracks:{value:P},_instanceId:{value:++c},_clientTrackSwitchOffControl:{value:w.clientTrackSwitchOffControl},_contentPreferencesMode:{value:w.contentPreferencesMode},_log:{value:f},_signaling:{value:T},_tracks:{value:E},_trackEventReemitters:{value:new Map},_trackPublicationEventReemitters:{value:new Map},_trackSignalingUpdatedEventCallbacks:{value:new Map},_videoTracks:{value:O},audioTracks:{enumerable:!0,value:new Map},dataTracks:{enumerable:!0,value:new Map},identity:{enumerable:!0,get:function(){return T.identity}},networkQualityLevel:{enumerable:!0,get:function(){return T.networkQualityLevel}},networkQualityStats:{enumerable:!0,get:function(){return T.networkQualityStats}},sid:{enumerable:!0,get:function(){return T.sid}},state:{enumerable:!0,get:function(){return T.state}},tracks:{enumerable:!0,value:new Map},videoTracks:{enumerable:!0,value:new Map}}),m._tracks.forEach(h.bind(null,m)),T.on("networkQualityLevelChanged",function(){return m.emit("networkQualityLevelChanged",m.networkQualityLevel,m.networkQualityStats&&(m.networkQualityStats.audio||m.networkQualityStats.video)?m.networkQualityStats:null)}),function d(b,R){var T=b._log;"disconnected"!==b.state&&R.on("stateChanged",function w(m){T.debug("Transitioned to state:",m),b.emit(m,b),"disconnected"===m&&(T.debug("Removing Track event reemitters"),R.removeListener("stateChanged",w),b._tracks.forEach(function(u){var f=b._trackEventReemitters.get(u.id);u&&f&&f.forEach(function(g,P){u.removeListener(P,g)})}),R.tracks.forEach(function(u){var f=b._tracks.get(u.id),g=b._trackEventReemitters.get(u.id);f&&g&&g.forEach(function(P,E){f.removeListener(E,P)})}),b._trackEventReemitters.clear(),b.tracks.forEach(function(u){b._trackPublicationEventReemitters.get(u.trackSid).forEach(function(f,g){u.removeListener(g,f)})}),b._trackPublicationEventReemitters.clear())})}(m,T),f.info("Created a new Participant"+(m.identity?": "+m.identity:"")),m}return S(R,b),R.prototype._getTrackEvents=function(){return[["dimensionsChanged","trackDimensionsChanged"],["message","trackMessage"],["started","trackStarted"]]},R.prototype._getTrackPublicationEvents=function(){return[]},R.prototype.toString=function(){return"[Participant #"+this._instanceId+": "+this.sid+"]"},R.prototype._addTrack=function(T,w){var m=this._log;return this._tracks.has(w)?null:(this._tracks.set(w,T),{audio:this._audioTracks,video:this._videoTracks,data:this._dataTracks}[T.kind].set(w,T),h(this,T,w),m.info("Added a new "+s.trackClass(T)+":",w),m.debug(s.trackClass(T)+":",T),T)},R.prototype._addTrackPublication=function(T){var w=this._log;return this.tracks.has(T.trackSid)?null:(this.tracks.set(T.trackSid,T),{audio:this.audioTracks,data:this.dataTracks,video:this.videoTracks}[T.kind].set(T.trackSid,T),function k(b,R){var T=new Map;"disconnected"!==b.state&&(b._getTrackPublicationEvents().forEach(function(w){var m=y(w,2),u=m[0],f=m[1];T.set(u,function(){for(var g=[],P=0;P<arguments.length;P++)g[P]=arguments[P];b.emit.apply(b,_(_([f],y(g)),[R]))}),R.on(u,T.get(u))}),b._trackPublicationEventReemitters.set(R.trackSid,T))}(this,T),w.info("Added a new "+s.trackPublicationClass(T)+":",T.trackSid),w.debug(s.trackPublicationClass(T)+":",T),T)},R.prototype._handleTrackSignalingEvents=function(){var T=this,w=T._log,m=T._clientTrackSwitchOffControl,u=T._contentPreferencesMode,f=this;if("disconnected"!==this.state){var g=this._RemoteAudioTrack,P=this._RemoteAudioTrackPublication,E=this._RemoteVideoTrack,O=this._RemoteVideoTrackPublication,A=this._RemoteDataTrack,N=this._RemoteDataTrackPublication,j=this._signaling;j.on("trackAdded",M),j.on("trackRemoved",Q),j.tracks.forEach(M),j.on("stateChanged",function F(V){"disconnected"===V?(w.debug("Removing event listeners"),j.removeListener("stateChanged",F),j.removeListener("trackAdded",M),j.removeListener("trackRemoved",Q)):"connected"===V&&(w.info("reconnected"),setTimeout(function(){return f.emit("reconnected")},0))})}function M(F){var D=new(0,{audio:P,data:N,video:O}[F.kind])(F,{log:w});f._addTrackPublication(D);var L=F.isSubscribed;L&&G(F),f._trackSignalingUpdatedEventCallbacks.set(F.sid,function(){if(L!==F.isSubscribed){if(L=F.isSubscribed)return void G(F);!function K(F){var V=y(Array.from(f._tracks.entries()).find(function(J){return y(J,2)[1].sid===F.sid}),2),D=V[0],L=V[1],H=f.tracks.get(F.sid);L&&f._removeTrack(L,H,D)}(F)}}),F.on("updated",f._trackSignalingUpdatedEventCallbacks.get(F.sid))}function Q(F){F.isSubscribed&&F.setTrackTransceiver(null);var V=f._trackSignalingUpdatedEventCallbacks.get(F.sid);V&&(F.removeListener("updated",V),f._trackSignalingUpdatedEventCallbacks.delete(F.sid));var D=f.tracks.get(F.sid);D&&f._removeTrackPublication(D)}function G(F){var V=F.isEnabled,D=F.name,L=F.kind,H=F.sid,J=F.trackTransceiver,X=F.isSwitchedOff,$={audio:g,video:E,data:A}[L],Z=f.tracks.get(H);if($&&L===J.kind){var se={log:w,name:D,clientTrackSwitchOffControl:m,contentPreferencesMode:u},ve="data"===L?new $(H,J,se):new $(H,J,V,X,function(ce){return j.updateSubscriberTrackPriority(H,ce)},function(ce){F.isSubscribed&&j.updateTrackRenderHint(H,ce)},se);f._addTrack(ve,Z,J.id)}}},R.prototype._removeTrack=function(T,w){if(!this._tracks.has(w))return null;this._tracks.delete(w),{audio:this._audioTracks,video:this._videoTracks,data:this._dataTracks}[T.kind].delete(w),(this._trackEventReemitters.get(w)||new Map).forEach(function(g,P){T.removeListener(P,g)});var f=this._log;return f.info("Removed a "+s.trackClass(T)+":",w),f.debug(s.trackClass(T)+":",T),T},R.prototype._removeTrackPublication=function(T){if(!(T=this.tracks.get(T.trackSid)))return null;this.tracks.delete(T.trackSid),{audio:this.audioTracks,data:this.dataTracks,video:this.videoTracks}[T.kind].delete(T.trackSid),(this._trackPublicationEventReemitters.get(T.trackSid)||new Map).forEach(function(f,g){T.removeListener(g,f)});var u=this._log;return u.info("Removed a "+s.trackPublicationClass(T)+":",T.trackSid),u.debug(s.trackPublicationClass(T)+":",T),T},R.prototype.toJSON=function(){return s.valueToJSON(this)},R}(o);function h(b,R,T){var w=new Map;"disconnected"!==b.state&&(b._getTrackEvents().forEach(function(m){var u=m[0],f=m[1];w.set(u,function(){var g=[f].concat([].slice.call(arguments));return b.emit.apply(b,_([],y(g)))}),R.on(u,w.get(u))}),b._trackEventReemitters.set(T,w))}C.exports=p},{"./eventemitter":10,"./media/track/remoteaudiotrack":31,"./media/track/remoteaudiotrackpublication":32,"./media/track/remotedatatrack":33,"./media/track/remotedatatrackpublication":34,"./media/track/remotevideotrack":37,"./media/track/remotevideotrackpublication":38,"./util":132}],47:[function(v,C,x){"use strict";var S=this&&this.__awaiter||function(r,n,a,s){return new(a||(a=Promise))(function(p,l){function d(b){try{k(s.next(b))}catch(R){l(R)}}function h(b){try{k(s.throw(b))}catch(R){l(R)}}function k(b){b.done?p(b.value):function c(p){return p instanceof a?p:new a(function(l){l(p)})}(b.value).then(d,h)}k((s=s.apply(r,n||[])).next())})},y=this&&this.__generator||function(r,n){var s,c,p,l,a={label:0,sent:function(){if(1&p[0])throw p[1];return p[1]},trys:[],ops:[]};return l={next:d(0),throw:d(1),return:d(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function d(k){return function(b){return function h(k){if(s)throw new TypeError("Generator is already executing.");for(;a;)try{if(s=1,c&&(p=2&k[0]?c.return:k[0]?c.throw||((p=c.return)&&p.call(c),0):c.next)&&!(p=p.call(c,k[1])).done)return p;switch(c=0,p&&(k=[2&k[0],p.value]),k[0]){case 0:case 1:p=k;break;case 4:return a.label++,{value:k[1],done:!1};case 5:a.label++,c=k[1],k=[0];continue;case 7:k=a.ops.pop(),a.trys.pop();continue;default:if(!(p=(p=a.trys).length>0&&p[p.length-1])&&(6===k[0]||2===k[0])){a=0;continue}if(3===k[0]&&(!p||k[1]>p[0]&&k[1]<p[3])){a.label=k[1];break}if(6===k[0]&&a.label<p[1]){a.label=p[1],p=k;break}if(p&&a.label<p[2]){a.label=p[2],a.ops.push(k);break}p[2]&&a.ops.pop(),a.trys.pop();continue}k=n.call(r,a)}catch(b){k=[6,b],c=0}finally{s=p=0}if(5&k[0])throw k[1];return{value:k[0]?k[1]:void 0,done:!0}}([k,b])}}},_=this&&this.__read||function(r,n){var a="function"==typeof Symbol&&r[Symbol.iterator];if(!a)return r;var c,l,s=a.call(r),p=[];try{for(;(void 0===n||n-- >0)&&!(c=s.next()).done;)p.push(c.value)}catch(d){l={error:d}}finally{try{c&&!c.done&&(a=s.return)&&a.call(s)}finally{if(l)throw l.error}}return p};function o(r,n,a,s){var c=[];return r.forEach(function(p){(0===s.length||s.includes(p.type))&&(0===a.length||a.includes(p.kind))&&"number"==typeof p[n]&&c.push(p[n])}),c}function e(r){return[{key:"transportId",type:"string"},{key:"candidateType",type:"string"},{key:"port",altKeys:["portNumber"],type:"number"},{key:"address",altKeys:["ip","ipAddress"],type:"string"},{key:"priority",type:"number"},{key:"protocol",altKeys:["transport"],type:"string"},{key:"url",type:"string"},{key:"relayProtocol",type:"string"}].reduce(function(a,s){var c=[s.key];s.altKeys&&(c=c.concat(s.altKeys));var p=c.find(function(l){return l in r});return p&&typeof r[p]===s.type&&(a[s.key]=r[p]),a},{})}Object.defineProperty(x,"__esModule",{value:!0}),x.getCombinedConnectionStats=void 0,x.getCombinedConnectionStats=function i(r){var n=r.publisher,a=r.subscriber;return S(this,void 0,void 0,function(){var s,c,p,l,d,h,k,b,R,T,w,m,u,f,g;return y(this,function(P){switch(P.label){case 0:return[4,Promise.all([n,a].map(function(E){return E.getStats()}))];case 1:return s=_.apply(void 0,[P.sent(),2]),c=s[0],l=o(p=s[1],"timestamp",["audio"],["inbound-rtp"]),d=l.length>0?l[0]:0,h=o(p,"jitter",["audio"],["inbound-rtp"]).reduce(function(E,O){return Math.max(E,O)},0),k=o(p,"packetsReceived",["audio","video"],["inbound-rtp"]).reduce(function(E,O){return E+O},0),b=o(p,"packetsLost",["audio","video"],["inbound-rtp"]).reduce(function(E,O){return E+O},0),R=o(c,"roundTripTime",["audio","video"],["remote-inbound-rtp"]).reduce(function(E,O){return Math.max(E,O)},0),T=o(p,"currentRoundTripTime",[],["candidate-pair"]).reduce(function(E,O){return Math.max(E,O)},0),w=1e3*(T||R),m=o(c,"bytesSent",[],["candidate-pair"]).reduce(function(E,O){return E+O},0),u=o(p,"bytesReceived",[],["candidate-pair"]).reduce(function(E,O){return E+O},0),f=function t(r){var n=null,a=[];r.forEach(function(d){"transport"===d.type&&d.selectedCandidatePairId?n=d.selectedCandidatePairId:"candidate-pair"===d.type&&a.push(d)});var s=a.find(function(d){return d.selected||n&&d.id===n});if(!s)return null;var c=s,p=r.get(c.localCandidateId),l=r.get(c.remoteCandidateId);return p&&l?{localCandidate:e(p),remoteCandidate:e(l)}:null}(p),g=[],p.forEach(function(E){("local-candidate"===E.type||"remote-candidate"===E.type)&&g.push(e(E))}),[2,{timestamp:d,jitter:h,packets:k,packetsLost:b,roundTripTime:w,bytesSent:m,bytesReceived:u,selectedIceCandidatePairStats:f,iceCandidateStats:g}]}})})}},{}],48:[function(v,C,x){"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.getTurnCredentials=void 0;var S=v("../twilioconnection.js"),y=v("../util/constants").ICE_VERSION,_=v("../util/twilio-video-errors"),o=_.createTwilioError,i=_.SignalingConnectionError,e=v("events");x.getTurnCredentials=function t(r,n){return new Promise(function(a,s){var c=new e.EventEmitter,l=new S(n,{networkMonitor:null,eventObserver:c,helloBody:{edge:"roaming",preflight:!0,token:r,type:"ice",version:y}}),d=!1;l.once("close",function(){d||(d=!0,s(new i))}),l.on("message",function(h){var k=h.code,b=h.message,T=h.type;("iced"===T||"error"===T)&&!d&&(d=!0,"iced"===T?a(h.ice_servers):s(o(k,b)),l.close())})})}},{"../twilioconnection.js":120,"../util/constants":125,"../util/twilio-video-errors":147,events:173}],49:[function(v,C,x){"use strict";var S=this&&this.__read||function(o,i){var e="function"==typeof Symbol&&o[Symbol.iterator];if(!e)return o;var r,a,t=e.call(o),n=[];try{for(;(void 0===i||i-- >0)&&!(r=t.next()).done;)n.push(r.value)}catch(s){a={error:s}}finally{try{r&&!r.done&&(e=t.return)&&e.call(t)}finally{if(a)throw a.error}}return n},y=this&&this.__spreadArray||function(o,i){for(var e=0,t=i.length,r=o.length;e<t;e++,r++)o[r]=i[e];return o};Object.defineProperty(x,"__esModule",{value:!0}),x.makeStat=void 0,x.makeStat=function _(o){return o&&o.length?{min:Math.min.apply(Math,y([],S(o))),max:Math.max.apply(Math,y([],S(o))),average:o.reduce(function(r,n){return r+n},0)/o.length}:null}},{}],50:[function(v,C,x){"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.mosToScore=x.calculateMOS=void 0;var S=94.768;x.calculateMOS=function y(o,i,e){var t=o+2*i+10,r=0;switch(!0){case t<160:r=S-t/40;break;case t<1e3:r=S-(t-120)/10}return 1+.035*(r=1==e<=r/2.5?Math.max(r-2.5*e,6.52):0)+7e-6*r*(r-60)*(100-r)},x.mosToScore=function _(o){return o?o>4.2?5:o>4?4:o>3.6?3:o>3?2:1:0}},{}],51:[function(v,C,x){"use strict";var G,S=this&&this.__extends||(G=function(K,F){return(G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(V,D){V.__proto__=D}||function(V,D){for(var L in D)Object.prototype.hasOwnProperty.call(D,L)&&(V[L]=D[L])})(K,F)},function(K,F){if("function"!=typeof F&&null!==F)throw new TypeError("Class extends value "+String(F)+" is not a constructor or null");function V(){this.constructor=K}G(K,F),K.prototype=null===F?Object.create(F):(V.prototype=F.prototype,new V)}),y=this&&this.__assign||function(){return y=Object.assign||function(G){for(var K,F=1,V=arguments.length;F<V;F++)for(var D in K=arguments[F])Object.prototype.hasOwnProperty.call(K,D)&&(G[D]=K[D]);return G},y.apply(this,arguments)},_=this&&this.__awaiter||function(G,K,F,V){return new(F||(F=Promise))(function(L,H){function J(Z){try{$(V.next(Z))}catch(se){H(se)}}function X(Z){try{$(V.throw(Z))}catch(se){H(se)}}function $(Z){Z.done?L(Z.value):function D(L){return L instanceof F?L:new F(function(H){H(L)})}(Z.value).then(J,X)}$((V=V.apply(G,K||[])).next())})},o=this&&this.__generator||function(G,K){var V,D,L,H,F={label:0,sent:function(){if(1&L[0])throw L[1];return L[1]},trys:[],ops:[]};return H={next:J(0),throw:J(1),return:J(2)},"function"==typeof Symbol&&(H[Symbol.iterator]=function(){return this}),H;function J($){return function(Z){return function X($){if(V)throw new TypeError("Generator is already executing.");for(;F;)try{if(V=1,D&&(L=2&$[0]?D.return:$[0]?D.throw||((L=D.return)&&L.call(D),0):D.next)&&!(L=L.call(D,$[1])).done)return L;switch(D=0,L&&($=[2&$[0],L.value]),$[0]){case 0:case 1:L=$;break;case 4:return F.label++,{value:$[1],done:!1};case 5:F.label++,D=$[1],$=[0];continue;case 7:$=F.ops.pop(),F.trys.pop();continue;default:if(!(L=(L=F.trys).length>0&&L[L.length-1])&&(6===$[0]||2===$[0])){F=0;continue}if(3===$[0]&&(!L||$[1]>L[0]&&$[1]<L[3])){F.label=$[1];break}if(6===$[0]&&F.label<L[1]){F.label=L[1],L=$;break}if(L&&F.label<L[2]){F.label=L[2],F.ops.push($);break}L[2]&&F.ops.pop(),F.trys.pop();continue}$=K.call(G,F)}catch(Z){$=[6,Z],D=0}finally{V=L=0}if(5&$[0])throw $[1];return{value:$[0]?$[1]:void 0,done:!0}}([$,Z])}}};Object.defineProperty(x,"__esModule",{value:!0}),x.runPreflight=x.PreflightTest=void 0;var i=v("../util/constants"),e=v("./timer"),t=v("./mos"),r=v("./getCombinedConnectionStats"),n=v("./getturncredentials"),a=v("./makestat"),s=v("./syntheticaudio"),c=v("./syntheticvideo"),p=v("../util/index"),l=v("../util/constants").WS_SERVER,d=v("../util/log"),h=v("../eventemitter"),k=v("../util/movingaveragedelta"),b=v("../util/eventobserver"),R=v("../util/insightspublisher"),T=v("../util/sid"),w=T.createSID,m=T.sessionSID,u=v("../util/twilio-video-errors"),f=u.SignalingConnectionTimeoutError,g=u.MediaConnectionError;function A(G){return null!==G&&typeof G<"u"}var N=0,j=function(G){function K(F,V){var D=G.call(this)||this;D._testTiming=new e.Timer,D._dtlsTiming=new e.Timer,D._iceTiming=new e.Timer,D._peerConnectionTiming=new e.Timer,D._mediaTiming=new e.Timer,D._connectTiming=new e.Timer,D._sentBytesMovingAverage=new k,D._packetLossMovingAverage=new k,D._progressEvents=[],D._receivedBytesMovingAverage=new k;var H=V.environment,J=void 0===H?"prod":H,X=V.region,Z=V.duration,se=void 0===Z?1e4:Z,le=V.wsServer||l(J,void 0===X?"gll":X);return D._log=new d("default",D,i.DEFAULT_LOG_LEVEL,i.DEFAULT_LOGGER_NAME),D._testDuration=se,D._instanceId=N++,D._testTiming.start(),D._runPreflightTest(F,J,le),D}return S(K,G),K.prototype.toString=function(){return"[Preflight #"+this._instanceId+"]"},K.prototype.stop=function(){this._stopped=!0},K.prototype._generatePreflightReport=function(F){return this._testTiming.stop(),{testTiming:this._testTiming.getTimeMeasurement(),networkTiming:{dtls:this._dtlsTiming.getTimeMeasurement(),ice:this._iceTiming.getTimeMeasurement(),peerConnection:this._peerConnectionTiming.getTimeMeasurement(),connect:this._connectTiming.getTimeMeasurement(),media:this._mediaTiming.getTimeMeasurement()},stats:{jitter:a.makeStat(F?.jitter),rtt:a.makeStat(F?.rtt),packetLoss:a.makeStat(F?.packetLoss)},selectedIceCandidatePairStats:F?F.selectedIceCandidatePairStats:null,iceCandidateStats:F?F.iceCandidateStats:[],progressEvents:this._progressEvents,mos:a.makeStat(F?.mos)}},K.prototype._executePreflightStep=function(F,V,D){return _(this,void 0,void 0,function(){var L,H,J,X;return o(this,function(Z){switch(Z.label){case 0:if(this._log.debug("Executing step: ",F),L=this._testDuration+1e4,this._stopped)throw new Error("stopped");H=Promise.resolve().then(V),J=null,X=new Promise(function(se,le){J=setTimeout(function(){le(D||new Error(F+" timeout."))},L)}),Z.label=1;case 1:return Z.trys.push([1,,3,4]),[4,Promise.race([X,H])];case 2:return[2,Z.sent()];case 3:return null!==J&&clearTimeout(J),[7];case 4:return[2]}})})},K.prototype._collectNetworkTimings=function(F){var V=this;return new Promise(function(D){var L;F.addEventListener("iceconnectionstatechange",function(){"checking"===F.iceConnectionState&&V._iceTiming.start(),"connected"===F.iceConnectionState&&(V._iceTiming.stop(),V._updateProgress("iceConnected"),(!L||L&&"connected"===L.state)&&D())}),F.addEventListener("connectionstatechange",function(){"connecting"===F.connectionState&&V._peerConnectionTiming.start(),"connected"===F.connectionState&&(V._peerConnectionTiming.stop(),V._updateProgress("peerConnectionConnected"))});var J=F.getSenders().map(function(X){return X.transport}).find(A);typeof J<"u"&&(L=J).addEventListener("statechange",function(){"connecting"===L.state&&V._dtlsTiming.start(),"connected"===L.state&&(V._dtlsTiming.stop(),V._updateProgress("dtlsConnected"),"connected"===F.iceConnectionState&&D())})})},K.prototype._setupInsights=function(F){var D=F.environment,H=F.realm,$=new R(F.token,i.SDK_NAME,i.SDK_VERSION,void 0===D?i.DEFAULT_ENVIRONMENT:D,void 0===H?i.DEFAULT_REALM:H,{});$.connect("PREFLIGHT_ROOM_SID","PREFLIGHT_PARTICIPANT");var Z=new b($,Date.now(),this._log),se=void 0;return{reportToInsights:function(le){var de,ve,ce=le.report,fe=ce.stats.jitter||se,pe=ce.stats.rtt||se,ye=ce.stats.packetLoss||se,ge=ce.mos||se,ke=new Map;ce.iceCandidateStats.forEach(function(Y){if(Y.candidateType&&Y.protocol){var q=ke.get(Y.candidateType)||[];q.indexOf(Y.protocol)<0&&q.push(Y.protocol),ke.set(Y.candidateType,q)}});var Le=JSON.stringify(Object.fromEntries(ke)),we={name:"report",group:"preflight",level:ce.error?"error":"info",payload:{sessionSID:m,preflightSID:w("PF"),progressEvents:JSON.stringify(ce.progressEvents),testTiming:ce.testTiming,dtlsTiming:ce.networkTiming.dtls,iceTiming:ce.networkTiming.ice,peerConnectionTiming:ce.networkTiming.peerConnection,connectTiming:ce.networkTiming.connect,mediaTiming:ce.networkTiming.media,selectedLocalCandidate:null===(de=ce.selectedIceCandidatePairStats)||void 0===de?void 0:de.localCandidate,selectedRemoteCandidate:null===(ve=ce.selectedIceCandidatePairStats)||void 0===ve?void 0:ve.remoteCandidate,iceCandidateStats:Le,jitterStats:fe,rttStats:pe,packetLossStats:ye,mosStats:ge,error:ce.error}};Z.emit("event",we),setTimeout(function(){return $.disconnect()},2e3)}}},K.prototype._runPreflightTest=function(F,V,D){return _(this,void 0,void 0,function(){var L,H,J,X,$,Z,se,le,de,ve,ce,fe,pe=this;return o(this,function(ye){switch(ye.label){case 0:L=[],H=[],J=this._setupInsights({token:F,environment:V}).reportToInsights,ye.label=1;case 1:return ye.trys.push([1,8,9,10]),X=[],[4,this._executePreflightStep("Acquire media",function(){return[s.syntheticAudio(),c.syntheticVideo({width:640,height:480})]})];case 2:return L=ye.sent(),this._updateProgress("mediaAcquired"),this.emit("debug",{localTracks:L}),this._connectTiming.start(),[4,this._executePreflightStep("Get turn credentials",function(){return n.getTurnCredentials(F,D)},new f)];case 3:return $=ye.sent(),this._connectTiming.stop(),this._updateProgress("connected"),Z=new RTCPeerConnection({iceServers:$,iceTransportPolicy:"relay",bundlePolicy:"max-bundle"}),se=new RTCPeerConnection({iceServers:$,bundlePolicy:"max-bundle"}),H.push(Z),H.push(se),this._mediaTiming.start(),[4,this._executePreflightStep("Setup Peer Connections",function(){return _(pe,void 0,void 0,function(){var ge,ke,Le,we;return o(this,function(Y){switch(Y.label){case 0:return Z.addEventListener("icecandidate",function(q){return q.candidate&&se.addIceCandidate(q.candidate)}),se.addEventListener("icecandidate",function(q){return q.candidate&&Z.addIceCandidate(q.candidate)}),L.forEach(function(q){return Z.addTrack(q)}),ge=new Promise(function(q){var B=[];se.addEventListener("track",function(I){B.push(I.track),B.length===L.length&&q(B)})}),[4,Z.createOffer()];case 1:return ke=Y.sent(),[4,Z.setLocalDescription(Le=ke)];case 2:return Y.sent(),[4,se.setRemoteDescription(Le)];case 3:return Y.sent(),[4,se.createAnswer()];case 4:return we=Y.sent(),[4,se.setLocalDescription(we)];case 5:return Y.sent(),[4,Z.setRemoteDescription(we)];case 6:return Y.sent(),[4,this._collectNetworkTimings(Z)];case 7:return Y.sent(),[2,ge]}})})},new g)];case 4:return le=ye.sent(),this.emit("debug",{remoteTracks:le}),le.forEach(function(ge){ge.addEventListener("ended",function(){return pe._log.warn(ge.kind+":ended")}),ge.addEventListener("mute",function(){return pe._log.warn(ge.kind+":muted")}),ge.addEventListener("unmute",function(){return pe._log.warn(ge.kind+":unmuted")})}),this._updateProgress("mediaSubscribed"),[4,this._executePreflightStep("Wait for tracks to start",function(){return new Promise(function(ge){var ke=document.createElement("video");ke.autoplay=!0,ke.playsInline=!0,ke.muted=!0,ke.srcObject=new MediaStream(le),X.push(ke),pe.emit("debugElement",ke),ke.oncanplay=ge})},new g)];case 5:return ye.sent(),this._mediaTiming.stop(),this._updateProgress("mediaStarted"),[4,this._executePreflightStep("Collect stats for duration",function(){return pe._collectRTCStatsForDuration(pe._testDuration,{mos:[],jitter:[],rtt:[],outgoingBitrate:[],incomingBitrate:[],packetLoss:[],selectedIceCandidatePairStats:null,iceCandidateStats:[]},Z,se)})];case 6:return de=ye.sent(),[4,this._executePreflightStep("Generate report",function(){return pe._generatePreflightReport(de)})];case 7:return ve=ye.sent(),J({report:ve}),this.emit("completed",ve),[3,10];case 8:return ce=ye.sent(),fe=this._generatePreflightReport(),J({report:y(y({},fe),{error:ce?.toString()})}),this.emit("failed",ce,fe),[3,10];case 9:return H.forEach(function(ge){return ge.close()}),L.forEach(function(ge){return ge.stop()}),[7];case 10:return[2]}})})},K.prototype._collectRTCStats=function(F,V,D){return _(this,void 0,void 0,function(){var L,H,J,X,$,Z,se,le,de,ve,ce,fe,pe,ye;return o(this,function(ge){switch(ge.label){case 0:return[4,r.getCombinedConnectionStats({publisher:V,subscriber:D})];case 1:return L=ge.sent(),H=L.timestamp,J=L.bytesSent,X=L.bytesReceived,$=L.packets,Z=L.packetsLost,se=L.roundTripTime,de=L.selectedIceCandidatePairStats,ve=L.iceCandidateStats,ce=F.jitter.length>0,F.jitter.push(le=L.jitter),F.rtt.push(se),this._sentBytesMovingAverage.putSample(J,H),this._receivedBytesMovingAverage.putSample(X,H),this._packetLossMovingAverage.putSample(Z,$),ce&&(F.outgoingBitrate.push(1e3*this._sentBytesMovingAverage.get()*8),F.incomingBitrate.push(1e3*this._receivedBytesMovingAverage.get()*8),fe=this._packetLossMovingAverage.get(),pe=Math.min(100,100*fe),F.packetLoss.push(pe),ye=t.calculateMOS(se,le,fe),F.mos.push(ye)),F.selectedIceCandidatePairStats||(F.selectedIceCandidatePairStats=de),0===F.iceCandidateStats.length&&(F.iceCandidateStats=ve),[2]}})})},K.prototype._collectRTCStatsForDuration=function(F,V,D,L){return _(this,void 0,void 0,function(){var H,J,X;return o(this,function($){switch($.label){case 0:return H=Date.now(),J=Math.min(1e3,F),[4,p.waitForSometime(J)];case 1:return $.sent(),[4,this._collectRTCStats(V,D,L)];case 2:return $.sent(),(X=F-(Date.now()-H))>0?[4,this._collectRTCStatsForDuration(X,V,D,L)]:[3,4];case 3:V=$.sent(),$.label=4;case 4:return[2,V]}})})},K.prototype._updateProgress=function(F){var V=Date.now()-this._testTiming.getTimeMeasurement().start;this._progressEvents.push({duration:V,name:F}),this.emit("progress",F)},K}(h);x.PreflightTest=j,x.runPreflight=function Q(G,K){return void 0===K&&(K={}),new j(G,K)}},{"../eventemitter":10,"../util/constants":125,"../util/eventobserver":130,"../util/index":132,"../util/insightspublisher":133,"../util/log":136,"../util/movingaveragedelta":137,"../util/sid":144,"../util/twilio-video-errors":147,"./getCombinedConnectionStats":47,"./getturncredentials":48,"./makestat":49,"./mos":50,"./syntheticaudio":52,"./syntheticvideo":53,"./timer":54}],52:[function(v,C,x){"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.syntheticAudio=void 0,x.syntheticAudio=function S(){var y=v("../webaudio/audiocontext"),_={},o=y.getOrCreate(_),i=o.createOscillator(),e=i.connect(o.createMediaStreamDestination());i.start();var t=e.stream.getAudioTracks()[0],r=t.stop;return t.stop=function(){r.call(t),y.release(_)},t}},{"../webaudio/audiocontext":153}],53:[function(v,C,x){"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.syntheticVideo=void 0,x.syntheticVideo=function S(y){var _=void 0===y?{}:y,o=_.width,i=void 0===o?640:o,e=_.height,t=void 0===e?480:e,r=Object.assign(document.createElement("canvas"),{width:i,height:t}),n=r.getContext("2d");n.fillStyle="green",n.fillRect(0,0,r.width,r.height);var a=!1;requestAnimationFrame(function l(){if(!a){var d=Math.round(255*Math.random()),h=Math.round(255*Math.random()),k=Math.round(255*Math.random()),b=Math.round(255*Math.random());n.fillStyle="rgba("+d+", "+h+", "+k+", "+b+")",n.fillRect(Math.random()*i,Math.random()*t,50,50),requestAnimationFrame(l)}});var c=r.captureStream(30).getTracks()[0],p=c.stop;return c.stop=function(){a=!0,p.call(c)},c}},{}],54:[function(v,C,x){"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.Timer=void 0;var S=function(){function y(){this._end=void 0,this.start()}return y.prototype.start=function(){return this._start=Date.now(),this},y.prototype.stop=function(){return this._end=Date.now(),this},y.prototype.getTimeMeasurement=function(){return{start:this._start,end:this._end,duration:void 0===this._end?void 0:this._end-this._start}},y}();x.Timer=S},{}],55:[function(v,C,x){"use strict";var e,S=this&&this.__extends||(e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(n[s]=a[s])})(t,r)},function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),y=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var a,c,n=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(a=n.next()).done;)s.push(a.value)}catch(p){c={error:p}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(c)throw c.error}}return s},_=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,a=e.length;r<n;r++,a++)e[a]=t[r];return e},i=function(e){function t(){var r=e.call(this)||this;return Object.defineProperties(r,{_queuedEvents:{value:new Map}}),r}return S(t,e),t.prototype.dequeue=function(r){var n=this,a=!0;if(!r)return this._queuedEvents.forEach(function(c,p){a=this.dequeue(p)&&a},this),a;var s=this._queuedEvents.get(r)||[];return this._queuedEvents.delete(r),s.reduce(function(c,p){return n.emit.apply(n,_([],y([r].concat(p))))&&c},a)},t.prototype.queue=function(){var r=[].slice.call(arguments);if(this.emit.apply(this,_([],y(r))))return!0;var n=r[0];return this._queuedEvents.has(n)||this._queuedEvents.set(n,[]),this._queuedEvents.get(n).push(r.slice(1)),!1},t}(v("events").EventEmitter);C.exports=i},{events:173}],56:[function(v,C,x){"use strict";var e,S=this&&this.__extends||(e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(n[s]=a[s])})(t,r)},function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),y=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var a,c,n=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(a=n.next()).done;)s.push(a.value)}catch(p){c={error:p}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(c)throw c.error}}return s},_=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,a=e.length;r<n;r++,a++)e[a]=t[r];return e},i=function(e){function t(r,n){var a=e.call(this,r,n)||this;return a._handleTrackSignalingEvents(),a.once("disconnected",a._unsubscribeTracks.bind(a)),a}return S(t,e),t.prototype.toString=function(){return"[RemoteParticipant #"+this._instanceId+(this.sid?": "+this.sid:"")+"]"},t.prototype._addTrack=function(r,n,a){return e.prototype._addTrack.call(this,r,a)?(n._subscribed(r),this.emit("trackSubscribed",r,n),r):null},t.prototype._addTrackPublication=function(r){var n=e.prototype._addTrackPublication.call(this,r);return n?(this.emit("trackPublished",n),n):null},t.prototype._getTrackPublicationEvents=function(){return _(_([],y(e.prototype._getTrackPublicationEvents.call(this))),[["subscriptionFailed","trackSubscriptionFailed"],["trackDisabled","trackDisabled"],["trackEnabled","trackEnabled"],["publishPriorityChanged","trackPublishPriorityChanged"],["trackSwitchedOff","trackSwitchedOff"],["trackSwitchedOn","trackSwitchedOn"]])},t.prototype._unsubscribeTracks=function(){var r=this;this.tracks.forEach(function(n){if(n.isSubscribed){var a=n.track;n._unsubscribe(),r.emit("trackUnsubscribed",a,n)}})},t.prototype._removeTrack=function(r,n,a){var s=this._tracks.get(a);return s?(e.prototype._removeTrack.call(this,s,a),n._unsubscribe(),this.emit("trackUnsubscribed",s,n),s):null},t.prototype._removeTrackPublication=function(r){this._signaling.clearTrackHint(r.trackSid);var n=e.prototype._removeTrackPublication.call(this,r);return n?(this.emit("trackUnpublished",n),n):null},t}(v("./participant"));C.exports=i},{"./participant":46}],57:[function(v,C,x){"use strict";var b,S=this&&this.__extends||(b=function(R,T){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,m){w.__proto__=m}||function(w,m){for(var u in m)Object.prototype.hasOwnProperty.call(m,u)&&(w[u]=m[u])})(R,T)},function(R,T){if("function"!=typeof T&&null!==T)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");function w(){this.constructor=R}b(R,T),R.prototype=null===T?Object.create(T):(w.prototype=T.prototype,new w)}),y=this&&this.__read||function(b,R){var T="function"==typeof Symbol&&b[Symbol.iterator];if(!T)return b;var m,f,w=T.call(b),u=[];try{for(;(void 0===R||R-- >0)&&!(m=w.next()).done;)u.push(m.value)}catch(g){f={error:g}}finally{try{m&&!m.done&&(T=w.return)&&T.call(w)}finally{if(f)throw f.error}}return u},_=this&&this.__spreadArray||function(b,R){for(var T=0,w=R.length,m=b.length;T<w;T++,m++)b[m]=R[T];return b},o=v("./eventemitter"),i=v("./remoteparticipant"),e=v("./stats/statsreport"),t=v("./util"),r=t.flatMap,n=t.valueToJSON,a=0,s=function(b){function R(T,w,m){var u=b.call(this)||this,f=m.log.createLog("default",u),g=new Map;return Object.defineProperties(u,{_log:{value:f},_clientTrackSwitchOffControl:{value:m.clientTrackSwitchOffControl||"disabled"},_contentPreferencesMode:{value:m.contentPreferencesMode||"disabled"},_instanceId:{value:++a},_options:{value:m},_participants:{value:g},_signaling:{value:w},dominantSpeaker:{enumerable:!0,get:function(){return this.participants.get(w.dominantSpeakerSid)||null}},isRecording:{enumerable:!0,get:function(){return w.recording.isEnabled||!1}},localParticipant:{enumerable:!0,value:T},name:{enumerable:!0,value:w.name},participants:{enumerable:!0,value:g},sid:{enumerable:!0,value:w.sid},state:{enumerable:!0,get:function(){return w.state}},mediaRegion:{enumerable:!0,value:w.mediaRegion}}),function d(b,R){var T=["trackWarning","trackWarningsCleared"].map(function(w){return{eventName:w,handler:function(){for(var m=[],u=0;u<arguments.length;u++)m[u]=arguments[u];return b.emit.apply(b,_([w],y(_(_([],y(m)),[R]))))}}});T.forEach(function(w){return R.on(w.eventName,w.handler)}),b.once("disconnected",function(){return T.forEach(function(w){return R.removeListener(w.eventName,w.handler)})})}(u,T),function h(b,R){R.on("updated",function(){var w=R.isEnabled;b._log.info("Recording "+(w?"started":"stopped")),b.emit("recording"+(w?"Started":"Stopped"))})}(u,w.recording),function k(b,R){var T=b._log;T.debug("Creating a new RemoteParticipant for each ParticipantSignaling in the RoomSignaling"),R.participants.forEach(l.bind(null,b)),T.debug("Setting up RemoteParticipant creation for all subsequent ParticipantSignalings that connect to the RoomSignaling"),R.on("participantConnected",l.bind(null,b)),R.on("dominantSpeakerChanged",function(){return b.emit("dominantSpeakerChanged",b.dominantSpeaker)}),R.on("stateChanged",function w(m,u){switch(T.info("Transitioned to state:",m),m){case"disconnected":b.participants.forEach(function(f){f._unsubscribeTracks()}),b.emit(m,b,u),b.localParticipant.tracks.forEach(function(f){f.unpublish()}),R.removeListener("stateChanged",w);break;case"reconnecting":setTimeout(function(){return b.emit("reconnecting",u)},0);break;default:setTimeout(function(){return b.emit("reconnected")},0)}})}(u,w),function c(b){var R=b.localParticipant._signaling.audioProcessors;b.localParticipant.audioTracks.forEach(function(T){var m=T.track.noiseCancellation;m&&!R.includes(m.vendor)&&(b._log.warn(m.vendor+" is not supported in this room. disabling it permanently"),m.disablePermanently())})}(u),f.info("Created a new Room:",u.name),f.debug("Initial RemoteParticipants:",Array.from(u._participants.values())),u}return S(R,b),R.prototype.toString=function(){return"[Room #"+this._instanceId+": "+this.sid+"]"},R.prototype.disconnect=function(){return this._log.info("Disconnecting"),this._signaling.disconnect(),this},R.prototype.getStats=function(){var T=this;return this._signaling.getStats().then(function(w){return Array.from(w).map(function(m){var u=y(m,2),g=u[1];return new e(u[0],Object.assign({},g,{localAudioTrackStats:p(T,g.localAudioTrackStats),localVideoTrackStats:p(T,g.localVideoTrackStats)}))})})},R.prototype.refreshInactiveMedia=function(){var w=Array.from(this.localParticipant.tracks.values()).filter(function(P){return"data"!==P.track.kind}).map(function(P){return P.track}),m=r(this.participants,function(P){return Array.from(P.tracks.values())}).filter(function(P){var E=P.track;return E&&"data"!==E.kind}).map(function(P){return P.track}),u=w.concat(m),f=new Event("unmute");w.forEach(function(P){P.isMuted&&P.mediaStreamTrack.dispatchEvent(f)});var g=new Event("pause");return u.forEach(function(P){var O=P._elShims;return P._attachments.forEach(function(A){var N=O.get(A);A.paused&&N&&!N.pausedIntentionally()&&A.dispatchEvent(g)})}),this},R.prototype.toJSON=function(){return n(this)},R}(o);function p(b,R){var T=b.localParticipant._signaling;return R.reduce(function(w,m){var u=T.tracks.get(m.trackId),f=T.getSender(u);return f?[Object.assign({},m,{trackId:f.id})].concat(w):w},[])}function l(b,R){var T=b._log,u=new i(R,{log:T,clientTrackSwitchOffControl:b._clientTrackSwitchOffControl,contentPreferencesMode:b._contentPreferencesMode});T.info("A new RemoteParticipant connected:",u),b._participants.set(u.sid,u),b.emit("participantConnected",u);var f=[["reconnected","participantReconnected"],["reconnecting","participantReconnecting"],"trackDimensionsChanged","trackDisabled","trackEnabled","trackMessage","trackPublished","trackPublishPriorityChanged","trackStarted","trackSubscribed","trackSubscriptionFailed","trackSwitchedOff","trackSwitchedOn","trackUnpublished","trackUnsubscribed"].map(function(g){var P=y(Array.isArray(g)?g:[g,g],2),E=P[0],O=P[1];function A(){var N=[].slice.call(arguments);N.unshift(O),N.push(u),b.emit.apply(b,_([],y(N)))}return u.on(E,A),[E,A]});u.once("disconnected",function(){var P=b.dominantSpeaker;T.info("RemoteParticipant disconnected:",u),b._participants.delete(u.sid),f.forEach(function(E){u.removeListener(E[0],E[1])}),b.emit("participantDisconnected",u),u===P&&b.emit("dominantSpeakerChanged",b.dominantSpeaker)})}C.exports=s},{"./eventemitter":10,"./remoteparticipant":56,"./stats/statsreport":116,"./util":132}],58:[function(v,C,x){"use strict";var t,S=this&&this.__extends||(t=function(r,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,s){a.__proto__=s}||function(a,s){for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(a[c]=s[c])})(r,n)},function(r,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function a(){this.constructor=r}t(r,n),r.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}),y=v("./participant"),_=v("./room"),o=v("../statemachine"),i={closed:["opening"],opening:["closed","open"],open:["closed","closing"],closing:["closed","open"]},e=function(t){function r(){return t.call(this,"closed",i)||this}return S(r,t),r.prototype._close=function(n){return this.transition("closing",n),this.transition("closed",n),Promise.resolve(this)},r.prototype._connect=function(n,a,s,c,p){n.connect("PA00000000000000000000000000000000","test");var d=Promise.resolve(new _(n,"RM00000000000000000000000000000000",p));return d.cancel=function(){},d},r.prototype._open=function(n){return this.transition("opening",n),this.transition("open",n),Promise.resolve(this)},r.prototype.close=function(){var n=this;return this.bracket("close",function(a){switch(n.state){case"closed":return n;case"open":return n._close(a);default:throw new Error('Unexpected Signaling state "'+n.state+'"')}})},r.prototype.connect=function(n,a,s,c,p){var l=this;return this.bracket("connect",function d(h){switch(l.state){case"closed":return l._open(h).then(d.bind(null,h));case"open":return l.releaseLockCompletely(h),l._connect(n,a,s,c,p);default:throw new Error('Unexpected Signaling state "'+l.state+'"')}})},r.prototype.createLocalParticipantSignaling=function(){return new y},r.prototype.open=function(){var n=this;return this.bracket("open",function(a){switch(n.state){case"closed":return n._open(a);case"open":return n;default:throw new Error('Unexpected Signaling state "'+n.state+'"')}})},r}(o);C.exports=e},{"../statemachine":88,"./participant":61,"./room":65}],59:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(){var e=o.call(this)||this;return Object.defineProperties(e,{_publicationsToTrackSenders:{value:new Map},_trackSendersToPublications:{value:new Map}}),e}return S(i,o),i.prototype.addTrack=function(e,t,r,n){void 0===n&&(n=null);var a=this._createLocalTrackPublicationSignaling(e,t,r,n);return this._trackSendersToPublications.set(e,a),this._publicationsToTrackSenders.set(a,e),o.prototype.addTrack.call(this,a),this},i.prototype.getPublication=function(e){return this._trackSendersToPublications.get(e)||null},i.prototype.getSender=function(e){return this._publicationsToTrackSenders.get(e)||null},i.prototype.removeTrack=function(e){var t=this._trackSendersToPublications.get(e);return t?(this._trackSendersToPublications.delete(e),this._publicationsToTrackSenders.delete(t),o.prototype.removeTrack.call(this,t)&&t.stop(),t):null},i}(v("./participant"));C.exports=_},{"./participant":61}],60:[function(v,C,x){"use strict";var i,S=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),_=function(i){function e(t,r,n){var a=this;return t=t.clone(),(a=i.call(this,r,t.kind,"data"===t.kind||t.track.enabled,n)||this).setTrackTransceiver(t),Object.defineProperties(a,{_updatedPriority:{value:n,writable:!0},id:{enumerable:!0,value:t.id}}),a}return S(e,i),Object.defineProperty(e.prototype,"updatedPriority",{get:function(){return this._updatedPriority},enumerable:!1,configurable:!0}),e.prototype.enable=function(t){return this.trackTransceiver.track.enabled=t="boolean"!=typeof t||t,i.prototype.enable.call(this,t)},e.prototype.publishFailed=function(t){return function o(i,e){return null===i._sid&&!i._error&&(i._error=e,!0)}(this,t)&&this.emit("updated"),this},e.prototype.setPriority=function(t){return this._updatedPriority!==t&&(this._updatedPriority=t,this.emit("updated")),this},e.prototype.setSid=function(t){return this._error?this:i.prototype.setSid.call(this,t)},e.prototype.stop=function(){this.trackTransceiver.stop()},e}(v("./track"));C.exports=_},{"./track":66}],61:[function(v,C,x){"use strict";var e,S=this&&this.__extends||(e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(n[s]=a[s])})(t,r)},function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),y=v("../statemachine"),_=v("../stats/networkqualitystats"),o={connecting:["connected"],connected:["disconnected","reconnecting"],reconnecting:["connected","disconnected"],disconnected:[]},i=function(e){function t(){var r=e.call(this,"connecting",o)||this;return Object.defineProperties(r,{_identity:{writable:!0,value:null},_networkQualityLevel:{value:null,writable:!0},_networkQualityStats:{value:null,writable:!0},_sid:{writable:!0,value:null},identity:{enumerable:!0,get:function(){return this._identity}},sid:{enumerable:!0,get:function(){return this._sid}},tracks:{enumerable:!0,value:new Map}}),r}return S(t,e),Object.defineProperty(t.prototype,"networkQualityLevel",{get:function(){return this._networkQualityLevel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"networkQualityStats",{get:function(){return this._networkQualityStats},enumerable:!1,configurable:!0}),t.prototype.addTrack=function(r){return this.tracks.set(r.id||r.sid,r),this.emit("trackAdded",r),this},t.prototype.disconnect=function(){return"disconnected"!==this.state&&(this.preempt("disconnected"),!0)},t.prototype.removeTrack=function(r){var n=this.tracks.get(r.id||r.sid);return this.tracks.delete(r.id||r.sid),n&&this.emit("trackRemoved",r),n||null},t.prototype.setNetworkQualityLevel=function(r,n){this._networkQualityLevel!==r&&(this._networkQualityLevel=r,this._networkQualityStats=n&&(n.audio||n.video)?new _(n):null,this.emit("networkQualityLevelChanged"))},t.prototype.connect=function(r,n){return("connecting"===this.state||"reconnecting"===this.state)&&(this._sid||(this._sid=r),this._identity||(this._identity=n),this.preempt("connected"),!0)},t.prototype.reconnecting=function(){return("connecting"===this.state||"connected"===this.state)&&(this.preempt("reconnecting"),!0)},t}(y);C.exports=i},{"../statemachine":88,"../stats/networkqualitystats":103}],62:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(){var e=o.call(this)||this;return Object.defineProperties(e,{_isEnabled:{value:null,writable:!0},isEnabled:{enumerable:!0,get:function(){return this._isEnabled}}}),e}return S(i,o),i.prototype.disable=function(){return this.enable(!1)},i.prototype.enable=function(e){return this.isEnabled!==(e="boolean"!=typeof e||e)&&(this._isEnabled=e,this.emit("updated")),this},i}(v("events").EventEmitter);C.exports=_},{events:173}],63:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t){var r=o.call(this)||this;return r.connect(e,t),r}return S(i,o),i}(v("./participant"));C.exports=_},{"./participant":61}],64:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t,r,n,a,s){var c=o.call(this,t,r,n,a)||this;return Object.defineProperties(c,{_isSwitchedOff:{value:s,writable:!0}}),c.setSid(e),c}return S(i,o),Object.defineProperty(i.prototype,"isSubscribed",{get:function(){return!!this.trackTransceiver},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isSwitchedOff",{get:function(){return this._isSwitchedOff},enumerable:!1,configurable:!0}),i.prototype.subscribeFailed=function(e){return this.error||(this._error=e,this.emit("updated")),this},i.prototype.setPriority=function(e){return this._priority!==e&&(this._priority=e,this.emit("updated")),this},i.prototype.setSwitchedOff=function(e){return this._isSwitchedOff!==e&&(this._isSwitchedOff=e,this.emit("updated")),this},i}(v("./track"));C.exports=_},{"./track":66}],65:[function(v,C,x){"use strict";var h,S=this&&this.__extends||(h=function(k,b){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,T){R.__proto__=T}||function(R,T){for(var w in T)Object.prototype.hasOwnProperty.call(T,w)&&(R[w]=T[w])})(k,b)},function(k,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function R(){this.constructor=k}h(k,b),k.prototype=null===b?Object.create(b):(R.prototype=b.prototype,new R)}),y=v("./recording"),_=v("../statemachine"),o=v("../util/timeout"),i=v("../util").buildLogLevels,e=v("../util/constants").DEFAULT_LOG_LEVEL,t=v("../util/log"),r=v("../util/twilio-video-errors"),n=r.MediaConnectionError,a=r.MediaDTLSTransportFailedError,s=r.SignalingConnectionDisconnectedError,c=0,p={connected:["reconnecting","disconnected"],reconnecting:["connected","disconnected"],disconnected:[]},l=function(h){function k(b,R,T,w){var m=this;w=Object.assign({logLevel:e,RecordingSignaling:y,Timeout:o},w);var u=i(w.logLevel);m=h.call(this,"connected",p)||this;var f=w.RecordingSignaling,g=new w.Timeout(function(){m._disconnect(m._reconnectingError)},w.sessionTimeout,!1);return Object.defineProperties(m,{_instanceId:{value:c++},_log:{value:w.log?w.log.createLog("default",m):new t("default",m,u,w.loggerName)},_mediaConnectionIsReconnecting:{writable:!0,value:!1},_options:{value:w},_reconnectingError:{value:null,writable:!0},_sessionTimeout:{value:g},dominantSpeakerSid:{enumerable:!0,value:null,writable:!0},localParticipant:{enumerable:!0,value:b},name:{enumerable:!0,value:T},participants:{enumerable:!0,value:new Map},recording:{enumerable:!0,value:new f},sid:{enumerable:!0,value:R}}),m.on("connectionStateChanged",function(){"failed"===m.connectionState&&!["disconnected","failed"].includes(m.iceConnectionState)&&m._disconnect(new a)}),m.on("iceConnectionStateChanged",function(){return d(m)}),m.on("signalingConnectionStateChanged",function(){return d(m)}),setTimeout(function(){return d(m)}),m}return S(k,h),k.prototype._disconnect=function(b){return"disconnected"!==this.state&&(this.preempt("disconnected",null,[b]),!0)},k.prototype.toString=function(){return"[RoomSignaling #"+this._instanceId+": "+(this.localParticipant?this.localParticipant.sid:"null")+"]"},k.prototype.connectParticipant=function(b){var R=this;return"disconnected"!==b.state&&!this.participants.has(b.sid)&&(this.participants.set(b.sid,b),b.on("stateChanged",function T(w){"disconnected"===w&&(b.removeListener("stateChanged",T),R.participants.delete(b.sid),R.emit("participantDisconnected",b))}),this.emit("participantConnected",b),!0)},k.prototype.disconnect=function(){return this._disconnect()},k.prototype.setDominantSpeaker=function(b){this.dominantSpeakerSid=b,this.emit("dominantSpeakerChanged")},k}(_);function d(h){var k;"disconnected"!==h.state&&"disconnected"!==h.signalingConnectionState?("reconnecting"===h.signalingConnectionState?k=h.signalingConnectionState:"failed"===h.iceConnectionState?(h._mediaConnectionIsReconnecting=!0,k="reconnecting"):"new"===h.iceConnectionState||"checking"===h.iceConnectionState?k=h._mediaConnectionIsReconnecting?"reconnecting":"connected":(h._mediaConnectionIsReconnecting=!1,h._reconnectingError=null,h._sessionTimeout.clear(),k="connected"),k!==h.state&&("reconnecting"===k?(h._reconnectingError="reconnecting"===h.signalingConnectionState?new s:new n,h._sessionTimeout.start(),h.preempt(k,null,[h._reconnectingError])):h.preempt(k))):h._sessionTimeout.clear()}C.exports=l},{"../statemachine":88,"../util":132,"../util/constants":125,"../util/log":136,"../util/timeout":146,"../util/twilio-video-errors":147,"./recording":62}],66:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t,r,n){var a=o.call(this)||this,s=null;return Object.defineProperties(a,{_error:{value:null,writable:!0},_isEnabled:{value:r,writable:!0},_priority:{value:n,writable:!0},_trackTransceiver:{value:null,writable:!0},_sid:{get:function(){return s},set:function(c){null===s&&(s=c)}},kind:{enumerable:!0,value:t},name:{enumerable:!0,value:e}}),a}return S(i,o),Object.defineProperty(i.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isEnabled",{get:function(){return this._isEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"priority",{get:function(){return this._priority},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sid",{get:function(){return this._sid},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"trackTransceiver",{get:function(){return this._trackTransceiver},enumerable:!1,configurable:!0}),i.prototype.disable=function(){return this.enable(!1)},i.prototype.enable=function(e){return this.isEnabled!==(e="boolean"!=typeof e||e)&&(this._isEnabled=e,this.emit("updated")),this},i.prototype.setTrackTransceiver=function(e){return this.trackTransceiver!==(e=e||null)&&(this._trackTransceiver=e,this.emit("updated")),this},i.prototype.setSid=function(e){return null===this.sid&&(this._sid=e,this.emit("updated")),this},i}(v("events").EventEmitter);C.exports=_},{events:173}],67:[function(v,C,x){"use strict";var S=v("../../util/cancelablepromise"),y=v("./peerconnectionmanager"),_=v("./room"),o=v("./twilioconnectiontransport"),i=v("../../util/twilio-video-errors"),e=i.SignalingConnectionDisconnectedError,t=i.SignalingIncomingMessageInvalidError,r=v("../../util"),n=r.flatMap,a=r.createRoomConnectEventPayload;C.exports=function s(c,p,l,d,h,k){k=Object.assign({PeerConnectionManager:y,RoomV2:_,Transport:o},k);var b=h.video[0]&&!0===h.video[0].adaptiveSimulcast,T=k.RoomV2,w=k.Transport,m=k.iceServers,u=k.log,f=new(0,k.PeerConnectionManager)(d,h,k),g=n(l.tracks,function(A){return[A.trackTransceiver]});f.setTrackSenders(g);var E,P=new Error("Canceled"),O=new S(function(A,N,j){var G=k.bandwidthProfile,V=k.eventObserver,H=k.name,ce=Object.assign({adaptiveSimulcast:b,automaticSubscription:k.automaticSubscription,dominantSpeaker:k.dominantSpeaker,environment:k.environment,eventObserver:V,loggerName:k.loggerName,logLevel:k.logLevel,networkMonitor:k.networkMonitor,networkQuality:k.networkQuality,notifyWarnings:k.notifyWarnings,iceServers:m,onIced:function(pe){return j()?(N(P),Promise.reject(P)):(u.debug("Got ICE servers:",pe),k.iceServers=pe,f.setConfiguration(k),f.createAndOffer().then(function(){if(j())throw N(P),P;u.debug("createAndOffer() succeeded."),f.dequeue("description")}).catch(function(ye){throw u.error("createAndOffer() failed:",ye),N(ye),ye}))},realm:k.realm,renderHints:!!G&&("disabled"!==k.clientTrackSwitchOffControl||"disabled"!==k.contentPreferencesMode),sdpSemantics:k.sdpSemantics,trackPriority:!!G,trackSwitchOff:!!G},G?{bandwidthProfile:G}:{});E=new w(H,c,l,f,p,ce);var fe=a(k);V.emit("event",fe),E.once("connected",function(pe){u.debug("Transport connected:",pe),j()?N(P):pe.participant?A(new T(l,pe,E,f,k)):N(new t)}),E.once("stateChanged",function(pe,ye){"disconnected"===pe?(E=null,N(ye||new e)):u.debug("Transport state changed:",pe)})},function(){E&&(E.disconnect(),E=null)});return O.catch(function(){E&&(E.disconnect(),E=null),f.close()}),O}},{"../../util":132,"../../util/cancelablepromise":124,"../../util/twilio-video-errors":147,"./peerconnectionmanager":78,"./room":84,"./twilioconnectiontransport":87}],68:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t){var r=o.call(this,e,"active_speaker",t)||this;return Object.defineProperties(r,{_loudestParticipantSid:{value:null,writable:!0}}),r.on("ready",function(n){n.on("message",function(a){"active_speaker"===a.type&&r._setLoudestParticipantSid(a.participant)})}),r}return S(i,o),Object.defineProperty(i.prototype,"loudestParticipantSid",{get:function(){return this._loudestParticipantSid},enumerable:!1,configurable:!0}),i.prototype._setLoudestParticipantSid=function(e){this.loudestParticipantSid!==e&&(this._loudestParticipantSid=e,this.emit("updated"))},i}(v("./mediasignaling"));C.exports=_},{"./mediasignaling":74}],69:[function(v,C,x){"use strict";var S=v("../../util/filter"),y=function(){function _(){Object.defineProperties(this,{_filter:{value:new S({getKey:function(i){return i.ufrag},isLessThanOrEqualTo:function(i,e){return i.revision<=e.revision}})},_ufrag:{writable:!0,value:null},ufrag:{enumerable:!0,get:function(){return this._ufrag}}})}return _.prototype.setUfrag=function(o){this._ufrag=o;var i=this._filter.toMap().get(o);return i?i.candidates:[]},_.prototype.update=function(o){o.candidates=o.candidates||[];var i=this._filter.toMap().get(o.ufrag),e=i?i.candidates:[];return this._filter.update(o)&&this._ufrag===o.ufrag?o.candidates.slice(e.length):[]},_}();C.exports=y},{"../../util/filter":131}],70:[function(v,C,x){"use strict";var S=v("../../util/constants"),y=S.ICE_ACTIVITY_CHECK_PERIOD_MS,_=S.ICE_INACTIVITY_THRESHOLD_MS,o=function(){function i(e,t){t=Object.assign({activityCheckPeriodMs:y,inactivityThresholdMs:_},t),Object.defineProperties(this,{_activityCheckPeriodMs:{value:t.activityCheckPeriodMs},_inactivityThresholdMs:{value:t.inactivityThresholdMs},_lastActivity:{value:null,writable:!0},_peerConnection:{value:e},_timer:{value:null,writable:!0},_onIceConnectionStateChanged:{value:null,writable:!0}})}return i.prototype._getActivePairStat=function(e){return Array.from(e.values()).find(function(n){return"candidate-pair"===n.type&&n.nominated})||{bytesReceived:0,timestamp:Math.round((new Date).getTime())}},i.prototype._getIceConnectionStats=function(){var e=this;return this._peerConnection.getStats().then(function(t){return e._getActivePairStat(t)}).catch(function(){return null})},i.prototype._scheduleInactivityCallback=function(e){var t=this;e&&null===this._onIceConnectionStateChanged?(this._onIceConnectionStateChanged=function(){"disconnected"===t._peerConnection.iceConnectionState&&e()},this._peerConnection.addEventListener("iceconnectionstatechange",this._onIceConnectionStateChanged)):!e&&this._onIceConnectionStateChanged&&(this._peerConnection.removeEventListener("iceconnectionstatechange",this._onIceConnectionStateChanged),this._onIceConnectionStateChanged=null)},i.prototype.start=function(e){var t=this;this.stop(),this._timer=setInterval(function(){t._getIceConnectionStats().then(function(r){r&&((!t._lastActivity||t._lastActivity.bytesReceived!==r.bytesReceived)&&(t._lastActivity=r,t._scheduleInactivityCallback(null)),r.timestamp-t._lastActivity.timestamp>=t._inactivityThresholdMs&&("disconnected"===t._peerConnection.iceConnectionState?e():null===t._onIceConnectionStateChanged&&t._scheduleInactivityCallback(e)))})},this._activityCheckPeriodMs)},i.prototype.stop=function(){this._scheduleInactivityCallback(null),null!==this._timer&&(clearInterval(this._timer),this._timer=null,this._lastActivity=null)},i}();C.exports=o},{"../../util/constants":125}],71:[function(v,C,x){"use strict";var e,S=this&&this.__extends||(e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(n[s]=a[s])})(t,r)},function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),y=v("./cancelableroomsignalingpromise"),_=v("./localparticipant"),i=function(e){function t(r,n){var a;return n=Object.assign({createCancelableRoomSignalingPromise:y},n),a=e.call(this)||this,Object.defineProperties(a,{_createCancelableRoomSignalingPromise:{value:n.createCancelableRoomSignalingPromise},_options:{value:n},_wsServer:{value:r}}),a}return S(t,e),t.prototype._connect=function(r,n,a,s,c){return c=Object.assign({},this._options,c),this._createCancelableRoomSignalingPromise.bind(null,n,this._wsServer,r,a,s,c)},t.prototype.createLocalParticipantSignaling=function(r,n){return new _(r,n)},t}(v("../"));C.exports=i},{"../":58,"./cancelableroomsignalingpromise":67,"./localparticipant":72}],72:[function(v,C,x){"use strict";var a,S=this&&this.__extends||(a=function(s,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,l){p.__proto__=l}||function(p,l){for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(p[d]=l[d])})(s,c)},function(s,c){if("function"!=typeof c&&null!==c)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");function p(){this.constructor=s}a(s,c),s.prototype=null===c?Object.create(c):(p.prototype=c.prototype,new p)}),y=v("../localparticipant"),_=v("./localtrackpublication"),o=v("../../util/constants").DEFAULT_LOG_LEVEL,i=v("../../util/log"),e=v("../../util"),t=e.buildLogLevels,r=e.isDeepEqual,n=function(a){function s(c,p,l){var d;l=Object.assign({logLevel:o,LocalTrackPublicationV2:_},l),d=a.call(this)||this;var h=t(l.logLevel);return Object.defineProperties(d,{_bandwidthProfile:{value:null,writable:!0},_bandwidthProfileRevision:{value:0,writable:!0},_encodingParameters:{value:c},_removeListeners:{value:new Map},_LocalTrackPublicationV2:{value:l.LocalTrackPublicationV2},_log:{value:l.log?l.log.createLog("default",d):new i("default",d,h,l.loggerName)},_publishedRevision:{writable:!0,value:0},_revision:{writable:!0,value:1},_signalingRegion:{value:null,writable:!0},audioProcessors:{value:[],writable:!0},bandwidthProfile:{enumerable:!0,get:function(){return this._bandwidthProfile}},bandwidthProfileRevision:{enumerable:!0,get:function(){return this._bandwidthProfileRevision}},networkQualityConfiguration:{enumerable:!0,value:p},revision:{enumerable:!0,get:function(){return this._revision}},signalingRegion:{enumerable:!0,get:function(){return this._signalingRegion}}}),d}return S(s,a),s.prototype.toString=function(){return"[LocalParticipantSignaling: "+this.sid+"]"},s.prototype.setSignalingRegion=function(c){this._signalingRegion||(this._signalingRegion=c)},s.prototype.setBandwidthProfile=function(c){r(this._bandwidthProfile,c)||(this._bandwidthProfile=JSON.parse(JSON.stringify(c)),this._bandwidthProfileRevision++,this.didUpdate())},s.prototype.setAudioProcessors=function(c){this.audioProcessors=c},s.prototype.getParameters=function(){return this._encodingParameters},s.prototype.setParameters=function(c){return this._encodingParameters.update(c),this},s.prototype.update=function(c){return this._publishedRevision>=c.revision||(this._publishedRevision=c.revision,c.tracks.forEach(function(p){var l=this.tracks.get(p.id);l&&l.update(p)},this)),this},s.prototype.updateMediaStates=function(c){return c&&c.tracks?(Array.from(this.tracks.values()).forEach(function(p){var l=c.tracks[p.sid];l&&p.updateMediaStates(l)}),this):this},s.prototype._createLocalTrackPublicationSignaling=function(c,p,l,d){return new this._LocalTrackPublicationV2(c,p,l,d,{log:this._log})},s.prototype.addTrack=function(c,p,l,d){var h=this;a.prototype.addTrack.call(this,c,p,l,d);var k=this.getPublication(c),b=k.isEnabled,R=k.updatedPriority,T=function(){(b!==k.isEnabled||R!==k.updatedPriority)&&(h.didUpdate(),b=k.isEnabled,R=k.updatedPriority)};return k.on("updated",T),this._removeListener(k),this._removeListeners.set(k,function(){return k.removeListener("updated",T)}),this.didUpdate(),this},s.prototype._removeListener=function(c){var p=this._removeListeners.get(c);p&&p()},s.prototype.getState=function(){return{revision:this.revision,tracks:Array.from(this.tracks.values()).map(function(c){return c.getState()})}},s.prototype.didUpdate=function(){this._revision++,this.emit("updated")},s.prototype.removeTrack=function(c){var p=a.prototype.removeTrack.call(this,c);return p&&(c.removeClone(p.trackTransceiver),this._removeListener(p),this.didUpdate()),p},s.prototype.setNetworkQualityConfiguration=function(c){this.networkQualityConfiguration.update(c)},s.prototype.setPublisherHint=function(c,p){var l=Array.from(this.tracks.values()).find(function(d){return d.sid===c});return l?l.trackTransceiver.setPublisherHint(p):(this._log.warn("track:"+c+" not found"),Promise.resolve("UNKNOWN_TRACK"))},s}(y);C.exports=n},{"../../util":132,"../../util/constants":125,"../../util/log":136,"../localparticipant":59,"./localtrackpublication":73}],73:[function(v,C,x){"use strict";var e,S=this&&this.__extends||(e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(n[s]=a[s])})(t,r)},function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),y=v("../localtrackpublication"),_=v("../../util/twiliowarning"),o=v("../../util/twilio-video-errors").createTwilioError,i=function(e){function t(r,n,a,s,c){var p=e.call(this,r,n,a)||this;return Object.defineProperties(p,{_log:{value:c.log.createLog("default",p)},_mediaStates:{value:{recordings:null},writable:!0},_noiseCancellationVendor:{value:s}}),p}return S(t,e),t.prototype.getState=function(){var r={enabled:this.isEnabled,id:this.id,kind:this.kind,name:this.name,priority:this.updatedPriority};return this._noiseCancellationVendor&&(r.audio_processor=this._noiseCancellationVendor),r},t.prototype.toString=function(){return"[LocalTrackPublicationV2: "+this.sid+"]"},t.prototype.update=function(r){switch(r.state){case"ready":this.setSid(r.sid);break;case"failed":var n=r.error;this.publishFailed(o(n.code,n.message))}return this},t.prototype.updateMediaStates=function(r){if(!r||!r.recordings||this._mediaStates.recordings===r.recordings)return this;switch(this._mediaStates.recordings=r.recordings,this._mediaStates.recordings){case"OK":this._log.info("Warnings have cleared."),this.emit("warningsCleared");break;case"NO_MEDIA":this._log.warn("Recording media lost."),this.emit("warning",_.recordingMediaLost);break;default:this._log.warn("Unknown media state detected: "+this._mediaStates.recordings)}return this},t}(y);C.exports=i},{"../../util/twilio-video-errors":147,"../../util/twiliowarning":149,"../localtrackpublication":60}],74:[function(v,C,x){"use strict";var i,S=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),y=v("events"),_=0,o=function(i){function e(t,r,n){var a=i.call(this)||this;return Object.defineProperties(a,{_instanceId:{value:_++},channel:{value:r},_log:{value:n.log.createLog("default",a)},_getReceiver:{value:t},_receiverPromise:{value:null,writable:!0},_transport:{value:null,writable:!0}}),a}return S(e,i),Object.defineProperty(e.prototype,"isSetup",{get:function(){return!!this._receiverPromise},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return"[MediaSignaling #"+this._instanceId+":"+this.channel+"]"},e.prototype.setup=function(t){var r=this;this._teardown(),this._log.info("setting up msp transport for id:",t);var n=this._getReceiver(t).then(function(a){if("data"!==a.kind&&r._log.error("Expected a DataTrackReceiver"),r._receiverPromise===n){try{r._transport=a.toDataTransport(),r.emit("ready",r._transport)}catch(s){r._log.error("Failed to toDataTransport: "+s.message)}a.once("close",function(){return r._teardown()})}});this._receiverPromise=n},e.prototype._teardown=function(){this._transport&&(this._log.info("Tearing down"),this._transport=null,this._receiverPromise=null,this.emit("teardown"))},e}(y);C.exports=o},{events:173}],75:[function(v,C,x){"use strict";var t,S=this&&this.__extends||(t=function(r,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,s){a.__proto__=s}||function(a,s){for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(a[c]=s[c])})(r,n)},function(r,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function a(){this.constructor=r}t(r,n),r.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}),y=this&&this.__read||function(t,r){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var s,p,a=n.call(t),c=[];try{for(;(void 0===r||r-- >0)&&!(s=a.next()).done;)c.push(s.value)}catch(l){p={error:l}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(p)throw p.error}}return c},_=v("events"),o=v("../../stats/peerconnectionreportfactory"),i=function(t){function r(n,a){var s=t.call(this)||this;return Object.defineProperties(s,{_factories:{value:new WeakMap},_manager:{value:n},_signaling:{value:a}}),a.on("updated",function(){return s.emit("updated")}),s}return S(r,t),Object.defineProperty(r.prototype,"level",{get:function(){return this._signaling.level},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"levels",{get:function(){return this._signaling.levels},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"remoteLevels",{get:function(){return this._signaling.remoteLevels},enumerable:!1,configurable:!0}),r.prototype.start=function(){var n=this;this.stop();var a=setTimeout(function(){n._timeout===a&&function e(t){var s=(t._manager._peerConnections?Array.from(t._manager._peerConnections.values()):[]).map(function(c){return c._peerConnection}).filter(function(c){return"closed"!==c.signalingState}).map(function(c){if(t._factories.has(c))return t._factories.get(c);var p=new o(c);return t._factories.set(c,p),p}).map(function(c){return c.next().catch(function(){return null})});return Promise.all(s).then(function(c){return c.filter(function(p){return p}).map(function(p){return p.summarize()})})}(n).then(function(s){if(n._timeout===a){if(s.length){var c=y(s,1);n._signaling.put(c[0])}n.start()}})},200);this._timeout=a},r.prototype.stop=function(){clearTimeout(this._timeout),this._timeout=null},r}(_);C.exports=i},{"../../stats/peerconnectionreportfactory":106,events:173}],76:[function(v,C,x){"use strict";var r,S=this&&this.__extends||(r=function(n,a){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var p in c)Object.prototype.hasOwnProperty.call(c,p)&&(s[p]=c[p])})(n,a)},function(n,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function s(){this.constructor=n}r(n,a),n.prototype=null===a?Object.create(a):(s.prototype=a.prototype,new s)}),y=v("./mediasignaling"),_=v("../../util/asyncvar"),o=v("../../util/timeout"),e=function(r){function n(a,s,c){var p=r.call(this,a,"network_quality",c)||this;return Object.defineProperties(p,{_level:{value:null,writable:!0},_levels:{value:null,writable:!0},_remoteLevels:{value:new Map,writable:!0},_networkQualityInputs:{value:new _},_resendTimer:{value:new o(function(){p._resendTimer.setDelay(1.5*p._resendTimer.delay),p._sendNetworkQualityInputs()},5e3,!1)},_networkQualityReportLevels:{get:function(){return{reportLevel:s.local,remoteReportLevel:s.remote}}}}),p.on("ready",function(l){l.on("message",function(d){"network_quality"===(p._log.debug("Incoming: ",d),d.type)&&p._handleNetworkQualityMessage(d)})}),p._sendNetworkQualityInputs(),p}return S(n,r),Object.defineProperty(n.prototype,"level",{get:function(){return this._level},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"levels",{get:function(){return this._levels},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"remoteLevels",{get:function(){return this._remoteLevels},enumerable:!1,configurable:!0}),n.prototype._handleNetworkQualityMessage=function(a){var s=this,c=!1,p=null,l=a?a.local:null;"number"==typeof l?(p=l,this._levels=null):"object"==typeof l&&l&&(this._levels=l,p="number"==typeof l.level?l.level:Math.min(l.audio.send,l.audio.recv,l.video.send,l.video.recv)),null!==p&&this.level!==p&&(this._level=p,c=!0),this._remoteLevels=a&&a.remotes?a.remotes.reduce(function(d,h){return(s._remoteLevels.get(h.sid)||{}).level!==h.level&&(c=!0),d.set(h.sid,h)},new Map):this._remoteLevels,c&&this.emit("updated"),this._resendTimer.setDelay(5e3),this._resendTimer.isSet&&setTimeout(function(){return s._sendNetworkQualityInputs()},1e3)},n.prototype._sendNetworkQualityInputs=function(){var a=this;return this._resendTimer.clear(),this._networkQualityInputs.take().then(function(s){a._transport&&a._transport.publish(function t(r,n){return Object.assign({type:"network_quality"},r,n)}(s,a._networkQualityReportLevels))}).finally(function(){a._resendTimer.start()})},n.prototype.put=function(a){this._networkQualityInputs.put(a)},n}(y);C.exports=e},{"../../util/asyncvar":121,"../../util/timeout":146,"./mediasignaling":74}],77:[function(v,C,x){"use strict";var oe,S=this&&this.__extends||(oe=function(ne,W){return(oe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(z,ee){z.__proto__=ee}||function(z,ee){for(var te in ee)Object.prototype.hasOwnProperty.call(ee,te)&&(z[te]=ee[te])})(ne,W)},function(ne,W){if("function"!=typeof W&&null!==W)throw new TypeError("Class extends value "+String(W)+" is not a constructor or null");function z(){this.constructor=ne}oe(ne,W),ne.prototype=null===W?Object.create(W):(z.prototype=W.prototype,new z)}),y=this&&this.__read||function(oe,ne){var W="function"==typeof Symbol&&oe[Symbol.iterator];if(!W)return oe;var ee,ie,z=W.call(oe),te=[];try{for(;(void 0===ne||ne-- >0)&&!(ee=z.next()).done;)te.push(ee.value)}catch(he){ie={error:he}}finally{try{ee&&!ee.done&&(W=z.return)&&W.call(z)}finally{if(ie)throw ie.error}}return te},_=this&&this.__spreadArray||function(oe,ne){for(var W=0,z=ne.length,ee=oe.length;W<z;W++,ee++)oe[ee]=ne[W];return oe},o=v("../../util/backoff"),i=v("../../webrtc"),e=i.RTCIceCandidate,t=i.RTCPeerConnection,r=i.RTCSessionDescription,n=i.getStats,a=v("../../webrtc/util"),s=v("../../util/constants"),c=s.DEFAULT_ICE_GATHERING_TIMEOUT_MS,p=s.DEFAULT_LOG_LEVEL,l=s.DEFAULT_SESSION_TIMEOUT_SEC,d=s.iceRestartBackoffConfig,h=v("../../util/sdp"),k=h.addOrRewriteNewTrackIds,b=h.addOrRewriteTrackIds,R=h.createCodecMapForMediaSection,T=h.disableRtx,w=h.enableDtxForOpus,m=h.filterLocalCodecs,u=h.getMediaSections,f=h.removeSSRCAttributes,g=h.revertSimulcast,P=h.setCodecPreferences,E=h.setSimulcast,O=v("../../util/timeout"),A=v("../../util/twilio-video-errors"),N=A.MediaClientLocalDescFailedError,j=A.MediaClientRemoteDescFailedError,M=v("../../util"),Q=M.buildLogLevels,G=M.getPlatform,K=M.isChromeScreenShareTrack,F=M.oncePerTick,V=M.defer,D=v("./icebox"),L=v("./iceconnectionmonitor.js"),H=v("../../data/receiver"),J=v("../../media/track/receiver"),X=v("../../statemachine"),$=v("../../util/log"),Z=v("../../util/sdp/trackmatcher"),se=v("../../util/sdp/issue8329"),le=a.guessBrowser(),de=G(),ve=/android/.test(de),ce="chrome"===le,fe="firefox"===le,pe="safari"===le,ye=0,ge={open:["closed","updating"],updating:["closed","open"],closed:[]},ke=function(oe){function ne(W,z,ee,te){var ie=oe.call(this,"open",ge)||this,he=B(te=Object.assign({enableDscp:!1,dummyAudioMediaStreamTrack:null,isChromeScreenShareTrack:K,iceServers:[],logLevel:p,offerOptions:{},revertSimulcast:g,sessionTimeout:1e3*l,setCodecPreferences:P,setSimulcast:E,Backoff:o,IceConnectionMonitor:L,RTCIceCandidate:e,RTCPeerConnection:t,RTCSessionDescription:r,Timeout:O},te)),be=Q(te.logLevel),xe=te.RTCPeerConnection;!0===te.enableDscp&&(te.chromeSpecificConstraints=te.chromeSpecificConstraints||{},te.chromeSpecificConstraints.optional=te.chromeSpecificConstraints.optional||[],te.chromeSpecificConstraints.optional.push({googDscp:!0}));var Ae=te.log?te.log.createLog("webrtc",ie):new $("webrtc",ie,be,te.loggerName),Te=new xe(he,te.chromeSpecificConstraints);te.dummyAudioMediaStreamTrack&&Te.addTrack(te.dummyAudioMediaStreamTrack),Object.defineProperties(ie,{_appliedTrackIdsToAttributes:{value:new Map,writable:!0},_dataChannels:{value:new Map},_dataTrackReceivers:{value:new Set},_descriptionRevision:{writable:!0,value:0},_didGenerateLocalCandidates:{writable:!0,value:!1},_enableDscp:{value:te.enableDscp},_encodingParameters:{value:z},_isChromeScreenShareTrack:{value:te.isChromeScreenShareTrack},_iceGatheringFailed:{value:!1,writable:!0},_iceGatheringTimeout:{value:new te.Timeout(function(){return ie._handleIceGatheringTimeout()},c,!1)},_iceRestartBackoff:{value:new te.Backoff(d)},_instanceId:{value:++ye},_isIceConnectionInactive:{writable:!0,value:!1},_isIceLite:{writable:!0,value:!1},_isIceRestartBackoffInProgress:{writable:!0,value:!1},_isRestartingIce:{writable:!0,value:!1},_lastIceConnectionState:{writable:!0,value:null},_lastStableDescriptionRevision:{writable:!0,value:0},_localCandidates:{writable:!0,value:[]},_localCodecs:{value:new Set},_localCandidatesRevision:{writable:!0,value:1},_localDescriptionWithoutSimulcast:{writable:!0,value:null},_localDescription:{writable:!0,value:null},_localUfrag:{writable:!0,value:null},_log:{value:Ae},_eventObserver:{value:te.eventObserver},_remoteCodecMaps:{value:new Map},_rtpSenders:{value:new Map},_rtpNewSenders:{value:new Set},_iceConnectionMonitor:{value:new te.IceConnectionMonitor(Te)},_mediaTrackReceivers:{value:new Set},_needsAnswer:{writable:!0,value:!1},_negotiationRole:{writable:!0,value:null},_offerOptions:{writable:!0,value:te.offerOptions},_onEncodingParametersChanged:{value:F(function(){ie._needsAnswer||Oe(ie)})},_peerConnection:{value:Te},_preferredAudioCodecs:{value:ee.audio},_preferredVideoCodecs:{value:ee.video},_shouldApplyDtx:{value:ee.audio.every(function(_e){return"opus"!==_e.codec})||ee.audio.some(function(_e){return"opus"===_e.codec&&_e.dtx})},_queuedDescription:{writable:!0,value:null},_iceReconnectTimeout:{value:new te.Timeout(function(){Ae.debug("ICE reconnect timed out"),ie.close()},te.sessionTimeout,!1)},_recycledTransceivers:{value:{audio:[],video:[]}},_replaceTrackPromises:{value:new Map},_remoteCandidates:{writable:!0,value:new D},_setCodecPreferences:{value:fe&&ve&&ee.video[0]&&"h264"!==ee.video[0].codec.toLowerCase()?function(_e){return _e}:te.setCodecPreferences},_setSimulcast:{value:te.setSimulcast},_revertSimulcast:{value:te.revertSimulcast},_RTCIceCandidate:{value:te.RTCIceCandidate},_RTCPeerConnection:{value:te.RTCPeerConnection},_RTCSessionDescription:{value:te.RTCSessionDescription},_shouldOffer:{writable:!0,value:!1},_shouldRestartIce:{writable:!0,value:!1},_trackIdsToAttributes:{value:new Map,writable:!0},_trackMatcher:{writable:!0,value:null},_mediaTrackSenderToPublisherHints:{value:new Map},id:{enumerable:!0,value:W}}),z.on("changed",ie._onEncodingParametersChanged),Te.addEventListener("connectionstatechange",ie._handleConnectionStateChange.bind(ie)),Te.addEventListener("datachannel",ie._handleDataChannelEvent.bind(ie)),Te.addEventListener("icecandidate",ie._handleIceCandidateEvent.bind(ie)),Te.addEventListener("iceconnectionstatechange",ie._handleIceConnectionStateChange.bind(ie)),Te.addEventListener("icegatheringstatechange",ie._handleIceGatheringStateChange.bind(ie)),Te.addEventListener("signalingstatechange",ie._handleSignalingStateChange.bind(ie)),Te.addEventListener("track",ie._handleTrackEvent.bind(ie));var Re=ie;return ie.on("stateChanged",function _e(me){"closed"===me&&(Re.removeListener("stateChanged",_e),Re._dataChannels.forEach(function(Ie,je){Re.removeDataTrackSender(je)}))}),ie}return S(ne,oe),ne.prototype.toString=function(){return"[PeerConnectionV2 #"+this._instanceId+": "+this.id+"]"},ne.prototype.setEffectiveAdaptiveSimulcast=function(W){this._log.debug("Setting setEffectiveAdaptiveSimulcast: ",W),this._preferredVideoCodecs.forEach(function(z){"adaptiveSimulcast"in z&&(z.adaptiveSimulcast=W)})},Object.defineProperty(ne.prototype,"_shouldApplySimulcast",{get:function(){return!(!ce&&!pe)&&this._preferredVideoCodecs.some(function(z){return"vp8"===z.codec.toLowerCase()&&z.simulcast&&!1!==z.adaptiveSimulcast})},enumerable:!1,configurable:!0}),Object.defineProperty(ne.prototype,"connectionState",{get:function(){return"failed"===this.iceConnectionState?"failed":this._peerConnection.connectionState||this.iceConnectionState},enumerable:!1,configurable:!0}),Object.defineProperty(ne.prototype,"iceConnectionState",{get:function(){return this._isIceConnectionInactive&&"disconnected"===this._peerConnection.iceConnectionState||this._iceGatheringFailed?"failed":this._peerConnection.iceConnectionState},enumerable:!1,configurable:!0}),Object.defineProperty(ne.prototype,"isApplicationSectionNegotiated",{get:function(){return"closed"===this._peerConnection.signalingState||!!this._peerConnection.localDescription&&u(this._peerConnection.localDescription.sdp,"application").length>0},enumerable:!1,configurable:!0}),Object.defineProperty(ne.prototype,"_isAdaptiveSimulcastEnabled",{get:function(){var W=this._preferredVideoCodecs.find(function(z){return"adaptiveSimulcast"in z});return W&&!0===W.adaptiveSimulcast},enumerable:!1,configurable:!0}),ne.prototype._maybeUpdateEncodings=function(W,z,ee){if(void 0===ee&&(ee=!1),"video"!==W.kind||"ended"===W.readyState)return!1;var te=W.getSettings();if("number"!=typeof te.height||"number"!=typeof te.width)return!1;var be=a.guessBrowser();return!!("safari"===be||"chrome"===be&&this._isAdaptiveSimulcastEnabled)&&(this._updateEncodings(W,z,ee),!0)},ne.prototype._updateEncodings=function(W,z,ee){if(this._isChromeScreenShareTrack(W)){var te=[{scaleResolutionDownBy:1},{scaleResolutionDownBy:1}];z.forEach(function(_e,me){var Ie=te[me];Ie?(_e.scaleResolutionDownBy=Ie.scaleResolutionDownBy,ee&&delete _e.active):(_e.active=!1,delete _e.scaleResolutionDownBy)})}else{var ie=W.getSettings(),Ae=ie.width*ie.height,Te=[{pixels:518400,maxActiveLayers:3},{pixels:129600,maxActiveLayers:2},{pixels:0,maxActiveLayers:1}].find(function(_e){return Ae>=_e.pixels}),Re=Math.min(z.length,Te.maxActiveLayers);z.forEach(function(_e,me){me<Re?(_e.scaleResolutionDownBy=1<<Re-me-1,ee&&(_e.active=!0)):(_e.active=!1,delete _e.scaleResolutionDownBy)})}this._log.debug("_updateEncodings:",z.map(function(_e,me){return"["+me+": "+_e.active+", "+(_e.scaleResolutionDownBy||0)+"]"}).join(", "))},ne.prototype._addIceCandidate=function(W){var z=this;return Promise.resolve().then(function(){return W=new z._RTCIceCandidate(W),z._peerConnection.addIceCandidate(W)}).catch(function(ee){z._log.warn("Failed to add RTCIceCandidate "+(W?'"'+W.candidate+'"':"null")+": "+ee.message)})},ne.prototype._addIceCandidates=function(W){return Promise.all(W.map(this._addIceCandidate,this)).then(function(){})},ne.prototype._addOrUpdateTransceiver=function(W){var z=this,ee=function ae(oe,ne){var W={audio:oe._preferredAudioCodecs.map(function(ie){return ie.codec.toLowerCase()}),video:oe._preferredVideoCodecs.map(function(ie){return ie.codec.toLowerCase()})}[ne],z=oe._recycledTransceivers[ne],ee=W.find(function(ie){return oe._localCodecs.has(ie)});if(!ee)return z.shift();var te=z.find(function(ie){var he=oe._remoteCodecMaps.get(ie.mid);return he&&he.has(ee)});return te&&z.splice(z.indexOf(te),1),te}(this,W.kind);if(ee&&ee.sender){var te=ee.sender.track?ee.sender.track.id:null;return te&&this._log.warn("Reusing transceiver: "+ee.mid+"] "+te+" => "+W.id),this._replaceTrackPromises.set(ee,ee.sender.replaceTrack(W).then(function(){ee.direction="sendrecv"},function(){}).finally(function(){z._replaceTrackPromises.delete(ee)})),ee}return this._peerConnection.addTransceiver(W)},ne.prototype._checkIceBox=function(W){var z=q(W);if(!z)return Promise.resolve();var ee=this._remoteCandidates.setUfrag(z);return this._addIceCandidates(ee)},ne.prototype._answer=function(W){var z=this;return Promise.resolve().then(function(){return z._negotiationRole||(z._negotiationRole="answerer"),z._setRemoteDescription(W)}).catch(function(){throw new j}).then(function(){return z._peerConnection.createAnswer()}).then(function(ee){ee=fe?new z._RTCSessionDescription({sdp:T(ee.sdp),type:ee.type}):se(ee);var te=f(ee.sdp,["mslabel","label"]);if(z._shouldApplySimulcast){var ie=te;te=z._setSimulcast(ie,z._trackIdsToAttributes),te=z._revertSimulcast(te,ie,W.sdp)}return te=te.replace(/42e015/g,"42e01f"),z._setLocalDescription({type:ee.type,sdp:te})}).then(function(){return z._checkIceBox(W)}).then(function(){return z._queuedDescription&&z._updateDescription(z._queuedDescription)}).then(function(){return z._queuedDescription=null,z._maybeReoffer(z._peerConnection.localDescription)}).catch(function(ee){var te=ee instanceof j?ee:new N;throw z._publishMediaWarning({message:"Failed to _answer",code:te.code,error:ee}),te})},ne.prototype._close=function(){return this._iceConnectionMonitor.stop(),"closed"!==this._peerConnection.signalingState&&(this._peerConnection.close(),this.preempt("closed"),this._encodingParameters.removeListener("changed",this._onEncodingParametersChanged),!0)},ne.prototype._handleConnectionStateChange=function(){this.emit("connectionStateChanged")},ne.prototype._handleDataChannelEvent=function(W){var z=this,ee=W.channel,te=new H(ee);this._dataTrackReceivers.add(te),ee.addEventListener("close",function(){z._dataTrackReceivers.delete(te)}),this.emit("trackAdded",te)},ne.prototype._handleGlare=function(W){var z=this;return this._log.debug("Glare detected; rolling back"),this._isRestartingIce&&(this._log.debug("An ICE restart was in progress; we'll need to restart ICE again after rolling back"),this._isRestartingIce=!1,this._shouldRestartIce=!0),Promise.resolve().then(function(){return z._trackIdsToAttributes=new Map(z._appliedTrackIdsToAttributes),z._setLocalDescription({type:"rollback"})}).then(function(){return z._needsAnswer=!1,z._answer(W)}).then(function(ee){return ee?Promise.resolve():z._offer()})},ne.prototype._publishMediaWarning=function(W){this._eventObserver.emit("event",{level:"warning",name:"error",group:"media",payload:{message:W.message,code:W.code,context:JSON.stringify({error:W.error.message,sdp:W.sdp})}})},ne.prototype._handleIceCandidateEvent=function(W){W.candidate&&(this._log.debug("Clearing ICE gathering timeout"),this._didGenerateLocalCandidates=!0,this._iceGatheringTimeout.clear(),this._localCandidates.push(W.candidate));var z={ice:{candidates:this._isIceLite?[]:this._localCandidates.slice(),ufrag:this._localUfrag},id:this.id};W.candidate||(z.ice.complete=!0),this._isIceLite&&W.candidate||(z.ice.revision=this._localCandidatesRevision++,this.emit("candidates",z))},ne.prototype._handleIceConnectionStateChange=function(){var W=this,z=this._peerConnection.iceConnectionState,ee=["connected","completed"].includes(z),te=this._log;te.debug('ICE connection state is "'+z+'"'),ee&&(this._iceReconnectTimeout.clear(),this._iceRestartBackoff.reset()),"failed"===this._lastIceConnectionState||"failed"!==z||this._shouldRestartIce||this._isRestartingIce?["disconnected","failed"].includes(this._lastIceConnectionState)&&ee&&te.debug("ICE reconnected"):(te.warn("ICE failed"),this._initiateIceRestartBackoff()),"connected"===z?(this._isIceConnectionInactive=!1,this._iceConnectionMonitor.start(function(){W._iceConnectionMonitor.stop(),!W._shouldRestartIce&&!W._isRestartingIce&&(te.warn("ICE Connection Monitor detected inactivity"),W._isIceConnectionInactive=!0,W._initiateIceRestartBackoff(),W.emit("iceConnectionStateChanged"),W.emit("connectionStateChanged"))})):["disconnected","completed"].includes(z)||(this._iceConnectionMonitor.stop(),this._isIceConnectionInactive=!1),this._lastIceConnectionState=z,this.emit("iceConnectionStateChanged")},ne.prototype._handleIceGatheringTimeout=function(){this._log.warn("ICE failed to gather any local candidates"),this._iceGatheringFailed=!0,this._initiateIceRestartBackoff(),this.emit("iceConnectionStateChanged"),this.emit("connectionStateChanged")},ne.prototype._handleIceGatheringStateChange=function(){var W=this._peerConnection.iceGatheringState,z=this._log;z.debug('ICE gathering state is "'+W+'"');var ee=this._iceGatheringTimeout;"gathering"===W&&!this._didGenerateLocalCandidates&&!ee.isSet&&(z.debug("Starting ICE gathering timeout: "+ee.delay),this._iceGatheringFailed=!1,this._iceGatheringTimeout.start())},ne.prototype._handleSignalingStateChange=function(){"stable"===this._peerConnection.signalingState&&(this._appliedTrackIdsToAttributes=new Map(this._trackIdsToAttributes))},ne.prototype._handleTrackEvent=function(W){var z=this,ee=this._peerConnection.remoteDescription?this._peerConnection.remoteDescription.sdp:null;this._trackMatcher=this._trackMatcher||new Z,this._trackMatcher.update(ee);var te=W.track,ie=this._trackMatcher.match(W)||te.id,he=new J(ie,te);this._mediaTrackReceivers.forEach(function(be){be.track.id===he.track.id&&z._mediaTrackReceivers.delete(be)}),this._mediaTrackReceivers.add(he),te.addEventListener("ended",function(){return z._mediaTrackReceivers.delete(he)}),this.emit("trackAdded",he)},ne.prototype._initiateIceRestart=function(){if("closed"!==this._peerConnection.signalingState){var W=this._log;W.warn("Attempting to restart ICE"),this._didGenerateLocalCandidates=!1,this._isIceRestartBackoffInProgress=!1,this._shouldRestartIce=!0;var z=this._iceReconnectTimeout;z.isSet||(W.debug("Starting ICE reconnect timeout: "+z.delay),this._iceReconnectTimeout.start()),this.offer().catch(function(ie){W.error("offer failed in _initiateIceRestart with: "+ie.message)})}},ne.prototype._initiateIceRestartBackoff=function(){var W=this;"closed"===this._peerConnection.signalingState||this._isIceRestartBackoffInProgress||(this._log.warn("An ICE restart has been scheduled"),this._isIceRestartBackoffInProgress=!0,this._iceRestartBackoff.backoff(function(){return W._initiateIceRestart()}))},ne.prototype._maybeReoffer=function(W){var z=this._shouldOffer;if(W&&W.sdp){var ee=this._peerConnection.getSenders().filter(function(xe){return xe.track});z=["audio","video"].reduce(function(xe,Ae){var Te=u(W.sdp,Ae,"(sendrecv|sendonly)"),Re=ee.filter(I.bind(null,Ae));return xe||Te.length<Re.length},z);var te=this._dataChannels.size>0,ie=u(W.sdp,"application").length>0;z=z||te&&!ie}return(z?this._offer():Promise.resolve()).then(function(){return z})},ne.prototype._offer=function(){var W=this,z=Object.assign({},this._offerOptions);return this._needsAnswer=!0,this._shouldRestartIce&&(this._shouldRestartIce=!1,this._isRestartingIce=!0,z.iceRestart=!0),Promise.all(this._replaceTrackPromises.values()).then(function(){return W._peerConnection.createOffer(z)}).catch(function(ee){var te=new N;throw W._publishMediaWarning({message:"Failed to create offer",code:te.code,error:ee}),te}).then(function(ee){ee=fe?new W._RTCSessionDescription({sdp:T(ee.sdp),type:ee.type}):se(ee);var te=f(ee.sdp,["mslabel","label"]);te=W._peerConnection.remoteDescription?m(te,W._peerConnection.remoteDescription.sdp):te;var ie=W._setCodecPreferences(te,W._preferredAudioCodecs,W._preferredVideoCodecs);return W._shouldOffer=!1,W._negotiationRole||(W._negotiationRole="offerer"),W._shouldApplySimulcast&&(W._localDescriptionWithoutSimulcast={type:"offer",sdp:ie},ie=W._setSimulcast(ie,W._trackIdsToAttributes)),W._setLocalDescription({type:"offer",sdp:ie})})},ne.prototype._getMediaTrackSenderId=function(W){var z=Array.from(this._rtpSenders.keys()).find(function(ee){return ee.track.id===W});return z?z.id:W},ne.prototype._addOrRewriteLocalTrackIds=function(W){var z=this,te=this._peerConnection.getTransceivers().filter(function(Re){var _e=Re.sender;return!Re.stopped&&_e&&_e.track}),ie=te.filter(function(Re){return Re.mid}),he=new Map(ie.map(function(Re){return[Re.mid,z._getMediaTrackSenderId(Re.sender.track.id)]})),be=b(W.sdp,he),xe=te.filter(function(Re){return!Re.mid}),Ae=new Map(["audio","video"].map(function(Re){return[Re,xe.filter(function(_e){return _e.sender.track.kind===Re}).map(function(_e){return z._getMediaTrackSenderId(_e.sender.track.id)})]})),Te=k(be,he,Ae);return new this._RTCSessionDescription({sdp:Te,type:W.type})},ne.prototype._rollbackAndApplyOffer=function(W){var z=this;return this._setLocalDescription({type:"rollback"}).then(function(){return z._setLocalDescription(W)})},ne.prototype._setLocalDescription=function(W){var z=this;return"rollback"!==W.type&&this._shouldApplyDtx&&(W=new this._RTCSessionDescription({sdp:w(W.sdp),type:W.type})),this._peerConnection.setLocalDescription(W).catch(function(ee){z._log.warn('Calling setLocalDescription with an RTCSessionDescription of type "'+W.type+'" failed with the error "'+ee.message+'".',ee);var te=new N,ie={message:'Calling setLocalDescription with an RTCSessionDescription of type "'+W.type+'" failed',code:te.code,error:ee};throw W.sdp&&(z._log.warn("The SDP was "+W.sdp),ie.sdp=W.sdp),z._publishMediaWarning(ie),te}).then(function(){"rollback"!==W.type&&(z._localDescription=z._addOrRewriteLocalTrackIds(W),z._shouldApplyDtx&&(z._localDescription=new z._RTCSessionDescription({sdp:w(z._localDescription.sdp,[]),type:z._localDescription.type})),z._localCandidates=[],"offer"===W.type?z._descriptionRevision++:"answer"===W.type&&(z._lastStableDescriptionRevision=z._descriptionRevision,Ce(z)),z._localUfrag=q(W),z.emit("description",z.getState()))})},ne.prototype._setRemoteDescription=function(W){var z=this;return W.sdp&&(W.sdp=this._setCodecPreferences(W.sdp,this._preferredAudioCodecs,this._preferredVideoCodecs),W.sdp=this._shouldApplyDtx?w(W.sdp):w(W.sdp,[]),fe&&(W.sdp=function U(oe){return oe.replace(/a=msid:[^ ]+ /g,"a=msid:- ")}(W.sdp)),this._peerConnection.remoteDescription||(this._isIceLite=/a=ice-lite/.test(W.sdp))),W=new this._RTCSessionDescription(W),Promise.resolve().then(function(){if("answer"===W.type&&z._localDescriptionWithoutSimulcast){var ee=z._preferredVideoCodecs.find(function(he){return"adaptiveSimulcast"in he}),ie=z._revertSimulcast(z._localDescription.sdp,z._localDescriptionWithoutSimulcast.sdp,W.sdp,!!ee&&!1===ee.adaptiveSimulcast);if(z._localDescriptionWithoutSimulcast=null,ie!==z._localDescription.sdp)return z._rollbackAndApplyOffer({type:z._localDescription.type,sdp:ie})}}).then(function(){return z._peerConnection.setRemoteDescription(W)}).then(function(){"answer"===W.type&&(z._isRestartingIce&&(z._log.debug("An ICE restart was in-progress and is now completed"),z._isRestartingIce=!1),Ce(z))},function(ee){throw z._log.warn('Calling setRemoteDescription with an RTCSessionDescription of type "'+W.type+'" failed with the error "'+ee.message+'".',ee),W.sdp&&z._log.warn("The SDP was "+W.sdp),ee})},ne.prototype._updateDescription=function(W){var z=this;switch(W.type){case"answer":case"pranswer":if(W.revision!==this._descriptionRevision||"have-local-offer"!==this._peerConnection.signalingState)return Promise.resolve();this._descriptionRevision=W.revision;break;case"close":return this._close();case"create-offer":return W.revision<=this._lastStableDescriptionRevision?Promise.resolve():this._needsAnswer?(this._queuedDescription=W,Promise.resolve()):(this._descriptionRevision=W.revision,this._offer());case"offer":return W.revision<=this._lastStableDescriptionRevision||"closed"===this._peerConnection.signalingState?Promise.resolve():"have-local-offer"===this._peerConnection.signalingState?this._needsAnswer&&0===this._lastStableDescriptionRevision?(this._queuedDescription=W,Promise.resolve()):(this._descriptionRevision=W.revision,this._handleGlare(W)):(this._descriptionRevision=W.revision,this._answer(W).then(function(){}))}var ee=W.revision;return Promise.resolve().then(function(){return z._setRemoteDescription(W)}).catch(function(te){var ie=new j;throw z._publishMediaWarning({message:'Calling setRemoteDescription with an RTCSessionDescription of type "'+W.type+'" failed',code:ie.code,error:te,sdp:W.sdp}),ie}).then(function(){return z._lastStableDescriptionRevision=ee,z._needsAnswer=!1,z._checkIceBox(W)}).then(function(){return z._queuedDescription&&z._updateDescription(z._queuedDescription)}).then(function(){return z._queuedDescription=null,z._maybeReoffer(z._peerConnection.localDescription).then(function(){})})},ne.prototype._updateIce=function(W){var z=this._remoteCandidates.update(W);return this._addIceCandidates(z)},ne.prototype.addDataTrackSender=function(W){if(!this._dataChannels.has(W))try{var z={ordered:W.ordered};null!==W.maxPacketLifeTime&&(z.maxPacketLifeTime=W.maxPacketLifeTime),null!==W.maxRetransmits&&(z.maxRetransmits=W.maxRetransmits);var ee=this._peerConnection.createDataChannel(W.id,z);W.addDataChannel(ee),this._dataChannels.set(W,ee)}catch(te){this._log.warn('Error creating an RTCDataChannel for DataTrack "'+W.id+'": '+te.message)}},ne.prototype._handleQueuedPublisherHints=function(){var W=this;"stable"===this._peerConnection.signalingState&&this._mediaTrackSenderToPublisherHints.forEach(function(z,ee){var te=z.deferred,ie=z.encodings;W._mediaTrackSenderToPublisherHints.delete(ee),W._setPublisherHint(ee,ie).then(function(he){return te.resolve(he)}).catch(function(he){return te.reject(he)})})},ne.prototype._setPublisherHint=function(W,z){var ee=this;if(fe)return Promise.resolve("COULD_NOT_APPLY_HINT");this._mediaTrackSenderToPublisherHints.has(W)&&(this._mediaTrackSenderToPublisherHints.get(W).deferred.resolve("REQUEST_SKIPPED"),this._mediaTrackSenderToPublisherHints.delete(W));var ie=this._rtpSenders.get(W);if(!ie)return this._log.warn("Could not apply publisher hint because RTCRtpSender was not found"),Promise.resolve("UNKNOWN_TRACK");if("closed"===this._peerConnection.signalingState)return this._log.warn('Could not apply publisher hint because signalingState was "closed"'),Promise.resolve("COULD_NOT_APPLY_HINT");if("stable"!==this._peerConnection.signalingState){this._log.debug("Queuing up publisher hint because signalingState:",this._peerConnection.signalingState);var he=V();return this._mediaTrackSenderToPublisherHints.set(W,{deferred:he,encodings:z}),he.promise}var be=ie.getParameters();return null!==z&&z.forEach(function(xe){var Ae=xe.enabled,Te=xe.layer_index;be.encodings.length>Te?(ee._log.debug("layer:"+Te+", active:"+be.encodings[Te].active+" => "+Ae),be.encodings[Te].active=Ae):ee._log.warn("invalid layer:"+Te+", active:"+Ae)}),this._maybeUpdateEncodings(ie.track,be.encodings,null===z),ie.setParameters(be).then(function(){return"OK"}).catch(function(xe){return ee._log.error("Failed to apply publisher hints:",xe),"COULD_NOT_APPLY_HINT"})},ne.prototype.addMediaTrackSender=function(W){var z=this;if("closed"!==this._peerConnection.signalingState&&!this._rtpSenders.has(W)){var te=this._addOrUpdateTransceiver(W.track).sender;W.addSender(te,function(ie){return z._setPublisherHint(W,ie)}),this._rtpNewSenders.add(te),this._rtpSenders.set(W,te)}},ne.prototype.close=function(){this._close()&&(this._descriptionRevision++,this._localDescription={type:"close"},this.emit("description",this.getState()))},ne.prototype.getTrackReceivers=function(){return Array.from(this._dataTrackReceivers).concat(Array.from(this._mediaTrackReceivers))},ne.prototype.getState=function(){if(!this._localDescription)return null;var z={type:this._localDescription.type,revision:"answer"===this._localDescription.type?this._lastStableDescriptionRevision:this._descriptionRevision};return this._localDescription.sdp&&(z.sdp=this._localDescription.sdp),{description:z,id:this.id}},ne.prototype.offer=function(){var W=this;return this._needsAnswer||this._isRestartingIce?(this._shouldOffer=!0,Promise.resolve()):this.bracket("offering",function(z){return W.transition("updating",z),(W._needsAnswer||W._isRestartingIce?Promise.resolve():W._offer()).then(function(){W.tryTransition("open",z)},function(te){throw W.tryTransition("open",z),te})})},ne.prototype.removeDataTrackSender=function(W){var z=this._dataChannels.get(W);z&&(W.removeDataChannel(z),this._dataChannels.delete(W),z.close())},ne.prototype.removeMediaTrackSender=function(W){var z=this._rtpSenders.get(W);z&&("closed"!==this._peerConnection.signalingState&&this._peerConnection.removeTrack(z),W.removeSender(z),this._mediaTrackSenderToPublisherHints.has(W)&&(this._mediaTrackSenderToPublisherHints.get(W).deferred.resolve("UNKNOWN_TRACK"),this._mediaTrackSenderToPublisherHints.delete(W)),this._rtpNewSenders.delete(z),this._rtpSenders.delete(W))},ne.prototype.setConfiguration=function(W){"function"==typeof this._peerConnection.setConfiguration&&this._peerConnection.setConfiguration(B(W))},ne.prototype.setIceReconnectTimeout=function(W){return this._iceReconnectTimeout.setDelay(W),this._log.debug("Updated ICE reconnection timeout period:",this._iceReconnectTimeout.delay),this},ne.prototype.update=function(W){var z=this;return this.bracket("updating",function(ee){if("closed"===z.state)return Promise.resolve();z.transition("updating",ee);var te=[];return W.ice&&te.push(z._updateIce(W.ice)),W.description&&te.push(z._updateDescription(W.description)),Promise.all(te).then(function(){z.tryTransition("open",ee)},function(ie){throw z.tryTransition("open",ee),ie})})},ne.prototype.getStats=function(){var W=this;return n(this._peerConnection).then(function(z){return function Y(oe,ne){return Object.assign(ne,{remoteAudioTrackStats:ne.remoteAudioTrackStats.map(function(W){return we(oe,W)}),remoteVideoTrackStats:ne.remoteVideoTrackStats.map(function(W){return we(oe,W)}),localAudioTrackStats:ne.localAudioTrackStats.map(function(W){return Le(oe,W)}),localVideoTrackStats:ne.localVideoTrackStats.map(function(W){return Le(oe,W)})})}(W,z)})},ne}(X);function Le(oe,ne){var W=oe._getMediaTrackSenderId(ne.trackId);return Object.assign(ne,{trackId:W})}function we(oe,ne){var W=_([],y(oe._mediaTrackReceivers)).find(function(ee){return ee.track.id===ne.trackId});return Object.assign(ne,{trackId:W?W.id:null})}function q(oe){if(oe.sdp){var ne=oe.sdp.match(/^a=ice-ufrag:([a-zA-Z0-9+/]+)/m);if(ne)return ne[1]}return null}function B(oe){return Object.assign({bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},oe)}function I(oe,ne){var W=ne.track;return W&&W.kind===oe&&"ended"!==W.readyState}function Ce(oe){(function Pe(oe){oe._recycledTransceivers.audio=[],oe._recycledTransceivers.video=[],oe._peerConnection.getTransceivers().forEach(function(ne){(function ue(oe,ne){return!oe.stopped&&!ne._replaceTrackPromises.has(oe)&&["inactive","recvonly"].includes(oe.direction)})(ne,oe)&&oe._recycledTransceivers[ne.receiver.track.kind].push(ne)})})(oe),function re(oe){var ne=oe._peerConnection.localDescription;!ne||!ne.sdp||u(ne.sdp).forEach(function(W){R(W).forEach(function(ee,te){return oe._localCodecs.add(te)})})}(oe),function Se(oe){var ne=oe._peerConnection.remoteDescription;!ne||!ne.sdp||u(ne.sdp).forEach(function(W){var z=W.match(/^a=mid:(.+)$/m);if(z&&z[1]){var ee=z[1],te=R(W);oe._remoteCodecMaps.set(ee,te)}})}(oe),Oe(oe).then(function(){oe._handleQueuedPublisherHints()})}function Oe(oe){var ne=oe._encodingParameters,ee=new Map([["audio",ne.maxAudioBitrate],["video",ne.maxVideoBitrate]]),te=[];return oe._peerConnection.getSenders().filter(function(ie){return ie.track}).forEach(function(ie){var he=ee.get(ie.track.kind),be=ie.getParameters();null===he||0===he?function Me(oe){Array.isArray(oe.encodings)&&oe.encodings.forEach(function(ne){return delete ne.maxBitrate})}(be):oe._isChromeScreenShareTrack(ie.track)?oe._log.warn("Not setting maxBitrate for "+ie.track.kind+" Track "+ie.track.id+" because it appears to be screen share track: "+ie.track.label):function Ee(oe,ne){fe?oe.encodings=[{maxBitrate:ne}]:oe.encodings.forEach(function(W){W.maxBitrate=ne})}(be,he),!fe&&be.encodings.length>0&&("audio"===ie.track.kind?be.encodings[0].priority="high":oe._isChromeScreenShareTrack(ie.track)&&(be.encodings[0].priority="medium"),oe._enableDscp&&(be.encodings[0].networkPriority="high"));var xe=oe._rtpNewSenders.has(ie);oe._maybeUpdateEncodings(ie.track,be.encodings,xe),oe._rtpNewSenders.delete(ie);var Ae=ie.setParameters(be).catch(function(Te){oe._log.warn("Error while setting encodings parameters for "+ie.track.kind+" Track "+ie.track.id+": "+(Te.message||Te.name))});te.push(Ae)}),Promise.all(te)}C.exports=ke},{"../../data/receiver":5,"../../media/track/receiver":30,"../../statemachine":88,"../../util":132,"../../util/backoff":122,"../../util/constants":125,"../../util/log":136,"../../util/sdp":140,"../../util/sdp/issue8329":141,"../../util/sdp/trackmatcher":143,"../../util/timeout":146,"../../util/twilio-video-errors":147,"../../webrtc":158,"../../webrtc/util":170,"./icebox":69,"./iceconnectionmonitor.js":70}],78:[function(v,C,x){"use strict";var u,S=this&&this.__extends||(u=function(f,g){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,E){P.__proto__=E}||function(P,E){for(var O in E)Object.prototype.hasOwnProperty.call(E,O)&&(P[O]=E[O])})(f,g)},function(f,g){if("function"!=typeof g&&null!==g)throw new TypeError("Class extends value "+String(g)+" is not a constructor or null");function P(){this.constructor=f}u(f,g),f.prototype=null===g?Object.create(g):(P.prototype=g.prototype,new P)}),y=this&&this.__read||function(u,f){var g="function"==typeof Symbol&&u[Symbol.iterator];if(!g)return u;var E,A,P=g.call(u),O=[];try{for(;(void 0===f||f-- >0)&&!(E=P.next()).done;)O.push(E.value)}catch(N){A={error:N}}finally{try{E&&!E.done&&(g=P.return)&&g.call(P)}finally{if(A)throw A.error}}return O},_=this&&this.__spreadArray||function(u,f){for(var g=0,P=f.length,E=u.length;g<P;g++,E++)u[E]=f[g];return u},o=v("../../webrtc/util").guessBrowser,i=v("./peerconnection"),e=v("../../media/track/sender"),t=v("../../queueingeventemitter"),r=v("../../util"),n=v("../../util/twilio-video-errors").MediaConnectionError,a="firefox"===o(),s=function(u){function f(g,P,E){var O=u.call(this)||this,A=(E=Object.assign({audioContextFactory:a?v("../../webaudio/audiocontext"):null,PeerConnectionV2:i},E)).audioContextFactory?E.audioContextFactory.getOrCreate(O):null,N=A?{offerToReceiveVideo:!0}:{offerToReceiveAudio:!0,offerToReceiveVideo:!0};return Object.defineProperties(O,{_audioContextFactory:{value:E.audioContextFactory},_closedPeerConnectionIds:{value:new Set},_configuration:{writable:!0,value:null},_configurationDeferred:{writable:!0,value:r.defer()},_connectionState:{value:"new",writable:!0},_dummyAudioTrackSender:{value:A?new e(c(A)):null},_encodingParameters:{value:g},_iceConnectionState:{writable:!0,value:"new"},_dataTrackSenders:{writable:!0,value:new Set},_lastConnectionState:{value:"new",writable:!0},_lastIceConnectionState:{writable:!0,value:"new"},_mediaTrackSenders:{writable:!0,value:new Set},_offerOptions:{value:N},_peerConnections:{value:new Map},_preferredCodecs:{value:P},_sessionTimeout:{value:null,writable:!0},_PeerConnectionV2:{value:E.PeerConnectionV2}}),O}return S(f,u),f.prototype.setEffectiveAdaptiveSimulcast=function(g){this._peerConnections.forEach(function(P){return P.setEffectiveAdaptiveSimulcast(g)}),this._preferredCodecs.video.forEach(function(P){"adaptiveSimulcast"in P&&(P.adaptiveSimulcast=g)})},Object.defineProperty(f.prototype,"connectionState",{get:function(){return this._connectionState},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"iceConnectionState",{get:function(){return this._iceConnectionState},enumerable:!1,configurable:!0}),f.prototype._closeAbsentPeerConnections=function(g){var P=new Set(g.map(function(E){return E.id}));return this._peerConnections.forEach(function(E){P.has(E.id)||E._close()}),this},f.prototype._getConfiguration=function(){return this._configurationDeferred.promise},f.prototype._getOrCreate=function(g,P){var E=this,O=this,A=this._peerConnections.get(g);if(!A){var N=this._PeerConnectionV2,j=Object.assign({dummyAudioMediaStreamTrack:this._dummyAudioTrackSender?this._dummyAudioTrackSender.track:null,offerOptions:this._offerOptions},this._sessionTimeout?{sessionTimeout:this._sessionTimeout}:{},P);try{A=new N(g,this._encodingParameters,this._preferredCodecs,j)}catch{throw new n}this._peerConnections.set(A.id,A),A.on("candidates",this.queue.bind(this,"candidates")),A.on("description",this.queue.bind(this,"description")),A.on("trackAdded",this.queue.bind(this,"trackAdded")),A.on("stateChanged",function M(Q){"closed"===Q&&(A.removeListener("stateChanged",M),O._dataTrackSenders.forEach(function(G){return A.removeDataTrackSender(G)}),O._mediaTrackSenders.forEach(function(G){return A.removeMediaTrackSender(G)}),O._peerConnections.delete(A.id),O._closedPeerConnectionIds.add(A.id),m(O),w(O))}),A.on("connectionStateChanged",function(){return m(E)}),A.on("iceConnectionStateChanged",function(){return w(E)}),this._dataTrackSenders.forEach(A.addDataTrackSender,A),this._mediaTrackSenders.forEach(A.addMediaTrackSender,A),w(this)}return A},f.prototype.close=function(){return this._peerConnections.forEach(function(g){g.close()}),this._dummyAudioTrackSender&&this._dummyAudioTrackSender.stop(),this._audioContextFactory&&this._audioContextFactory.release(this),w(this),this},f.prototype.createAndOffer=function(){var g=this;return this._getConfiguration().then(function(P){var E;do{E=r.makeUUID()}while(g._peerConnections.has(E));return g._getOrCreate(E,P)}).then(function(P){return P.offer()}).then(function(){return g})},f.prototype.getTrackReceivers=function(){return r.flatMap(this._peerConnections,function(g){return g.getTrackReceivers()})},f.prototype.getStates=function(){var g=[];return this._peerConnections.forEach(function(P){var E=P.getState();E&&g.push(E)}),g},f.prototype.setConfiguration=function(g){return this._configuration&&(this._configurationDeferred=r.defer(),this._peerConnections.forEach(function(P){P.setConfiguration(g)})),this._configuration=g,this._configurationDeferred.resolve(g),this},f.prototype.setIceReconnectTimeout=function(g){return null===this._sessionTimeout&&(this._peerConnections.forEach(function(P){P.setIceReconnectTimeout(g)}),this._sessionTimeout=g),this},f.prototype.setTrackSenders=function(g){var P=new Set(g.filter(function(A){return"data"===A.kind})),E=new Set(g.filter(function(A){return A&&("audio"===A.kind||"video"===A.kind)})),O=function d(u,f,g){return{data:l(u,f),media:h(u,g)}}(this,P,E);return this._dataTrackSenders=P,this._mediaTrackSenders=E,function p(u,f){(f.data.add.size||f.data.remove.size||f.media.add.size||f.media.remove.size)&&u._peerConnections.forEach(function(g){f.data.remove.forEach(g.removeDataTrackSender,g),f.media.remove.forEach(g.removeMediaTrackSender,g),f.data.add.forEach(g.addDataTrackSender,g),f.media.add.forEach(g.addMediaTrackSender,g),(f.media.add.size||f.media.remove.size||f.data.add.size&&!g.isApplicationSectionNegotiated)&&g.offer()})}(this,O),this},f.prototype.update=function(g,P){var E=this;return void 0===P&&(P=!1),P&&this._closeAbsentPeerConnections(g),this._getConfiguration().then(function(O){return Promise.all(g.map(function(A){return E._closedPeerConnectionIds.has(A.id)?null:E._getOrCreate(A.id,O).update(A)}))}).then(function(){return E})},f.prototype.getStats=function(){var g=Array.from(this._peerConnections.values());return Promise.all(g.map(function(P){return P.getStats().then(function(E){return[P.id,E]})})).then(function(P){return new Map(P)})},f}(t);function c(u){return u.createMediaStreamDestination().stream.getAudioTracks()[0]}function l(u,f){return{add:r.difference(f,u._dataTrackSenders),remove:r.difference(u._dataTrackSenders,f)}}function h(u,f){return{add:r.difference(f,u._mediaTrackSenders),remove:r.difference(u._mediaTrackSenders,f)}}var b,k={new:0,checking:1,connecting:2,connected:3,completed:4,disconnected:-1,failed:-2,closed:-3};function T(u){return u.length?(b=b||function R(){return Object.keys(k).reduce(function(u,f){var g;return Object.assign(u,((g={})[k[f]]=f,g))},{})}(),u.reduce(function(f,g){return b[Math.max(k[f],k[g])]})):"new"}function w(u){u._lastIceConnectionState=u.iceConnectionState,u._iceConnectionState=T(_([],y(u._peerConnections.values())).map(function(f){return f.iceConnectionState})),u.iceConnectionState!==u._lastIceConnectionState&&u.emit("iceConnectionStateChanged")}function m(u){u._lastConnectionState=u.connectionState,u._connectionState=T(_([],y(u._peerConnections.values())).map(function(f){return f.connectionState})),u.connectionState!==u._lastConnectionState&&u.emit("connectionStateChanged")}C.exports=s},{"../../media/track/sender":39,"../../queueingeventemitter":55,"../../util":132,"../../util/twilio-video-errors":147,"../../webaudio/audiocontext":153,"../../webrtc/util":170,"./peerconnection":77}],79:[function(v,C,x){"use strict";var i,S=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),y=v("./mediasignaling"),_=1,o=function(i){function e(t,r){var n=i.call(this,t,"publisher_hints",r)||this;return n.on("ready",function(a){n._log.debug("publisher_hints transport ready:",a),a.on("message",function(s){"publisher_hints"===(n._log.debug("Incoming: ",s),s.type)?s.publisher&&s.publisher.hints&&s.publisher.id&&n._processPublisherHints(s.publisher.hints,s.publisher.id):n._log.warn("Unknown message type: ",s.type)})}),n}return S(e,i),e.prototype.sendTrackReplaced=function(t){if(this._transport){var n={type:"client_reset",track:t.trackSid,id:_++};this._log.debug("Outgoing: ",n),this._transport.publish(n)}},e.prototype.sendHintResponse=function(t){if(this._transport){var a={type:"publisher_hints",id:t.id,hints:t.hints};this._log.debug("Outgoing: ",a),this._transport.publish(a)}},e.prototype._processPublisherHints=function(t,r){try{this.emit("updated",t,r)}catch(n){this._log.error("error processing hints:",n)}},e}(y);C.exports=o},{"./mediasignaling":74}],80:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(){var e=o.call(this)||this;return Object.defineProperties(e,{_revision:{value:1,writable:!0}}),e}return S(i,o),i.prototype.update=function(e){return e.revision<this._revision?this:(this._revision=e.revision,this.enable(e.is_recording))},i}(v("../recording"));C.exports=_},{"../recording":62}],81:[function(v,C,x){"use strict";var i,S=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),y=v("../remoteparticipant"),_=v("./remotetrackpublication"),o=function(i){function e(t,r,n,a,s,c){var p=i.call(this,t.sid,t.identity)||this;return c=Object.assign({RemoteTrackPublicationV2:_},c),Object.defineProperties(p,{_revision:{writable:!0,value:null},_RemoteTrackPublicationV2:{value:c.RemoteTrackPublicationV2},_getInitialTrackSwitchOffState:{value:r},updateSubscriberTrackPriority:{value:function(l,d){return n(l,d)}},updateTrackRenderHint:{value:function(l,d){return a(l,d)}},clearTrackHint:{value:function(l){return s(l)}},revision:{enumerable:!0,get:function(){return this._revision}}}),p.update(t)}return S(e,i),e.prototype._getOrCreateTrack=function(t){var r=this._RemoteTrackPublicationV2,n=this.tracks.get(t.sid);return n||(n=new r(t,this._getInitialTrackSwitchOffState(t.sid)),this.addTrack(n)),n},e.prototype.update=function(t){var r=this;if(null!==this.revision&&t.revision<=this.revision)return this;this._revision=t.revision;var n=new Set;switch(t.tracks.forEach(function(a){var s=r._getOrCreateTrack(a);s.update(a),n.add(s)}),this.tracks.forEach(function(a){n.has(a)||r.removeTrack(a)}),t.state){case"disconnected":this.disconnect();break;case"reconnecting":this.reconnecting();break;case"connected":this.connect(this.sid,this.identity)}return this},e}(y);C.exports=o},{"../remoteparticipant":63,"./remotetrackpublication":82}],82:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t){return o.call(this,e.sid,e.name,e.kind,e.enabled,e.priority,t)||this}return S(i,o),i.prototype.update=function(e){return this.enable(e.enabled),this.setPriority(e.priority),this},i}(v("../remotetrackpublication"));C.exports=_},{"../remotetrackpublication":64}],83:[function(v,C,x){"use strict";var r,S=this&&this.__extends||(r=function(n,a){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var p in c)Object.prototype.hasOwnProperty.call(c,p)&&(s[p]=c[p])})(n,a)},function(n,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function s(){this.constructor=n}r(n,a),n.prototype=null===a?Object.create(a):(s.prototype=a.prototype,new s)}),y=v("./mediasignaling"),_=v("../../util/timeout"),o=v("../../util").isDeepEqual,e=1,t=function(r){function n(a,s){var c=r.call(this,a,"render_hints",s)||this;return Object.defineProperties(c,{_trackSidsToRenderHints:{value:new Map},_responseTimer:{value:new _(function(){c._sendAllHints(),c._responseTimer.setDelay(2*c._responseTimer.delay)},2e3,!1)}}),c.on("ready",function(p){p.on("message",function(l){"render_hints"===(c._log.debug("Incoming: ",l),l.type)?c._processHintResults(l&&l.subscriber&&l.subscriber.hints||[]):c._log.warn("Unknown message type: ",l.type)}),c._sendAllHints()}),c}return S(n,r),n.prototype._sendAllHints=function(){var a=this;Array.from(this._trackSidsToRenderHints.keys()).forEach(function(s){var c=a._trackSidsToRenderHints.get(s);c.renderDimensions&&(c.isDimensionDirty=!0),"enabled"in c&&(c.isEnabledDirty=!0)}),this._sendHints()},n.prototype._processHintResults=function(a){var s=this;this._responseTimer.clear(),this._responseTimer.setDelay(2e3),a.forEach(function(c){"OK"!==c.result&&s._log.debug("Server error processing hint:",c)}),this._sendHints()},n.prototype._sendHints=function(){var a=this;if(this._transport&&!this._responseTimer.isSet){var s=[];if(Array.from(this._trackSidsToRenderHints.keys()).forEach(function(p){var l=a._trackSidsToRenderHints.get(p);if(l.isEnabledDirty||l.isDimensionDirty){var d={track:p};l.isEnabledDirty&&(d.enabled=l.enabled,l.isEnabledDirty=!1),l.isDimensionDirty&&(d.render_dimensions=l.renderDimensions,l.isDimensionDirty=!1),s.push(d)}}),s.length>0){var c={type:"render_hints",subscriber:{id:e++,hints:s}};this._log.debug("Outgoing: ",c),this._transport.publish(c),this._responseTimer.start()}}},n.prototype.setTrackHint=function(a,s){var c=this._trackSidsToRenderHints.get(a)||{isEnabledDirty:!1,isDimensionDirty:!1};"enabled"in s&&c.enabled!==s.enabled&&(c.enabled=!!s.enabled,c.isEnabledDirty=!0),s.renderDimensions&&!o(s.renderDimensions,c.renderDimensions)&&(c.renderDimensions=s.renderDimensions,c.isDimensionDirty=!0),this._trackSidsToRenderHints.set(a,c),this._sendHints()},n.prototype.clearTrackHint=function(a){this._trackSidsToRenderHints.delete(a)},n}(y);C.exports=t},{"../../util":132,"../../util/timeout":146,"./mediasignaling":74}],84:[function(v,C,x){"use strict";var V,S=this&&this.__extends||(V=function(D,L){return(V=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(H,J){H.__proto__=J}||function(H,J){for(var X in J)Object.prototype.hasOwnProperty.call(J,X)&&(H[X]=J[X])})(D,L)},function(D,L){if("function"!=typeof L&&null!==L)throw new TypeError("Class extends value "+String(L)+" is not a constructor or null");function H(){this.constructor=D}V(D,L),D.prototype=null===L?Object.create(L):(H.prototype=L.prototype,new H)}),y=this&&this.__read||function(V,D){var L="function"==typeof Symbol&&V[Symbol.iterator];if(!L)return V;var J,$,H=L.call(V),X=[];try{for(;(void 0===D||D-- >0)&&!(J=H.next()).done;)X.push(J.value)}catch(Z){$={error:Z}}finally{try{J&&!J.done&&(L=H.return)&&L.call(H)}finally{if($)throw $.error}}return X},_=v("./dominantspeakersignaling"),o=v("./networkqualitymonitor"),i=v("./networkqualitysignaling"),e=v("./recording"),t=v("../room"),r=v("./remoteparticipant"),n=v("../../stats/statsreport"),a=v("./trackprioritysignaling"),s=v("./trackswitchoffsignaling"),c=v("./renderhintssignaling"),p=v("./publisherhintsignaling.js"),l=v("../../util"),d=l.constants.DEFAULT_SESSION_TIMEOUT_SEC,h=l.createBandwidthProfilePayload,k=l.defer,b=l.difference,R=l.filterObject,T=l.flatMap,w=l.oncePerTick,m=v("../../util/movingaveragedelta"),u=v("../../util/twilio-video-errors").createTwilioError,g=function(V){function D(L,H,J,X,$){var Z=this;H.options=Object.assign({session_timeout:d},H.options),$=Object.assign({DominantSpeakerSignaling:_,NetworkQualityMonitor:o,NetworkQualitySignaling:i,RecordingSignaling:e,RemoteParticipantV2:r,TrackPrioritySignaling:a,TrackSwitchOffSignaling:s,bandwidthProfile:null,sessionTimeout:1e3*H.options.session_timeout,statsPublishIntervalMs:1e4},$),L.setBandwidthProfile($.bandwidthProfile);var se=H.options,de=se.audio_processors,ve=void 0===de?[]:de;L.setSignalingRegion(se.signaling_region),ve.includes("krisp")&&ve.push("rnnoise"),L.setAudioProcessors(ve),X.setIceReconnectTimeout($.sessionTimeout);var ce=function(pe){return Z._getTrackReceiver(pe)},fe=(Z=V.call(this,L,H.sid,H.name,$)||this)._log;return Object.defineProperties(Z,{_disconnectedParticipantRevisions:{value:new Map},_NetworkQualityMonitor:{value:$.NetworkQualityMonitor},_lastBandwidthProfileRevision:{value:L.bandwidthProfileRevision,writable:!0},_mediaStatesWarningsRevision:{value:0,writable:!0},_networkQualityMonitor:{value:null,writable:!0},_networkQualityConfiguration:{value:L.networkQualityConfiguration},_peerConnectionManager:{value:X},_published:{value:new Map},_publishedRevision:{value:0,writable:!0},_RemoteParticipantV2:{value:$.RemoteParticipantV2},_subscribed:{value:new Map},_subscribedRevision:{value:0,writable:!0},_subscriptionFailures:{value:new Map},_dominantSpeakerSignaling:{value:new $.DominantSpeakerSignaling(ce,{log:fe})},_networkQualitySignaling:{value:new $.NetworkQualitySignaling(ce,L.networkQualityConfiguration,{log:fe})},_renderHintsSignaling:{value:new c(ce,{log:fe})},_publisherHintsSignaling:{value:new p(ce,{log:fe})},_trackPrioritySignaling:{value:new $.TrackPrioritySignaling(ce,{log:fe})},_trackSwitchOffSignaling:{value:new $.TrackSwitchOffSignaling(ce,{log:fe})},_pendingSwitchOffStates:{value:new Map},_transport:{value:J},_trackReceiverDeferreds:{value:new Map},mediaRegion:{enumerable:!0,value:H.options.media_region||null}}),Z._initTrackSwitchOffSignaling(),Z._initDominantSpeakerSignaling(),Z._initNetworkQualityMonitorSignaling(),Z._initPublisherHintSignaling(),function A(V,D){var L=w(function(){V._publishNewLocalParticipantState()}),H=w(function(){var J=T(D.tracks,function(X){return X.trackTransceiver});V._peerConnectionManager.setTrackSenders(J)});D.on("trackAdded",H),D.on("trackRemoved",H),D.on("updated",L),V.on("stateChanged",function J(X){"disconnected"===X&&(D.removeListener("trackAdded",H),D.removeListener("trackRemoved",H),D.removeListener("updated",L),V.removeListener("stateChanged",J),D.disconnect())}),V.on("signalingConnectionStateChanged",function(){var J=V.localParticipant,$=J.identity,Z=J.sid;switch(V.signalingConnectionState){case"connected":J.connect(Z,$);break;case"reconnecting":J.reconnecting()}})}(Z,L),function N(V,D){D.on("description",function(H){V._publishPeerConnectionState(H)}),D.dequeue("description"),D.on("candidates",function(H){V._publishPeerConnectionState(H)}),D.dequeue("candidates"),D.on("trackAdded",V._addTrackReceiver.bind(V)),D.dequeue("trackAdded"),D.getTrackReceivers().forEach(V._addTrackReceiver,V),D.on("connectionStateChanged",function(){V.emit("connectionStateChanged")}),D.on("iceConnectionStateChanged",function(){V.emit("iceConnectionStateChanged"),"failed"===V.iceConnectionState&&(null!==V.localParticipant.networkQualityLevel&&V.localParticipant.setNetworkQualityLevel(0),V.participants.forEach(function(L){null!==L.networkQualityLevel&&L.setNetworkQualityLevel(0)}))})}(Z,X),function j(V,D){D.on("message",V._update.bind(V)),D.on("stateChanged",function L(H,J){"disconnected"===H&&("disconnected"!==V.state&&V._disconnect(J),D.removeListener("stateChanged",L)),V.emit("signalingConnectionStateChanged")})}(Z,J),function M(V,D,L){var H=new Map,J=!1,X=setInterval(function(){V.getStats().then(function($){J=!J,$.forEach(function(Z,se){var le=new n(se,Z,!0);D.publishEvent("quality","stats-report","info",{audioTrackStats:le.remoteAudioTrackStats.map(function(fe,pe){return K(fe,Z.remoteAudioTrackStats[pe],H)}),localAudioTrackStats:le.localAudioTrackStats.map(function(fe,pe){return G(fe,Z.localAudioTrackStats[pe],H)}),localVideoTrackStats:le.localVideoTrackStats.map(function(fe,pe){return G(fe,Z.localVideoTrackStats[pe],H)}),peerConnectionId:le.peerConnectionId,videoTrackStats:le.remoteVideoTrackStats.map(function(fe,pe){return K(fe,Z.remoteVideoTrackStats[pe],H)})});var de=T(["localAudioTrackStats","localVideoTrackStats","remoteAudioTrackStats","remoteVideoTrackStats"],function(fe){return le[fe].map(function(pe){return pe.trackSid+"+"+pe.ssrc})});if(b(Array.from(H.keys()),de).forEach(function(fe){return H.delete(fe)}),J){var ce=function F(V,D){return(V=Object.assign({availableIncomingBitrate:0,availableOutgoingBitrate:0,bytesReceived:0,bytesSent:0,consentRequestsSent:0,currentRoundTripTime:0,lastPacketReceivedTimestamp:0,lastPacketSentTimestamp:0,nominated:!1,peerConnectionId:D,priority:0,readable:!1,requestsReceived:0,requestsSent:0,responsesReceived:0,responsesSent:0,retransmissionsReceived:0,retransmissionsSent:0,state:"failed",totalRoundTripTime:0,transportId:"",writable:!1},R(V||{},null))).localCandidate=Object.assign({candidateType:"host",deleted:!1,ip:"",port:0,priority:0,protocol:"udp",url:""},R(V.localCandidate||{},null)),V.remoteCandidate=Object.assign({candidateType:"host",ip:"",port:0,priority:0,protocol:"udp",url:""},R(V.remoteCandidate||{},null)),V}(Z.activeIceCandidatePair,le.peerConnectionId);D.publishEvent("quality","active-ice-candidate-pair","info",ce)}})},function(){})},L);V.on("stateChanged",function $(Z){"disconnected"===Z&&(clearInterval(X),V.removeListener("stateChanged",$))})}(Z,J,$.statsPublishIntervalMs),Z._update(H),Z._peerConnectionManager.setEffectiveAdaptiveSimulcast(Z._publisherHintsSignaling.isSetup),Z}return S(D,V),Object.defineProperty(D.prototype,"connectionState",{get:function(){return this._peerConnectionManager.connectionState},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"signalingConnectionState",{get:function(){return"syncing"===this._transport.state?"reconnecting":this._transport.state},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"iceConnectionState",{get:function(){return this._peerConnectionManager.iceConnectionState},enumerable:!1,configurable:!0}),D.prototype._deleteTrackReceiverDeferred=function(L){return this._trackReceiverDeferreds.delete(L)},D.prototype._getOrCreateTrackReceiverDeferred=function(L){var H=this._trackReceiverDeferreds.get(L)||k(),X=this._peerConnectionManager.getTrackReceivers().find(function($){return $.id===L&&"ended"!==$.readyState});return X?H.resolve(X):this._trackReceiverDeferreds.set(L,H),H},D.prototype._addTrackReceiver=function(L){return this._getOrCreateTrackReceiverDeferred(L.id).resolve(L),this},D.prototype._disconnect=function(L){var H=V.prototype._disconnect.call(this,L);return H&&(this._teardownNetworkQualityMonitor(),this._transport.disconnect(),this._peerConnectionManager.close()),this.localParticipant.tracks.forEach(function(J){J.publishFailed(L||new Error("LocalParticipant disconnected"))}),H},D.prototype._getTrackReceiver=function(L){var H=this;return this._getOrCreateTrackReceiverDeferred(L).promise.then(function(J){return H._deleteTrackReceiverDeferred(L),J})},D.prototype._getInitialTrackSwitchOffState=function(L){var H=this._pendingSwitchOffStates.get(L)||!1;return this._pendingSwitchOffStates.delete(L),H&&this._log.warn("["+L+"] was initially switched off! "),H},D.prototype._getTrackSidsToTrackSignalings=function(){var L=T(this.participants,function(H){return Array.from(H.tracks)});return new Map(L)},D.prototype._getOrCreateRemoteParticipant=function(L){var H=this,J=this._RemoteParticipantV2,X=this.participants.get(L.sid),$=this;return X||((X=new J(L,function(Z){return H._getInitialTrackSwitchOffState(Z)},function(Z,se){return H._trackPrioritySignaling.sendTrackPriorityUpdate(Z,"subscribe",se)},function(Z,se){return H._renderHintsSignaling.setTrackHint(Z,se)},function(Z){return H._renderHintsSignaling.clearTrackHint(Z)})).on("stateChanged",function Z(se){"disconnected"===se&&(X.removeListener("stateChanged",Z),$.participants.delete(X.sid),$._disconnectedParticipantRevisions.set(X.sid,X.revision))}),this.connectParticipant(X)),X},D.prototype._getState=function(){return{participant:this.localParticipant.getState()}},D.prototype._maybeAddBandwidthProfile=function(L){var H=this.localParticipant,J=H.bandwidthProfile,X=H.bandwidthProfileRevision;return J&&this._lastBandwidthProfileRevision<X?(this._lastBandwidthProfileRevision=X,Object.assign({bandwidth_profile:h(J)},L)):L},D.prototype._publishNewLocalParticipantState=function(){this._transport.publish(this._maybeAddBandwidthProfile(this._getState()))},D.prototype._publishPeerConnectionState=function(L){this._transport.publish(Object.assign({peer_connections:[L]},this._getState()))},D.prototype._update=function(L){var H=this;if(L.subscribed&&L.subscribed.revision>this._subscribedRevision){this._subscribedRevision=L.subscribed.revision,L.subscribed.tracks.forEach(function($){$.id?(H._subscriptionFailures.delete($.sid),H._subscribed.set($.sid,$.id)):$.error&&!H._subscriptionFailures.has($.sid)&&H._subscriptionFailures.set($.sid,$.error)});var J=new Set(L.subscribed.tracks.filter(function($){return!!$.id}).map(function($){return $.sid}));this._subscribed.forEach(function($,Z){J.has(Z)||H._subscribed.delete(Z)})}var X=new Set;return(L.participants||[]).forEach(function($){if($.sid!==H.localParticipant.sid){var Z=H._disconnectedParticipantRevisions.get($.sid);if(!(Z&&$.revision<=Z)){Z&&H._disconnectedParticipantRevisions.delete($.sid);var se=H._getOrCreateRemoteParticipant($);se.update($),X.add(se)}}}),"synced"===L.type&&this.participants.forEach(function($){X.has($)||$.disconnect()}),function Q(V){var D=V._getTrackSidsToTrackSignalings();V._subscriptionFailures.forEach(function(L,H){var J=D.get(H);J&&(V._subscriptionFailures.delete(H),J.subscribeFailed(u(L.code,L.message)))}),D.forEach(function(L){var H=V._subscribed.get(L.sid);(!H||L.isSubscribed&&L.trackTransceiver.id!==H)&&L.setTrackTransceiver(null),H&&V._getTrackReceiver(H).then(function(J){return L.setTrackTransceiver(J)})})}(this),L.peer_connections&&this._peerConnectionManager.update(L.peer_connections,"synced"===L.type),L.recording&&this.recording.update(L.recording),L.published&&L.published.revision>this._publishedRevision&&(this._publishedRevision=L.published.revision,L.published.tracks.forEach(function($){$.sid&&H._published.set($.id,$.sid)}),this.localParticipant.update(L.published)),L.participant&&this.localParticipant.connect(L.participant.sid,L.participant.identity),[this._dominantSpeakerSignaling,this._networkQualitySignaling,this._trackPrioritySignaling,this._trackSwitchOffSignaling,this._renderHintsSignaling,this._publisherHintsSignaling].forEach(function($){var Z=$.channel;!$.isSetup&&L.media_signaling&&L.media_signaling[Z]&&L.media_signaling[Z].transport&&"data-channel"===L.media_signaling[Z].transport.type&&$.setup(L.media_signaling[Z].transport.label)}),"warning"===L.type&&L.states&&L.states.revision>this._mediaStatesWarningsRevision&&(this._mediaStatesWarningsRevision=L.states.revision,this.localParticipant.updateMediaStates(L.states)),this},D.prototype._initPublisherHintSignaling=function(){var L=this;this._publisherHintsSignaling.on("updated",function(J,X){Promise.all(J.map(function($){return L.localParticipant.setPublisherHint($.track,$.encodings).then(function(Z){return{track:$.track,result:Z}})})).then(function($){L._publisherHintsSignaling.sendHintResponse({id:X,hints:$})})});var H=function(J){"video"===J.kind&&J.trackTransceiver.on("replaced",function(){L._publisherHintsSignaling.sendTrackReplaced({trackSid:J.sid})})};Array.from(this.localParticipant.tracks.values()).forEach(function(J){return H(J)}),this.localParticipant.on("trackAdded",function(J){return H(J)})},D.prototype._initTrackSwitchOffSignaling=function(){var L=this;this._trackSwitchOffSignaling.on("updated",function(H,J){try{L._log.debug("received trackSwitch: ",{tracksOn:J,tracksOff:H});var X=new Map;J.forEach(function($){return X.set($,!0)}),H.forEach(function($){X.get($)&&L._log.warn($+" is DUPLICATED in both tracksOff and tracksOn list"),X.set($,!1)}),L.participants.forEach(function($){$.tracks.forEach(function(Z){var se=X.get(Z.sid);typeof se<"u"&&(Z.setSwitchedOff(!se),X.delete(Z.sid))})}),X.forEach(function($,Z){return L._pendingSwitchOffStates.set(Z,!$)})}catch($){L._log.error("error processing track switch off:",$)}})},D.prototype._initDominantSpeakerSignaling=function(){var L=this;this._dominantSpeakerSignaling.on("updated",function(){return L.setDominantSpeaker(L._dominantSpeakerSignaling.loudestParticipantSid)})},D.prototype._initNetworkQualityMonitorSignaling=function(){var L=this;this._networkQualitySignaling.on("ready",function(){var H=new L._NetworkQualityMonitor(L._peerConnectionManager,L._networkQualitySignaling);L._networkQualityMonitor=H,H.on("updated",function(){"failed"!==L.iceConnectionState&&(L.localParticipant.setNetworkQualityLevel(H.level,H.levels),L.participants.forEach(function(J){var X=H.remoteLevels.get(J.sid);X&&J.setNetworkQualityLevel(X.level,X)}))}),H.start()}),this._networkQualitySignaling.on("teardown",function(){return L._teardownNetworkQualityMonitor()})},D.prototype._teardownNetworkQualityMonitor=function(){this._networkQualityMonitor&&(this._networkQualityMonitor.stop(),this._networkQualityMonitor=null)},D.prototype.getStats=function(){var L=this;return this._peerConnectionManager.getStats().then(function(H){return new Map(Array.from(H).map(function(J){var X=y(J,2),Z=X[1];return[X[0],Object.assign({},Z,{localAudioTrackStats:E(L,Z.localAudioTrackStats),localVideoTrackStats:E(L,Z.localVideoTrackStats),remoteAudioTrackStats:O(L,Z.remoteAudioTrackStats),remoteVideoTrackStats:O(L,Z.remoteVideoTrackStats)})]}))})},D}(t);function P(V,D){return D.reduce(function(L,H){var J=V.get(H.trackId);return J?[Object.assign({},H,{trackSid:J})].concat(L):L},[])}function E(V,D){return P(V._published,D)}function O(V,D){return P(new Map(Array.from(V._subscribed.entries()).map(function(H){var J=y(H,2);return[J[1],J[0]]})),D)}function G(V,D,L){var H=D.framesEncoded,J=D.packetsSent,X=D.totalEncodeTime,$=D.totalPacketSendDelay,Z=Object.assign({},V),se=V.trackSid+"+"+V.ssrc,le=L.get(se)||new Map;if("number"==typeof X&&"number"==typeof H){var de=le.get("avgEncodeDelay")||new m;de.putSample(1e3*X,H),Z.avgEncodeDelay=Math.round(de.get()),le.set("avgEncodeDelay",de)}if("number"==typeof $&&"number"==typeof J){var ve=le.get("avgPacketSendDelay")||new m;ve.putSample(1e3*$,J),Z.avgPacketSendDelay=Math.round(ve.get()),le.set("avgPacketSendDelay",ve)}return L.set(se,le),Z}function K(V,D,L){var H=D.estimatedPlayoutTimestamp,J=D.framesDecoded,X=D.jitterBufferDelay,$=D.jitterBufferEmittedCount,Z=D.totalDecodeTime,se=Object.assign({},V),le=V.trackSid+"+"+V.ssrc,de=L.get(le)||new Map;if("number"==typeof H&&(se.estimatedPlayoutTimestamp=H),"number"==typeof J&&"number"==typeof Z){var ve=de.get("avgDecodeDelay")||new m;ve.putSample(1e3*Z,J),se.avgDecodeDelay=Math.round(ve.get()),de.set("avgDecodeDelay",ve)}if("number"==typeof X&&"number"==typeof $){var ce=de.get("avgJitterBufferDelay")||new m;ce.putSample(1e3*X,$),se.avgJitterBufferDelay=Math.round(ce.get()),de.set("avgJitterBufferDelay",ce)}return L.set(le,de),se}C.exports=g},{"../../stats/statsreport":116,"../../util":132,"../../util/movingaveragedelta":137,"../../util/twilio-video-errors":147,"../room":65,"./dominantspeakersignaling":68,"./networkqualitymonitor":75,"./networkqualitysignaling":76,"./publisherhintsignaling.js":79,"./recording":80,"./remoteparticipant":81,"./renderhintssignaling":83,"./trackprioritysignaling":85,"./trackswitchoffsignaling":86}],85:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t){var r=o.call(this,e,"track_priority",t)||this;return Object.defineProperties(r,{_enqueuedPriorityUpdates:{value:new Map}}),r.on("ready",function(n){Array.from(r._enqueuedPriorityUpdates.keys()).forEach(function(a){n.publish({type:"track_priority",track:a,subscribe:r._enqueuedPriorityUpdates.get(a)})})}),r}return S(i,o),i.prototype.sendTrackPriorityUpdate=function(e,t,r){if("subscribe"!==t)throw new Error("only subscribe priorities are supported, found: "+t);this._enqueuedPriorityUpdates.set(e,r),this._transport&&this._transport.publish({type:"track_priority",track:e,subscribe:r})},i}(v("./mediasignaling"));C.exports=_},{"./mediasignaling":74}],86:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t){var r=o.call(this,e,"track_switch_off",t)||this;return r.on("ready",function(n){n.on("message",function(a){"track_switch_off"===a.type&&r._setTrackSwitchOffUpdates(a.off||[],a.on||[])})}),r}return S(i,o),i.prototype._setTrackSwitchOffUpdates=function(e,t){this.emit("updated",e,t)},i}(v("./mediasignaling"));C.exports=_},{"./mediasignaling":74}],87:[function(v,C,x){"use strict";var N,S=this&&this.__extends||(N=function(j,M){return(N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Q,G){Q.__proto__=G}||function(Q,G){for(var K in G)Object.prototype.hasOwnProperty.call(G,K)&&(Q[K]=G[K])})(j,M)},function(j,M){if("function"!=typeof M&&null!==M)throw new TypeError("Class extends value "+String(M)+" is not a constructor or null");function Q(){this.constructor=j}N(j,M),j.prototype=null===M?Object.create(M):(Q.prototype=M.prototype,new Q)}),y=v("../../statemachine"),_=v("../../twilioconnection"),o=v("../../util/backoff"),i=v("../../util/constants").reconnectBackoffConfig,e=v("../../util/timeout"),t=v("../../util/constants"),r=t.SDK_NAME,n=t.SDK_VERSION,a=t.SDP_FORMAT,s=v("../../util"),c=s.createBandwidthProfilePayload,p=s.createMediaSignalingPayload,l=s.createMediaWarningsPayload,d=s.createSubscribePayload,h=s.getUserAgent,k=s.isNonArrayObject,b=v("../../util/twilio-video-errors"),R=b.createTwilioError,T=b.RoomCompletedError,w=b.SignalingConnectionError,m=b.SignalingServerBusyError,g={connecting:["connected","disconnected"],connected:["disconnected","syncing"],syncing:["connected","disconnected"],disconnected:[]},P=function(N){function j(M,Q,G,K,F,V){var D;return V=Object.assign({Backoff:o,TwilioConnection:_,iceServers:null,trackPriority:!0,trackSwitchOff:!0,renderHints:!0,userAgent:h()},V),D=N.call(this,"connecting",g)||this,Object.defineProperties(D,{_accessToken:{value:Q},_automaticSubscription:{value:V.automaticSubscription},_bandwidthProfile:{value:V.bandwidthProfile},_dominantSpeaker:{value:V.dominantSpeaker},_adaptiveSimulcast:{value:V.adaptiveSimulcast},_eventObserver:{value:V.eventObserver,writable:!1},_renderHints:{value:V.renderHints},_iceServersStatus:{value:Array.isArray(V.iceServers)?"overrode":"acquire"},_localParticipant:{value:G},_name:{value:M},_networkQuality:{value:k(V.networkQuality)||V.networkQuality},_notifyWarnings:{value:V.notifyWarnings},_options:{value:V},_peerConnectionManager:{value:K},_sessionTimer:{value:null,writable:!0},_sessionTimeoutMS:{value:0,writable:!0},_reconnectBackoff:{value:new V.Backoff(i)},_session:{value:null,writable:!0},_trackPriority:{value:V.trackPriority},_trackSwitchOff:{value:V.trackSwitchOff},_twilioConnection:{value:null,writable:!0},_updatesReceived:{value:[]},_updatesToSend:{value:[]},_userAgent:{value:V.userAgent},_wsServer:{value:F}}),function A(N){function j(){if("disconnected"!==N.state){N._twilioConnection&&N._twilioConnection.removeListener("message",Q);var L=N._options,X=L.TwilioConnection,$=new X(N._wsServer,Object.assign({helloBody:"connecting"===N.state&&"acquire"===N._iceServersStatus?N._createIceMessage():N._createConnectOrSyncOrDisconnectMessage()},L));$.once("close",function(Z){Z===X.CloseReason.LOCAL?M():M(new Error(Z))}),$.on("message",Q),N._twilioConnection=$}}function M(D){if("disconnected"!==N.state){if(!D)return void N.disconnect();var L=N._getReconnectTimer();if(!L){var H=D.message===_.CloseReason.BUSY?new m:new w;return void N.disconnect(H)}"connected"===N.state&&N.preempt("syncing"),L.then(j)}}function Q(D){if("disconnected"!==N.state){if("error"===D.type)return void N.disconnect(R(D.code,D.message));switch(N.state){case"connected":switch(D.type){case"connected":case"synced":case"update":case"warning":return void N.emit("message",D);case"disconnected":return void N.disconnect("completed"===D.status?new T:null);default:return}case"connecting":switch(D.type){case"iced":return void N._options.onIced(D.ice_servers).then(function(){N._sendConnectOrSyncOrDisconnectMessage()});case"connected":return N._setSession(D.session,D.options.session_timeout),N.emit("connected",D),void N.preempt("connected");case"synced":case"update":return void N._updatesReceived.push(D);case"disconnected":return void N.disconnect("completed"===D.status?new T:null);default:return}case"syncing":switch(D.type){case"connected":case"update":return void N._updatesReceived.push(D);case"synced":return N._clearReconnectTimer(),N.emit("message",D),void N.preempt("connected");case"disconnected":return void N.disconnect("completed"===D.status?new T:null);default:return}default:return}}}N.on("stateChanged",function D(L){switch(L){case"connected":var H=N._updatesToSend.splice(0);return H.length&&N.publish(function O(N){return N.reduce(function(j,M){return(!j.participant&&M.participant||j.participant&&M.participant&&M.participant.revision>j.participant.revision)&&(j.participant=M.participant),!j.peer_connections&&M.peer_connections?j.peer_connections=E(M.peer_connections):j.peer_connections&&M.peer_connections&&(j.peer_connections=E(j.peer_connections.concat(M.peer_connections))),j},{})}(H)),void N._updatesReceived.splice(0).forEach(function(J){return N.emit("message",J)});case"disconnected":return N._twilioConnection.removeListener("message",Q),void N.removeListener("stateChanged",D);default:return}});var G=N._options;"overrode"===N._iceServersStatus?(0,G.onIced)(G.iceServers).then(j):j()}(D),D}return S(j,N),j.prototype._createConnectOrSyncOrDisconnectMessage=function(){if("connected"===this.state)return null;if("disconnected"===this.state)return{session:this._session,type:"disconnect",version:2};var M={connecting:"connect",syncing:"sync"}[this.state],Q={name:this._name,participant:this._localParticipant.getState(),peer_connections:this._peerConnectionManager.getStates(),type:M,version:2};return"connect"===Q.type?(Q.ice_servers=this._iceServersStatus,Q.publisher={name:r,sdk_version:n,user_agent:this._userAgent},this._bandwidthProfile&&(Q.bandwidth_profile=c(this._bandwidthProfile)),this._notifyWarnings&&(Q.participant.media_warnings=l(this._notifyWarnings)),Q.media_signaling=p(this._dominantSpeaker,this._networkQuality,this._trackPriority,this._trackSwitchOff,this._adaptiveSimulcast,this._renderHints),Q.subscribe=d(this._automaticSubscription),Q.format=a,Q.token=this._accessToken):"sync"===Q.type?(Q.session=this._session,Q.token=this._accessToken):"update"===Q.type&&(Q.session=this._session),Q},j.prototype._createIceMessage=function(){return{edge:"roaming",token:this._accessToken,type:"ice",version:1}},j.prototype._sendConnectOrSyncOrDisconnectMessage=function(){var M=this._createConnectOrSyncOrDisconnectMessage();M&&this._twilioConnection.sendMessage(M)},j.prototype.disconnect=function(M){return"disconnected"!==this.state&&(this.preempt("disconnected",null,[M]),this._sendConnectOrSyncOrDisconnectMessage(),this._twilioConnection.close(),!0)},j.prototype.publish=function(M){switch(this.state){case"connected":return this._twilioConnection.sendMessage(Object.assign({session:this._session,type:"update",version:2},M)),!0;case"connecting":case"syncing":return this._updatesToSend.push(M),!0;default:return!1}},j.prototype.publishEvent=function(M,Q,G,K){this._eventObserver.emit("event",{group:M,name:Q,level:G,payload:K})},j.prototype.sync=function(){return"connected"===this.state&&(this.preempt("syncing"),this._sendConnectOrSyncOrDisconnectMessage(),!0)},j.prototype._setSession=function(M,Q){this._session=M,this._sessionTimeoutMS=1e3*Q},j.prototype._getReconnectTimer=function(){var M=this;return 0===this._sessionTimeoutMS?null:(this._sessionTimer||(this._sessionTimer=new e(function(){M._sessionTimer&&(M._sessionTimeoutMS=0)},this._sessionTimeoutMS)),new Promise(function(Q){M._reconnectBackoff.backoff(Q)}))},j.prototype._clearReconnectTimer=function(){this._reconnectBackoff.reset(),this._sessionTimer&&(this._sessionTimer.clear(),this._sessionTimer=null)},j}(y);function E(N){return Array.from(N.reduce(function(j,M){var Q=j.get(M.id)||M;return(!Q.description&&M.description||Q.description&&M.description&&M.description.revision>Q.description.revision)&&(Q.description=M.description),(!Q.ice&&M.ice||Q.ice&&M.ice&&M.ice.revision>Q.ice.revision)&&(Q.ice=M.ice),j.set(Q.id,Q),j},new Map).values())}C.exports=P},{"../../statemachine":88,"../../twilioconnection":120,"../../util":132,"../../util/backoff":122,"../../util/constants":125,"../../util/timeout":146,"../../util/twilio-video-errors":147}],88:[function(v,C,x){"use strict";var p,S=this&&this.__extends||(p=function(l,d){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,k){h.__proto__=k}||function(h,k){for(var b in k)Object.prototype.hasOwnProperty.call(k,b)&&(h[b]=k[b])})(l,d)},function(l,d){if("function"!=typeof d&&null!==d)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");function h(){this.constructor=l}p(l,d),l.prototype=null===d?Object.create(d):(h.prototype=d.prototype,new h)}),y=this&&this.__read||function(p,l){var d="function"==typeof Symbol&&p[Symbol.iterator];if(!d)return p;var k,R,h=d.call(p),b=[];try{for(;(void 0===l||l-- >0)&&!(k=h.next()).done;)b.push(k.value)}catch(T){R={error:T}}finally{try{k&&!k.done&&(d=h.return)&&d.call(h)}finally{if(R)throw R.error}}return b},_=this&&this.__spreadArray||function(p,l){for(var d=0,h=l.length,k=p.length;d<h;d++,k++)p[k]=l[d];return p},o=v("events").EventEmitter,i=v("./util"),e=function(p){function l(d,h){var k=p.call(this)||this,b=null,R=d;return h=function s(p){var l=new Map;for(var d in p)l.set(d,new Set(p[d]));return l}(h),Object.defineProperties(k,{_lock:{get:function(){return b},set:function(T){b=T}},_reachableStates:{value:n(h)},_state:{get:function(){return R},set:function(T){R=T}},_states:{value:h},_whenDeferreds:{value:new Set},isLocked:{enumerable:!0,get:function(){return null!==b}},state:{enumerable:!0,get:function(){return R}}}),k.on("stateChanged",function(T){k._whenDeferreds.forEach(function(w){w.when(T,w.resolve,w.reject)})}),k}return S(l,p),l.prototype._whenPromise=function(d){var h=this;if("function"!=typeof d)return Promise.reject(new Error("when() executor must be a function"));var k=i.defer();return k.when=d,this._whenDeferreds.add(k),k.promise.then(function(b){return h._whenDeferreds.delete(k),b},function(b){throw h._whenDeferreds.delete(k),b})},l.prototype.bracket=function(d,h){var k,b=this;function R(T){if(b.hasLock(k)&&b.releaseLockCompletely(k),T)throw T}return this.takeLock(d).then(function(w){return h(k=w)}).then(function(w){return R(),w},R)},l.prototype.hasLock=function(d){return this._lock===d},l.prototype.preempt=function(d,h,k){if(!t(this._states,this.state,d))throw new Error('Cannot transition from "'+this.state+'" to "'+d+'"');var b;this.isLocked&&(b=this._lock,this._lock=null);var R=null;h&&(R=this.takeLockSync(h));var T=R?null:this.takeLockSync("preemption");return this.transition(d,R||T,k),b&&b.resolve(),T&&this.releaseLock(T),R},l.prototype.releaseLock=function(d){if(!this.isLocked)throw new Error("Could not release the lock for "+d.name+" because the StateMachine is not locked");if(!this.hasLock(d))throw new Error("Could not release the lock for "+d.name+" because "+this._lock.name+" has the lock");0===d.depth?(this._lock=null,d.resolve()):d.depth--},l.prototype.releaseLockCompletely=function(d){if(!this.isLocked)throw new Error("Could not release the lock for "+d.name+" because the StateMachine is not locked");if(!this.hasLock(d))throw new Error("Could not release the lock for "+d.name+" because "+this._lock.name+" has the lock");d.depth=0,this._lock=null,d.resolve()},l.prototype.takeLock=function(d){var h=this;if("object"==typeof d){var k=d;return new Promise(function(T){T(h.takeLockSync(k))})}var b=d;if(this.isLocked){var R=this.takeLock.bind(this,b);return this._lock.promise.then(R)}return Promise.resolve(this.takeLockSync(b))},l.prototype.takeLockSync=function(d){var h="string"==typeof d?null:d,k=h?h.name:d;if(h&&!this.hasLock(h)||!h&&this.isLocked)throw new Error("Could not take the lock for "+k+" because the lock for "+this._lock.name+" was not released");if(h)return h.depth++,h;var b=function r(p){var l=i.defer();return l.name=p,l.depth=0,l}(k);return this._lock=b,b},l.prototype.transition=function(d,h,k){if(k=k||[],this.isLocked){if(!h)throw new Error("You must provide the key in order to transition");if(!this.hasLock(h))throw new Error("Could not transition using the key for "+h.name+" because "+this._lock.name+" has the lock")}else if(h)throw new Error("Key provided for "+h.name+", but the StateMachine was not locked (possibly due to preemption)");if(!t(this._states,this.state,d))throw new Error('Cannot transition from "'+this.state+'" to "'+d+'"');this._state=d,this.emit.apply(this,_([],y(["stateChanged",d].concat(k))))},l.prototype.tryTransition=function(d,h,k){try{this.transition(d,h,k)}catch{return!1}return!0},l.prototype.when=function(d){var h=this;return this.state===d?Promise.resolve(this):t(this._reachableStates,this.state,d)?this._whenPromise(function(k,b,R){k===d?b(h):t(h._reachableStates,k,d)||R(c(k,d))}):Promise.reject(c(this.state,d))},l}(o);function t(p,l,d){return p.get(l).has(d)}function n(p){return Array.from(p.keys()).reduce(function(l,d){return l.set(d,a(p,d))},new Map)}function a(p,l,d){return d=d||new Set,p.get(l).forEach(function(h){d.has(h)||(d.add(h),a(p,h,d).forEach(d.add,d))}),d}function c(p,l){return new Error('"'+l+'" cannot be reached from "'+p+'"')}C.exports=e},{"./util":132,events:173}],89:[function(v,C,x){"use strict";C.exports=function S(y){return(y=y.filter(function(_){return"number"==typeof _})).length<1?void 0:y.reduce(function(_,o){return o+_})/y.length}},{}],90:[function(v,C,x){"use strict";var S=function(){function y(_,o,i,e){Object.defineProperties(this,{availableSend:{enumerable:!0,value:i},recv:{enumerable:!0,value:o},rtt:{enumerable:!0,value:e},send:{enumerable:!0,value:_}})}return y.of=function(_,o){var i=(o.timestamp-_.timestamp)/1e3;return new y(i>0?(o.bytesSent-_.bytesSent)/i*8:0,i>0?(o.bytesReceived-_.bytesReceived)/i*8:0,o.availableOutgoingBitrate,o.currentRoundTripTime)},y}();C.exports=S},{}],91:[function(v,C,x){"use strict";var S=v("./icereport"),y=function(){function _(){Object.defineProperties(this,{lastReport:{enumerable:!0,value:new S(0,0),writable:!0},lastStats:{enumerable:!0,value:null,writable:!0}})}return _.prototype.next=function(o){var i=this.lastStats;if(this.lastStats=o,i){var e=i.id===o.id?S.of(i,o):new S(0,0);this.lastReport=e}return this.lastReport},_}();C.exports=y},{"./icereport":90}],92:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t,r){var n=o.call(this,e,t,r)||this;return Object.defineProperties(n,{audioLevel:{value:"number"==typeof t.audioInputLevel?t.audioInputLevel:null,enumerable:!0},jitter:{value:"number"==typeof t.jitter?t.jitter:null,enumerable:!0}}),n}return S(i,o),i}(v("./localtrackstats"));C.exports=_},{"./localtrackstats":93}],93:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t,r){var n=o.call(this,e,t)||this;return Object.defineProperties(n,{bytesSent:{value:"number"==typeof t.bytesSent?t.bytesSent:r?0:null,enumerable:!0},packetsSent:{value:"number"==typeof t.packetsSent?t.packetsSent:r?0:null,enumerable:!0},roundTripTime:{value:"number"==typeof t.roundTripTime?t.roundTripTime:r?0:null,enumerable:!0}}),n}return S(i,o),i}(v("./trackstats"));C.exports=_},{"./trackstats":118}],94:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t,r){var n=o.call(this,e,t,r)||this,a=null;"number"==typeof t.frameWidthInput&&"number"==typeof t.frameHeightInput&&(a={},Object.defineProperties(a,{width:{value:t.frameWidthInput,enumerable:!0},height:{value:t.frameHeightInput,enumerable:!0}}));var s=null;return"number"==typeof t.frameWidthSent&&"number"==typeof t.frameHeightSent&&(s={},Object.defineProperties(s,{width:{value:t.frameWidthSent,enumerable:!0},height:{value:t.frameHeightSent,enumerable:!0}})),Object.defineProperties(n,{captureDimensions:{value:a,enumerable:!0},dimensions:{value:s,enumerable:!0},captureFrameRate:{value:"number"==typeof t.frameRateInput?t.frameRateInput:null,enumerable:!0},frameRate:{value:"number"==typeof t.frameRateSent?t.frameRateSent:null,enumerable:!0}}),n}return S(i,o),i}(v("./localtrackstats"));C.exports=_},{"./localtrackstats":93}],95:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e){return o.call(this,e)||this}return S(i,o),i}(v("./networkqualitymediastats"));C.exports=_},{"./networkqualitymediastats":99}],96:[function(v,C,x){"use strict";C.exports=function y(_){var o=_.actual,e=_.available,r=_.level;Object.defineProperties(this,{actual:{value:void 0===o?null:o,enumerable:!0},available:{value:void 0===e?null:e,enumerable:!0},level:{value:void 0===r?null:r,enumerable:!0}})}},{}],97:[function(v,C,x){"use strict";C.exports=function y(_){var o=_.fractionLost,e=_.level;Object.defineProperties(this,{fractionLost:{value:void 0===o?null:o,enumerable:!0},level:{value:void 0===e?null:e,enumerable:!0}})}},{}],98:[function(v,C,x){"use strict";C.exports=function y(_){var o=_.jitter,e=_.rtt,r=_.level;Object.defineProperties(this,{jitter:{value:void 0===o?null:o,enumerable:!0},rtt:{value:void 0===e?null:e,enumerable:!0},level:{value:void 0===r?null:r,enumerable:!0}})}},{}],99:[function(v,C,x){"use strict";var S=v("./networkqualitysendstats"),y=v("./networkqualityrecvstats");C.exports=function o(i){var r=i.sendStats,n=void 0===r?null:r,a=i.recvStats,s=void 0===a?null:a;Object.defineProperties(this,{send:{value:i.send,enumerable:!0},recv:{value:i.recv,enumerable:!0},sendStats:{value:n?new S(n):null,enumerable:!0},recvStats:{value:s?new y(s):null,enumerable:!0}})}},{"./networkqualityrecvstats":100,"./networkqualitysendstats":102}],100:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e){return o.call(this,e)||this}return S(i,o),i}(v("./networkqualitysendorrecvstats"));C.exports=_},{"./networkqualitysendorrecvstats":101}],101:[function(v,C,x){"use strict";var S=v("./networkqualitybandwidthstats"),y=v("./networkqualityfractionloststats"),_=v("./networkqualitylatencystats");C.exports=function i(e){var t=e.bandwidth,r=void 0===t?null:t,n=e.fractionLost,a=void 0===n?null:n,s=e.latency,c=void 0===s?null:s;Object.defineProperties(this,{bandwidth:{value:r?new S(r):null,enumerable:!0},fractionLost:{value:a?new y(a):null,enumerable:!0},latency:{value:c?new _(c):null,enumerable:!0}})}},{"./networkqualitybandwidthstats":96,"./networkqualityfractionloststats":97,"./networkqualitylatencystats":98}],102:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e){return o.call(this,e)||this}return S(i,o),i}(v("./networkqualitysendorrecvstats"));C.exports=_},{"./networkqualitysendorrecvstats":101}],103:[function(v,C,x){"use strict";var S=v("./networkqualityaudiostats"),y=v("./networkqualityvideostats");C.exports=function o(i){var t=i.audio,r=i.video;Object.defineProperties(this,{level:{value:i.level,enumerable:!0},audio:{value:t?new S(t):null,enumerable:!0},video:{value:r?new y(r):null,enumerable:!0}})}},{"./networkqualityaudiostats":95,"./networkqualityvideostats":104}],104:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e){return o.call(this,e)||this}return S(i,o),i}(v("./networkqualitymediastats"));C.exports=_},{"./networkqualitymediastats":99}],105:[function(v,C,x){"use strict";var S=v("./receiverreport"),y=v("./senderreport"),_=function(){function o(i,e,t){Object.defineProperties(this,{ice:{enumerable:!0,value:i},audio:{enumerable:!0,value:e},video:{enumerable:!0,value:t}})}return o.prototype.summarize=function(){var i=this.audio.send.concat(this.video.send),e=y.summarize(i),t=this.audio.recv.concat(this.video.recv),r=S.summarize(t);return{ice:this.ice,send:e,recv:r,audio:{send:y.summarize(this.audio.send),recv:S.summarize(this.audio.recv)},video:{send:y.summarize(this.video.send),recv:S.summarize(this.video.recv)}}},o}();C.exports=_},{"./receiverreport":107,"./senderreport":114}],106:[function(v,C,x){"use strict";var S=this&&this.__read||function(f,g){var P="function"==typeof Symbol&&f[Symbol.iterator];if(!P)return f;var O,N,E=P.call(f),A=[];try{for(;(void 0===g||g-- >0)&&!(O=E.next()).done;)A.push(O.value)}catch(j){N={error:j}}finally{try{O&&!O.done&&(P=E.return)&&P.call(E)}finally{if(N)throw N.error}}return A},y=this&&this.__spreadArray||function(f,g){for(var P=0,E=g.length,O=f.length;P<E;P++,O++)f[O]=g[P];return f},_=this&&this.__values||function(f){var g="function"==typeof Symbol&&Symbol.iterator,P=g&&f[g],E=0;if(P)return P.call(f);if(f&&"number"==typeof f.length)return{next:function(){return f&&E>=f.length&&(f=void 0),{value:f&&f[E++],done:!f}}};throw new TypeError(g?"Object is not iterable.":"Symbol.iterator is not defined.")},o=v("../webrtc/util").guessBrowser,i=v("./icereportfactory"),e=v("./peerconnectionreport"),t=v("./receiverreportfactory"),r=v("./senderreportfactory"),n=function(){function f(g){Object.defineProperties(this,{pc:{enumerable:!0,value:g},ice:{enumerable:!0,value:new i},audio:{enumerable:!0,value:{send:new Map,recv:new Map}},video:{enumerable:!0,value:{send:new Map,recv:new Map}},lastReport:{enumerable:!0,value:null,writable:!0}})}return f.prototype.next=function(){var g=this,P="firefox"===o()?function m(f){var g=f.pc.getTransceivers().filter(function(E){return E.currentDirection&&E.currentDirection.match(/send/)&&E.sender.track}).map(function(E){return E.sender}),P=f.pc.getTransceivers().filter(function(E){return E.currentDirection&&E.currentDirection.match(/recv/)}).map(function(E){return E.receiver});return Promise.all([a(g),a(P),f.pc.getStats()]).then(function(E){var O=S(E,3),A=O[0],N=O[1],j=O[2],M=c(f),Q=h(f);A.forEach(function(F,V){return b(f,F,Q,V)}),T(M,Q);var G=p(f),K=k(f);N.forEach(function(F,V){return R(f,F,K,V)}),T(G,K),w(f.ice,j)})}(this):function u(f){return f.pc.getStats().then(function(g){var P=c(f),E=h(f);b(f,g,E),T(P,E);var O=p(f),A=k(f);R(f,g,A),T(O,A),w(f.ice,g)})}(this);return P.then(function(){var E=y([],S(g.audio.send.values())),O=y([],S(g.video.send.values())),A=y([],S(g.audio.recv.values())),N=y([],S(g.video.recv.values())),j=new e(g.ice.lastReport,{send:E.map(function(M){return M.lastReport}).filter(function(M){return M}),recv:A.map(function(M){return M.lastReport}).filter(function(M){return M})},{send:O.map(function(M){return M.lastReport}).filter(function(M){return M}),recv:N.map(function(M){return M.lastReport}).filter(function(M){return M})});return g.lastReport=j,j})},f}();function a(f){return Promise.all(f.map(function(g){var P=g.track.id;return g.getStats().then(function(E){var O,A;try{for(var N=_(E.values()),j=N.next();!j.done;j=N.next()){var M=j.value;"inbound-rtp"===M.type&&(M.id=P+"-"+M.id)}}catch(Q){O={error:Q}}finally{try{j&&!j.done&&(A=N.return)&&A.call(N)}finally{if(O)throw O.error}}return[P,E]})})).then(function(g){return new Map(g)})}function s(f,g,P,E,O){var A=g[E.mediaType];if(!O){var N=P.get(E.trackId);N&&(O=N.trackIdentifier)}if(A&&O){if(A.has(E.id))return A.get(E.id);var j=new f(O,E);A.set(E.id,j)}return null}function c(f){return{audio:f.audio.send,video:f.video.send}}function p(f){return{audio:f.audio.recv,video:f.video.recv}}function l(f,g,P,E){return s(r,c(f),g,P,E)}function d(f,g,P,E){return s(t,p(f),g,P,E)}function h(f){return{audio:new Set(f.audio.send.keys()),video:new Set(f.video.send.keys())}}function k(f){return{audio:new Set(f.audio.recv.keys()),video:new Set(f.video.recv.keys())}}function b(f,g,P,E){var O,A;try{for(var N=_(g.values()),j=N.next();!j.done;j=N.next()){var M=j.value;if("outbound-rtp"===M.type&&!M.isRemote){if("firefox"!==o()&&!M.trackId)continue;var Q=P[M.mediaType];Q&&Q.delete(M.id);var G=l(f,g,M,E);if(G){var K=g.get(M.remoteId);G.next(E||G.trackId,M,K)}}}}catch(F){O={error:F}}finally{try{j&&!j.done&&(A=N.return)&&A.call(N)}finally{if(O)throw O.error}}}function R(f,g,P,E){var O,A;try{for(var N=_(g.values()),j=N.next();!j.done;j=N.next()){var M=j.value;if("inbound-rtp"===M.type&&!M.isRemote){var Q=P[M.mediaType];Q&&Q.delete(M.id);var G=d(f,g,M,E);G&&G.next(E||G.trackId,M)}}}catch(K){O={error:K}}finally{try{j&&!j.done&&(A=N.return)&&A.call(N)}finally{if(O)throw O.error}}}function T(f,g){var P=function(O){var A=f[O];g[O].forEach(function(j){return A.delete(j)})};for(var E in g)P(E)}function w(f,g){var P,E,O,A,N;try{for(var j=_(g.values()),M=j.next();!M.done;M=j.next())"transport"===(Q=M.value).type&&(N=g.get(Q.selectedCandidatePairId))}catch(F){P={error:F}}finally{try{M&&!M.done&&(E=j.return)&&E.call(j)}finally{if(P)throw P.error}}if(N)f.next(N);else try{for(var G=_(g.values()),K=G.next();!K.done;K=G.next()){var Q;"candidate-pair"===(Q=K.value).type&&Q.nominated&&(!("selected"in Q)||Q.selected)&&f.next(Q)}}catch(F){O={error:F}}finally{try{K&&!K.done&&(A=G.return)&&A.call(G)}finally{if(O)throw O.error}}}C.exports=n},{"../webrtc/util":170,"./icereportfactory":91,"./peerconnectionreport":105,"./receiverreportfactory":108,"./senderreportfactory":115}],107:[function(v,C,x){"use strict";var e,S=this&&this.__extends||(e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(n[s]=a[s])})(t,r)},function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),y=v("./average"),_=v("./senderorreceiverreport"),o=v("./sum"),i=function(e){function t(r,n,a,s,c,p,l){var d=e.call(this,r,n,a)||this;return Object.defineProperties(d,{deltaPacketsLost:{enumerable:!0,value:s},deltaPacketsReceived:{enumerable:!0,value:c},fractionLost:{enumerable:!0,value:p},jitter:{enumerable:!0,value:l},phonyFractionLost:{enumerable:!0,value:c>0?s/c:0}}),d}return S(t,e),t.of=function(r,n,a){if(n.id!==a.id)throw new Error("RTCStats IDs must match");var s=(a.timestamp-n.timestamp)/1e3,p=s>0?(a.bytesReceived-n.bytesReceived)/s*8:0,l=Math.max(a.packetsLost-n.packetsLost,0);return new t(n.id,r,p,l,a.packetsReceived-n.packetsReceived,a.fractionLost,a.jitter)},t.summarize=function(r){var n=r.map(function(p){return p.summarize()});return{bitrate:o(n.map(function(p){return p.bitrate})),fractionLost:y(n.map(function(p){return p.fractionLost})),jitter:y(n.map(function(p){return p.jitter}))}},t.prototype.summarize=function(){return{bitrate:this.bitrate,fractionLost:"number"==typeof this.fractionLost?this.fractionLost:this.phonyFractionLost,jitter:this.jitter}},t}(_);C.exports=i},{"./average":89,"./senderorreceiverreport":112,"./sum":117}],108:[function(v,C,x){"use strict";var i,S=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),y=v("./receiverreport"),o=function(i){function e(t,r){var n=i.call(this,r.id,t,r)||this;return Object.defineProperties(n,{lastReport:{enumerable:!0,value:null,writable:!0}}),n}return S(e,i),e.prototype.next=function(t,r){var n=this.lastStats;this.lastStats=r,this.trackId=t;var a=y.of(t,n,r);return this.lastReport=a,a},e}(v("./senderorreceiverreportfactory"));C.exports=o},{"./receiverreport":107,"./senderorreceiverreportfactory":113}],109:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t){var r=o.call(this,e,t)||this;return Object.defineProperties(r,{audioLevel:{value:"number"==typeof t.audioOutputLevel?t.audioOutputLevel:null,enumerable:!0},jitter:{value:"number"==typeof t.jitter?t.jitter:null,enumerable:!0}}),r}return S(i,o),i}(v("./remotetrackstats"));C.exports=_},{"./remotetrackstats":110}],110:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t){var r=o.call(this,e,t)||this;return Object.defineProperties(r,{bytesReceived:{value:"number"==typeof t.bytesReceived?t.bytesReceived:null,enumerable:!0},packetsReceived:{value:"number"==typeof t.packetsReceived?t.packetsReceived:null,enumerable:!0}}),r}return S(i,o),i}(v("./trackstats"));C.exports=_},{"./trackstats":118}],111:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t){var r=o.call(this,e,t)||this,n=null;return"number"==typeof t.frameWidthReceived&&"number"==typeof t.frameHeightReceived&&(n={},Object.defineProperties(n,{width:{value:t.frameWidthReceived,enumerable:!0},height:{value:t.frameHeightReceived,enumerable:!0}})),Object.defineProperties(r,{dimensions:{value:n,enumerable:!0},frameRate:{value:"number"==typeof t.frameRateReceived?t.frameRateReceived:null,enumerable:!0}}),r}return S(i,o),i}(v("./remotetrackstats"));C.exports=_},{"./remotetrackstats":110}],112:[function(v,C,x){"use strict";C.exports=function y(_,o,i){Object.defineProperties(this,{id:{enumerable:!0,value:_},trackId:{enumerable:!0,value:o},bitrate:{enumerable:!0,value:i}})}},{}],113:[function(v,C,x){"use strict";C.exports=function y(_,o,i){Object.defineProperties(this,{id:{enumerable:!0,value:_,writable:!0},trackId:{enumerable:!0,value:o,writable:!0},lastStats:{enumerable:!0,value:i,writable:!0}})}},{}],114:[function(v,C,x){"use strict";var e,S=this&&this.__extends||(e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(n[s]=a[s])})(t,r)},function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),y=v("./average"),_=v("./senderorreceiverreport"),o=v("./sum"),i=function(e){function t(r,n,a,s){var c=e.call(this,r,n,a)||this;return Object.defineProperties(c,{rtt:{enumerable:!0,value:s}}),c}return S(t,e),t.of=function(r,n,a,s){if(n.id!==a.id)throw new Error("RTCStats IDs must match");var c=(a.timestamp-n.timestamp)/1e3;return new t(n.id,r,c>0?(a.bytesSent-n.bytesSent)/c*8:0,s&&"number"==typeof s.roundTripTime?s.roundTripTime/1e3:void 0)},t.summarize=function(r){return{bitrate:o(r.map(function(s){return s.bitrate})),rtt:y(r.map(function(s){return s.rtt}))}},t}(_);C.exports=i},{"./average":89,"./senderorreceiverreport":112,"./sum":117}],115:[function(v,C,x){"use strict";var i,S=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),y=v("./senderorreceiverreportfactory"),_=v("./senderreport"),o=function(i){function e(t,r){var n=i.call(this,r.id,t,r)||this;return Object.defineProperties(n,{lastReport:{enumerable:!0,value:null,writable:!0}}),n}return S(e,i),e.prototype.next=function(t,r,n){var a=this.lastStats;this.lastStats=r,this.trackId=t;var s=_.of(t,a,r,n);return this.lastReport=s,s},e}(y);C.exports=o},{"./senderorreceiverreportfactory":113,"./senderreport":114}],116:[function(v,C,x){"use strict";var S=v("./localaudiotrackstats"),y=v("./localvideotrackstats"),_=v("./remoteaudiotrackstats"),o=v("./remotevideotrackstats");C.exports=function e(t,r,n){if("string"!=typeof t)throw new Error("RTCPeerConnection id must be a string");Object.defineProperties(this,{peerConnectionId:{value:t,enumerable:!0},localAudioTrackStats:{value:r.localAudioTrackStats.map(function(a){return new S(a.trackId,a,n)}),enumerable:!0},localVideoTrackStats:{value:r.localVideoTrackStats.map(function(a){return new y(a.trackId,a,n)}),enumerable:!0},remoteAudioTrackStats:{value:r.remoteAudioTrackStats.map(function(a){return new _(a.trackId,a)}),enumerable:!0},remoteVideoTrackStats:{value:r.remoteVideoTrackStats.map(function(a){return new o(a.trackId,a)}),enumerable:!0}})}},{"./localaudiotrackstats":92,"./localvideotrackstats":94,"./remoteaudiotrackstats":109,"./remotevideotrackstats":111}],117:[function(v,C,x){"use strict";C.exports=function S(y){return y.reduce(function(_,o){return"number"==typeof o?o+_:_},0)}},{}],118:[function(v,C,x){"use strict";C.exports=function y(_,o){if("string"!=typeof _)throw new Error("Track id must be a string");Object.defineProperties(this,{trackId:{value:_,enumerable:!0},trackSid:{value:o.trackSid,enumerable:!0},timestamp:{value:o.timestamp,enumerable:!0},ssrc:{value:o.ssrc,enumerable:!0},packetsLost:{value:"number"==typeof o.packetsLost?o.packetsLost:null,enumerable:!0},codec:{value:"string"==typeof o.codecName?o.codecName:null,enumerable:!0}})}},{}],119:[function(v,C,x){"use strict";var o,S=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),_=function(o){function i(e,t){var r=o.call(this)||this;return Object.defineProperties(r,{id:{enumerable:!0,value:e},kind:{enumerable:!0,value:t}}),r}return S(i,o),i.prototype.stop=function(){this.emit("stopped")},i}(v("./queueingeventemitter"));C.exports=_},{"./queueingeventemitter":55}],120:[function(v,C,x){"use strict";var K,S=this&&this.__extends||(K=function(F,V){return(K=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,L){D.__proto__=L}||function(D,L){for(var H in L)Object.prototype.hasOwnProperty.call(L,H)&&(D[H]=L[H])})(F,V)},function(F,V){if("function"!=typeof V&&null!==V)throw new TypeError("Class extends value "+String(V)+" is not a constructor or null");function D(){this.constructor=F}K(F,V),F.prototype=null===V?Object.create(V):(D.prototype=V.prototype,new D)}),y=this&&this.__read||function(K,F){var V="function"==typeof Symbol&&K[Symbol.iterator];if(!V)return K;var L,J,D=V.call(K),H=[];try{for(;(void 0===F||F-- >0)&&!(L=D.next()).done;)H.push(L.value)}catch(X){J={error:X}}finally{try{L&&!L.done&&(V=D.return)&&V.call(D)}finally{if(J)throw J.error}}return H},_=this&&this.__spreadArray||function(K,F){for(var V=0,D=F.length,L=K.length;V<D;V++,L++)K[L]=F[V];return K},o=v("./statemachine"),i=v("./util"),e=i.buildLogLevels,t=i.makeUUID,r=v("./util/log"),n=v("./util/networkmonitor"),a=v("./util/timeout"),s=0,c={closed:[],connecting:["closed","open","waiting"],early:["closed","connecting"],open:["closed"],waiting:["closed","connecting","early","open"]},p={closed:"close",open:"open",waiting:"waiting"},E=3005,N=globalThis,j=N.WebSocket?N.WebSocket:v("ws"),M={BUSY:"busy",FAILED:"failed",LOCAL:"local",REMOTE:"remote",TIMEOUT:"timeout"},Q=new Map([[3e3,M.TIMEOUT],[3001,M.TIMEOUT],[3002,M.FAILED],[3003,M.FAILED],[3004,M.TIMEOUT],[3006,M.BUSY],[3007,M.TIMEOUT]]),G=function(K){function F(V,D){var L=K.call(this,"early",c)||this;D=Object.assign({helloBody:null,maxConsecutiveFailedHellos:3,maxConsecutiveMissedHeartbeats:3,requestedHeartbeatTimeout:5e3,openTimeout:15e3,welcomeTimeout:5e3,Log:r,WebSocket:j},D);var H=e(D.logLevel),J=new D.Log("default",L,H,D.loggerName),X=D.networkMonitor?new n(function(){var Z=X.type,se="Network changed"+(Z?" to "+Z:"");J.debug(se),L._close({code:3004,reason:se})}):null;Object.defineProperties(L,{_busyWaitTimeout:{value:null,writable:!0},_consecutiveHeartbeatsMissed:{value:0,writable:!0},_cookie:{value:null,writable:!0},_eventObserver:{value:D.eventObserver},_heartbeatTimeout:{value:null,writable:!0},_hellosLeft:{value:D.maxConsecutiveFailedHellos,writable:!0},_instanceId:{value:++s},_log:{value:J},_messageQueue:{value:[]},_networkMonitor:{value:X},_options:{value:D},_openTimeout:{value:null,writable:!0},_sendHeartbeatTimeout:{value:null,writable:!0},_serverUrl:{value:V},_welcomeTimeout:{value:null,writable:!0},_ws:{value:null,writable:!0}});var $={connecting:"info",early:"info",open:"info",waiting:"warning",closed:"info"};return L.on("stateChanged",function(Z){for(var se=[],le=1;le<arguments.length;le++)se[le-1]=arguments[le];Z in p&&L.emit.apply(L,_([p[Z]],y(se)));var de={name:Z,group:"signaling",level:$[L.state]};if("closed"===Z){var ce=y(se,1)[0];de.payload={reason:ce},de.level=ce===M.LOCAL?"info":"error"}L._eventObserver.emit("event",de)}),L._eventObserver.emit("event",{name:L.state,group:"signaling",level:$[L.state]}),L._connect(),L}return S(F,K),F.prototype.toString=function(){return"[TwilioConnection #"+this._instanceId+": "+this._ws.url+"]"},F.prototype._close=function(V){var D=V.code,L=V.reason;if("closed"!==this.state){this._openTimeout&&this._openTimeout.clear(),this._welcomeTimeout&&this._welcomeTimeout.clear(),this._heartbeatTimeout&&this._heartbeatTimeout.clear(),this._sendHeartbeatTimeout&&this._sendHeartbeatTimeout.clear(),this._networkMonitor&&this._networkMonitor.stop(),this._busyWaitTimeout&&D!==E&&this._busyWaitTimeout.clear(),this._messageQueue.splice(0);var H=this._log;1e3===D?(H.debug("Closed"),this.transition("closed",null,[M.LOCAL])):(H.warn("Closed: "+D+" - "+L),D!==E&&this.transition("closed",null,[Q.get(D)||M.REMOTE]));var J=this._ws.readyState,X=this._options.WebSocket;J!==X.CLOSING&&J!==X.CLOSED&&this._ws.close(D,L)}},F.prototype._connect=function(){var V=this,D=this._log;if("waiting"===this.state)this.transition("early");else if("early"!==this.state)return void D.warn('Unexpected state "'+this.state+'" for connecting to the TCMP server.');this._ws=new this._options.WebSocket(this._serverUrl);var L=this._ws;D.debug("Created a new WebSocket:",L),L.addEventListener("close",function(J){return V._close(J)});var H=this._options.openTimeout;this._openTimeout=new a(function(){V._close({code:3007,reason:"Failed to open in "+H+" ms"})},H),L.addEventListener("open",function(){D.debug("WebSocket opened:",L),V._openTimeout.clear(),V._startHandshake(),V._networkMonitor&&V._networkMonitor.start()}),L.addEventListener("message",function(J){D.debug("Incoming: "+J.data);try{J=JSON.parse(J.data)}catch(X){return void V.emit("error",X)}switch(J.type){case"bad":V._handleBad(J);break;case"busy":V._handleBusy(J);break;case"bye":break;case"msg":V._handleMessage(J);case"heartbeat":V._handleHeartbeat();break;case"welcome":V._handleWelcome(J);break;default:V._log.debug("Unknown message type: "+J.type),V.emit("error",new Error("Unknown message type: "+J.type))}})},F.prototype._handleBad=function(V){var D=V.reason,L=this._log;if(["connecting","open"].includes(this.state))return"connecting"===this.state?(L.warn("Closing: 3002 - "+D),void this._close({code:3002,reason:D})):(L.debug("Error: "+D),void this.emit("error",new Error(D)));L.warn('Unexpected state "'+this.state+'" for handling a "bad" message from the TCMP server.')},F.prototype._handleBusy=function(V){var D=this,L=V.cookie,H=V.keepAlive,J=V.retryAfter,X=this._log;if(["connecting","waiting"].includes(this.state)){this._busyWaitTimeout&&this._busyWaitTimeout.clear(),this._welcomeTimeout&&this._welcomeTimeout.clear();var $=J<0?'Received terminal "busy" message':'Received "busy" message, retrying after '+J+" ms";if(J<0)return X.warn("Closing: 3006 - "+$),void this._close({code:3006,reason:$});this._hellosLeft=this._options.maxConsecutiveFailedHellos,this._cookie=L||null,H?(X.warn($),this._busyWaitTimeout=new a(function(){return D._startHandshake()},J)):(X.warn("Closing: 3005 - "+$),this._close({code:E,reason:$}),this._busyWaitTimeout=new a(function(){return D._connect()},J)),this.transition("waiting",null,[H,J])}else X.warn('Unexpected state "'+this.state+'" for handling a "busy" message from the TCMP server.')},F.prototype._handleHeartbeat=function(){"open"===this.state?this._heartbeatTimeout.reset():this._log.warn('Unexpected state "'+this.state+'" for handling a "heartbeat" message from the TCMP server.')},F.prototype._handleHeartbeatTimeout=function(){if("open"===this.state){var V=this._log,D=this._options.maxConsecutiveMissedHeartbeats;V.debug("Consecutive heartbeats missed: "+D);var L="Missed "+D+' "heartbeat" messages';V.warn("Closing: 3001 - "+L),this._close({code:3001,reason:L})}},F.prototype._handleMessage=function(V){"open"===this.state?this.emit("message",V.body):this._log.warn('Unexpected state "'+this.state+'" for handling a "msg" message from the TCMP server.')},F.prototype._handleWelcome=function(V){var D=this,L=V.negotiatedTimeout,H=this._log;if(["connecting","waiting"].includes(this.state)){"waiting"===this.state&&(H.debug('Received "welcome" message, no need to retry connection.'),this._busyWaitTimeout.clear());var X=L*this._options.maxConsecutiveMissedHeartbeats,$=L-200;this._welcomeTimeout.clear(),this._heartbeatTimeout=new a(function(){return D._handleHeartbeatTimeout()},X),this._messageQueue.splice(0).forEach(function(Z){return D._send(Z)}),this._sendHeartbeatTimeout=new a(function(){return D._sendHeartbeat()},$),this.transition("open")}else H.warn('Unexpected state "'+this.state+'" for handling a "welcome" message from the TCMP server.')},F.prototype._handleWelcomeTimeout=function(){if("connecting"===this.state){var V=this._log;if(this._hellosLeft<=0){var D="All handshake attempts failed";return V.warn("Closing: 3000 - "+D),void this._close({code:3e3,reason:D})}V.warn("Handshake attempt "+(this._options.maxConsecutiveFailedHellos-this._hellosLeft)+" failed"),this._startHandshake()}},F.prototype._send=function(V){if(this._ws.readyState===this._options.WebSocket.OPEN){var H=JSON.stringify(V);this._log.debug("Outgoing: "+H);try{this._ws.send(H),this._sendHeartbeatTimeout&&this._sendHeartbeatTimeout.reset()}catch{var J="Failed to send message";this._log.warn("Closing: 3003 - "+J),this._close({code:3003,reason:J})}}},F.prototype._sendHeartbeat=function(){"closed"!==this.state&&this._send({type:"heartbeat"})},F.prototype._sendHello=function(){var V=this._options,D=V.helloBody,L=V.requestedHeartbeatTimeout,H={id:t(),timeout:L,type:"hello",version:2};this._cookie&&(H.cookie=this._cookie),D&&(H.body=D),this._send(H)},F.prototype._sendOrEnqueue=function(V){var D=this;"closed"!==this.state&&("open"===this.state?function(H){return D._send(H)}:function(H){return D._messageQueue.push(H)})(V)},F.prototype._startHandshake=function(){var V=this;["early","waiting"].includes(this.state)&&this.transition("connecting"),"connecting"===this.state&&(this._hellosLeft--,this._sendHello(),this._welcomeTimeout=new a(function(){return V._handleWelcomeTimeout()},this._options.welcomeTimeout))},F.prototype.close=function(){"closed"!==this.state&&(this._sendOrEnqueue({type:"bye"}),this._close({code:1e3,reason:"Normal"}))},F.prototype.sendMessage=function(V){this._sendOrEnqueue({body:V,type:"msg"})},F}(o);G.CloseReason=M,C.exports=G},{"./statemachine":88,"./util":132,"./util/log":136,"./util/networkmonitor":138,"./util/timeout":146,ws:175}],121:[function(v,C,x){"use strict";var S=v("./").defer,y=function(){function _(){Object.defineProperties(this,{_deferreds:{value:[]},_hasValue:{value:!1,writable:!0},_value:{value:null,writable:!0}})}return _.prototype.put=function(o){this._hasValue=!0,this._value=o;var i=this._deferreds.shift();return i&&i.resolve(o),this},_.prototype.take=function(){var o=this;if(this._hasValue&&!this._deferreds.length)return this._hasValue=!1,Promise.resolve(this._value);var i=S();return this._deferreds.push(i),i.promise.then(function(e){return o._hasValue=!1,e})},_}();C.exports=y},{"./":132}],122:[function(v,C,x){var S=function(){function y(_){Object.defineProperties(this,{_min:{value:_.min||100},_max:{value:_.max||1e4},_jitter:{value:_.jitter>0&&_.jitter<=1?_.jitter:0},_factor:{value:_.factor||2},_attempts:{value:0,writable:!0},_duration:{enumerable:!1,get:function(){var o=this._min*Math.pow(this._factor,this._attempts);if(this._jitter){var i=Math.random(),e=Math.floor(i*this._jitter*o);o=1&Math.floor(10*i)?o+e:o-e}return 0|Math.min(o,this._max)}},_timeoutID:{value:null,writable:!0}})}return y.prototype.backoff=function(_){var o=this,i=this._duration;this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null),this._timeoutID=setTimeout(function(){o._attempts++,_()},i)},y.prototype.reset=function(){this._attempts=0,this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null)},y}();C.exports=S},{}],123:[function(v,C,x){"use strict";var S=this&&this.__read||function(c,p){var l="function"==typeof Symbol&&c[Symbol.iterator];if(!l)return c;var h,b,d=l.call(c),k=[];try{for(;(void 0===p||p-- >0)&&!(h=d.next()).done;)k.push(h.value)}catch(R){b={error:R}}finally{try{h&&!h.done&&(l=d.return)&&l.call(d)}finally{if(b)throw b.error}}return k};function _(){return!!(navigator&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2)}function o(){return _()&&window.screen.width>=744&&(/Macintosh/i.test(navigator.userAgent)||/iPad/.test(navigator.userAgent)||/iPad/.test(navigator.platform))}function i(){return _()&&window.screen.width<=476&&(/Macintosh/i.test(navigator.userAgent)||/iPhone/.test(navigator.userAgent)||/iPhone/.test(navigator.platform))}C.exports={isAndroid:function y(){return/Android/.test(navigator.userAgent)},isIOS:function e(){return o()||i()},isIpad:o,isIphone:i,isMobile:function t(){return/Mobi/.test(navigator.userAgent)},isNonChromiumEdge:function r(c){return"chrome"===c&&/Edge/.test(navigator.userAgent)&&(typeof chrome>"u"||typeof chrome.runtime>"u")},mobileWebKitBrowser:function a(c){return"safari"!==c?null:"brave"in navigator?"brave":["edge","edg"].find(function(p){return navigator.userAgent.toLowerCase().includes(p)})||null},rebrandedChromeBrowser:function n(c){if("chrome"!==c)return null;if("brave"in navigator)return"brave";var d=function s(c){for(var p=[],l=[],d=0;d<c.length;d++)if("("===c[d])p.push(d);else if(")"===c[d]&&p.length>0){var h=p.pop();0===p.length&&l.push(c.substring(h,d+1))}return l}(navigator.userAgent).reduce(function(b,R){return b.replace(R,"")},navigator.userAgent).match(/[^\s]+/g)||[];return S(d.map(function(b){return b.split("/")[0].toLowerCase()})).slice(2).find(function(b){return!["chrome","mobile","safari"].includes(b)})||null}}},{}],124:[function(v,C,x){"use strict";var S=this&&this.__read||function(o,i){var e="function"==typeof Symbol&&o[Symbol.iterator];if(!e)return o;var r,a,t=e.call(o),n=[];try{for(;(void 0===i||i-- >0)&&!(r=t.next()).done;)n.push(r.value)}catch(s){a={error:s}}finally{try{r&&!r.done&&(e=t.return)&&e.call(t)}finally{if(a)throw a.error}}return n},y=this&&this.__spreadArray||function(o,i){for(var e=0,t=i.length,r=o.length;e<t;e++,r++)o[r]=i[e];return o},_=function(){function o(i,e){var t=this;Object.defineProperties(this,{_isCancelable:{writable:!0,value:!0},_isCanceled:{writable:!0,value:!1},_onCancel:{value:e}}),Object.defineProperty(this,"_promise",{value:new Promise(function(r,n){i(function(a){t._isCancelable=!1,r(a)},function(a){t._isCancelable=!1,n(a)},function(){return t._isCanceled})})})}return o.reject=function(i){return new o(function(t,r){r(i)},function(){})},o.resolve=function(i){return new o(function(t){t(i)},function(){})},o.prototype.cancel=function(){return this._isCancelable&&(this._isCanceled=!0,this._onCancel()),this},o.prototype.catch=function(){var i=[].slice.call(arguments),e=this._promise;return new o(function(r,n){e.catch.apply(e,y([],S(i))).then(r,n)},this._onCancel)},o.prototype.then=function(){var i=[].slice.call(arguments),e=this._promise;return new o(function(r,n){e.then.apply(e,y([],S(i))).then(r,n)},this._onCancel)},o.prototype.finally=function(){var i=[].slice.call(arguments),e=this._promise;return new o(function(r,n){e.finally.apply(e,y([],S(i))).then(r,n)},this._onCancel)},o}();C.exports=_},{}],125:[function(v,C,x){"use strict";var S=v("../../package.json");C.exports.SDK_NAME=S.name+".js",C.exports.SDK_VERSION=S.version,C.exports.SDP_FORMAT="unified",C.exports.hardwareDevicePublisheriPad={hwDeviceManufacturer:"Apple",hwDeviceModel:"iPad",hwDeviceType:"tablet",platformName:"iOS"},C.exports.hardwareDevicePublisheriPhone={hwDeviceManufacturer:"Apple",hwDeviceModel:"iPhone",hwDeviceType:"mobile",platformName:"iOS"},C.exports.DEFAULT_ENVIRONMENT="prod",C.exports.DEFAULT_REALM="us1",C.exports.DEFAULT_REGION="gll",C.exports.DEFAULT_LOG_LEVEL="warn",C.exports.DEFAULT_LOGGER_NAME="twilio-video",C.exports.WS_SERVER=function(_,o){return o="gll"===o?"global":encodeURIComponent(o),"prod"===_?"wss://"+o+".vss.twilio.com/signaling":"wss://"+o+".vss."+_+".twilio.com/signaling"},C.exports.PUBLISH_MAX_ATTEMPTS=5,C.exports.PUBLISH_BACKOFF_JITTER=10,C.exports.PUBLISH_BACKOFF_MS=20,C.exports.typeErrors={ILLEGAL_INVOKE:function(_,o){return new TypeError("Illegal call to "+_+": "+o)},INVALID_TYPE:function(_,o){return new TypeError(_+" must be "+function y(_){return["a","e","i","o","u"].includes(_.toLowerCase()[0])?"an":"a"}(o)+" "+o)},INVALID_VALUE:function(_,o){return new RangeError(_+" must be one of "+o.join(", "))},REQUIRED_ARGUMENT:function(_){return new TypeError(_+" must be specified")}},C.exports.DEFAULT_FRAME_RATE=24,C.exports.DEFAULT_VIDEO_PROCESSOR_STATS_INTERVAL_MS=1e4,C.exports.DEFAULT_ICE_GATHERING_TIMEOUT_MS=15e3,C.exports.DEFAULT_SESSION_TIMEOUT_SEC=30,C.exports.DEFAULT_NQ_LEVEL_LOCAL=1,C.exports.DEFAULT_NQ_LEVEL_REMOTE=0,C.exports.MAX_NQ_LEVEL=3,C.exports.ICE_ACTIVITY_CHECK_PERIOD_MS=1e3,C.exports.ICE_INACTIVITY_THRESHOLD_MS=3e3,C.exports.iceRestartBackoffConfig={factor:1.1,min:1,max:1e3*C.exports.DEFAULT_SESSION_TIMEOUT_SEC,jitter:1},C.exports.reconnectBackoffConfig={factor:1.5,min:80,jitter:1},C.exports.subscriptionMode={MODE_COLLABORATION:"collaboration",MODE_GRID:"grid",MODE_PRESENTATION:"presentation"},C.exports.trackSwitchOffMode={MODE_DISABLED:"disabled",MODE_DETECTED:"detected",MODE_PREDICTED:"predicted"},C.exports.trackPriority={PRIORITY_HIGH:"high",PRIORITY_LOW:"low",PRIORITY_STANDARD:"standard"},C.exports.clientTrackSwitchOffControl={MODE_AUTO:"auto",MODE_MANUAL:"manual"},C.exports.videoContentPreferencesMode={MODE_AUTO:"auto",MODE_MANUAL:"manual"}},{"../../package.json":174}],126:[function(v,C,x){"use strict";var S=v("../webaudio/detectsilence");C.exports=function o(i){var e=v("../webaudio/audiocontext"),t={},r=e.getOrCreate(t),n=3;return function a(){return n--,S(r,i.srcObject,250).then(function(s){return!!s&&(!(n>0)||a())}).catch(function(){return!0})}().finally(function(){e.release(t)})}},{"../webaudio/audiocontext":153,"../webaudio/detectsilence":154}],127:[function(v,C,x){"use strict";var S=null;C.exports=function t(r){return S=S||document.createElement("canvas"),new Promise(function(n){var a=3;setTimeout(function s(){return a--,function e(r){try{var n=S.getContext("2d");n.drawImage(r,0,0,50,50);var s=n.getImageData(0,0,50,50).data.filter(function(p,l){return(l+1)%4});return 0===Math.max.apply(Math,s)}catch(p){return console.log("Error checking silence: ",p),!1}}(r)?a>0?setTimeout(s,250):n(!0):n(!1)},250)})}},{}],128:[function(v,C,x){"use strict";var S=function(){function y(_){var o=this;void 0===_&&(_=1),Object.defineProperties(this,{_listeners:{value:[]},_onVisibilityChange:{value:function(){o._emitVisible("visible"===document.visibilityState)}}});for(var i=0;i<_;i++)this._listeners.push([])}return y.prototype.clear=function(){for(var _=this._listeners.length,o=0;o<_;o++)this._listeners[o]=[]},y.prototype._listenerCount=function(){return this._listeners.reduce(function(_,o){return _+o.length},0)},y.prototype._emitVisible=function(_){for(var o=this,i=Promise.resolve(),e=function(r){i=i.then(function(){return o._emitVisiblePhase(r,_)})},t=1;t<=this._listeners.length;t++)e(t);return i},y.prototype._emitVisiblePhase=function(_,o){return Promise.all(this._listeners[_-1].map(function(e){var t=e(o);return t instanceof Promise?t:Promise.resolve(t)}))},y.prototype._start=function(){document.addEventListener("visibilitychange",this._onVisibilityChange)},y.prototype._stop=function(){document.removeEventListener("visibilitychange",this._onVisibilityChange)},y.prototype.onVisibilityChange=function(_,o){if("number"!=typeof _||_<=0||_>this._listeners.length)throw new Error("invalid phase: ",_);return this._listeners[_-1].push(o),1===this._listenerCount()&&this._start(),this},y.prototype.offVisibilityChange=function(_,o){if("number"!=typeof _||_<=0||_>this._listeners.length)throw new Error("invalid phase: ",_);var i=this._listeners[_-1],e=i.indexOf(o);return-1!==e&&(i.splice(e,1),0===this._listenerCount()&&this._stop()),this},y}();C.exports=new S(2)},{}],129:[function(v,C,x){"use strict";var S,y,_;C.exports=(S=globalThis,[y=S.location,_=S.URL].some(function(o){return!o})?function(i){return Promise.reject(new Error("Failed to import: "+i+": dynamicImport is not supported"))}:(S.__twilioVideoImportedModules={},function(i){return i in S.__twilioVideoImportedModules?Promise.resolve(S.__twilioVideoImportedModules[i]):new Function("scope","return import('"+new _(i,y)+"').then(m => scope.__twilioVideoImportedModules['"+i+"'] = m);")(S)}))},{}],130:[function(v,C,x){"use strict";var e,S=this&&this.__extends||(e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(n[s]=a[s])})(t,r)},function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),y=v("events").EventEmitter,_=["signaling","room","media","quality","video-processor","preflight"],o=["debug","error","info","warning"],i=function(e){function t(r,n,a,s){void 0===s&&(s=null);var c=e.call(this)||this;return c.on("event",function(p){var l=p.name,d=p.group,h=p.level,k=p.payload;if("string"!=typeof l)throw a.error("Unexpected name: ",l),new Error("Unexpected name: ",l);if(!_.includes(d))throw a.error("Unexpected group: ",d),new Error("Unexpected group: ",d);if(!o.includes(h))throw a.error("Unexpected level: ",h),new Error("Unexpected level: ",h);var b=Date.now(),R=b-n,T=Object.assign({elapsedTime:R,level:h},k||{});r.publish(d,l,T);var w=Object.assign({elapsedTime:R,group:d,level:h,name:l,timestamp:b},k?{payload:k}:{});a[{debug:"debug",error:"error",info:"info",warning:"warn"}[h]]("event",w),s&&"signaling"===d&&s.emit("event",w)}),c}return S(t,e),t}(y);C.exports=i},{events:173}],131:[function(v,C,x){"use strict";var S=function(){function y(_){_=Object.assign({getKey:function(i){return i},getValue:function(i){return i},isLessThanOrEqualTo:function(i,e){return i<=e}},_),Object.defineProperties(this,{_getKey:{value:_.getKey},_getValue:{value:_.getValue},_isLessThanOrEqualTo:{value:_.isLessThanOrEqualTo},_map:{value:new Map}})}return y.prototype.toMap=function(){return new Map(this._map)},y.prototype.updateAndFilter=function(_){return _.filter(this.update,this)},y.prototype.update=function(_){var o=this._getKey(_),i=this._getValue(_);return!(this._map.has(o)&&this._isLessThanOrEqualTo(i,this._map.get(o))||(this._map.set(o,i),0))},y}();C.exports=S},{}],132:[function(v,C,x){"use strict";var Y,S=this&&this.__extends||(Y=function(q,B){return(Y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,U){I.__proto__=U}||function(I,U){for(var ue in U)Object.prototype.hasOwnProperty.call(U,ue)&&(I[ue]=U[ue])})(q,B)},function(q,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function I(){this.constructor=q}Y(q,B),q.prototype=null===B?Object.create(B):(I.prototype=B.prototype,new I)}),y=this&&this.__read||function(Y,q){var B="function"==typeof Symbol&&Y[Symbol.iterator];if(!B)return Y;var U,ae,I=B.call(Y),ue=[];try{for(;(void 0===q||q-- >0)&&!(U=I.next()).done;)ue.push(U.value)}catch(re){ae={error:re}}finally{try{U&&!U.done&&(B=I.return)&&B.call(I)}finally{if(ae)throw ae.error}}return ue},_=this&&this.__spreadArray||function(Y,q){for(var B=0,I=q.length,U=Y.length;B<I;B++,U++)Y[U]=q[B];return Y},o=v("./constants"),i=o.typeErrors,e=o.trackPriority,t=v("../webrtc/util"),r=v("./sid").sessionSID,n=v("./twiliowarning");function k(){return typeof navigator<"u"&&navigator.userAgent?navigator.userAgent:"Unknown"}function f(Y,q,B,I){if(!(I in q)&&!I.match(/^on[a-z]+$/)){var U;try{U=typeof Y[I]}catch{}"function"===U&&(q[I]=function(){for(var ue,ae=[],re=0;re<arguments.length;re++)ae[re]=arguments[re];return(ue=this[B])[I].apply(ue,_([],y(ae)))})}}function E(Y){return"object"==typeof Y&&!Array.isArray(Y)}function G(Y){Object.getOwnPropertyNames(Y).forEach(function(q){q.startsWith("_")&&F(Y,q)})}function F(Y,q){var B=Object.getOwnPropertyDescriptor(Y,q);B.enumerable=!1,Object.defineProperty(Y,q,B)}function D(Y){return Y.map(X)}function X(Y){return Array.isArray(Y)?D(Y):Y instanceof Set?function L(Y){return D(_([],y(Y)))}(Y):Y instanceof Map?function H(Y){return _([],y(Y.entries())).reduce(function(q,B){var I,U=y(B,2);return Object.assign(((I={})[U[0]]=X(U[1]),I),q)},{})}(Y):Y&&"object"==typeof Y?function J(Y){return Object.entries(Y).reduce(function(q,B){var I,U=y(B,2);return Object.assign(((I={})[U[0]]=X(U[1]),I),q)},{})}(Y):Y}function se(Y){return ce(Y,[{prop:"dominantSpeakerPriority",type:"string",payloadProp:"active_speaker_priority"},{prop:"maxSubscriptionBitrate",type:"number",payloadProp:"max_subscription_bandwidth"},{prop:"maxTracks",type:"number",payloadProp:"max_tracks"},{prop:"mode",type:"string"},{prop:"renderDimensions",type:"object",payloadProp:"render_dimensions",transform:ve},{prop:"trackSwitchOffMode",type:"string",payloadProp:"track_switch_off"}])}function de(Y){return ce(Y,[{prop:"height",type:"number"},{prop:"width",type:"number"}])}function ve(Y){return ce(Y,[{prop:e.PRIORITY_HIGH,type:"object",transform:de},{prop:e.PRIORITY_LOW,type:"object",transform:de},{prop:e.PRIORITY_STANDARD,type:"object",transform:de}])}function ce(Y,q){return q.reduce(function(B,I){var U,ue=I.prop,re=I.payloadProp,Pe=I.transform;return typeof Y[ue]===I.type?Object.assign(((U={})[void 0===re?ue:re]=(void 0===Pe?function(Oe){return Oe}:Pe)(Y[ue]),U),B):B},{})}x.constants=o,x.createBandwidthProfilePayload=function Z(Y){return ce(Y,[{prop:"video",type:"object",transform:se}])},x.createMediaSignalingPayload=function le(Y,q,B,I,U,ue){var ae={transports:[{type:"data-channel"}]};return Object.assign(Y?{active_speaker:ae}:{},q?{network_quality:ae}:{},ue?{render_hints:ae}:{},U?{publisher_hints:ae}:{},B?{track_priority:ae}:{},I?{track_switch_off:ae}:{})},x.createMediaWarningsPayload=function pe(Y){var q,B=((q={})[n.recordingMediaLost]="recordings",q);return Y.map(function(I){return B[I]}).filter(function(I){return!!I})},x.createRoomConnectEventPayload=function $(Y){function q(U){return U?"true":"false"}var B={sessionSID:r,iceServers:(Y.iceServers||[]).length,audioTracks:(Y.tracks||[]).filter(function(U){return"audio"===U.kind}).length,videoTracks:(Y.tracks||[]).filter(function(U){return"video"===U.kind}).length,dataTracks:(Y.tracks||[]).filter(function(U){return"data"===U.kind}).length};if([["audio"],["automaticSubscription"],["enableDscp"],["eventListener"],["preflight"],["video"],["dominantSpeaker","enableDominantSpeaker"]].forEach(function(U){var ue=y(U,2),ae=ue[0],re=ue[1];B[re=re||ae]=q(!!Y[ae])}),[["maxVideoBitrate"],["maxAudioBitrate"]].forEach(function(U){var ue=y(U,2),ae=ue[0],re=ue[1];re=re||ae,"number"==typeof Y[ae]?B[re]=Y[ae]:isNaN(Number(Y[ae]))||(B[re]=Number(Y[ae]))}),[["iceTransportPolicy"],["region"],["name","roomName"]].forEach(function(U){var ue=y(U,2),ae=ue[0],re=ue[1];re=re||ae,"string"==typeof Y[ae]?B[re]=Y[ae]:"number"==typeof Y[ae]&&"name"===ae&&(B[re]=Y[ae].toString())}),["preferredAudioCodecs","preferredVideoCodecs"].forEach(function(U){U in Y&&(B[U]=JSON.stringify(Y[U]))}),"networkQuality"in Y&&(B.networkQualityConfiguration={},E(Y.networkQuality)?["local","remote"].forEach(function(U){"number"==typeof Y.networkQuality[U]&&(B.networkQualityConfiguration[U]=Y.networkQuality[U])}):(B.networkQualityConfiguration.remote=0,B.networkQualityConfiguration.local=Y.networkQuality?1:0)),Y.bandwidthProfile&&Y.bandwidthProfile.video){var I=Y.bandwidthProfile.video||{};B.bandwidthProfileOptions={},["mode","maxTracks","trackSwitchOffMode","dominantSpeakerPriority","maxSubscriptionBitrate","renderDimensions","contentPreferencesMode","clientTrackSwitchOffControl"].forEach(function(U){"number"==typeof I[U]||"string"==typeof I[U]?B.bandwidthProfileOptions[U]=I[U]:"boolean"==typeof I[U]?B.bandwidthProfileOptions[U]=q(I[U]):"object"==typeof I[U]&&(B.bandwidthProfileOptions[U]=JSON.stringify(I[U]))})}return{group:"room",name:"connect",level:"info",payload:B}},x.createSubscribePayload=function fe(Y){return{rules:[{type:Y?"include":"exclude",all:!0}],revision:1}},x.asLocalTrack=function a(Y,q){if(Y instanceof q.LocalAudioTrack||Y instanceof q.LocalVideoTrack||Y instanceof q.LocalDataTrack)return Y;if(Y instanceof q.MediaStreamTrack)return"audio"===Y.kind?new q.LocalAudioTrack(Y,q):new q.LocalVideoTrack(Y,q);throw i.INVALID_TYPE("track","LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack")},x.asLocalTrackPublication=function s(Y,q,B,I){return new(0,{audio:I.LocalAudioTrackPublication,video:I.LocalVideoTrackPublication,data:I.LocalDataTrackPublication}[Y.kind])(q,Y,B,I)},x.capitalize=function c(Y){return Y[0].toUpperCase()+Y.slice(1)},x.deprecateEvents=function p(Y,q,B,I){var U=new Set;q.on("newListener",function ue(ae){B.has(ae)&&!U.has(ae)&&(I.deprecated(Y+"#"+ae+" has been deprecated and scheduled for removal in twilio-video.js@2.0.0."+(B.get(ae)?" Use "+Y+"#"+B.get(ae)+" instead.":"")),U.add(ae)),U.size>=B.size&&q.removeListener("newListener",ue)})},x.difference=function l(Y,q){Y=Array.isArray(Y)?new Set(Y):new Set(Y.values()),q=Array.isArray(q)?new Set(q):new Set(q.values());var B=new Set;return Y.forEach(function(I){q.has(I)||B.add(I)}),B},x.filterObject=function d(Y,q){return Object.keys(Y).reduce(function(B,I){return Y[I]!==q&&(B[I]=Y[I]),B},{})},x.flatMap=function h(Y,q){var B=Y instanceof Map||Y instanceof Set?Array.from(Y.values()):Y;return q=q||function(U){return U},B.reduce(function(I,U){var ue=q(U);return I.concat(ue)},[])},x.getPlatform=function b(){var Y=k(),B=y(Y.match(/\(([^)]+)\)/)||[],2)[1];return y((void 0===B?"unknown":B).split(";").map(function(ae){return ae.trim()}),1)[0].toLowerCase()},x.getUserAgent=k,x.hidePrivateProperties=G,x.hidePrivateAndCertainPublicPropertiesInClass=function K(Y,q){return function(B){function I(){for(var U=[],ue=0;ue<arguments.length;ue++)U[ue]=arguments[ue];var ae=B.apply(this,_([],y(U)))||this;return G(ae),function V(Y,q){void 0===q&&(q=[]),q.forEach(function(B){Y.hasOwnProperty(B)&&F(Y,B)})}(ae,q),ae}return S(I,B),I}(Y)},x.isDeepEqual=function P(Y,q){if(Y===q)return!0;if(typeof Y!=typeof q)return!1;if(null===Y)return null===q;if(null===q)return!1;if(Array.isArray(Y))return Array.isArray(q)&&Y.length===q.length&&Y.every(function(U,ue){return P(U,q[ue])});if("object"==typeof Y){var B=Object.keys(Y).sort(),I=Object.keys(q).sort();return!Array.isArray(q)&&P(B,I)&&B.every(function(U){return P(Y[U],q[U])})}return!1},x.isNonArrayObject=E,x.inRange=function ge(Y,q,B){return q<=Y&&Y<=B},x.makeUUID=function R(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(Y){var q=16*Math.random()|0;return("x"===Y?q:3&q|8).toString(16)})},x.oncePerTick=function T(Y){var q=null;function B(){q=null,Y()}return function(){q&&clearTimeout(q),q=setTimeout(B)}},x.promiseFromEvents=function w(Y,q,B,I){return new Promise(function(U,ue){function ae(){var Se=[].slice.call(arguments);I&&q.removeListener(I,re),U.apply(void 0,_([],y(Se)))}function re(){var Se=[].slice.call(arguments);q.removeListener(B,ae),ue.apply(void 0,_([],y(Se)))}q.once(B,ae),I&&q.once(I,re),Y()})},x.getOrNull=function m(Y,q){return q.split(".").reduce(function(B,I){return B?B[I]:null},Y)},x.defer=function u(){var Y={};return Y.promise=new Promise(function(q,B){Y.resolve=q,Y.reject=B}),Y},x.delegateMethods=function g(Y,q,B){for(var I in Y)f(Y,q,B,I)},x.proxyProperties=function O(Y,q,B){Object.getOwnPropertyNames(Y).forEach(function(I){!function A(Y,q,B,I){if(!(I in q)){if(I.match(/^on[a-z]+$/))return Object.defineProperty(q,I,{value:null,writable:!0}),void B.addEventListener(I.slice(2),function(){for(var U=[],ue=0;ue<arguments.length;ue++)U[ue]=arguments[ue];q.dispatchEvent.apply(q,_([],y(U)))});Object.defineProperty(q,I,{enumerable:!0,get:function(){return B[I]}})}}(0,q,B,I)})},x.legacyPromise=function N(Y,q,B){return q?Y.then(function(I){q(I)},function(I){B(I)}):Y},x.buildLogLevels=function j(Y){return"string"==typeof Y?{default:Y,media:Y,signaling:Y,webrtc:Y}:Y},x.trackClass=function M(Y,q){return(q=q?"Local":"")+(Y.kind||"").replace(/\w{1}/,function(B){return B.toUpperCase()})+"Track"},x.trackPublicationClass=function Q(Y,q){return(q=q?"Local":"")+(Y.kind||"").replace(/\w{1}/,function(B){return B.toUpperCase()})+"TrackPublication"},x.valueToJSON=X,x.withJitter=function ye(Y,q){var B=Math.random();return Y-q+Math.floor(2*q*B+.5)},x.isChromeScreenShareTrack=function ke(Y){return"chrome"===t.guessBrowser()&&"video"===Y.kind&&"displaySurface"in Y.getSettings()},x.waitForSometime=function Le(Y){return void 0===Y&&(Y=10),new Promise(function(q){return setTimeout(q,Y)})},x.waitForEvent=function we(Y,q){return new Promise(function(B){Y.addEventListener(q,function I(U){Y.removeEventListener(q,I),B(U)})})}},{"../webrtc/util":170,"./constants":125,"./sid":144,"./twiliowarning":149}],133:[function(v,C,x){"use strict";var T,S=this&&this.__extends||(T=function(w,m){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,f){u.__proto__=f}||function(u,f){for(var g in f)Object.prototype.hasOwnProperty.call(f,g)&&(u[g]=f[g])})(w,m)},function(w,m){if("function"!=typeof m&&null!==m)throw new TypeError("Class extends value "+String(m)+" is not a constructor or null");function u(){this.constructor=w}T(w,m),w.prototype=null===m?Object.create(m):(u.prototype=m.prototype,new u)}),y=this&&this.__assign||function(){return y=Object.assign||function(T){for(var w,m=1,u=arguments.length;m<u;m++)for(var f in w=arguments[m])Object.prototype.hasOwnProperty.call(w,f)&&(T[f]=w[f]);return T},y.apply(this,arguments)},_=v("events").EventEmitter,o=v("..").getUserAgent,r=globalThis,n=r.WebSocket?r.WebSocket:v("ws"),a=v("../constants"),s=a.hardwareDevicePublisheriPad,c=a.hardwareDevicePublisheriPhone,p=v("../../util"),l=v("../browserdetection"),d=function(T){function w(m,u,f,g,P,E){var O=T.call(this)||this;return E=Object.assign({gateway:k(g,P)+"/v1/VideoEvents",maxReconnectAttempts:5,reconnectIntervalMs:50,userAgent:o(),WebSocket:n},E),Object.defineProperties(O,{_connectTimestamp:{value:0,writable:!0},_eventQueue:{value:[]},_readyToConnect:{value:p.defer()},_reconnectAttemptsLeft:{value:E.maxReconnectAttempts,writable:!0},_ws:{value:null,writable:!0},_WebSocket:{value:E.WebSocket}}),O._readyToConnect.promise.then(function(A){var N=A.roomSid,j=A.participantSid,M=O;O.on("disconnected",function Q(G){if(M._session=null,G&&M._reconnectAttemptsLeft>0)return M.emit("reconnecting"),void function R(T,w,m,u,f,g,P){var E=Date.now()-T._connectTimestamp,O=P.reconnectIntervalMs-E;O>0?setTimeout(function(){h(T,w,m,u,f,g,P)},O):h(T,w,m,u,f,g,P)}(M,m,u,f,N,j,E);M.removeListener("disconnected",Q)}),h(O,m,u,f,N,j,E)}).catch(function(){}),O}return S(w,T),w.prototype.connect=function(m,u){this._readyToConnect.resolve({roomSid:m,participantSid:u})},w.prototype._publish=function(m){m.session=this._session,this._ws.send(JSON.stringify(m))},w.prototype.disconnect=function(){if(null===this._ws||this._ws.readyState===this._WebSocket.CLOSING||this._ws.readyState===this._WebSocket.CLOSED)return!1;try{this._ws.close()}catch{}return this.emit("disconnected"),!0},w.prototype.publish=function(m,u,f){return(null===this._ws||this._ws.readyState!==this._WebSocket.CLOSING&&this._ws.readyState!==this._WebSocket.CLOSED)&&(("string"==typeof this._session?this._publish.bind(this):this._eventQueue.push.bind(this._eventQueue))({group:m,name:u,payload:f,timestamp:Date.now(),type:"event",version:1}),!0)},w}(_);function h(T,w,m,u,f,g,P){T._connectTimestamp=Date.now(),T._reconnectAttemptsLeft--,T._ws=new P.WebSocket(P.gateway);var E=T._ws;E.addEventListener("close",function(O){1e3!==O.code?T.emit("disconnected",new Error("WebSocket Error "+O.code+": "+O.reason)):T.emit("disconnected")}),E.addEventListener("message",function(O){!function b(T,w,m){switch(w.type){case"connected":T._session=w.session,T._reconnectAttemptsLeft=m.maxReconnectAttempts,T._eventQueue.splice(0).forEach(T._publish,T),T.emit("connected");break;case"error":T._ws.close(),T.emit("disconnected",new Error(w.message))}}(T,JSON.parse(O.data),P)}),E.addEventListener("open",function(){var O={type:"connect",token:w,version:1};O.publisher={name:m,sdkVersion:u,userAgent:P.userAgent,participantSid:g,roomSid:f},l.isIpad()?O.publisher=y(y({},O.publisher),s):l.isIphone()&&(O.publisher=y(y({},O.publisher),c)),E.send(JSON.stringify(O))})}function k(T,w){return"prod"===T?"wss://sdkgw."+w+".twilio.com":"wss://sdkgw."+T+"-"+w+".twilio.com"}C.exports=d},{"..":132,"../../util":132,"../browserdetection":123,"../constants":125,events:173,ws:175}],134:[function(v,C,x){"use strict";var S=function(){function y(){Object.defineProperties(this,{_connected:{writable:!0,value:!0}})}return y.prototype.connect=function(){},y.prototype.disconnect=function(){return!!this._connected&&(this._connected=!1,!0)},y.prototype.publish=function(){return this._connected},y}();C.exports=S},{}],135:[function(v,C,x){"use strict";var S=v("./").defer,y=function(){function _(){Object.defineProperties(this,{_audio:{value:S(),writable:!0},_video:{value:S(),writable:!0}}),this._audio.resolve(),this._video.resolve()}return _.prototype.resolveDeferred=function(o){"audio"===o?this._audio.resolve():this._video.resolve()},_.prototype.startDeferred=function(o){"audio"===o?this._audio=S():this._video=S()},_.prototype.whenResolved=function(o){return"audio"===o?this._audio.promise:this._video.promise},_}();C.exports=new y},{"./":132}],136:[function(v,C,x){"use strict";var r,S=this&&this.__read||function(h,k){var b="function"==typeof Symbol&&h[Symbol.iterator];if(!b)return h;var T,m,R=b.call(h),w=[];try{for(;(void 0===k||k-- >0)&&!(T=R.next()).done;)w.push(T.value)}catch(u){m={error:u}}finally{try{T&&!T.done&&(b=R.return)&&b.call(R)}finally{if(m)throw m.error}}return w},y=this&&this.__spreadArray||function(h,k){for(var b=0,R=k.length,T=h.length;b<R;b++,T++)h[T]=k[b];return h},_=v("../vendor/loglevel").getLogger,o=v("./constants"),i=o.DEFAULT_LOG_LEVEL,e=o.DEFAULT_LOGGER_NAME,t=v("./constants").typeErrors,a=function(){function h(k,b,R,T,w){if("string"!=typeof k)throw t.INVALID_TYPE("moduleName","string");if(!b)throw t.REQUIRED_ARGUMENT("component");"object"!=typeof R&&(R={}),w=w||_,d(R),Object.defineProperties(this,{_component:{value:b},_logLevels:{value:R},_warnings:{value:new Set},_loggerName:{get:function(){var u=T&&"string"==typeof T?T:e;return this._logLevelsEqual||(u=u+"-"+k),u}},_logger:{get:function(){var u=w(this._loggerName),f=this._logLevels[k]||i;return u.setDefaultLevel(f="off"===f?"silent":f),u}},_logLevelsEqual:{get:function(){return 1===new Set(Object.values(this._logLevels)).size}},logLevel:{get:function(){return h.getLevelByName(R[k]||i)}},name:{get:b.toString.bind(b)}})}return h.getLevelByName=function(k){return isNaN(k)?(l(k=k.toUpperCase()),h[k]):parseInt(k,10)},h.prototype.createLog=function(k,b){var R=this._loggerName;return this._logLevelsEqual||(R=R.substring(0,R.lastIndexOf("-"))),new h(k,b,this._logLevels,R)},h.prototype.setLevels=function(k){return d(k),Object.assign(this._logLevels,k),this},h.prototype.log=function(k,b){var R=h._levels[k];if(!R)throw t.INVALID_VALUE("logLevel",c);R=R.toLowerCase();var T=[(new Date).toISOString(),R,this.name];return(this._logger[R]||function(){}).apply(void 0,y([],S(T.concat(b)))),this},h.prototype.debug=function(){return this.log(h.DEBUG,[].slice.call(arguments))},h.prototype.deprecated=function(k){var b=function n(h){if((r=r||new Map).has(h))return r.get(h);var k=new Set;return r.set(h,k),k}(this._component.constructor);return b.has(k)?this:(b.add(k),this.warn(k))},h.prototype.info=function(){return this.log(h.INFO,[].slice.call(arguments))},h.prototype.warn=function(){return this.log(h.WARN,[].slice.call(arguments))},h.prototype.warnOnce=function(k){return this._warnings.has(k)?this:(this._warnings.add(k),this.warn(k))},h.prototype.error=function(){return this.log(h.ERROR,[].slice.call(arguments))},h.prototype.throw=function(k,b){throw k.clone&&(k=k.clone(b)),this.log(h.ERROR,k),k},h}();Object.defineProperties(a,{DEBUG:{value:0},INFO:{value:1},WARN:{value:2},ERROR:{value:3},OFF:{value:4},_levels:{value:["DEBUG","INFO","WARN","ERROR","OFF"]}});var s={},c=[],p=a._levels.map(function(h,k){return s[h]=!0,c.push(k),h});function l(h){if(!(h in s))throw t.INVALID_VALUE("level",p)}function d(h){Object.keys(h).forEach(function(k){l(h[k].toUpperCase())})}C.exports=a},{"../vendor/loglevel":152,"./constants":125}],137:[function(v,C,x){"use strict";var S=function(){function y(){Object.defineProperties(this,{_samples:{value:[{denominator:0,numerator:0},{denominator:0,numerator:0}]}})}return y.prototype.get=function(){var _=this._samples;return(_[1].numerator-_[0].numerator)/(_[1].denominator-_[0].denominator||1/0)},y.prototype.putSample=function(_,o){var i=this._samples;i.shift(),i.push({denominator:o,numerator:_})},y}();C.exports=S},{}],138:[function(v,C,x){"use strict";var S=function(){function y(_,o){var i=this,e=(o=Object.assign({navigator,window},o)).navigator,t=e.connection||{type:null},r=t.type,n=t.type?{_events:{value:["change","typechange"]},_listener:{value:function(){var p=r!==i.type&&i.isOnline;r=i.type,p&&_()}},_target:{value:t}}:{_events:{value:["online"]},_listener:{value:_},_target:{value:o.window}};Object.defineProperties(this,{isOnline:{enumerable:!0,get:function(){return"boolean"!=typeof e.onLine||e.onLine}},type:{enumerable:!0,get:function(){return t.type||null}},_listener:n._listener,_events:n._events,_target:n._target})}return y.prototype.start=function(){var _=this;this._events.forEach(function(o){_._target.addEventListener(o,_._listener)})},y.prototype.stop=function(){var _=this;this._events.forEach(function(o){_._target.removeEventListener(o,_._listener)})},y}();C.exports=S},{}],139:[function(v,C,x){"use strict";var i,S=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),y=function(){function i(e){Object.defineProperties(this,{_callback:{value:e}})}return i.prototype.observe=function(){},i.prototype.unobserve=function(){},i.prototype.makeVisible=function(e){var t=this._makeFakeEntry(e,!0);this._callback([t])},i.prototype.makeInvisible=function(e){var t=this._makeFakeEntry(e,!1);this._callback([t])},i.prototype._makeFakeEntry=function(e,t){return{target:e,isIntersecting:t}},i}(),_=function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return S(e,i),e}(y),o=function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return S(e,i),e.prototype.resize=function(t){var r=this._makeFakeEntry(t,!0);this._callback([r])},e}(y);C.exports={NullIntersectionObserver:_,NullResizeObserver:o,NullObserver:y}},{}],140:[function(v,C,x){"use strict";var S=this&&this.__read||function(O,A){var N="function"==typeof Symbol&&O[Symbol.iterator];if(!N)return O;var M,G,j=N.call(O),Q=[];try{for(;(void 0===A||A-- >0)&&!(M=j.next()).done;)Q.push(M.value)}catch(K){G={error:K}}finally{try{M&&!M.done&&(N=j.return)&&N.call(j)}finally{if(G)throw G.error}}return Q},y=v("../"),_=y.difference,o=y.flatMap,i=v("./simulcast"),e={0:"PCMU",8:"PCMA"};function t(O){return Array.from(n(O)).reduce(function(A,N){var j=N[0],M=N[1],Q=A.get(M)||[];return A.set(M,Q.concat(j))},new Map)}function r(O){return c(O).reduce(function(A,N){var j=s(N);return j?A.set(j,N):A},new Map)}function n(O){return p(O).reduce(function(A,N){var j=new RegExp("a=rtpmap:"+N+" ([^/]+)"),M=O.match(j),Q=M?M[1].toLowerCase():e[N]?e[N].toLowerCase():"";return A.set(N,Q)},new Map)}function a(O,A){var N=new RegExp("^a=fmtp:"+O+" (.+)$","m"),j=A.match(N);return j&&j[1].split(";").reduce(function(M,Q){var G=S(Q.split("="),2),F=G[1];return M[G[0]]=isNaN(F)?F:parseInt(F,10),M},{})}function s(O){var A=O.match(/^a=mid:(.+)$/m);return A&&A[1]}function c(O,A,N){return O.replace(/\r\n\r\n$/,"\r\n").split("\r\nm=").slice(1).map(function(j){return"m="+j}).filter(function(j){var M=new RegExp("m="+(A||".*"),"gm"),Q=new RegExp("a="+(N||".*"),"gm");return M.test(j)&&Q.test(j)})}function p(O){var N=O.split("\r\n")[0].match(/([0-9]+)/g);return N?N.slice(1).map(function(j){return parseInt(j,10)}):[]}function d(O,A){var N=A.split("\r\n"),j=N[0],M=N.slice(1);return[j=j.replace(/([0-9]+\s?)+$/,O.join(" "))].concat(M).join("\r\n")}function u(O,A){var N=c(O);return[O.split("\r\nm=")[0]].concat(N.map(function(M){if(!/^m=(audio|video)/.test(M))return M;var Q=s(M);if(!Q)return M;var G=A.get(Q);if(!G)return M;var K=(M.match(/^a=msid:(.+)$/m)||[])[1];if(!K)return M;var F=S(K.split(" "),2),V=F[0],D=F[1],L=new RegExp("msid:"+V+(D?" "+D:"")+"$","gm");return M.replace(L,"msid:"+V+" "+G)})).join("\r\n")}function P(O,A){return"a=fmtp:"+O+" "+Object.entries(A).map(function(j){var M=S(j,2);return M[0]+"="+M[1]}).join(";")}x.addOrRewriteNewTrackIds=function m(O,A,N){var j=Array.from(N).reduce(function(M,Q){var G=S(Q,2),F=G[1];return c(O,G[0],"send(only|recv)").map(s).filter(function(L){return!A.has(L)}).forEach(function(L,H){return M.set(L,F[H])}),M},new Map);return u(O,j)},x.addOrRewriteTrackIds=u,x.createCodecMapForMediaSection=t,x.createPtToCodecName=n,x.disableRtx=function g(O){var A=c(O);return[O.split("\r\nm=")[0]].concat(A.map(function(j){if(!/^m=video/.test(j))return j;var Q=t(j).get("rtx");if(!Q)return j;var G=new Set(p(j));Q.forEach(function(D){return G.delete(D)});var K=j.match(/a=ssrc-group:FID [0-9]+ ([0-9]+)/),F=K&&K[1],V=[/^a=fmtp:.+ apt=.+$/,/^a=rtpmap:.+ rtx\/.+$/,/^a=ssrc-group:.+$/].concat(F?[new RegExp("^a=ssrc:"+F+" .+$")]:[]);return j=j.split("\r\n").filter(function(D){return V.every(function(L){return!L.test(D)})}).join("\r\n"),d(Array.from(G),j)})).join("\r\n")},x.enableDtxForOpus=function E(O,A){var N=c(O),j=O.split("\r\nm=")[0];return A=A||N.filter(function(M){return/^m=audio/.test(M)}).map(s),[j].concat(N.map(function(M){if(!/^m=audio/.test(M))return M;var G=t(M).get("opus");if(!G)return M;var K=a(G,M);if(!K)return M;var F=P(G,K),V=new RegExp(F),D=s(M);A.includes(D)?K.usedtx=1:delete K.usedtx;var L=P(G,K);return M.replace(V,L)})).join("\r\n")},x.filterLocalCodecs=function T(O,A){var N=c(O),j=O.split("\r\nm=")[0],M=r(A);return[j].concat(N.map(function(Q){return function R(O,A,N){if(!/^m=(audio|video)/.test(O))return O;var j=s(O),M=j&&A.get(j);if(!M)return O;var Q=n(M),G=t(O),K=o(Array.from(Q),function(L){var H=S(L,2),J=H[0],X=H[1];return"rtx"===X||N.includes(X)?[]:function b(O,A,N,j,M){var Q=N.get(O)||[];if(Q.length<=1)return Q;var G=a(A,M);if(!G)return Q;var K=Q.find(function(F){var V=a(F,j);return V&&Object.keys(G).every(function(D){return G[D]===V[D]})});return"number"==typeof K?[K]:Q}(X,J,G,O,M)}),F=G.get("rtx")||[];K=K.concat(F.filter(function(L){var H=a(L,O);return H&&K.includes(H.apt)}));var V=O.split("\r\n").filter(function(L){var H=L.match(/^a=(rtpmap|fmtp|rtcp-fb):(.+) .+$/),J=H&&H[2];return!H||J&&K.includes(parseInt(J,10))});return d(p(O).filter(function(L){return K.includes(L)}),V.join("\r\n"))}(Q,M,[])})).join("\r\n")},x.getMediaSections=c,x.removeSSRCAttributes=function f(O,A){return O.split("\r\n").filter(function(N){return!A.find(function(j){return new RegExp("a=ssrc:.*"+j+":","g").test(N)})}).join("\r\n")},x.revertSimulcast=function w(O,A,N,j){void 0===j&&(j=!1);var M=r(N),Q=r(A),G=c(O);return[O.split("\r\nm=")[0]].concat(G.map(function(F){if(F=F.replace(/\r\n$/,""),!/^m=video/.test(F))return F;var V=F.match(/^a=mid:(.+)$/m),D=V&&V[1];if(!D)return F;var L=M.get(D),H=n(L),J=p(L),X=J.length&&"vp8"===H.get(J[0]);return j||!X?Q.get(D).replace(/\r\n$/,""):F})).concat("").join("\r\n")},x.setCodecPreferences=function h(O,A,N){var j=c(O);return[O.split("\r\nm=")[0]].concat(j.map(function(Q){if(!/^m=(audio|video)/.test(Q))return Q;var G=Q.match(/^m=(audio|video)/)[1],K=t(Q),V=function l(O,A){A=A.map(function(Q){return Q.codec.toLowerCase()});var N=o(A,function(Q){return O.get(Q)||[]}),j=_(Array.from(O.keys()),A),M=o(j,function(Q){return O.get(Q)});return N.concat(M)}(K,"audio"===G?A:N),D=d(V,Q),L=K.get("pcma")||[],H=K.get("pcmu")||[];return("audio"===G?new Set(L.concat(H)):new Set).has(V[0])?D.replace(/\r\nb=(AS|TIAS):([0-9]+)/g,""):D})).join("\r\n")},x.setSimulcast=function k(O,A){var N=c(O);return[O.split("\r\nm=")[0]].concat(N.map(function(M){if(M=M.replace(/\r\n$/,""),!/^m=video/.test(M))return M;var Q=t(M),G=p(M),K=new Set(Q.get("vp8")||[]);return G.some(function(V){return K.has(V)})?i(M,A):M})).concat("").join("\r\n")}},{"../":132,"./simulcast":142}],141:[function(v,C,x){"use strict";var S=v("../../webrtc").RTCSessionDescription,y=v("./"),_=y.createPtToCodecName,o=y.getMediaSections;function t(d){var h=_(d);d=function r(d,h){return Array.from(h.keys()).reduce(function(k,b){var R=new RegExp("^a=rtpmap:"+b+" rtx.+$","gm");return(k.match(R)||[]).slice("rtx"===h.get(b)?1:0).reduce(function(T,w){var m=new RegExp("\r\n"+w),u=new RegExp("\r\na=fmtp:"+b+" apt=[0-9]+");return T.replace(m,"").replace(u,"")},k)},d)}(d,h);var k=function n(d){var h=new Map;return d.forEach(function(k,b){var R=h.get(k)||new Set;return h.set(k,R.add(b))}),h}(h),b=k.get("rtx")||new Set,R=new Set,T=function a(d,h,k,b){return Array.from(k).reduce(function(R,T){var w=new RegExp("a=fmtp:"+T+" apt=(\\d+)"),m=d.match(w);if(!m)return b.add(T),R;var u=Number.parseInt(m[1]);return h.has(u)?"rtx"===h.get(u)?(b.add(T),R):R.set(T,u):(b.add(T),R)},new Map)}(d,h,b,R),w=function s(d,h){var k=Array.from(d).reduce(function(b,R){var T=R[0],w=R[1],m=b.get(w)||new Set;return b.set(w,m.add(T))},new Map);return Array.from(k).reduce(function(b,R){var T=R[0],w=Array.from(R[1]);return w.length>1?(w.forEach(function(m){h.add(m)}),b):b.set(T,w[0])},new Map)}(T,R),m=Array.from(R);return["h264","vp8","vp9"].reduce(function(g,P){var E=k.get(P)||new Set;return Array.from(E).reduce(function(O,A){return w.has(A)?O:O.add(A)},g)},new Set).forEach(function(g){if(m.length){var P=m.shift();d=function l(d,h,k){return d.endsWith("\r\n")?d+"a=fmtp:"+h+" apt="+k+"\r\n":d+"\r\na=fmtp:"+h+" apt="+k}(d=c(d,P),P,g)}}),m.forEach(function(g){d=function p(d,h){var k=new RegExp("a=rtpmap:"+h+".*\r\n","gm");return d.replace(k,"")}(d=c(d,g),g)}),d}function c(d,h){var k=new RegExp("a=fmtp:"+h+".*\r\n","gm");return d.replace(k,"")}C.exports=function i(d){var h={type:d.type};return"rollback"!==d.type&&(h.sdp=function e(d){var h=o(d);return[d.split("\r\nm=")[0]].concat(h.map(t)).join("\r\n")}(d.sdp)),new S(h)}},{"../../webrtc":158,"./":140}],142:[function(v,C,x){"use strict";var S=this&&this.__read||function(l,d){var h="function"==typeof Symbol&&l[Symbol.iterator];if(!h)return l;var b,T,k=h.call(l),R=[];try{for(;(void 0===d||d-- >0)&&!(b=k.next()).done;)R.push(b.value)}catch(w){T={error:w}}finally{try{b&&!b.done&&(h=k.return)&&h.call(k)}finally{if(T)throw T.error}}return R},y=v("../"),_=y.difference,o=y.flatMap;function i(){return String(Math.floor(4294967295*Math.random()))}var e=function(){function l(d,h,k){Object.defineProperties(this,{cName:{enumerable:!0,value:k},isSimulcastEnabled:{enumerable:!0,value:!1,writable:!0},primarySSRCs:{enumerable:!0,value:new Set},rtxPairs:{enumerable:!0,value:new Map},streamId:{enumerable:!0,value:h},trackId:{enumerable:!0,value:d}})}return l.prototype.addSimulcastSSRCs=function(){if(!this.isSimulcastEnabled){var d=[i(),i()];d.forEach(function(h){this.primarySSRCs.add(h)},this),this.rtxPairs.size&&d.forEach(function(h){this.rtxPairs.set(i(),h)},this)}},l.prototype.addSSRC=function(d,h,k){h?this.rtxPairs.set(d,h):this.primarySSRCs.add(d),this.isSimulcastEnabled=this.isSimulcastEnabled||k},l.prototype.toSdpLines=function(d){var h=this,k=d?[]:Array.from(this.rtxPairs.entries()).map(function(u){return u.reverse()}),b=Array.from(this.primarySSRCs.values()),R=k.length?o(k):b,T=o(R,function(u){return["a=ssrc:"+u+" cname:"+h.cName,"a=ssrc:"+u+" msid:"+h.streamId+" "+h.trackId]}),w=k.map(function(u){return"a=ssrc-group:FID "+u.join(" ")}),m=["a=ssrc-group:SIM "+b.join(" ")];return w.concat(T).concat(m)},l}();function t(l,d){return(l.match(new RegExp(d,"gm"))||[]).map(function(k){return(k.match(new RegExp(d))||[]).slice(1)})}C.exports=function p(l,d){var h=function c(l){var d=function r(l){return new Set(o(t(l,"^a=ssrc-group:SIM ([0-9]+) ([0-9]+) ([0-9]+)$")))}(l),h=function a(l){return new Map(t(l,"^a=ssrc-group:FID ([0-9]+) ([0-9]+)$").map(function(h){return h.reverse()}))}(l),k=function s(l){var d=S(o(t(l,"^a=msid:(.+) (.+)$")),2),h=d[0],k=d[1];return o(t(l,"^a=ssrc:(.+) cname:.+$")).map(function(R){return[R,h,k]})}(l);return k.reduce(function(b,R){var T=R[0],w=R[1],m=R[2],u=b.get(m)||new e(m,w,function n(l,d,h){return l.match(new RegExp("a=ssrc:"+d+" "+h+":(.+)"))[1]}(l,T,"cname")),f=h.get(T)||null;return u.addSSRC(T,f,d.has(T)),b.set(m,u)},new Map)}(l),k=Array.from(h.keys()),b=Array.from(d.keys()),R=_(k,b),T=_(b,k);o(R,function(O){return h.get(O)}).forEach(function(O){O.addSimulcastSSRCs(),d.set(O.trackId,O)}),b=Array.from(d.keys());var m=_(b,T),u=o(m,function(O){return d.get(O)}),f=!l.match(/a=rtpmap:[0-9]+ rtx/),g=o(u,function(O){return O.toSdpLines(f)}),P=o(new Set(l.split("\r\n").concat(g))),E="a=x-google-flag:conference";return l.match(E)||P.push(E),P.join("\r\n")}},{"../":132}],143:[function(v,C,x){"use strict";var S=v("./").getMediaSections,y=function(){function _(){Object.defineProperties(this,{_midsToTrackIds:{value:new Map,writable:!0}})}return _.prototype.match=function(o){return this._midsToTrackIds.get(o.transceiver.mid)||null},_.prototype.update=function(o){var i=S(o,"(audio|video)");this._midsToTrackIds=i.reduce(function(e,t){var r=t.match(/^a=mid:(.+)$/m)||[],n=t.match(/^a=msid:.+ (.+)$/m)||[],a=r[1],s=n[1];return a&&s?e.set(a,s):e},this._midsToTrackIds)},_}();C.exports=y},{"./":140}],144:[function(v,C,x){function _(o){for(var i="",e=0;e<32;e++)i+="1234567890abcdef".charAt(Math.floor(16*Math.random()));return""+o+i}x.sessionSID=_("SS"),x.createSID=_},{}],145:[function(v,C,x){"use strict";var S=v("../webrtc/util"),y=S.guessBrowser,_=S.support,o=v("../webrtc/util/sdp").getSdpFormat,i=v("./browserdetection"),e=i.isAndroid,t=i.isMobile,r=i.isNonChromiumEdge,n=i.rebrandedChromeBrowser,a=i.mobileWebKitBrowser,s=["crios","edg","edge","electron","headlesschrome"],c=["chrome","firefox"],p=["chrome","safari"],l=[];C.exports=function d(){var h=y();if(!h)return!1;var k=n(h),b=a(h),R=e()?c:p;return!!h&&_()&&"unified"===o()&&(!k||s.includes(k))&&!r(h)&&(!b||l.includes(b))&&(!t()||R.includes(h))}},{"../webrtc/util":170,"../webrtc/util/sdp":172,"./browserdetection":123}],146:[function(v,C,x){"use strict";var S=function(){function y(_,o,i){void 0===i&&(i=!0),Object.defineProperties(this,{_delay:{value:o,writable:!0},_fn:{value:_},_timeout:{value:null,writable:!0}}),i&&this.start()}return Object.defineProperty(y.prototype,"delay",{get:function(){return this._delay},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"isSet",{get:function(){return!!this._timeout},enumerable:!1,configurable:!0}),y.prototype.setDelay=function(_){this._delay=_},y.prototype.start=function(){var _=this;this.isSet||(this._timeout=setTimeout(function(){var o=_._fn;_.clear(),o()},this._delay))},y.prototype.clear=function(){clearTimeout(this._timeout),this._timeout=null},y.prototype.reset=function(){this.clear(),this.start()},y}();C.exports=S},{}],147:[function(v,C,x){"use strict";var B,S=this&&this.__extends||(B=function(I,U){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ue,ae){ue.__proto__=ae}||function(ue,ae){for(var re in ae)Object.prototype.hasOwnProperty.call(ae,re)&&(ue[re]=ae[re])})(I,U)},function(I,U){if("function"!=typeof U&&null!==U)throw new TypeError("Class extends value "+String(U)+" is not a constructor or null");function ue(){this.constructor=I}B(I,U),I.prototype=null===U?Object.create(U):(ue.prototype=U.prototype,new ue)}),y=v("./twilioerror"),_={};x.createTwilioError=function(I,U){return U="string"==typeof U&&U?U:"Unknown error",_[I="number"==typeof I?I:0]?new _[I]:new y(I,U)};var o=function(B){function I(){var U=B.call(this,20101,"Invalid Access Token")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.AccessTokenInvalidError=o,Object.defineProperty(_,20101,{value:o});var i=function(B){function I(){var U=B.call(this,20102,"Invalid Access Token header")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.AccessTokenHeaderInvalidError=i,Object.defineProperty(_,20102,{value:i});var e=function(B){function I(){var U=B.call(this,20103,"Invalid Access Token issuer/subject")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.AccessTokenIssuerInvalidError=e,Object.defineProperty(_,20103,{value:e});var t=function(B){function I(){var U=B.call(this,20104,"Access Token expired or expiration date invalid")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.AccessTokenExpiredError=t,Object.defineProperty(_,20104,{value:t});var r=function(B){function I(){var U=B.call(this,20105,"Access Token not yet valid")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.AccessTokenNotYetValidError=r,Object.defineProperty(_,20105,{value:r});var n=function(B){function I(){var U=B.call(this,20106,"Invalid Access Token grants")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.AccessTokenGrantsInvalidError=n,Object.defineProperty(_,20106,{value:n});var a=function(B){function I(){var U=B.call(this,20107,"Invalid Access Token signature")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.AccessTokenSignatureInvalidError=a,Object.defineProperty(_,20107,{value:a});var s=function(B){function I(){var U=B.call(this,53e3,"Signaling connection error")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.SignalingConnectionError=s,Object.defineProperty(_,53e3,{value:s});var c=function(B){function I(){var U=B.call(this,53001,"Signaling connection disconnected")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.SignalingConnectionDisconnectedError=c,Object.defineProperty(_,53001,{value:c});var p=function(B){function I(){var U=B.call(this,53002,"Signaling connection timed out")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.SignalingConnectionTimeoutError=p,Object.defineProperty(_,53002,{value:p});var l=function(B){function I(){var U=B.call(this,53003,"Client received an invalid signaling message")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.SignalingIncomingMessageInvalidError=l,Object.defineProperty(_,53003,{value:l});var d=function(B){function I(){var U=B.call(this,53004,"Client sent an invalid signaling message")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.SignalingOutgoingMessageInvalidError=d,Object.defineProperty(_,53004,{value:d});var h=function(B){function I(){var U=B.call(this,53006,"Video server is busy")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.SignalingServerBusyError=h,Object.defineProperty(_,53006,{value:h});var k=function(B){function I(){var U=B.call(this,53100,"Room name is invalid")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.RoomNameInvalidError=k,Object.defineProperty(_,53100,{value:k});var b=function(B){function I(){var U=B.call(this,53101,"Room name is too long")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.RoomNameTooLongError=b,Object.defineProperty(_,53101,{value:b});var R=function(B){function I(){var U=B.call(this,53102,"Room name contains invalid characters")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.RoomNameCharsInvalidError=R,Object.defineProperty(_,53102,{value:R});var T=function(B){function I(){var U=B.call(this,53103,"Unable to create Room")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.RoomCreateFailedError=T,Object.defineProperty(_,53103,{value:T});var w=function(B){function I(){var U=B.call(this,53104,"Unable to connect to Room")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.RoomConnectFailedError=w,Object.defineProperty(_,53104,{value:w});var m=function(B){function I(){var U=B.call(this,53105,"Room contains too many Participants")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.RoomMaxParticipantsExceededError=m,Object.defineProperty(_,53105,{value:m});var u=function(B){function I(){var U=B.call(this,53106,"Room not found")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.RoomNotFoundError=u,Object.defineProperty(_,53106,{value:u});var f=function(B){function I(){var U=B.call(this,53107,"MaxParticipants is out of range")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.RoomMaxParticipantsOutOfRangeError=f,Object.defineProperty(_,53107,{value:f});var g=function(B){function I(){var U=B.call(this,53108,"RoomType is not valid")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.RoomTypeInvalidError=g,Object.defineProperty(_,53108,{value:g});var P=function(B){function I(){var U=B.call(this,53109,"Timeout is out of range")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.RoomTimeoutOutOfRangeError=P,Object.defineProperty(_,53109,{value:P});var E=function(B){function I(){var U=B.call(this,53110,"StatusCallbackMethod is invalid")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.RoomStatusCallbackMethodInvalidError=E,Object.defineProperty(_,53110,{value:E});var O=function(B){function I(){var U=B.call(this,53111,"StatusCallback is invalid")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.RoomStatusCallbackInvalidError=O,Object.defineProperty(_,53111,{value:O});var A=function(B){function I(){var U=B.call(this,53112,"Status is invalid")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.RoomStatusInvalidError=A,Object.defineProperty(_,53112,{value:A});var N=function(B){function I(){var U=B.call(this,53113,"Room exists")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.RoomRoomExistsError=N,Object.defineProperty(_,53113,{value:N});var j=function(B){function I(){var U=B.call(this,53114,"Room creation parameter(s) incompatible with the Room type")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.RoomInvalidParametersError=j,Object.defineProperty(_,53114,{value:j});var M=function(B){function I(){var U=B.call(this,53115,"MediaRegion is invalid")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.RoomMediaRegionInvalidError=M,Object.defineProperty(_,53115,{value:M});var Q=function(B){function I(){var U=B.call(this,53116,"There are no media servers available in the MediaRegion")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.RoomMediaRegionUnavailableError=Q,Object.defineProperty(_,53116,{value:Q});var G=function(B){function I(){var U=B.call(this,53117,"The subscription operation requested is not supported for the Room type")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.RoomSubscriptionOperationNotSupportedError=G,Object.defineProperty(_,53117,{value:G});var K=function(B){function I(){var U=B.call(this,53118,"Room completed")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.RoomCompletedError=K,Object.defineProperty(_,53118,{value:K});var F=function(B){function I(){var U=B.call(this,53124,"The AudioOnly flag is not supported for the Room type")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.RoomAudioOnlyFlagNotSupportedError=F,Object.defineProperty(_,53124,{value:F});var V=function(B){function I(){var U=B.call(this,53125,"The track kind is not supported by the Room")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.RoomTrackKindNotSupportedError=V,Object.defineProperty(_,53125,{value:V});var D=function(B){function I(){var U=B.call(this,53200,"Participant identity is invalid")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.ParticipantIdentityInvalidError=D,Object.defineProperty(_,53200,{value:D});var L=function(B){function I(){var U=B.call(this,53201,"Participant identity is too long")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.ParticipantIdentityTooLongError=L,Object.defineProperty(_,53201,{value:L});var H=function(B){function I(){var U=B.call(this,53202,"Participant identity contains invalid characters")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.ParticipantIdentityCharsInvalidError=H,Object.defineProperty(_,53202,{value:H});var J=function(B){function I(){var U=B.call(this,53203,"The maximum number of published tracks allowed in the Room at the same time has been reached")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.ParticipantMaxTracksExceededError=J,Object.defineProperty(_,53203,{value:J});var X=function(B){function I(){var U=B.call(this,53204,"Participant not found")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.ParticipantNotFoundError=X,Object.defineProperty(_,53204,{value:X});var $=function(B){function I(){var U=B.call(this,53205,"Participant disconnected because of duplicate identity")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.ParticipantDuplicateIdentityError=$,Object.defineProperty(_,53205,{value:$});var Z=function(B){function I(){var U=B.call(this,53300,"Track is invalid")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.TrackInvalidError=Z,Object.defineProperty(_,53300,{value:Z});var se=function(B){function I(){var U=B.call(this,53301,"Track name is invalid")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.TrackNameInvalidError=se,Object.defineProperty(_,53301,{value:se});var le=function(B){function I(){var U=B.call(this,53302,"Track name is too long")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.TrackNameTooLongError=le,Object.defineProperty(_,53302,{value:le});var de=function(B){function I(){var U=B.call(this,53303,"Track name contains invalid characters")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.TrackNameCharsInvalidError=de,Object.defineProperty(_,53303,{value:de});var ve=function(B){function I(){var U=B.call(this,53304,"Track name is duplicated")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.TrackNameIsDuplicatedError=ve,Object.defineProperty(_,53304,{value:ve});var ce=function(B){function I(){var U=B.call(this,53305,"The server has reached capacity and cannot fulfill this request")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.TrackServerTrackCapacityReachedError=ce,Object.defineProperty(_,53305,{value:ce});var fe=function(B){function I(){var U=B.call(this,53400,"Client is unable to create or apply a local media description")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.MediaClientLocalDescFailedError=fe,Object.defineProperty(_,53400,{value:fe});var pe=function(B){function I(){var U=B.call(this,53401,"Server is unable to create or apply a local media description")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.MediaServerLocalDescFailedError=pe,Object.defineProperty(_,53401,{value:pe});var ye=function(B){function I(){var U=B.call(this,53402,"Client is unable to apply a remote media description")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.MediaClientRemoteDescFailedError=ye,Object.defineProperty(_,53402,{value:ye});var ge=function(B){function I(){var U=B.call(this,53403,"Server is unable to apply a remote media description")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.MediaServerRemoteDescFailedError=ge,Object.defineProperty(_,53403,{value:ge});var ke=function(B){function I(){var U=B.call(this,53404,"No supported codec")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.MediaNoSupportedCodecError=ke,Object.defineProperty(_,53404,{value:ke});var Le=function(B){function I(){var U=B.call(this,53405,"Media connection failed or Media activity ceased")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.MediaConnectionError=Le,Object.defineProperty(_,53405,{value:Le});var we=function(B){function I(){var U=B.call(this,53407,"Media connection failed due to DTLS handshake failure")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.MediaDTLSTransportFailedError=we,Object.defineProperty(_,53407,{value:we});var Y=function(B){function I(){var U=B.call(this,53500,"Unable to acquire configuration")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.ConfigurationAcquireFailedError=Y,Object.defineProperty(_,53500,{value:Y});var q=function(B){function I(){var U=B.call(this,53501,"Unable to acquire TURN credentials")||this;return Object.setPrototypeOf(U,I.prototype),U}return S(I,B),I}(y);x.ConfigurationAcquireTurnFailedError=q,Object.defineProperty(_,53501,{value:q})},{"./twilioerror":148}],148:[function(v,C,x){"use strict";var i,S=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),y=this&&this.__read||function(i,e){var t="function"==typeof Symbol&&i[Symbol.iterator];if(!t)return i;var n,s,r=t.call(i),a=[];try{for(;(void 0===e||e-- >0)&&!(n=r.next()).done;)a.push(n.value)}catch(c){s={error:c}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(s)throw s.error}}return a},_=this&&this.__spreadArray||function(i,e){for(var t=0,r=e.length,n=i.length;t<r;t++,n++)i[n]=e[t];return i},o=function(i){function e(t){var r,n=[].slice.call(arguments,1);r=i.apply(this,_([],y(n)))||this,Object.setPrototypeOf(r,e.prototype);var a=Error.apply(r,n);return a.name="TwilioError",Object.defineProperty(r,"code",{value:t,enumerable:!0}),Object.getOwnPropertyNames(a).forEach(function(s){Object.defineProperty(this,s,{value:a[s],enumerable:!0})},r),r}return S(e,i),e.prototype.toString=function(){return this.name+" "+this.code+(this.message?": "+this.message:"")},e}(Error);C.exports=o},{}],149:[function(v,C,x){"use strict";C.exports={recordingMediaLost:"recording-media-lost"}},{}],150:[function(v,C,x){"use strict";var S=v("./").isNonArrayObject,y=v("./constants"),_=y.typeErrors,o=y.clientTrackSwitchOffControl,i=y.videoContentPreferencesMode,e=y.subscriptionMode,t=y.trackPriority,r=y.trackSwitchOffMode;function s(p,l,d){return void 0===d&&(d=[]),typeof p>"u"?null:null!==p&&S(p)?d.reduce(function(h,k){var b=k.prop,R=k.type,T=k.values;if(h||!(b in p))return h;var w=p[b];return R&&typeof w!==R||"number"===R&&isNaN(w)?_.INVALID_TYPE(l+"."+b,R):Array.isArray(T)&&!T.includes(w)?_.INVALID_VALUE(l+"."+b,T):h},null):_.INVALID_TYPE(l,"object")}x.validateBandwidthProfile=function n(p){var l=s(p,"options.bandwidthProfile");return!p||l||(l=s(p.video,"options.bandwidthProfile.video",[{prop:"contentPreferencesMode",values:Object.values(i)},{prop:"dominantSpeakerPriority",values:Object.values(t)},{prop:"maxSubscriptionBitrate",type:"number"},{prop:"maxTracks",type:"number"},{prop:"mode",values:Object.values(e)},{prop:"clientTrackSwitchOffControl",values:Object.values(o)},{prop:"trackSwitchOffMode",values:Object.values(r)}]))?l:p.video?"maxTracks"in p.video&&"clientTrackSwitchOffControl"in p.video?new TypeError("options.bandwidthProfile.video.maxTracks is deprecated. Use options.bandwidthProfile.video.clientTrackSwitchOffControl instead."):"renderDimensions"in p.video&&"contentPreferencesMode"in p.video?new TypeError("options.bandwidthProfile.video.renderDimensions is deprecated. Use options.bandwidthProfile.video.contentPreferencesMode instead."):function c(p){var l="options.bandwidthProfile.video.renderDimensions",d=s(p,l);return p?d||Object.values(t).reduce(function(h,k){return h||s(p[k],l+"."+k,[{prop:"height",type:"number"},{prop:"width",type:"number"}])},null):d}(p.video.renderDimensions):null},x.validateLocalTrack=function a(p,l){if(!(p instanceof l.LocalAudioTrack||p instanceof l.LocalDataTrack||p instanceof l.LocalVideoTrack||p instanceof l.MediaStreamTrack))throw _.INVALID_TYPE("track","LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack")},x.validateObject=s},{"./":132,"./constants":125}],151:[function(v,C,x){C.exports=function(y,_){if(y&&_)if(y.super_=_,"function"==typeof Object.create)y.prototype=Object.create(_.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}});else{var o=function i(){};o.prototype=_.prototype,y.prototype=new o,y.prototype.constructor=y}}},{}],152:[function(v,C,x){var S=function(){},y="undefined",_=typeof window!==y&&typeof window.navigator!==y&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"];function i(d,h){var k=d[h];if("function"==typeof k.bind)return k.bind(d);try{return Function.prototype.bind.call(k,d)}catch{return function(){return Function.prototype.apply.apply(k,[d,arguments])}}}function e(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function r(d,h){for(var k=0;k<o.length;k++){var b=o[k];this[b]=k<d?S:this.methodFactory(b,d,h)}this.log=this.debug}function n(d,h,k){return function(){typeof console!==y&&(r.call(this,h,k),this[d].apply(this,arguments))}}function a(d,h,k){return function t(d){return"debug"===d&&(d="log"),typeof console!==y&&("trace"===d&&_?e:void 0!==console[d]?i(console,d):void 0!==console.log?i(console,"log"):S)}(d)||n.apply(this,arguments)}function s(d,h,k){var R,b=this,T="loglevel";function m(){var f;if(typeof window!==y&&T){try{f=window.localStorage[T]}catch{}if(typeof f===y)try{var g=window.document.cookie,P=g.indexOf(encodeURIComponent(T)+"=");-1!==P&&(f=/^([^;]+)/.exec(g.slice(P))[1])}catch{}return void 0===b.levels[f]&&(f=void 0),f}}"string"==typeof d?T+=":"+d:"symbol"==typeof d&&(T=void 0),b.name=d,b.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},b.methodFactory=k||a,b.getLevel=function(){return R},b.setLevel=function(f,g){if("string"==typeof f&&void 0!==b.levels[f.toUpperCase()]&&(f=b.levels[f.toUpperCase()]),!("number"==typeof f&&f>=0&&f<=b.levels.SILENT))throw"log.setLevel() called with invalid level: "+f;if(R=f,!1!==g&&function w(f){var g=(o[f]||"silent").toUpperCase();if(typeof window!==y&&T){try{return void(window.localStorage[T]=g)}catch{}try{window.document.cookie=encodeURIComponent(T)+"="+g+";"}catch{}}}(f),r.call(b,f,d),typeof console===y&&f<b.levels.SILENT)return"No console available for logging"},b.setDefaultLevel=function(f){m()||b.setLevel(f,!1)},b.enableAll=function(f){b.setLevel(b.levels.TRACE,f)},b.disableAll=function(f){b.setLevel(b.levels.SILENT,f)};var u=m();null==u&&(u=h??"WARN"),b.setLevel(u,!1)}var c=new s,p={};c.getLogger=function(h){if("symbol"!=typeof h&&"string"!=typeof h||""===h)throw new TypeError("You must supply a name when creating a logger.");var k=p[h];return k||(k=p[h]=new s(h,c.getLevel(),c.methodFactory)),k};var l=typeof window!==y?window.log:void 0;c.noConflict=function(){return typeof window!==y&&window.log===c&&(window.log=l),c},c.getLoggers=function(){return p},c.default=c,C.exports=c},{}],153:[function(v,C,x){"use strict";var S=typeof AudioContext<"u"?AudioContext:typeof webkitAudioContext<"u"?webkitAudioContext:null,y=function(){function _(o){o=Object.assign({AudioContext:S},o),Object.defineProperties(this,{_AudioContext:{value:o.AudioContext},_audioContext:{value:null,writable:!0},_holders:{value:new Set},AudioContextFactory:{enumerable:!0,value:_}})}return _.prototype.getOrCreate=function(o){if(!this._holders.has(o)&&(this._holders.add(o),this._AudioContext&&!this._audioContext))try{this._audioContext=new this._AudioContext}catch{}return this._audioContext},_.prototype.release=function(o){this._holders.has(o)&&(this._holders.delete(o),!this._holders.size&&this._audioContext&&(this._audioContext.close(),this._audioContext=null))},_}();C.exports=new y},{}],154:[function(v,C,x){"use strict";C.exports=function y(_,o,i){i="number"==typeof i?i:250;var e=_.createMediaStreamSource(o),t=_.createAnalyser();t.fftSize=2048,e.connect(t);var r=new Uint8Array(t.fftSize),n=!1;return setTimeout(function(){n=!0},i),function a(){return n?Promise.resolve(!0):(t.getByteTimeDomainData(r),r.some(function(s){return 128!==s&&0!==s})?Promise.resolve(!1):function S(_){return _="number"==typeof _?_:0,new Promise(function(o){return setTimeout(o,_)})}().then(a))}().then(function(s){return e.disconnect(),s},function(s){throw e.disconnect(),s})}},{}],155:[function(v,C,x){"use strict";var S=v("./detectsilence");C.exports=function y(_,o,i,e,t){e="number"==typeof e?e:3;var r=0,n=v("./audiocontext"),a={},s=n.getOrCreate(a);return function c(){return o(i).then(function(p){return(i.audio?S(s,p,t).catch(function(d){return _.warn("Encountered an error while detecting silence",d),!0}):Promise.resolve(!1)).then(function(d){return d?e<=0?(_.warn("Got a silent audio MediaStreamTrack. Normally we would try to get a new one, but we've run out of retries; returning it anyway."),p):(_.warn("Got a silent audio MediaStreamTrack. Stopping all MediaStreamTracks and calling getUserMedia again. This is retry #"+ ++r+"."),p.getTracks().forEach(function(h){return h.stop()}),e--,c()):(_.info("Got a non-silent audio MediaStreamTrack; returning it."),p)})})}().then(function(p){return n.release(a),p},function(p){throw n.release(a),p})}},{"./audiocontext":153,"./detectsilence":154}],156:[function(v,C,x){"use strict";var S=this&&this.__read||function(P,E){var O="function"==typeof Symbol&&P[Symbol.iterator];if(!O)return P;var N,M,A=O.call(P),j=[];try{for(;(void 0===E||E-- >0)&&!(N=A.next()).done;)j.push(N.value)}catch(Q){M={error:Q}}finally{try{N&&!N.done&&(O=A.return)&&O.call(A)}finally{if(M)throw M.error}}return j},y=v("./util"),_=y.flatMap,o=y.guessBrowser,i=y.guessBrowserVersion,e=v("./util/sdp").getSdpFormat,t=o(),r=i(),n="chrome"===t,a="firefox"===t,s="safari"===t,c=n?r.major:null;function k(P){var E=Array.from(P.values()).find(function(G){return"candidate-pair"===G.type&&G.nominated});if(!E)return null;var O=P.get(E.localCandidateId),A=P.get(E.remoteCandidateId),N=[{key:"candidateType",type:"string"},{key:"ip",type:"string"},{key:"port",type:"number"},{key:"priority",type:"number"},{key:"protocol",type:"string"},{key:"url",type:"string"}],j=N.concat([{key:"deleted",type:"boolean"},{key:"relayProtocol",type:"string"}]),M=O?j.reduce(function(G,K){var F=K.key;return G[F]=typeof O[F]===K.type?O[F]:"deleted"!==F&&null,G},{}):null,Q=A?N.reduce(function(G,K){var F=K.key;return G[F]=typeof A[F]===K.type?A[F]:null,G},{}):null;return[{key:"availableIncomingBitrate",type:"number"},{key:"availableOutgoingBitrate",type:"number"},{key:"bytesReceived",type:"number"},{key:"bytesSent",type:"number"},{key:"consentRequestsSent",type:"number"},{key:"currentRoundTripTime",type:"number"},{key:"lastPacketReceivedTimestamp",type:"number"},{key:"lastPacketSentTimestamp",type:"number"},{key:"nominated",type:"boolean"},{key:"priority",type:"number"},{key:"readable",type:"boolean"},{key:"requestsReceived",type:"number"},{key:"requestsSent",type:"number"},{key:"responsesReceived",type:"number"},{key:"responsesSent",type:"number"},{key:"retransmissionsReceived",type:"number"},{key:"retransmissionsSent",type:"number"},{key:"state",type:"string",fixup:function(G){return"inprogress"===G?"in-progress":G}},{key:"totalRoundTripTime",type:"number"},{key:"transportId",type:"string"},{key:"writable",type:"boolean"}].reduce(function(G,K){var F=K.key,D=K.fixup;return G[F]=typeof E[F]===K.type?D?D(E[F]):E[F]:null,G},{localCandidate:M,remoteCandidate:Q})}function b(P){var E=Array.from(P.values()).find(function(K){return"candidate-pair"===K.type&&K.nominated});if(!E)return null;var O=P.get(E.localCandidateId),A=P.get(E.remoteCandidateId),N=[{key:"candidateType",type:"string"},{key:"ip",ffKeys:["address","ipAddress"],type:"string"},{key:"port",ffKeys:["portNumber"],type:"number"},{key:"priority",type:"number"},{key:"protocol",ffKeys:["transport"],type:"string"},{key:"url",type:"string"}],j=N.concat([{key:"deleted",type:"boolean"},{key:"relayProtocol",type:"string"}]),M={host:"host",peerreflexive:"prflx",relayed:"relay",serverreflexive:"srflx"},Q=O?j.reduce(function(K,F){var V=F.ffKeys,D=F.key,L=F.type,H=V&&V.find(function(J){return J in O})||D;return K[D]=typeof O[H]===L?"candidateType"===H&&M[O[H]]||O[H]:"deleted"!==H&&null,K},{}):null,G=A?N.reduce(function(K,F){var V=F.ffKeys,D=F.key,L=F.type,H=V&&V.find(function(J){return J in A})||D;return K[D]=typeof A[H]===L?"candidateType"===H&&M[A[H]]||A[H]:null,K},{}):null;return[{key:"availableIncomingBitrate",type:"number"},{key:"availableOutgoingBitrate",type:"number"},{key:"bytesReceived",type:"number"},{key:"bytesSent",type:"number"},{key:"consentRequestsSent",type:"number"},{key:"currentRoundTripTime",type:"number"},{key:"lastPacketReceivedTimestamp",type:"number"},{key:"lastPacketSentTimestamp",type:"number"},{key:"nominated",type:"boolean"},{key:"priority",type:"number"},{key:"readable",type:"boolean"},{key:"requestsReceived",type:"number"},{key:"requestsSent",type:"number"},{key:"responsesReceived",type:"number"},{key:"responsesSent",type:"number"},{key:"retransmissionsReceived",type:"number"},{key:"retransmissionsSent",type:"number"},{key:"state",type:"string"},{key:"totalRoundTripTime",type:"number"},{key:"transportId",type:"string"},{key:"writable",type:"boolean"}].reduce(function(K,F){var V=F.key;return K[V]=typeof E[V]===F.type?E[V]:null,K},{localCandidate:Q,remoteCandidate:G})}function R(P,E,O){var A="local"===O?"getSenders":"getReceivers";if(P[A])return P[A]().map(function(M){return M.track}).filter(function(M){return M&&M.kind===E});var j="audio"===E?"getAudioTracks":"getVideoTracks";return _(P["local"===O?"getLocalStreams":"getRemoteStreams"](),function(M){return M[j]()})}function w(P,E,O){return c&&c<67?new Promise(function(A,N){P.getStats(function(j){A([u(j,E)])},null,N)}):P.getStats(E).then(function(A){return function f(P,E){var O=E.simulateExceptionWhileStandardizingStats;if(void 0!==O&&O)throw new Error("Error while gathering stats");var N=null,j=[],M=null,Q=null,G=null,K=null,F=null;P.forEach(function(J){switch(J.type){case"inbound-rtp":N=J;break;case"outbound-rtp":j.push(J);break;case"media-source":F=J;break;case"track":G=J;break;case"codec":K=J;break;case"remote-inbound-rtp":M=J;break;case"remote-outbound-rtp":Q=J}});var V=G?G.remoteSource:!F,L=[],H=V?Q:M;return(V?[N]:j).forEach(function(J){var X={},$=[J,F,G,K,H&&H.ssrc===J.ssrc?H:null];function Z(Ce){var Oe=$.find(function(Me){return Me&&typeof Me[Ce]<"u"})||null;return Oe?Oe[Ce]:null}var se=Z("ssrc");"number"==typeof se&&(X.ssrc=String(se));var le=Z("timestamp");X.timestamp=Math.round(le);var de=Z("mimeType");"string"==typeof de&&(de=de.split("/"),X.codecName=de[de.length-1]);var ve=Z("roundTripTime");"number"==typeof ve&&(X.roundTripTime=Math.round(1e3*ve));var ce=Z("jitter");"number"==typeof ce&&(X.jitter=Math.round(1e3*ce));var fe=Z("frameWidth");"number"==typeof fe&&(V?X.frameWidthReceived=fe:(X.frameWidthSent=fe,X.frameWidthInput=G?G.frameWidth:F.width));var pe=Z("frameHeight");"number"==typeof pe&&(V?X.frameHeightReceived=pe:(X.frameHeightSent=pe,X.frameHeightInput=G?G.frameHeight:F.height));var ye=Z("framesPerSecond");"number"==typeof ye&&(X[V?"frameRateReceived":"frameRateSent"]=ye);var ge=Z("bytesReceived");"number"==typeof ge&&(X.bytesReceived=ge);var ke=Z("bytesSent");"number"==typeof ke&&(X.bytesSent=ke);var Le=Z("packetsLost");"number"==typeof Le&&(X.packetsLost=Le);var we=Z("packetsReceived");"number"==typeof we&&(X.packetsReceived=we);var Y=Z("packetsSent");"number"==typeof Y&&(X.packetsSent=Y);var q=Z("audioLevel");"number"==typeof q&&(q=Math.round(32767*q),V?X.audioOutputLevel=q:X.audioInputLevel=q);var B=Z("totalPacketSendDelay");"number"==typeof B&&(X.totalPacketSendDelay=B);var I=Z("totalEncodeTime");"number"==typeof I&&(X.totalEncodeTime=I);var U=Z("framesEncoded");"number"==typeof U&&(X.framesEncoded=U);var ue=Z("estimatedPlayoutTimestamp");"number"==typeof ue&&(X.estimatedPlayoutTimestamp=ue);var ae=Z("totalDecodeTime");"number"==typeof ae&&(X.totalDecodeTime=ae);var re=Z("framesDecoded");"number"==typeof re&&(X.framesDecoded=re);var Se=Z("jitterBufferDelay");"number"==typeof Se&&(X.jitterBufferDelay=Se);var Pe=Z("jitterBufferEmittedCount");"number"==typeof Pe&&(X.jitterBufferEmittedCount=Pe),L.push(X)}),L}(A,O)})}function u(P,E){var O=P.result().find(function(N){return"ssrc"===N.type&&N.stat("googTrackId")===E.id}),A={};return O&&(A.timestamp=Math.round(Number(O.timestamp)),A=O.names().reduce(function(N,j){switch(j){case"googCodecName":N.codecName=O.stat(j);break;case"googRtt":N.roundTripTime=Number(O.stat(j));break;case"googJitterReceived":N.jitter=Number(O.stat(j));break;case"googFrameWidthInput":N.frameWidthInput=Number(O.stat(j));break;case"googFrameHeightInput":N.frameHeightInput=Number(O.stat(j));break;case"googFrameWidthSent":N.frameWidthSent=Number(O.stat(j));break;case"googFrameHeightSent":N.frameHeightSent=Number(O.stat(j));break;case"googFrameWidthReceived":N.frameWidthReceived=Number(O.stat(j));break;case"googFrameHeightReceived":N.frameHeightReceived=Number(O.stat(j));break;case"googFrameRateInput":N.frameRateInput=Number(O.stat(j));break;case"googFrameRateSent":N.frameRateSent=Number(O.stat(j));break;case"googFrameRateReceived":N.frameRateReceived=Number(O.stat(j));break;case"ssrc":N[j]=O.stat(j);break;case"bytesReceived":case"bytesSent":case"packetsLost":case"packetsReceived":case"packetsSent":case"audioInputLevel":case"audioOutputLevel":N[j]=Number(O.stat(j))}return N},A)),A}function g(P,E){void 0===P&&(P=new Map);var O=E.isRemote,A=E.simulateExceptionWhileStandardizingStats;if(void 0!==A&&A)throw new Error("Error while gathering stats");var j=null,M=null;P.forEach(function(we){var q=we.remoteId;if(!we.isRemote)switch(we.type){case"inbound-rtp":j=we,M=P.get(q);break;case"outbound-rtp":M=we,j=P.get(q)}});var Q=O?j:M,G=O?M:j;function K(we){return Q&&typeof Q[we]<"u"?Q[we]:G&&typeof G[we]<"u"?G[we]:null}var F={},V=K("timestamp");F.timestamp=Math.round(V);var D=K("ssrc");"number"==typeof D&&(F.ssrc=String(D));var L=K("bytesSent");"number"==typeof L&&(F.bytesSent=L);var H=K("packetsLost");"number"==typeof H&&(F.packetsLost=H);var J=K("packetsSent");"number"==typeof J&&(F.packetsSent=J);var X=K("roundTripTime");"number"==typeof X&&(F.roundTripTime=Math.round(1e3*X));var $=K("jitter");"number"==typeof $&&(F.jitter=Math.round(1e3*$));var Z=K("framerateMean");"number"==typeof Z&&(F.frameRateSent=Math.round(Z));var se=K("bytesReceived");"number"==typeof se&&(F.bytesReceived=se);var le=K("packetsReceived");"number"==typeof le&&(F.packetsReceived=le);var de=K("framerateMean");"number"==typeof de&&(F.frameRateReceived=Math.round(de));var ve=K("totalPacketSendDelay");"number"==typeof ve&&(F.totalPacketSendDelay=ve);var ce=K("totalEncodeTime");"number"==typeof ce&&(F.totalEncodeTime=ce);var fe=K("framesEncoded");"number"==typeof fe&&(F.framesEncoded=fe);var pe=K("estimatedPlayoutTimestamp");"number"==typeof pe&&(F.estimatedPlayoutTimestamp=pe);var ye=K("totalDecodeTime");"number"==typeof ye&&(F.totalDecodeTime=ye);var ge=K("framesDecoded");"number"==typeof ge&&(F.framesDecoded=ge);var ke=K("jitterBufferDelay");"number"==typeof ke&&(F.jitterBufferDelay=ke);var Le=K("jitterBufferEmittedCount");return"number"==typeof Le&&(F.jitterBufferEmittedCount=Le),F}C.exports=function l(P,E){return P&&"function"==typeof P.getStats?function d(P,E){var O=R(P,"audio","local"),A=R(P,"video","local"),N=R(P,"audio"),j=R(P,"video"),M={activeIceCandidatePair:null,localAudioTrackStats:[],localVideoTrackStats:[],remoteAudioTrackStats:[],remoteVideoTrackStats:[]},Q=_([[O,"localAudioTrackStats",!1],[A,"localVideoTrackStats",!1],[N,"remoteAudioTrackStats",!0],[j,"remoteVideoTrackStats",!0]],function(G){var K=S(G,3),V=K[1],D=K[2];return K[0].map(function(L){return function T(P,E,O){return void 0===O&&(O={}),typeof O.testForChrome<"u"||n?w(P,E,O):typeof O.testForFirefox<"u"||a?function m(P,E,O){return P.getStats(E).then(function(A){return[g(A,O)]})}(P,E,O):typeof O.testForSafari<"u"||s?typeof O.testForSafari<"u"||"unified"===e()?w(P,E,O):Promise.reject(new Error(["getStats() is not supported on this version of Safari","due to this bug: https://bugs.webkit.org/show_bug.cgi?id=192601"].join(" "))):Promise.reject(new Error("RTCPeerConnection#getStats() not supported"))}(P,L,Object.assign({isRemote:D},E)).then(function(H){H.forEach(function(J){J.trackId=L.id,M[V].push(J)})})})});return Promise.all(Q).then(function(){return function h(P,E){return void 0===E&&(E={}),typeof E.testForChrome<"u"||n||typeof E.testForSafari<"u"||s?P.getStats().then(k):typeof E.testForFirefox<"u"||a?P.getStats().then(b):Promise.reject(new Error("RTCPeerConnection#getStats() not supported"))}(P,E)}).then(function(G){return M.activeIceCandidatePair=G,M})}(P,E):Promise.reject(new Error("Given PeerConnection does not support getStats"))}},{"./util":170,"./util/sdp":172}],157:[function(v,C,x){"use strict";C.exports=function S(y){return void 0===y&&(y={audio:!0,video:!0}),"object"==typeof navigator&&"object"==typeof navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(y):Promise.reject(new Error("getUserMedia is not supported"))}},{}],158:[function(v,C,x){"use strict";var S={};Object.defineProperties(S,{getStats:{enumerable:!0,value:v("./getstats")},getUserMedia:{enumerable:!0,value:v("./getusermedia")},MediaStream:{enumerable:!0,value:v("./mediastream")},MediaStreamTrack:{enumerable:!0,value:v("./mediastreamtrack")},RTCIceCandidate:{enumerable:!0,value:v("./rtcicecandidate")},RTCPeerConnection:{enumerable:!0,value:v("./rtcpeerconnection")},RTCSessionDescription:{enumerable:!0,value:v("./rtcsessiondescription")}}),C.exports=S},{"./getstats":156,"./getusermedia":157,"./mediastream":159,"./mediastreamtrack":160,"./rtcicecandidate":161,"./rtcpeerconnection":164,"./rtcsessiondescription":169}],159:[function(v,C,x){"use strict";C.exports="function"==typeof MediaStream?MediaStream:function(){throw new Error("MediaStream is not supported")}},{}],160:[function(v,C,x){"use strict";C.exports="function"==typeof MediaStreamTrack?MediaStreamTrack:function(){throw new Error("MediaStreamTrack is not supported")}},{}],161:[function(v,C,x){"use strict";C.exports="function"==typeof RTCIceCandidate?RTCIceCandidate:function(){throw new Error("RTCIceCandidate is not supported")}},{}],162:[function(v,C,x){"use strict";var A,S=this&&this.__extends||(A=function(N,j){return(A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(M,Q){M.__proto__=Q}||function(M,Q){for(var G in Q)Object.prototype.hasOwnProperty.call(Q,G)&&(M[G]=Q[G])})(N,j)},function(N,j){if("function"!=typeof j&&null!==j)throw new TypeError("Class extends value "+String(j)+" is not a constructor or null");function M(){this.constructor=N}A(N,j),N.prototype=null===j?Object.create(j):(M.prototype=j.prototype,new M)}),y=this&&this.__read||function(A,N){var j="function"==typeof Symbol&&A[Symbol.iterator];if(!j)return A;var Q,K,M=j.call(A),G=[];try{for(;(void 0===N||N-- >0)&&!(Q=M.next()).done;)G.push(Q.value)}catch(F){K={error:F}}finally{try{Q&&!Q.done&&(j=M.return)&&j.call(M)}finally{if(K)throw K.error}}return G},_=this&&this.__spreadArray||function(A,N){for(var j=0,M=N.length,Q=A.length;j<M;j++,Q++)A[Q]=N[j];return A},o=v("../rtcsessiondescription/chrome"),i=v("../../eventtarget"),e=v("../util/latch"),t=v("../mediastream"),r=v("../rtcrtpsender"),n=v("../util/sdp"),a=n.getSdpFormat,s=n.updatePlanBTrackIdsToSSRCs,c=n.updateUnifiedPlanTrackIdsToSSRCs,p=v("../util"),l=p.delegateMethods,d=p.interceptEvent,h=p.isIOSChrome,k=p.legacyPromise,b=p.proxyProperties,R="unified"===a(),T=function(A){function N(j,M){void 0===j&&(j={});var Q=A.call(this)||this,G=Object.assign(j.iceTransportPolicy?{iceTransports:j.iceTransportPolicy}:{},j);d(Q,"datachannel"),d(Q,"signalingstatechange");var K=a(G.sdpSemantics),F=new RTCPeerConnection(G,M);return Object.defineProperties(Q,{_appliedTracksToSSRCs:{value:new Map,writable:!0},_localStream:{value:new t},_peerConnection:{value:F},_pendingLocalOffer:{value:null,writable:!0},_pendingRemoteOffer:{value:null,writable:!0},_rolledBackTracksToSSRCs:{value:new Map,writable:!0},_sdpFormat:{value:K},_senders:{value:new Map},_signalingStateLatch:{value:new e},_tracksToSSRCs:{value:new Map,writable:!0}}),F.addEventListener("datachannel",function(V){E(V.channel),Q.dispatchEvent(V)}),F.addEventListener("signalingstatechange",function(){for(var V=[],D=0;D<arguments.length;D++)V[D]=arguments[D];"stable"===F.signalingState&&(Q._appliedTracksToSSRCs=new Map(Q._tracksToSSRCs)),!Q._pendingLocalOffer&&!Q._pendingRemoteOffer&&Q.dispatchEvent.apply(Q,_([],y(V)))}),F.ontrack=function(){},"function"!=typeof F.addTrack&&F.addStream(Q._localStream),b(RTCPeerConnection.prototype,Q,F),Q}return S(N,A),Object.defineProperty(N.prototype,"localDescription",{get:function(){return this._pendingLocalOffer?this._pendingLocalOffer:this._peerConnection.localDescription},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"remoteDescription",{get:function(){return this._pendingRemoteOffer?this._pendingRemoteOffer:this._peerConnection.remoteDescription},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"signalingState",{get:function(){return this._pendingLocalOffer?"have-local-offer":this._pendingRemoteOffer?"have-remote-offer":this._peerConnection.signalingState},enumerable:!1,configurable:!0}),N.prototype.addTrack=function(j){for(var M,Q=[],G=1;G<arguments.length;G++)Q[G-1]=arguments[G];if("function"==typeof this._peerConnection.addTrack)return(M=this._peerConnection).addTrack.apply(M,_([j],y(Q)));if("closed"===this._peerConnection.signalingState)throw new Error("Cannot add MediaStreamTrack ["+j.id+", \n        "+j.kind+"]: RTCPeerConnection is closed");var K=this._senders.get(j);if(K&&K.track)throw new Error("Cannot add MediaStreamTrack ['"+j.id+", \n        "+j.kind+"]: RTCPeerConnection already has it");return this._peerConnection.removeStream(this._localStream),this._localStream.addTrack(j),this._peerConnection.addStream(this._localStream),K=new r(j),this._senders.set(j,K),K},N.prototype.removeTrack=function(j){if("closed"===this._peerConnection.signalingState)throw new Error("Cannot remove MediaStreamTrack: RTCPeerConnection is closed");if("function"==typeof this._peerConnection.addTrack)try{return this._peerConnection.removeTrack(j)}catch{}else{var M=j.track;if(!M)return;(j=this._senders.get(M))&&j.track&&(j.track=null,this._peerConnection.removeStream(this._localStream),this._localStream.removeTrack(M),this._peerConnection.addStream(this._localStream))}},N.prototype.getSenders=function(){return"function"==typeof this._peerConnection.addTrack?this._peerConnection.getSenders():Array.from(this._senders.values())},N.prototype.addIceCandidate=function(j){for(var M=this,Q=[],G=1;G<arguments.length;G++)Q[G-1]=arguments[G];var K;return K="have-remote-offer"===this.signalingState?this._signalingStateLatch.when("low").then(function(){return M._peerConnection.addIceCandidate(j)}):this._peerConnection.addIceCandidate(j),Q.length>0?k.apply(void 0,_([K],y(Q))):K},N.prototype.close=function(){"closed"!==this.signalingState&&(this._pendingLocalOffer=null,this._pendingRemoteOffer=null,this._peerConnection.close())},N.prototype.createAnswer=function(){for(var j=this,M=[],Q=0;Q<arguments.length;Q++)M[Q]=arguments[Q];var G;return G=this._pendingRemoteOffer?this._peerConnection.setRemoteDescription(this._pendingRemoteOffer).then(function(){return j._signalingStateLatch.lower(),j._peerConnection.createAnswer()}).then(function(K){return j._pendingRemoteOffer=null,j._rolledBackTracksToSSRCs.clear(),new o({type:"answer",sdp:O(j._sdpFormat,j._tracksToSSRCs,K.sdp)})},function(K){throw j._pendingRemoteOffer=null,K}):this._peerConnection.createAnswer().then(function(K){return j._rolledBackTracksToSSRCs.clear(),new o({type:"answer",sdp:O(j._sdpFormat,j._tracksToSSRCs,K.sdp)})}),M.length>1?k.apply(void 0,_([G],y(M))):G},N.prototype.createOffer=function(){for(var j=this,M=[],Q=0;Q<arguments.length;Q++)M[Q]=arguments[Q];var G=y(M,3),K=G[0],F=G[1],D=G[2]||K||{};if(h()){if(D.offerToReceiveVideo&&!this._audioTransceiver&&(!R||!u(this,"audio"))){delete D.offerToReceiveAudio;try{this._audioTransceiver=R?this.addTransceiver("audio",{direction:"recvonly"}):this.addTransceiver("audio")}catch(H){return Promise.reject(H)}}if(D.offerToReceiveVideo&&!this._videoTransceiver&&(!R||!u(this,"video"))){delete D.offerToReceiveVideo;try{this._videoTransceiver=R?this.addTransceiver("video",{direction:"recvonly"}):this.addTransceiver("video")}catch(H){return Promise.reject(H)}}}var L=this._peerConnection.createOffer(D).then(function(H){return j._rolledBackTracksToSSRCs.clear(),new o({type:H.type,sdp:O(j._sdpFormat,j._tracksToSSRCs,H.sdp)})});return M.length>1?k(L,K,F):L},N.prototype.createDataChannel=function(j,M){M=function P(A){return A=Object.assign({},A),g()&&"maxPacketLifeTime"in A&&(A.maxRetransmitTime=A.maxPacketLifeTime),A}(M);var Q=this._peerConnection.createDataChannel(j,M);return E(Q),Q},N.prototype.setLocalDescription=function(){for(var j=[],M=0;M<arguments.length;M++)j[M]=arguments[M];var Q=y(j,3),G=Q[0],K=Q[1],F=Q[2];this._rolledBackTracksToSSRCs.size>0&&(this._tracksToSSRCs=new Map(this._rolledBackTracksToSSRCs),this._rolledBackTracksToSSRCs.clear());var V=w(this,!0,G);return j.length>1?k(V,K,F):V},N.prototype.setRemoteDescription=function(){for(var j=[],M=0;M<arguments.length;M++)j[M]=arguments[M];var Q=y(j,3),G=Q[0],K=Q[1],F=Q[2];this._rolledBackTracksToSSRCs.clear();var V=w(this,!1,G);return j.length>1?k(V,K,F):V},N}(i);function w(A,N,j){var D,G=N?A._pendingLocalOffer:A._pendingRemoteOffer,F=N?"have-local-offer":"have-remote-offer",V=N?"setLocalDescription":"setRemoteDescription";if(!N&&(N?A._pendingRemoteOffer:A._pendingLocalOffer)&&"answer"===j.type)D=function m(A,N){return A._peerConnection.setLocalDescription(A._pendingLocalOffer).then(function(){return A._pendingLocalOffer=null,A.setRemoteDescription(N)}).then(function(){A._signalingStateLatch.lower()})}(A,j);else if("offer"===j.type){if(A.signalingState!==F&&"stable"!==A.signalingState)return Promise.reject(new Error("Cannot set "+(N?"local":"remote")+" offer in state "+A.signalingState));!G&&"low"===A._signalingStateLatch.state&&A._signalingStateLatch.raise();var L=A.signalingState;(function M(H){N?A._pendingLocalOffer=H:A._pendingRemoteOffer=H})(f(j)),D=Promise.resolve(),A.signalingState!==L&&D.then(function(){return A.dispatchEvent(new Event("signalingstatechange"))})}else"rollback"===j.type&&(A.signalingState!==F?D=Promise.reject(new Error("Cannot rollback "+(N?"local":"remote")+" description in "+A.signalingState)):(function Q(){N?A._pendingLocalOffer=null:A._pendingRemoteOffer=null}(),A._rolledBackTracksToSSRCs=new Map(A._tracksToSSRCs),A._tracksToSSRCs=new Map(A._appliedTracksToSSRCs),(D=Promise.resolve()).then(function(){return A.dispatchEvent(new Event("signalingstatechange"))})));return D||A._peerConnection[V](f(j))}function u(A,N){return!!A.getTransceivers().find(function(j){var M=j.receiver,G=(void 0===M?{}:M).track;return(void 0===G?{}:G).kind===N})}function f(A){return A instanceof o&&A._description?A._description:new RTCSessionDescription(A)}function g(){return"maxRetransmitTime"in RTCDataChannel.prototype&&!("maxPacketLifeTime"in RTCDataChannel.prototype)}function E(A){return Object.defineProperty(A,"maxRetransmits",{value:65535===A.maxRetransmits?null:A.maxRetransmits}),g()&&Object.defineProperty(A,"maxPacketLifeTime",{value:65535===A.maxRetransmitTime?null:A.maxRetransmitTime}),A}function O(A,N,j){return"unified"===A?c(N,j):s(N,j)}l(RTCPeerConnection.prototype,T.prototype,"_peerConnection"),C.exports=T},{"../../eventtarget":11,"../mediastream":159,"../rtcrtpsender":166,"../rtcsessiondescription/chrome":167,"../util":170,"../util/latch":171,"../util/sdp":172}],163:[function(v,C,x){"use strict";var h,S=this&&this.__extends||(h=function(k,b){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,T){R.__proto__=T}||function(R,T){for(var w in T)Object.prototype.hasOwnProperty.call(T,w)&&(R[w]=T[w])})(k,b)},function(k,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function R(){this.constructor=k}h(k,b),k.prototype=null===b?Object.create(b):(R.prototype=b.prototype,new R)}),y=this&&this.__read||function(h,k){var b="function"==typeof Symbol&&h[Symbol.iterator];if(!b)return h;var T,m,R=b.call(h),w=[];try{for(;(void 0===k||k-- >0)&&!(T=R.next()).done;)w.push(T.value)}catch(u){m={error:u}}finally{try{T&&!T.done&&(b=R.return)&&b.call(R)}finally{if(m)throw m.error}}return w},_=this&&this.__spreadArray||function(h,k){for(var b=0,R=k.length,T=h.length;b<R;b++,T++)h[T]=k[b];return h},o=v("../../eventtarget"),i=v("../rtcsessiondescription/firefox"),e=v("../util/sdp").updateUnifiedPlanTrackIdsToSSRCs,t=v("../util"),r=t.delegateMethods,n=t.interceptEvent,a=t.legacyPromise,s=t.proxyProperties,c=function(h){function k(b){var R=h.call(this)||this;n(R,"signalingstatechange");var w,T=new RTCPeerConnection(b);return Object.defineProperties(R,{_initiallyNegotiatedDtlsRole:{value:null,writable:!0},_isClosed:{value:!1,writable:!0},_peerConnection:{value:T},_rollingBack:{value:!1,writable:!0},_tracksToSSRCs:{value:new Map},peerIdentity:{enumerable:!0,value:Promise.resolve({idp:"",name:""})}}),T.addEventListener("signalingstatechange",function(){for(var m=[],u=0;u<arguments.length;u++)m[u]=arguments[u];!R._rollingBack&&R.signalingState!==w&&(w=R.signalingState,R._isClosed?setTimeout(function(){return R.dispatchEvent.apply(R,_([],y(m)))}):R.dispatchEvent.apply(R,_([],y(m))))}),s(RTCPeerConnection.prototype,R,T),R}return S(k,h),Object.defineProperty(k.prototype,"iceGatheringState",{get:function(){return this._isClosed?"complete":this._peerConnection.iceGatheringState},enumerable:!1,configurable:!0}),Object.defineProperty(k.prototype,"localDescription",{get:function(){return d(this._peerConnection.localDescription,this._initiallyNegotiatedDtlsRole)},enumerable:!1,configurable:!0}),Object.defineProperty(k.prototype,"signalingState",{get:function(){return this._isClosed?"closed":this._peerConnection.signalingState},enumerable:!1,configurable:!0}),k.prototype.createAnswer=function(){for(var b=this,R=[],T=0;T<arguments.length;T++)R[T]=arguments[T];var w;return w=this._peerConnection.createAnswer().then(function(m){return l(b,m),d(m,b._initiallyNegotiatedDtlsRole)}),"function"==typeof R[0]?a.apply(void 0,_([w],y(R))):w},k.prototype.createOffer=function(){for(var b=this,R=[],T=0;T<arguments.length;T++)R[T]=arguments[T];var P,w=y(R,3),m=w[0],u=w[1],g=w[2]||m||{};return P=(P="have-local-offer"===this.signalingState||"have-remote-offer"===this.signalingState?p(this,"have-local-offer"===this.signalingState,function(){return b.createOffer(g)}):this._peerConnection.createOffer(g)).then(function(O){return new i({type:O.type,sdp:e(b._tracksToSSRCs,O.sdp)})}),R.length>1?a(P,m,u):P},k.prototype.setLocalDescription=function(){for(var b,R=[],T=0;T<arguments.length;T++)R[T]=arguments[T];var f,w=y(R),m=w[0],u=w.slice(1);return m&&"answer"===m.type&&"have-local-offer"===this.signalingState&&(f=Promise.reject(new Error("Cannot set local answer in state have-local-offer"))),f?R.length>1?a.apply(void 0,_([f],y(u))):f:(b=this._peerConnection).setLocalDescription.apply(b,_([],y(R)))},k.prototype.setRemoteDescription=function(){for(var b=this,R=[],T=0;T<arguments.length;T++)R[T]=arguments[T];var f,w=y(R),m=w[0],u=w.slice(1);return m&&"have-remote-offer"===this.signalingState&&("answer"===m.type?f=Promise.reject(new Error("Cannot set remote answer in state have-remote-offer")):"offer"===m.type&&(f=p(this,!1,function(){return b._peerConnection.setRemoteDescription(m)}))),f||(f=this._peerConnection.setRemoteDescription(m)),f=f.then(function(){return l(b,m,!0)}),R.length>1?a.apply(void 0,_([f],y(u))):f},k.prototype.close=function(){"closed"!==this.signalingState&&(this._isClosed=!0,this._peerConnection.close())},k}(o);function p(h,k,b){var R=k?"setLocalDescription":"setRemoteDescription";return h._rollingBack=!0,h._peerConnection[R](new i({type:"rollback"})).then(b).then(function(T){return h._rollingBack=!1,T},function(T){throw h._rollingBack=!1,T})}function l(h,k,b){if(!h._initiallyNegotiatedDtlsRole&&"offer"!==k.type){var R=k.sdp.match(/a=setup:([a-z]+)/);if(R){var T=R[1];h._initiallyNegotiatedDtlsRole=b?{active:"passive",passive:"active"}[T]:T}}}function d(h,k){return h&&"answer"===h.type&&k?new i({type:h.type,sdp:h.sdp.replace(/a=setup:[a-z]+/g,"a=setup:"+k)}):h}r(RTCPeerConnection.prototype,c.prototype,"_peerConnection"),C.exports=c},{"../../eventtarget":11,"../rtcsessiondescription/firefox":168,"../util":170,"../util/sdp":172}],164:[function(v,C,x){"use strict";if("function"==typeof RTCPeerConnection)switch((0,v("../util").guessBrowser)()){case"chrome":C.exports=v("./chrome");break;case"firefox":C.exports=v("./firefox");break;case"safari":C.exports=v("./safari");break;default:C.exports=RTCPeerConnection}else C.exports=function(){throw new Error("RTCPeerConnection is not supported")}},{"../util":170,"./chrome":162,"./firefox":163,"./safari":165}],165:[function(v,C,x){"use strict";var w,S=this&&this.__extends||(w=function(m,u){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,g){f.__proto__=g}||function(f,g){for(var P in g)Object.prototype.hasOwnProperty.call(g,P)&&(f[P]=g[P])})(m,u)},function(m,u){if("function"!=typeof u&&null!==u)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");function f(){this.constructor=m}w(m,u),m.prototype=null===u?Object.create(u):(f.prototype=u.prototype,new f)}),y=this&&this.__read||function(w,m){var u="function"==typeof Symbol&&w[Symbol.iterator];if(!u)return w;var g,E,f=u.call(w),P=[];try{for(;(void 0===m||m-- >0)&&!(g=f.next()).done;)P.push(g.value)}catch(O){E={error:O}}finally{try{g&&!g.done&&(u=f.return)&&u.call(f)}finally{if(E)throw E.error}}return P},_=this&&this.__spreadArray||function(w,m){for(var u=0,f=m.length,g=w.length;u<f;u++,g++)w[g]=m[u];return w},o=v("../../eventtarget"),i=v("../util/latch"),e=v("../util/sdp"),t=e.getSdpFormat,r=e.updatePlanBTrackIdsToSSRCs,n=e.updateUnifiedPlanTrackIdsToSSRCs,a=v("../util"),s=a.delegateMethods,c=a.interceptEvent,p=a.proxyProperties,l="unified"===t(),d=l?n:r,h=function(w){function m(u){var f=w.call(this)||this;c(f,"datachannel"),c(f,"iceconnectionstatechange"),c(f,"signalingstatechange"),c(f,"track");var g=new RTCPeerConnection(u);return Object.defineProperties(f,{_appliedTracksToSSRCs:{value:new Map,writable:!0},_audioTransceiver:{value:null,writable:!0},_isClosed:{value:!1,writable:!0},_peerConnection:{value:g},_pendingLocalOffer:{value:null,writable:!0},_pendingRemoteOffer:{value:null,writable:!0},_rolledBackTracksToSSRCs:{value:new Map,writable:!0},_signalingStateLatch:{value:new i},_tracksToSSRCs:{value:new Map,writable:!0},_videoTransceiver:{value:null,writable:!0}}),g.addEventListener("datachannel",function(P){T(P.channel),f.dispatchEvent(P)}),g.addEventListener("iceconnectionstatechange",function(){for(var P=[],E=0;E<arguments.length;E++)P[E]=arguments[E];f._isClosed||f.dispatchEvent.apply(f,_([],y(P)))}),g.addEventListener("signalingstatechange",function(){for(var P=[],E=0;E<arguments.length;E++)P[E]=arguments[E];f._isClosed||("stable"===g.signalingState&&(f._appliedTracksToSSRCs=new Map(f._tracksToSSRCs)),!f._pendingLocalOffer&&!f._pendingRemoteOffer&&f.dispatchEvent.apply(f,_([],y(P))))}),g.addEventListener("track",function(P){f._pendingRemoteOffer=null,f.dispatchEvent(P)}),p(RTCPeerConnection.prototype,f,g),f}return S(m,w),Object.defineProperty(m.prototype,"localDescription",{get:function(){return this._pendingLocalOffer||this._peerConnection.localDescription},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"iceConnectionState",{get:function(){return this._isClosed?"closed":this._peerConnection.iceConnectionState},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"iceGatheringState",{get:function(){return this._isClosed?"complete":this._peerConnection.iceGatheringState},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"remoteDescription",{get:function(){return this._pendingRemoteOffer||this._peerConnection.remoteDescription},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"signalingState",{get:function(){return this._isClosed?"closed":this._pendingLocalOffer?"have-local-offer":this._pendingRemoteOffer?"have-remote-offer":this._peerConnection.signalingState},enumerable:!1,configurable:!0}),m.prototype.addIceCandidate=function(u){var f=this;return"have-remote-offer"===this.signalingState?this._signalingStateLatch.when("low").then(function(){return f._peerConnection.addIceCandidate(u)}):this._peerConnection.addIceCandidate(u)},m.prototype.createOffer=function(u){var f=this;if((u=Object.assign({},u)).offerToReceiveVideo&&!this._audioTransceiver&&(!l||!R(this,"audio"))){delete u.offerToReceiveAudio;try{this._audioTransceiver=l?this.addTransceiver("audio",{direction:"recvonly"}):this.addTransceiver("audio")}catch(g){return Promise.reject(g)}}if(u.offerToReceiveVideo&&!this._videoTransceiver&&(!l||!R(this,"video"))){delete u.offerToReceiveVideo;try{this._videoTransceiver=l?this.addTransceiver("video",{direction:"recvonly"}):this.addTransceiver("video")}catch(g){return Promise.reject(g)}}return this._peerConnection.createOffer(u).then(function(g){return f._rolledBackTracksToSSRCs.clear(),new RTCSessionDescription({type:g.type,sdp:d(f._tracksToSSRCs,g.sdp)})})},m.prototype.createAnswer=function(u){var f=this;return this._pendingRemoteOffer?this._peerConnection.setRemoteDescription(this._pendingRemoteOffer).then(function(){return f._signalingStateLatch.lower(),f._peerConnection.createAnswer()}).then(function(g){return f._pendingRemoteOffer=null,f._rolledBackTracksToSSRCs.clear(),l?new RTCSessionDescription({type:g.type,sdp:d(f._tracksToSSRCs,g.sdp)}):g},function(g){throw f._pendingRemoteOffer=null,g}):this._peerConnection.createAnswer(u).then(function(g){return f._rolledBackTracksToSSRCs.clear(),l?new RTCSessionDescription({type:g.type,sdp:d(f._tracksToSSRCs,g.sdp)}):g})},m.prototype.createDataChannel=function(u,f){var g=this._peerConnection.createDataChannel(u,f);return T(g),g},m.prototype.removeTrack=function(u){u.replaceTrack(null),this._peerConnection.removeTrack(u)},m.prototype.setLocalDescription=function(u){return this._rolledBackTracksToSSRCs.size>0&&(this._tracksToSSRCs=new Map(this._rolledBackTracksToSSRCs),this._rolledBackTracksToSSRCs.clear()),k(this,!0,u)},m.prototype.setRemoteDescription=function(u){return this._rolledBackTracksToSSRCs.clear(),k(this,!1,u)},m.prototype.close=function(){var u=this;this._isClosed||(this._isClosed=!0,this._peerConnection.close(),setTimeout(function(){u.dispatchEvent(new Event("iceconnectionstatechange")),u.dispatchEvent(new Event("signalingstatechange"))}))},m}(o);function k(w,m,u){var P=m?w._pendingLocalOffer:w._pendingRemoteOffer,O=m?"have-local-offer":"have-remote-offer",A=m?"setLocalDescription":"setRemoteDescription";if(!m&&(m?w._pendingRemoteOffer:w._pendingLocalOffer)&&"answer"===u.type)return function b(w,m){return w._peerConnection.setLocalDescription(w._pendingLocalOffer).then(function(){return w._pendingLocalOffer=null,w.setRemoteDescription(m)}).then(function(){return w._signalingStateLatch.lower()})}(w,u);if("offer"===u.type){if(w.signalingState!==O&&"stable"!==w.signalingState)return Promise.reject(new Error("Cannot set "+(m?"local":"remote")+"\n        offer in state "+w.signalingState));!P&&"low"===w._signalingStateLatch.state&&w._signalingStateLatch.raise();var N=w.signalingState;return function f(j){m?w._pendingLocalOffer=j:w._pendingRemoteOffer=j}(u),w.signalingState!==N?Promise.resolve().then(function(){return w.dispatchEvent(new Event("signalingstatechange"))}):Promise.resolve()}return"rollback"===u.type?w.signalingState!==O?Promise.reject(new Error("Cannot rollback \n        "+(m?"local":"remote")+" description in "+w.signalingState)):(function g(){m?w._pendingLocalOffer=null:w._pendingRemoteOffer=null}(),w._rolledBackTracksToSSRCs=new Map(w._tracksToSSRCs),w._tracksToSSRCs=new Map(w._appliedTracksToSSRCs),Promise.resolve().then(function(){return w.dispatchEvent(new Event("signalingstatechange"))})):w._peerConnection[A](u)}function R(w,m){return!!w.getTransceivers().find(function(u){var f=u.receiver,P=(void 0===f?{}:f).track;return(void 0===P?{}:P).kind===m})}function T(w){return Object.defineProperties(w,{maxPacketLifeTime:{value:65535===w.maxPacketLifeTime?null:w.maxPacketLifeTime},maxRetransmits:{value:65535===w.maxRetransmits?null:w.maxRetransmits}})}s(RTCPeerConnection.prototype,h.prototype,"_peerConnection"),C.exports=h},{"../../eventtarget":11,"../util":170,"../util/latch":171,"../util/sdp":172}],166:[function(v,C,x){"use strict";C.exports=function y(_){Object.defineProperties(this,{track:{enumerable:!0,value:_,writable:!0}})}},{}],167:[function(v,C,x){"use strict";var S=function(){function y(_){this.descriptionInitDict=_;var o=_&&"rollback"===_.type?null:new RTCSessionDescription(_);Object.defineProperties(this,{_description:{get:function(){return o}}})}return Object.defineProperty(y.prototype,"sdp",{get:function(){return this._description?this._description.sdp:this.descriptionInitDict.sdp},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"type",{get:function(){return this._description?this._description.type:this.descriptionInitDict.type},enumerable:!1,configurable:!0}),y}();C.exports=S},{}],168:[function(v,C,x){"use strict";C.exports=RTCSessionDescription},{}],169:[function(v,C,x){"use strict";if("function"==typeof RTCSessionDescription)switch((0,v("../util").guessBrowser)()){case"chrome":C.exports=v("./chrome");break;case"firefox":C.exports=v("./firefox");break;default:C.exports=RTCSessionDescription}else C.exports=function(){throw new Error("RTCSessionDescription is not supported")}},{"../util":170,"./chrome":167,"./firefox":168}],170:[function(v,C,x){"use strict";var S=this&&this.__read||function(m,u){var f="function"==typeof Symbol&&m[Symbol.iterator];if(!f)return m;var P,O,g=f.call(m),E=[];try{for(;(void 0===u||u-- >0)&&!(P=g.next()).done;)E.push(P.value)}catch(A){O={error:A}}finally{try{P&&!P.done&&(f=g.return)&&f.call(g)}finally{if(O)throw O.error}}return E},y=this&&this.__spreadArray||function(m,u){for(var f=0,g=u.length,P=m.length;f<g;f++,P++)m[P]=u[f];return m};function o(m,u,f,g){if(!(g in u)&&!g.match(/^on[a-z]+$/)){var P=!1;try{var E=Object.getOwnPropertyDescriptor(m,g);P=E&&!!E.get}catch{}if(!P){var O;try{O=typeof m[g]}catch{}"function"===O&&(u[g]=function(){return this[f][g].apply(this[f],arguments)})}}}function r(){return typeof navigator<"u"&&"string"==typeof navigator.userAgent?navigator.userAgent:null}function n(m){return typeof m>"u"&&(m=r()),/Chrome|CriOS/.test(m)?"chrome":/Firefox|FxiOS/.test(m)?"firefox":/Safari|iPhone|iPad|iPod/.test(m)?"safari":null}var R=new Map;x.clearCachedSupportedCodecs=function w(){R.clear()},x.defer=function _(){var m={};return m.promise=new Promise(function(u,f){m.resolve=u,m.reject=f}),m},x.delegateMethods=function i(m,u,f){for(var g in m)o(m,u,f,g)},x.difference=function e(m,u){m=Array.isArray(m)?new Set(m):new Set(m.values()),u=Array.isArray(u)?new Set(u):new Set(u.values());var f=new Set;return m.forEach(function(g){u.has(g)||f.add(g)}),f},x.flatMap=function t(m,u){return(m instanceof Map||m instanceof Set?Array.from(m.values()):m).reduce(function(g,P){return g.concat(u(P))},[])},x.guessBrowser=n,x.guessBrowserVersion=function a(m){typeof m>"u"&&(m=r());var u={chrome:"Chrome|CriOS",firefox:"Firefox|FxiOS",safari:"Version"}[n(m)];if(!u)return null;var f=new RegExp("("+u+")/([^\\s]+)"),P=S(m.match(f)||[],3)[2];if(!P)return null;var E=P.split(".").map(Number);return{major:isNaN(E[0])?null:E[0],minor:isNaN(E[1])?null:E[1]}},x.isCodecSupported=function T(m,u){var f=R.get(u);return f?Promise.resolve(f.has(m.toLowerCase())):function b(m){if(typeof RTCRtpSender<"u"&&"function"==typeof RTCRtpSender.getCapabilities)return Promise.resolve(new Set(RTCRtpSender.getCapabilities(m).codecs.map(function(f){return f.mimeType.split("/")[1].toLowerCase()})));if(typeof RTCPeerConnection>"u"||typeof RTCPeerConnection.prototype>"u"||"function"!=typeof RTCPeerConnection.prototype.addTransceiver||"function"!=typeof RTCPeerConnection.prototype.close||"function"!=typeof RTCPeerConnection.prototype.createOffer)return Promise.resolve(new Set);var u=new RTCPeerConnection;return u.addTransceiver(m),u.createOffer().then(function(f){var g=f.sdp;return u.close(),new Set((g.match(/^a=rtpmap:.+$/gm)||[]).map(function(P){return P.match(/^a=rtpmap:.+ ([^/]+)/)[1].toLowerCase()}))},function(){return u.close(),new Set})}(u).then(function(g){return R.set(u,g),g.has(m.toLowerCase())})},x.isIOSChrome=function s(m){return typeof m>"u"&&(m=r()),/Mobi/.test(m)&&"chrome"===n()&&/iPad|iPhone|iPod/.test(m)},x.interceptEvent=function c(m,u){var f=null;Object.defineProperty(m,"on"+u,{get:function(){return f},set:function(g){f&&this.removeEventListener(u,f),"function"==typeof g?this.addEventListener(u,f=g):f=null}})},x.legacyPromise=function p(m,u,f){return u?m.then(u,f):m},x.makeUUID=function l(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(m){var u=16*Math.random()|0;return("x"===m?u:3&u|8).toString(16)})},x.proxyProperties=function d(m,u,f){Object.getOwnPropertyNames(m).forEach(function(g){!function h(m,u,f,g){if(!(g in u)){if(g.match(/^on[a-z]+$/))return Object.defineProperty(u,g,{value:null,writable:!0}),void f.addEventListener(g.slice(2),function(){for(var P=[],E=0;E<arguments.length;E++)P[E]=arguments[E];return u.dispatchEvent.apply(u,y([],S(P)))});Object.defineProperty(u,g,{enumerable:!0,get:function(){return f[g]}})}}(0,u,f,g)})},x.support=function k(){return"object"==typeof navigator&&"object"==typeof navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.getUserMedia&&"function"==typeof RTCPeerConnection}},{}],171:[function(v,C,x){"use strict";var S=v("./").defer,y={high:new Set(["low"]),low:new Set(["high"])},_=function(){function i(e){void 0===e&&(e="low");var t=e;Object.defineProperties(this,{_state:{set:function(r){var n=this;if(t!==r){var a=this._whenDeferreds.get(t=r);a.forEach(function(s){return s.resolve(n)}),a.clear()}},get:function(){return t}},_whenDeferreds:{value:new Map([["high",new Set],["low",new Set]])}})}return Object.defineProperty(i.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),i.prototype.lower=function(){return this.transition("low")},i.prototype.raise=function(){return this.transition("high")},i.prototype.transition=function(e){if(!y[this.state].has(e))throw o(this.state,e);return this._state=e,this},i.prototype.when=function(e){if(this.state===e)return Promise.resolve(this);if(!y[this.state].has(e))return Promise.reject(o(this.state,e));var t=S();return this._whenDeferreds.get(e).add(t),t.promise},i}();function o(i,e){return new Error('Cannot transition from "'+i+'" to "'+e+'"')}C.exports=_},{"./":170}],172:[function(v,C,x){"use strict";var S=v("./"),y=S.flatMap,_=S.guessBrowser,o=null,e=null;function n(P){return P&&function i(){if("boolean"==typeof o)return o;if(typeof RTCPeerConnection>"u")return o=!1;try{new RTCPeerConnection({sdpSemantics:"foo"}),o=!1}catch{o=!0}return o}()?{"plan-b":"planb","unified-plan":"unified"}[P]:function r(){if(!e)if(typeof RTCPeerConnection<"u"&&"addTransceiver"in RTCPeerConnection.prototype){var P=new RTCPeerConnection;try{P.addTransceiver("audio"),e="unified"}catch{e="planb"}P.close()}else e="planb";return e}()}function c(P,E){return(E.match(new RegExp(P,"gm"))||[]).reduce(function(A,N){var j=N.match(new RegExp(P));return j?A.add(j[1]):A},new Set)}function p(P,E){return c(P,E)}function l(P){return p("^a=ssrc:[0-9]+ +msid:.+ +(.+) *$",P)}function d(P){return p("^a=msid:.+ +(.+) *$",P)}function h(P,E){return c("^a=ssrc:([0-9]+) +msid:[^ ]+ +"+E+" *$",P)}function k(P,E,O){return void 0===E&&(E=".*"),void 0===O&&(O=".*"),P.split("\r\nm=").slice(1).map(function(A){return"m="+A}).filter(function(A){var N=new RegExp("m="+E,"gm"),j=new RegExp("a="+O,"gm");return N.test(A)&&j.test(A)})}function b(P){return Array.from(c("^a=ssrc:([0-9]+) +.*$",P))}function R(P,E){var O=k(P),A=new RegExp("^a=msid:[^ ]+ +"+E+" *$","gm"),N=O.filter(function(j){return j.match(A)});return new Set(y(N,b))}function T(P,E,O){return new Map(Array.from(P(O)).map(function(A){return[A,E(O,A)]}))}function w(P){return T(l,h,P)}function m(P){return T(d,R,P)}function u(P,E,O){var A=P(O),N=new Map;A.forEach(function(Q,G){if(E.has(G)){var K=Array.from(E.get(G)),F=Array.from(Q);K.forEach(function(V,D){var L=F[D];N.set(L,V);var J="a=ssrc:"+V+" $1";O=O.replace(new RegExp("^a=ssrc:"+L+" (.*)$","gm"),J)})}else E.set(G,Q)});var j="^(a=ssrc-group:[^ ]+ +)(.*)$";return(O.match(new RegExp(j,"gm"))||[]).forEach(function(Q){var G=Q.match(new RegExp(j));if(G){var K=G[1],V=G[2].split(" ").map(function(D){return N.get(D)||D}).join(" ");O=O.replace(G[0],K+V)}}),O}x.clearChromeCachedSdpFormat=function t(){e=null},x.getSdpFormat=function s(P){return{chrome:n(P),firefox:"unified",safari:typeof RTCRtpTransceiver<"u"&&"currentDirection"in RTCRtpTransceiver.prototype?"unified":"planb"}[_()]||null},x.getMediaSections=k,x.getPlanBTrackIds=l,x.getUnifiedPlanTrackIds=d,x.getPlanBSSRCs=h,x.getUnifiedPlanSSRCs=R,x.updatePlanBTrackIdsToSSRCs=function f(P,E){return u(w,P,E)},x.updateUnifiedPlanTrackIdsToSSRCs=function g(P,E){return u(m,P,E)}},{"./":170}],173:[function(v,C,x){"use strict";var _,S="object"==typeof Reflect?Reflect:null,y=S&&"function"==typeof S.apply?S.apply:function(m,u,f){return Function.prototype.apply.call(m,u,f)};_=S&&"function"==typeof S.ownKeys?S.ownKeys:Object.getOwnPropertySymbols?function(m){return Object.getOwnPropertyNames(m).concat(Object.getOwnPropertySymbols(m))}:function(m){return Object.getOwnPropertyNames(m)};var i=Number.isNaN||function(m){return m!=m};function e(){e.init.call(this)}C.exports=e,C.exports.once=function b(w,m){return new Promise(function(u,f){function g(E){w.removeListener(m,P),f(E)}function P(){"function"==typeof w.removeListener&&w.removeListener("error",g),u([].slice.call(arguments))}T(w,m,P,{once:!0}),"error"!==m&&function R(w,m,u){"function"==typeof w.on&&T(w,"error",m,u)}(w,g,{once:!0})})},e.EventEmitter=e,e.prototype._events=void 0,e.prototype._eventsCount=0,e.prototype._maxListeners=void 0;var t=10;function r(w){if("function"!=typeof w)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof w)}function n(w){return void 0===w._maxListeners?e.defaultMaxListeners:w._maxListeners}function a(w,m,u,f){var g,P,E;if(r(u),void 0===(P=w._events)?(P=w._events=Object.create(null),w._eventsCount=0):(void 0!==P.newListener&&(w.emit("newListener",m,u.listener?u.listener:u),P=w._events),E=P[m]),void 0===E)E=P[m]=u,++w._eventsCount;else if("function"==typeof E?E=P[m]=f?[u,E]:[E,u]:f?E.unshift(u):E.push(u),(g=n(w))>0&&E.length>g&&!E.warned){E.warned=!0;var O=new Error("Possible EventEmitter memory leak detected. "+E.length+" "+String(m)+" listeners added. Use emitter.setMaxListeners() to increase limit");O.name="MaxListenersExceededWarning",O.emitter=w,O.type=m,O.count=E.length,function o(w){console&&console.warn&&console.warn(w)}(O)}return w}function s(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function c(w,m,u){var f={fired:!1,wrapFn:void 0,target:w,type:m,listener:u},g=s.bind(f);return g.listener=u,f.wrapFn=g,g}function p(w,m,u){var f=w._events;if(void 0===f)return[];var g=f[m];return void 0===g?[]:"function"==typeof g?u?[g.listener||g]:[g]:u?function k(w){for(var m=new Array(w.length),u=0;u<m.length;++u)m[u]=w[u].listener||w[u];return m}(g):d(g,g.length)}function l(w){var m=this._events;if(void 0!==m){var u=m[w];if("function"==typeof u)return 1;if(void 0!==u)return u.length}return 0}function d(w,m){for(var u=new Array(m),f=0;f<m;++f)u[f]=w[f];return u}function T(w,m,u,f){if("function"==typeof w.on)f.once?w.once(m,u):w.on(m,u);else{if("function"!=typeof w.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof w);w.addEventListener(m,function g(P){f.once&&w.removeEventListener(m,g),u(P)})}}Object.defineProperty(e,"defaultMaxListeners",{enumerable:!0,get:function(){return t},set:function(w){if("number"!=typeof w||w<0||i(w))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+w+".");t=w}}),e.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},e.prototype.setMaxListeners=function(m){if("number"!=typeof m||m<0||i(m))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+m+".");return this._maxListeners=m,this},e.prototype.getMaxListeners=function(){return n(this)},e.prototype.emit=function(m){for(var u=[],f=1;f<arguments.length;f++)u.push(arguments[f]);var g="error"===m,P=this._events;if(void 0!==P)g=g&&void 0===P.error;else if(!g)return!1;if(g){var E;if(u.length>0&&(E=u[0]),E instanceof Error)throw E;var O=new Error("Unhandled error."+(E?" ("+E.message+")":""));throw O.context=E,O}var A=P[m];if(void 0===A)return!1;if("function"==typeof A)y(A,this,u);else{var N=A.length,j=d(A,N);for(f=0;f<N;++f)y(j[f],this,u)}return!0},e.prototype.on=e.prototype.addListener=function(m,u){return a(this,m,u,!1)},e.prototype.prependListener=function(m,u){return a(this,m,u,!0)},e.prototype.once=function(m,u){return r(u),this.on(m,c(this,m,u)),this},e.prototype.prependOnceListener=function(m,u){return r(u),this.prependListener(m,c(this,m,u)),this},e.prototype.off=e.prototype.removeListener=function(m,u){var f,g,P,E,O;if(r(u),void 0===(g=this._events))return this;if(void 0===(f=g[m]))return this;if(f===u||f.listener===u)0==--this._eventsCount?this._events=Object.create(null):(delete g[m],g.removeListener&&this.emit("removeListener",m,f.listener||u));else if("function"!=typeof f){for(P=-1,E=f.length-1;E>=0;E--)if(f[E]===u||f[E].listener===u){O=f[E].listener,P=E;break}if(P<0)return this;0===P?f.shift():function h(w,m){for(;m+1<w.length;m++)w[m]=w[m+1];w.pop()}(f,P),1===f.length&&(g[m]=f[0]),void 0!==g.removeListener&&this.emit("removeListener",m,O||u)}return this},e.prototype.removeAllListeners=function(m){var u,f,g;if(void 0===(f=this._events))return this;if(void 0===f.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==f[m]&&(0==--this._eventsCount?this._events=Object.create(null):delete f[m]),this;if(0===arguments.length){var E,P=Object.keys(f);for(g=0;g<P.length;++g)"removeListener"!==(E=P[g])&&this.removeAllListeners(E);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(u=f[m]))this.removeListener(m,u);else if(void 0!==u)for(g=u.length-1;g>=0;g--)this.removeListener(m,u[g]);return this},e.prototype.listeners=function(m){return p(this,m,!0)},e.prototype.rawListeners=function(m){return p(this,m,!1)},e.listenerCount=function(w,m){return"function"==typeof w.listenerCount?w.listenerCount(m):l.call(w,m)},e.prototype.listenerCount=l,e.prototype.eventNames=function(){return this._eventsCount>0?_(this._events):[]}},{}],174:[function(v,C,x){C.exports={name:"twilio-video",title:"Twilio Video",description:"Twilio Video JavaScript Library",version:"2.28.1",homepage:"https://twilio.com",author:"Mark Andrus Roberts <mroberts@twilio.com>",contributors:["Ryan Rowland <rrowland@twilio.com>","Manjesh Malavalli <mmalavalli@twilio.com>","Makarand Patwardhan <mpatwardhan@twilio.com>"],keywords:["twilio","webrtc","library","javascript","video","rooms"],repository:{type:"git",url:"https://github.com/twilio/twilio-video.js.git"},devDependencies:{"@babel/core":"^7.14.2","@babel/plugin-proposal-class-properties":"^7.18.6","@babel/plugin-proposal-object-rest-spread":"^7.20.7","@babel/preset-env":"^7.14.2","@babel/preset-typescript":"^7.13.0","@types/express":"^4.11.0","@types/node":"^8.5.1","@types/selenium-webdriver":"^3.0.8","@types/ws":"^3.2.1","@typescript-eslint/eslint-plugin":"^4.13.0","@typescript-eslint/parser":"^4.0.0","babel-cli":"^6.26.0","babel-preset-es2015":"^6.24.1",browserify:"^17.0.0",cheerio:"^0.22.0",cors:"^2.8.5",electron:"^17.2.0",envify:"^4.0.0",eslint:"^6.2.1","eslint-config-standard":"^14.0.0","eslint-plugin-import":"^2.18.2","eslint-plugin-node":"^9.1.0","eslint-plugin-promise":"^4.2.1","eslint-plugin-standard":"^4.0.1",express:"^4.16.2",glob:"^7.1.7","ink-docstrap":"^1.3.2",inquirer:"^7.0.0","is-docker":"^2.0.0",jsdoc:"^3.5.5","jsdoc-babel":"^0.5.0","json-loader":"^0.5.7",karma:"6.4.1","karma-browserify":"^8.0.0","karma-chrome-launcher":"^2.0.0","karma-edgium-launcher":"^4.0.0-0","karma-electron":"^6.1.0","karma-firefox-launcher":"^1.3.0","karma-htmlfile-reporter":"^0.3.8","karma-junit-reporter":"^1.2.0","karma-mocha":"^1.3.0","karma-safari-launcher":"^1.0.0","karma-spec-reporter":"0.0.32","karma-typescript":"^5.5.1","karma-typescript-es6-transform":"^5.5.1",mocha:"^3.2.0","mock-require":"^3.0.3",ncp:"^2.0.0","node-http-server":"^8.1.2","npm-run-all":"^4.0.2",nyc:"^15.1.0",requirejs:"^2.3.3",rimraf:"^2.6.1","simple-git":"^1.126.0",sinon:"^4.0.1","ts-node":"4.0.1",tslint:"5.8.0",twilio:"^3.49.0","twilio-release-tool":"^1.0.2",typescript:"4.2.2","uglify-js":"^2.8.22","vinyl-fs":"^2.4.4","vinyl-source-stream":"^1.1.0",watchify:"^3.11.1","webrtc-adapter":"^7.7.1"},engines:{node:">=0.12"},license:"BSD-3-Clause",main:"./es5/index.js",types:"./tsdef/index.d.ts",scripts:{"lint:js":"eslint ./lib ./test/*.js ./docker/**/*.js ./test/framework/*.js ./test/lib/*.js ./test/integration/** ./test/unit/** ","lint:ts":"eslint ./tsdef/*.ts ./lib/**/*.ts",lint:"npm-run-all lint:js lint:ts",printVersion:"node --version && npm --version","test:unit":"npm-run-all printVersion build:es5 && nyc --report-dir=./coverage --include=lib/**/* --reporter=html --reporter=lcov --reporter=text mocha -r ts-node/register ./test/unit/*","test:unit:quick":"nyc --report-dir=./coverage --include=lib/**/* --reporter=html --reporter=lcov mocha -r ts-node/register","test:serversiderender":"mocha ./test/serversiderender/index.js","test:integration:adapter":"node ./scripts/karma.js karma/integration.adapter.conf.js","test:integration":"npm run build:es5 && node ./scripts/karma.js karma/integration.conf.js","test:umd:install":"npm install puppeteer@19.2.2","test:umd":"mocha ./test/umd/index.js","test:crossbrowser:build:clean":"rimraf ./test/crossbrowser/lib ./test/crossbrowser/src/browser/index.js","test:crossbrowser:build:lint":"cd ./test/crossbrowser && tslint --project tsconfig.json","test:crossbrowser:build:tsc":"cd ./test/crossbrowser && tsc","test:crossbrowser:build:browser":"cd ./test/crossbrowser && browserify lib/crossbrowser/src/browser/index.js > src/browser/index.js","test:crossbrowser:build":"npm-run-all test:crossbrowser:build:*","test:crossbrowser:test":"cd ./test/crossbrowser && mocha --compilers ts:ts-node/register test/integration/spec/**/*.ts","test:crossbrowser":"npm-run-all test:crossbrowser:*","test:sdkdriver:build:clean":"rimraf ./test/lib/sdkdriver/lib ./test/lib/sdkdriver/test/integration/browser/index.js","test:sdkdriver:build:lint":"cd ./test/lib/sdkdriver && tslint --project tsconfig.json","test:sdkdriver:build:tsc":"cd ./test/lib/sdkdriver && tsc --rootDir src","test:sdkdriver:build":"npm-run-all test:sdkdriver:build:*","test:sdkdriver:test:unit":"cd ./test/lib/sdkdriver && mocha --compilers ts:ts-node/register test/unit/spec/**/*.ts","test:sdkdriver:test:integration:browser":"cd ./test/lib/sdkdriver/test/integration && browserify browser/browser.js > browser/index.js","test:sdkdriver:test:integration:run":"cd ./test/lib/sdkdriver && mocha --compilers ts:ts-node/register test/integration/spec/**/*.ts","test:sdkdriver:test:integration":"npm-run-all test:sdkdriver:test:integration:*","test:sdkdriver:test":"npm-run-all test:sdkdriver:test:*","test:sdkdriver":"npm-run-all test:sdkdriver:*","test:framework:angular:install":"cd ./test/framework/twilio-video-angular && rimraf ./node_modules package-lock.json && npm install","test:framework:angular:run":"mocha ./test/framework/twilio-video-angular.js","test:framework:angular":"npm-run-all test:framework:angular:*","test:framework:no-framework:run":"mocha ./test/framework/twilio-video-no-framework.js","test:framework:no-framework":"npm-run-all test:framework:no-framework:*","test:framework:react:install":"cd ./test/framework/twilio-video-react && rimraf ./node_modules package-lock.json && npm install","test:framework:react:test":"node ./scripts/framework.js twilio-video-react","test:framework:react:build":"cd ./test/framework/twilio-video-react && npm run build","test:framework:react:run":"mocha ./test/framework/twilio-video-react.js","test:framework:react":"npm-run-all test:framework:react:*","test:framework:install":"npm install chromedriver && npm install selenium-webdriver && npm install geckodriver && npm install puppeteer","test:framework":"npm-run-all test:framework:install test:framework:no-framework test:framework:react",test:"npm-run-all test:unit test:integration","build:es5":"rimraf ./es5 && mkdir -p es5 && tsc tsdef/twilio-video-tests.ts --noEmit --lib es2018,dom && tsc","build:js":"node ./scripts/build.js ./src/twilio-video.js ./LICENSE.md ./dist/twilio-video.js","build:min.js":'uglifyjs ./dist/twilio-video.js -o ./dist/twilio-video.min.js --comments "/^! twilio-video.js/" -b beautify=false,ascii_only=true',build:"npm-run-all clean lint docs test:unit test:integration build:es5 build:js build:min.js test:umd","build:quick":"npm-run-all clean lint docs build:es5 build:js build:min.js",docs:"node ./scripts/docs.js ./dist/docs",watch:"tsc -w",clean:"rimraf ./coverage ./es5 ./dist"},dependencies:{events:"^3.3.0",util:"^0.12.4",ws:"^7.4.6",xmlhttprequest:"^1.8.0"},browser:{ws:"./src/ws.js",xmlhttprequest:"./src/xmlhttprequest.js"}}},{}],175:[function(v,C,x){C.exports=WebSocket},{}]},{},[12]),Ne=Fe(12);if("function"==typeof define&&define.amd)define([],function(){return Ne});else{var Ve=De.Twilio=De.Twilio||{};Ve.Video=Ve.Video||Ne}}(typeof window<"u"?window:typeof global<"u"?global:this);